{"version":3,"names":["require","getWindow","UI","TrackChanges","Symbol","isReact17Element","element","Object","getOwnPropertyNames","some","k","startsWith","REACT_VERSION","startTrackValue","previousValue","String","value","tracked","trackOrSetValue","v","_element_TrackChanges_tracked","_element_TrackChanges","undefined","push","setUIValueClean","setUISelection","focusOffset","length","commitValueAfterInput","cursorOffset","_changes_tracked","changes","isJustReactStateUpdate","hasUISelection","exports"],"sources":["trackValue.js"],"sourcesContent":["'use strict';\n\nrequire('../utils/dataTransfer/Clipboard.js');\nvar getWindow = require('../utils/misc/getWindow.js');\nvar UI = require('./UI.js');\n\nconst TrackChanges = Symbol('Track programmatic changes for React workaround');\n// When the input event happens in the browser, React executes all event handlers\n// and if they change state of a controlled value, nothing happens.\n// But when we trigger the event handlers in test environment with React@17,\n// the changes are rolled back before the state update is applied.\n// This results in a reset cursor.\n// There might be a better way to work around if we figure out\n// why the batched update is executed differently in our test environment.\nfunction isReact17Element(element) {\n    return Object.getOwnPropertyNames(element).some((k)=>k.startsWith('__react')) && getWindow.getWindow(element).REACT_VERSION === 17;\n}\nfunction startTrackValue(element) {\n    if (!isReact17Element(element)) {\n        return;\n    }\n    element[TrackChanges] = {\n        previousValue: String(element.value),\n        tracked: []\n    };\n}\nfunction trackOrSetValue(element, v) {\n    var _element_TrackChanges_tracked, _element_TrackChanges;\n    (_element_TrackChanges = element[TrackChanges]) === null || _element_TrackChanges === undefined ? undefined : (_element_TrackChanges_tracked = _element_TrackChanges.tracked) === null || _element_TrackChanges_tracked === undefined ? undefined : _element_TrackChanges_tracked.push(v);\n    if (!element[TrackChanges]) {\n        UI.setUIValueClean(element);\n        UI.setUISelection(element, {\n            focusOffset: v.length\n        });\n    }\n}\nfunction commitValueAfterInput(element, cursorOffset) {\n    var _changes_tracked;\n    const changes = element[TrackChanges];\n    element[TrackChanges] = undefined;\n    if (!(changes === null || changes === undefined ? undefined : (_changes_tracked = changes.tracked) === null || _changes_tracked === undefined ? undefined : _changes_tracked.length)) {\n        return;\n    }\n    const isJustReactStateUpdate = changes.tracked.length === 2 && changes.tracked[0] === changes.previousValue && changes.tracked[1] === element.value;\n    if (!isJustReactStateUpdate) {\n        UI.setUIValueClean(element);\n    }\n    if (UI.hasUISelection(element)) {\n        UI.setUISelection(element, {\n            focusOffset: isJustReactStateUpdate ? cursorOffset : element.value.length\n        });\n    }\n}\n\nexports.commitValueAfterInput = commitValueAfterInput;\nexports.startTrackValue = startTrackValue;\nexports.trackOrSetValue = trackOrSetValue;\n"],"mappings":"AAAA,YAAY;;AAEZA,OAAO,CAAC,oCAAoC,CAAC;AAC7C,IAAIC,SAAS,GAAGD,OAAO,CAAC,4BAA4B,CAAC;AACrD,IAAIE,EAAE,GAAGF,OAAO,CAAC,SAAS,CAAC;AAE3B,MAAMG,YAAY,GAAGC,MAAM,CAAC,iDAAiD,CAAC;AAC9E;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASC,gBAAgBA,CAACC,OAAO,EAAE;EAC/B,OAAOC,MAAM,CAACC,mBAAmB,CAACF,OAAO,CAAC,CAACG,IAAI,CAAEC,CAAC,IAAGA,CAAC,CAACC,UAAU,CAAC,SAAS,CAAC,CAAC,IAAIV,SAAS,CAACA,SAAS,CAACK,OAAO,CAAC,CAACM,aAAa,KAAK,EAAE;AACtI;AACA,SAASC,eAAeA,CAACP,OAAO,EAAE;EAC9B,IAAI,CAACD,gBAAgB,CAACC,OAAO,CAAC,EAAE;IAC5B;EACJ;EACAA,OAAO,CAACH,YAAY,CAAC,GAAG;IACpBW,aAAa,EAAEC,MAAM,CAACT,OAAO,CAACU,KAAK,CAAC;IACpCC,OAAO,EAAE;EACb,CAAC;AACL;AACA,SAASC,eAAeA,CAACZ,OAAO,EAAEa,CAAC,EAAE;EACjC,IAAIC,6BAA6B,EAAEC,qBAAqB;EACxD,CAACA,qBAAqB,GAAGf,OAAO,CAACH,YAAY,CAAC,MAAM,IAAI,IAAIkB,qBAAqB,KAAKC,SAAS,GAAGA,SAAS,GAAG,CAACF,6BAA6B,GAAGC,qBAAqB,CAACJ,OAAO,MAAM,IAAI,IAAIG,6BAA6B,KAAKE,SAAS,GAAGA,SAAS,GAAGF,6BAA6B,CAACG,IAAI,CAACJ,CAAC,CAAC;EACzR,IAAI,CAACb,OAAO,CAACH,YAAY,CAAC,EAAE;IACxBD,EAAE,CAACsB,eAAe,CAAClB,OAAO,CAAC;IAC3BJ,EAAE,CAACuB,cAAc,CAACnB,OAAO,EAAE;MACvBoB,WAAW,EAAEP,CAAC,CAACQ;IACnB,CAAC,CAAC;EACN;AACJ;AACA,SAASC,qBAAqBA,CAACtB,OAAO,EAAEuB,YAAY,EAAE;EAClD,IAAIC,gBAAgB;EACpB,MAAMC,OAAO,GAAGzB,OAAO,CAACH,YAAY,CAAC;EACrCG,OAAO,CAACH,YAAY,CAAC,GAAGmB,SAAS;EACjC,IAAI,EAAES,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAKT,SAAS,GAAGA,SAAS,GAAG,CAACQ,gBAAgB,GAAGC,OAAO,CAACd,OAAO,MAAM,IAAI,IAAIa,gBAAgB,KAAKR,SAAS,GAAGA,SAAS,GAAGQ,gBAAgB,CAACH,MAAM,CAAC,EAAE;IAClL;EACJ;EACA,MAAMK,sBAAsB,GAAGD,OAAO,CAACd,OAAO,CAACU,MAAM,KAAK,CAAC,IAAII,OAAO,CAACd,OAAO,CAAC,CAAC,CAAC,KAAKc,OAAO,CAACjB,aAAa,IAAIiB,OAAO,CAACd,OAAO,CAAC,CAAC,CAAC,KAAKX,OAAO,CAACU,KAAK;EACnJ,IAAI,CAACgB,sBAAsB,EAAE;IACzB9B,EAAE,CAACsB,eAAe,CAAClB,OAAO,CAAC;EAC/B;EACA,IAAIJ,EAAE,CAAC+B,cAAc,CAAC3B,OAAO,CAAC,EAAE;IAC5BJ,EAAE,CAACuB,cAAc,CAACnB,OAAO,EAAE;MACvBoB,WAAW,EAAEM,sBAAsB,GAAGH,YAAY,GAAGvB,OAAO,CAACU,KAAK,CAACW;IACvE,CAAC,CAAC;EACN;AACJ;AAEAO,OAAO,CAACN,qBAAqB,GAAGA,qBAAqB;AACrDM,OAAO,CAACrB,eAAe,GAAGA,eAAe;AACzCqB,OAAO,CAAChB,eAAe,GAAGA,eAAe","ignoreList":[]}