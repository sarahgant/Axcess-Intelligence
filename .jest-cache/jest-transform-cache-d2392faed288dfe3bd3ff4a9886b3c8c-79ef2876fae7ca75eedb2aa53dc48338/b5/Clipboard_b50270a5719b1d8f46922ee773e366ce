18b977bd56ff2524ce55c17779e9813f
'use strict';

var getWindow = require('../misc/getWindow.js');
var Blob = require('./Blob.js');
var DataTransfer = require('./DataTransfer.js');

// Clipboard is not available in jsdom
function _define_property(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }
  return obj;
}
// MDN lists string|Blob|Promise<Blob|string> as possible types in ClipboardItemData
// lib.dom.d.ts lists only Promise<Blob|string>
// https://developer.mozilla.org/en-US/docs/Web/API/ClipboardItem/ClipboardItem#syntax
function createClipboardItem(window, ...blobs) {
  const dataMap = Object.fromEntries(blobs.map(b => [typeof b === 'string' ? 'text/plain' : b.type, Promise.resolve(b)]));
  // use real ClipboardItem if available
  /* istanbul ignore if */
  if (typeof window.ClipboardItem !== 'undefined') {
    return new window.ClipboardItem(dataMap);
  }
  return new class ClipboardItem {
    get types() {
      return Array.from(Object.keys(this.data));
    }
    async getType(type) {
      const value = await this.data[type];
      if (!value) {
        throw new Error(`${type} is not one of the available MIME types on this item.`);
      }
      return value instanceof window.Blob ? value : new window.Blob([value], {
        type
      });
    }
    constructor(d) {
      _define_property(this, "data", undefined);
      this.data = d;
    }
  }(dataMap);
}
const ClipboardStubControl = Symbol('Manage ClipboardSub');
function createClipboardStub(window, control) {
  return Object.assign(new class Clipboard extends window.EventTarget {
    async read() {
      return Array.from(this.items);
    }
    async readText() {
      let text = '';
      for (const item of this.items) {
        const type = item.types.includes('text/plain') ? 'text/plain' : item.types.find(t => t.startsWith('text/'));
        if (type) {
          text += await item.getType(type).then(b => Blob.readBlobText(b, window.FileReader));
        }
      }
      return text;
    }
    async write(data) {
      this.items = data;
    }
    async writeText(text) {
      this.items = [createClipboardItem(window, text)];
    }
    constructor(...args) {
      super(...args), _define_property(this, "items", []);
    }
  }(), {
    [ClipboardStubControl]: control
  });
}
function isClipboardStub(clipboard) {
  return !!(clipboard === null || clipboard === undefined ? undefined : clipboard[ClipboardStubControl]);
}
function attachClipboardStubToView(window) {
  if (isClipboardStub(window.navigator.clipboard)) {
    return window.navigator.clipboard[ClipboardStubControl];
  }
  const realClipboard = Object.getOwnPropertyDescriptor(window.navigator, 'clipboard');
  let stub;
  const control = {
    resetClipboardStub: () => {
      stub = createClipboardStub(window, control);
    },
    detachClipboardStub: () => {
      /* istanbul ignore if */if (realClipboard) {
        Object.defineProperty(window.navigator, 'clipboard', realClipboard);
      } else {
        Object.defineProperty(window.navigator, 'clipboard', {
          value: undefined,
          configurable: true
        });
      }
    }
  };
  stub = createClipboardStub(window, control);
  Object.defineProperty(window.navigator, 'clipboard', {
    get: () => stub,
    configurable: true
  });
  return stub[ClipboardStubControl];
}
function resetClipboardStubOnView(window) {
  if (isClipboardStub(window.navigator.clipboard)) {
    window.navigator.clipboard[ClipboardStubControl].resetClipboardStub();
  }
}
function detachClipboardStubFromView(window) {
  if (isClipboardStub(window.navigator.clipboard)) {
    window.navigator.clipboard[ClipboardStubControl].detachClipboardStub();
  }
}
async function readDataTransferFromClipboard(document) {
  const window = document.defaultView;
  const clipboard = window === null || window === undefined ? undefined : window.navigator.clipboard;
  const items = clipboard && (await clipboard.read());
  if (!items) {
    throw new Error('The Clipboard API is unavailable.');
  }
  const dt = DataTransfer.createDataTransfer(window);
  for (const item of items) {
    for (const type of item.types) {
      dt.setData(type, await item.getType(type).then(b => Blob.readBlobText(b, window.FileReader)));
    }
  }
  return dt;
}
async function writeDataTransferToClipboard(document, clipboardData) {
  const window = getWindow.getWindow(document);
  const clipboard = window.navigator.clipboard;
  const items = [];
  for (let i = 0; i < clipboardData.items.length; i++) {
    const dtItem = clipboardData.items[i];
    const blob = await DataTransfer.getBlobFromDataTransferItem(window, dtItem);
    items.push(createClipboardItem(window, blob));
  }
  const written = clipboard && (await clipboard.write(items).then(() => true,
  // Can happen with other implementations that e.g. require permissions
  /* istanbul ignore next */
  () => false));
  if (!written) {
    throw new Error('The Clipboard API is unavailable.');
  }
}
const g = globalThis;
/* istanbul ignore else */
if (typeof g.afterEach === 'function') {
  g.afterEach(() => resetClipboardStubOnView(globalThis.window));
}
/* istanbul ignore else */
if (typeof g.afterAll === 'function') {
  g.afterAll(() => detachClipboardStubFromView(globalThis.window));
}
exports.attachClipboardStubToView = attachClipboardStubToView;
exports.createClipboardItem = createClipboardItem;
exports.detachClipboardStubFromView = detachClipboardStubFromView;
exports.readDataTransferFromClipboard = readDataTransferFromClipboard;
exports.resetClipboardStubOnView = resetClipboardStubOnView;
exports.writeDataTransferToClipboard = writeDataTransferToClipboard;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJnZXRXaW5kb3ciLCJyZXF1aXJlIiwiQmxvYiIsIkRhdGFUcmFuc2ZlciIsIl9kZWZpbmVfcHJvcGVydHkiLCJvYmoiLCJrZXkiLCJ2YWx1ZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiY3JlYXRlQ2xpcGJvYXJkSXRlbSIsIndpbmRvdyIsImJsb2JzIiwiZGF0YU1hcCIsImZyb21FbnRyaWVzIiwibWFwIiwiYiIsInR5cGUiLCJQcm9taXNlIiwicmVzb2x2ZSIsIkNsaXBib2FyZEl0ZW0iLCJ0eXBlcyIsIkFycmF5IiwiZnJvbSIsImtleXMiLCJkYXRhIiwiZ2V0VHlwZSIsIkVycm9yIiwiY29uc3RydWN0b3IiLCJkIiwidW5kZWZpbmVkIiwiQ2xpcGJvYXJkU3R1YkNvbnRyb2wiLCJTeW1ib2wiLCJjcmVhdGVDbGlwYm9hcmRTdHViIiwiY29udHJvbCIsImFzc2lnbiIsIkNsaXBib2FyZCIsIkV2ZW50VGFyZ2V0IiwicmVhZCIsIml0ZW1zIiwicmVhZFRleHQiLCJ0ZXh0IiwiaXRlbSIsImluY2x1ZGVzIiwiZmluZCIsInQiLCJzdGFydHNXaXRoIiwidGhlbiIsInJlYWRCbG9iVGV4dCIsIkZpbGVSZWFkZXIiLCJ3cml0ZSIsIndyaXRlVGV4dCIsImFyZ3MiLCJpc0NsaXBib2FyZFN0dWIiLCJjbGlwYm9hcmQiLCJhdHRhY2hDbGlwYm9hcmRTdHViVG9WaWV3IiwibmF2aWdhdG9yIiwicmVhbENsaXBib2FyZCIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsInN0dWIiLCJyZXNldENsaXBib2FyZFN0dWIiLCJkZXRhY2hDbGlwYm9hcmRTdHViIiwiZ2V0IiwicmVzZXRDbGlwYm9hcmRTdHViT25WaWV3IiwiZGV0YWNoQ2xpcGJvYXJkU3R1YkZyb21WaWV3IiwicmVhZERhdGFUcmFuc2ZlckZyb21DbGlwYm9hcmQiLCJkb2N1bWVudCIsImRlZmF1bHRWaWV3IiwiZHQiLCJjcmVhdGVEYXRhVHJhbnNmZXIiLCJzZXREYXRhIiwid3JpdGVEYXRhVHJhbnNmZXJUb0NsaXBib2FyZCIsImNsaXBib2FyZERhdGEiLCJpIiwibGVuZ3RoIiwiZHRJdGVtIiwiYmxvYiIsImdldEJsb2JGcm9tRGF0YVRyYW5zZmVySXRlbSIsInB1c2giLCJ3cml0dGVuIiwiZyIsImdsb2JhbFRoaXMiLCJhZnRlckVhY2giLCJhZnRlckFsbCIsImV4cG9ydHMiXSwic291cmNlcyI6WyJDbGlwYm9hcmQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG52YXIgZ2V0V2luZG93ID0gcmVxdWlyZSgnLi4vbWlzYy9nZXRXaW5kb3cuanMnKTtcbnZhciBCbG9iID0gcmVxdWlyZSgnLi9CbG9iLmpzJyk7XG52YXIgRGF0YVRyYW5zZmVyID0gcmVxdWlyZSgnLi9EYXRhVHJhbnNmZXIuanMnKTtcblxuLy8gQ2xpcGJvYXJkIGlzIG5vdCBhdmFpbGFibGUgaW4ganNkb21cbmZ1bmN0aW9uIF9kZWZpbmVfcHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7XG4gICAgaWYgKGtleSBpbiBvYmopIHtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7XG4gICAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgb2JqW2tleV0gPSB2YWx1ZTtcbiAgICB9XG4gICAgcmV0dXJuIG9iajtcbn1cbi8vIE1ETiBsaXN0cyBzdHJpbmd8QmxvYnxQcm9taXNlPEJsb2J8c3RyaW5nPiBhcyBwb3NzaWJsZSB0eXBlcyBpbiBDbGlwYm9hcmRJdGVtRGF0YVxuLy8gbGliLmRvbS5kLnRzIGxpc3RzIG9ubHkgUHJvbWlzZTxCbG9ifHN0cmluZz5cbi8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9DbGlwYm9hcmRJdGVtL0NsaXBib2FyZEl0ZW0jc3ludGF4XG5mdW5jdGlvbiBjcmVhdGVDbGlwYm9hcmRJdGVtKHdpbmRvdywgLi4uYmxvYnMpIHtcbiAgICBjb25zdCBkYXRhTWFwID0gT2JqZWN0LmZyb21FbnRyaWVzKGJsb2JzLm1hcCgoYik9PltcbiAgICAgICAgICAgIHR5cGVvZiBiID09PSAnc3RyaW5nJyA/ICd0ZXh0L3BsYWluJyA6IGIudHlwZSxcbiAgICAgICAgICAgIFByb21pc2UucmVzb2x2ZShiKVxuICAgICAgICBdKSk7XG4gICAgLy8gdXNlIHJlYWwgQ2xpcGJvYXJkSXRlbSBpZiBhdmFpbGFibGVcbiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8gaWYgKHR5cGVvZiB3aW5kb3cuQ2xpcGJvYXJkSXRlbSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcmV0dXJuIG5ldyB3aW5kb3cuQ2xpcGJvYXJkSXRlbShkYXRhTWFwKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBjbGFzcyBDbGlwYm9hcmRJdGVtIHtcbiAgICAgICAgZ2V0IHR5cGVzKCkge1xuICAgICAgICAgICAgcmV0dXJuIEFycmF5LmZyb20oT2JqZWN0LmtleXModGhpcy5kYXRhKSk7XG4gICAgICAgIH1cbiAgICAgICAgYXN5bmMgZ2V0VHlwZSh0eXBlKSB7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGF3YWl0IHRoaXMuZGF0YVt0eXBlXTtcbiAgICAgICAgICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7dHlwZX0gaXMgbm90IG9uZSBvZiB0aGUgYXZhaWxhYmxlIE1JTUUgdHlwZXMgb24gdGhpcyBpdGVtLmApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2Ygd2luZG93LkJsb2IgPyB2YWx1ZSA6IG5ldyB3aW5kb3cuQmxvYihbXG4gICAgICAgICAgICAgICAgdmFsdWVcbiAgICAgICAgICAgIF0sIHtcbiAgICAgICAgICAgICAgICB0eXBlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdHJ1Y3RvcihkKXtcbiAgICAgICAgICAgIF9kZWZpbmVfcHJvcGVydHkodGhpcywgXCJkYXRhXCIsIHVuZGVmaW5lZCk7XG4gICAgICAgICAgICB0aGlzLmRhdGEgPSBkO1xuICAgICAgICB9XG4gICAgfShkYXRhTWFwKTtcbn1cbmNvbnN0IENsaXBib2FyZFN0dWJDb250cm9sID0gU3ltYm9sKCdNYW5hZ2UgQ2xpcGJvYXJkU3ViJyk7XG5mdW5jdGlvbiBjcmVhdGVDbGlwYm9hcmRTdHViKHdpbmRvdywgY29udHJvbCkge1xuICAgIHJldHVybiBPYmplY3QuYXNzaWduKG5ldyBjbGFzcyBDbGlwYm9hcmQgZXh0ZW5kcyB3aW5kb3cuRXZlbnRUYXJnZXQge1xuICAgICAgICBhc3luYyByZWFkKCkge1xuICAgICAgICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5pdGVtcyk7XG4gICAgICAgIH1cbiAgICAgICAgYXN5bmMgcmVhZFRleHQoKSB7XG4gICAgICAgICAgICBsZXQgdGV4dCA9ICcnO1xuICAgICAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIHRoaXMuaXRlbXMpe1xuICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBpdGVtLnR5cGVzLmluY2x1ZGVzKCd0ZXh0L3BsYWluJykgPyAndGV4dC9wbGFpbicgOiBpdGVtLnR5cGVzLmZpbmQoKHQpPT50LnN0YXJ0c1dpdGgoJ3RleHQvJykpO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRleHQgKz0gYXdhaXQgaXRlbS5nZXRUeXBlKHR5cGUpLnRoZW4oKGIpPT5CbG9iLnJlYWRCbG9iVGV4dChiLCB3aW5kb3cuRmlsZVJlYWRlcikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0ZXh0O1xuICAgICAgICB9XG4gICAgICAgIGFzeW5jIHdyaXRlKGRhdGEpIHtcbiAgICAgICAgICAgIHRoaXMuaXRlbXMgPSBkYXRhO1xuICAgICAgICB9XG4gICAgICAgIGFzeW5jIHdyaXRlVGV4dCh0ZXh0KSB7XG4gICAgICAgICAgICB0aGlzLml0ZW1zID0gW1xuICAgICAgICAgICAgICAgIGNyZWF0ZUNsaXBib2FyZEl0ZW0od2luZG93LCB0ZXh0KVxuICAgICAgICAgICAgXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdHJ1Y3RvciguLi5hcmdzKXtcbiAgICAgICAgICAgIHN1cGVyKC4uLmFyZ3MpLCBfZGVmaW5lX3Byb3BlcnR5KHRoaXMsIFwiaXRlbXNcIiwgW10pO1xuICAgICAgICB9XG4gICAgfSgpLCB7XG4gICAgICAgIFtDbGlwYm9hcmRTdHViQ29udHJvbF06IGNvbnRyb2xcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGlzQ2xpcGJvYXJkU3R1YihjbGlwYm9hcmQpIHtcbiAgICByZXR1cm4gISEoY2xpcGJvYXJkID09PSBudWxsIHx8IGNsaXBib2FyZCA9PT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkIDogY2xpcGJvYXJkW0NsaXBib2FyZFN0dWJDb250cm9sXSk7XG59XG5mdW5jdGlvbiBhdHRhY2hDbGlwYm9hcmRTdHViVG9WaWV3KHdpbmRvdykge1xuICAgIGlmIChpc0NsaXBib2FyZFN0dWIod2luZG93Lm5hdmlnYXRvci5jbGlwYm9hcmQpKSB7XG4gICAgICAgIHJldHVybiB3aW5kb3cubmF2aWdhdG9yLmNsaXBib2FyZFtDbGlwYm9hcmRTdHViQ29udHJvbF07XG4gICAgfVxuICAgIGNvbnN0IHJlYWxDbGlwYm9hcmQgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHdpbmRvdy5uYXZpZ2F0b3IsICdjbGlwYm9hcmQnKTtcbiAgICBsZXQgc3R1YjtcbiAgICBjb25zdCBjb250cm9sID0ge1xuICAgICAgICByZXNldENsaXBib2FyZFN0dWI6ICgpPT57XG4gICAgICAgICAgICBzdHViID0gY3JlYXRlQ2xpcGJvYXJkU3R1Yih3aW5kb3csIGNvbnRyb2wpO1xuICAgICAgICB9LFxuICAgICAgICBkZXRhY2hDbGlwYm9hcmRTdHViOiAoKT0+e1xuICAgICAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovIGlmIChyZWFsQ2xpcGJvYXJkKSB7XG4gICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdy5uYXZpZ2F0b3IsICdjbGlwYm9hcmQnLCByZWFsQ2xpcGJvYXJkKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdy5uYXZpZ2F0b3IsICdjbGlwYm9hcmQnLCB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBzdHViID0gY3JlYXRlQ2xpcGJvYXJkU3R1Yih3aW5kb3csIGNvbnRyb2wpO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3cubmF2aWdhdG9yLCAnY2xpcGJvYXJkJywge1xuICAgICAgICBnZXQ6ICgpPT5zdHViLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICByZXR1cm4gc3R1YltDbGlwYm9hcmRTdHViQ29udHJvbF07XG59XG5mdW5jdGlvbiByZXNldENsaXBib2FyZFN0dWJPblZpZXcod2luZG93KSB7XG4gICAgaWYgKGlzQ2xpcGJvYXJkU3R1Yih3aW5kb3cubmF2aWdhdG9yLmNsaXBib2FyZCkpIHtcbiAgICAgICAgd2luZG93Lm5hdmlnYXRvci5jbGlwYm9hcmRbQ2xpcGJvYXJkU3R1YkNvbnRyb2xdLnJlc2V0Q2xpcGJvYXJkU3R1YigpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGRldGFjaENsaXBib2FyZFN0dWJGcm9tVmlldyh3aW5kb3cpIHtcbiAgICBpZiAoaXNDbGlwYm9hcmRTdHViKHdpbmRvdy5uYXZpZ2F0b3IuY2xpcGJvYXJkKSkge1xuICAgICAgICB3aW5kb3cubmF2aWdhdG9yLmNsaXBib2FyZFtDbGlwYm9hcmRTdHViQ29udHJvbF0uZGV0YWNoQ2xpcGJvYXJkU3R1YigpO1xuICAgIH1cbn1cbmFzeW5jIGZ1bmN0aW9uIHJlYWREYXRhVHJhbnNmZXJGcm9tQ2xpcGJvYXJkKGRvY3VtZW50KSB7XG4gICAgY29uc3Qgd2luZG93ID0gZG9jdW1lbnQuZGVmYXVsdFZpZXc7XG4gICAgY29uc3QgY2xpcGJvYXJkID0gd2luZG93ID09PSBudWxsIHx8IHdpbmRvdyA9PT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkIDogd2luZG93Lm5hdmlnYXRvci5jbGlwYm9hcmQ7XG4gICAgY29uc3QgaXRlbXMgPSBjbGlwYm9hcmQgJiYgYXdhaXQgY2xpcGJvYXJkLnJlYWQoKTtcbiAgICBpZiAoIWl0ZW1zKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIENsaXBib2FyZCBBUEkgaXMgdW5hdmFpbGFibGUuJyk7XG4gICAgfVxuICAgIGNvbnN0IGR0ID0gRGF0YVRyYW5zZmVyLmNyZWF0ZURhdGFUcmFuc2Zlcih3aW5kb3cpO1xuICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcyl7XG4gICAgICAgIGZvciAoY29uc3QgdHlwZSBvZiBpdGVtLnR5cGVzKXtcbiAgICAgICAgICAgIGR0LnNldERhdGEodHlwZSwgYXdhaXQgaXRlbS5nZXRUeXBlKHR5cGUpLnRoZW4oKGIpPT5CbG9iLnJlYWRCbG9iVGV4dChiLCB3aW5kb3cuRmlsZVJlYWRlcikpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZHQ7XG59XG5hc3luYyBmdW5jdGlvbiB3cml0ZURhdGFUcmFuc2ZlclRvQ2xpcGJvYXJkKGRvY3VtZW50LCBjbGlwYm9hcmREYXRhKSB7XG4gICAgY29uc3Qgd2luZG93ID0gZ2V0V2luZG93LmdldFdpbmRvdyhkb2N1bWVudCk7XG4gICAgY29uc3QgY2xpcGJvYXJkID0gd2luZG93Lm5hdmlnYXRvci5jbGlwYm9hcmQ7XG4gICAgY29uc3QgaXRlbXMgPSBbXTtcbiAgICBmb3IobGV0IGkgPSAwOyBpIDwgY2xpcGJvYXJkRGF0YS5pdGVtcy5sZW5ndGg7IGkrKyl7XG4gICAgICAgIGNvbnN0IGR0SXRlbSA9IGNsaXBib2FyZERhdGEuaXRlbXNbaV07XG4gICAgICAgIGNvbnN0IGJsb2IgPSBhd2FpdCBEYXRhVHJhbnNmZXIuZ2V0QmxvYkZyb21EYXRhVHJhbnNmZXJJdGVtKHdpbmRvdywgZHRJdGVtKTtcbiAgICAgICAgaXRlbXMucHVzaChjcmVhdGVDbGlwYm9hcmRJdGVtKHdpbmRvdywgYmxvYikpO1xuICAgIH1cbiAgICBjb25zdCB3cml0dGVuID0gY2xpcGJvYXJkICYmIGF3YWl0IGNsaXBib2FyZC53cml0ZShpdGVtcykudGhlbigoKT0+dHJ1ZSwgLy8gQ2FuIGhhcHBlbiB3aXRoIG90aGVyIGltcGxlbWVudGF0aW9ucyB0aGF0IGUuZy4gcmVxdWlyZSBwZXJtaXNzaW9uc1xuICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovICgpPT5mYWxzZSk7XG4gICAgaWYgKCF3cml0dGVuKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIENsaXBib2FyZCBBUEkgaXMgdW5hdmFpbGFibGUuJyk7XG4gICAgfVxufVxuY29uc3QgZyA9IGdsb2JhbFRoaXM7XG4vKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAqLyBpZiAodHlwZW9mIGcuYWZ0ZXJFYWNoID09PSAnZnVuY3Rpb24nKSB7XG4gICAgZy5hZnRlckVhY2goKCk9PnJlc2V0Q2xpcGJvYXJkU3R1Yk9uVmlldyhnbG9iYWxUaGlzLndpbmRvdykpO1xufVxuLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi8gaWYgKHR5cGVvZiBnLmFmdGVyQWxsID09PSAnZnVuY3Rpb24nKSB7XG4gICAgZy5hZnRlckFsbCgoKT0+ZGV0YWNoQ2xpcGJvYXJkU3R1YkZyb21WaWV3KGdsb2JhbFRoaXMud2luZG93KSk7XG59XG5cbmV4cG9ydHMuYXR0YWNoQ2xpcGJvYXJkU3R1YlRvVmlldyA9IGF0dGFjaENsaXBib2FyZFN0dWJUb1ZpZXc7XG5leHBvcnRzLmNyZWF0ZUNsaXBib2FyZEl0ZW0gPSBjcmVhdGVDbGlwYm9hcmRJdGVtO1xuZXhwb3J0cy5kZXRhY2hDbGlwYm9hcmRTdHViRnJvbVZpZXcgPSBkZXRhY2hDbGlwYm9hcmRTdHViRnJvbVZpZXc7XG5leHBvcnRzLnJlYWREYXRhVHJhbnNmZXJGcm9tQ2xpcGJvYXJkID0gcmVhZERhdGFUcmFuc2ZlckZyb21DbGlwYm9hcmQ7XG5leHBvcnRzLnJlc2V0Q2xpcGJvYXJkU3R1Yk9uVmlldyA9IHJlc2V0Q2xpcGJvYXJkU3R1Yk9uVmlldztcbmV4cG9ydHMud3JpdGVEYXRhVHJhbnNmZXJUb0NsaXBib2FyZCA9IHdyaXRlRGF0YVRyYW5zZmVyVG9DbGlwYm9hcmQ7XG4iXSwibWFwcGluZ3MiOiJBQUFBLFlBQVk7O0FBRVosSUFBSUEsU0FBUyxHQUFHQyxPQUFPLENBQUMsc0JBQXNCLENBQUM7QUFDL0MsSUFBSUMsSUFBSSxHQUFHRCxPQUFPLENBQUMsV0FBVyxDQUFDO0FBQy9CLElBQUlFLFlBQVksR0FBR0YsT0FBTyxDQUFDLG1CQUFtQixDQUFDOztBQUUvQztBQUNBLFNBQVNHLGdCQUFnQkEsQ0FBQ0MsR0FBRyxFQUFFQyxHQUFHLEVBQUVDLEtBQUssRUFBRTtFQUN2QyxJQUFJRCxHQUFHLElBQUlELEdBQUcsRUFBRTtJQUNaRyxNQUFNLENBQUNDLGNBQWMsQ0FBQ0osR0FBRyxFQUFFQyxHQUFHLEVBQUU7TUFDNUJDLEtBQUssRUFBRUEsS0FBSztNQUNaRyxVQUFVLEVBQUUsSUFBSTtNQUNoQkMsWUFBWSxFQUFFLElBQUk7TUFDbEJDLFFBQVEsRUFBRTtJQUNkLENBQUMsQ0FBQztFQUNOLENBQUMsTUFBTTtJQUNIUCxHQUFHLENBQUNDLEdBQUcsQ0FBQyxHQUFHQyxLQUFLO0VBQ3BCO0VB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