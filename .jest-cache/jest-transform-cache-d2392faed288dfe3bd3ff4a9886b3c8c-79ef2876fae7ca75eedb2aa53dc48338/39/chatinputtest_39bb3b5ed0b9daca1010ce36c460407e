0a8ddcdbebc80e8f29fad6ed27db42c9
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = __importDefault(require("react"));
const react_2 = require("@testing-library/react");
const user_event_1 = __importDefault(require("@testing-library/user-event"));
const chat_input_1 = require("../../src/components/ui/chat-input");
describe("ChatInput", () => {
    const mockOnSend = jest.fn();
    const mockOnStop = jest.fn();
    beforeEach(() => {
        jest.clearAllMocks();
    });
    it("renders chat input with correct placeholder", () => {
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_input_1.ChatInput, { onSend: mockOnSend }));
        const textarea = react_2.screen.getByRole("textbox");
        expect(textarea).toBeInTheDocument();
        expect(textarea).toHaveAttribute("placeholder", "Type your message... (Enter to send, Shift+Enter for new line)");
    });
    it("displays send button when not streaming", () => {
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_input_1.ChatInput, { onSend: mockOnSend, isStreaming: false }));
        const sendButton = react_2.screen.getByRole("button", { name: /send message/i });
        expect(sendButton).toBeInTheDocument();
        expect(sendButton).toHaveTextContent("Send");
    });
    it("displays stop button when streaming", () => {
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_input_1.ChatInput, { onSend: mockOnSend, onStop: mockOnStop, isStreaming: true }));
        const stopButton = react_2.screen.getByRole("button", { name: /stop streaming response/i });
        expect(stopButton).toBeInTheDocument();
        expect(stopButton).toHaveTextContent("Stop");
    });
    it("sends message on Enter key press", async () => {
        const user = user_event_1.default.setup();
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_input_1.ChatInput, { onSend: mockOnSend }));
        const textarea = react_2.screen.getByRole("textbox");
        await user.type(textarea, "Test message");
        await user.keyboard("{Enter}");
        expect(mockOnSend).toHaveBeenCalledWith("Test message");
    });
    it("adds new line on Shift+Enter", async () => {
        const user = user_event_1.default.setup();
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_input_1.ChatInput, { onSend: mockOnSend }));
        const textarea = react_2.screen.getByRole("textbox");
        await user.type(textarea, "Line 1");
        await user.keyboard("{Shift>}{Enter}{/Shift}");
        await user.type(textarea, "Line 2");
        expect(textarea).toHaveValue("Line 1\nLine 2");
        expect(mockOnSend).not.toHaveBeenCalled();
    });
    it("sends message on button click", async () => {
        const user = user_event_1.default.setup();
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_input_1.ChatInput, { onSend: mockOnSend }));
        const textarea = react_2.screen.getByRole("textbox");
        const sendButton = react_2.screen.getByRole("button", { name: /send message/i });
        await user.type(textarea, "Test message");
        await user.click(sendButton);
        expect(mockOnSend).toHaveBeenCalledWith("Test message");
    });
    it("clears input after sending message", async () => {
        const user = user_event_1.default.setup();
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_input_1.ChatInput, { onSend: mockOnSend }));
        const textarea = react_2.screen.getByRole("textbox");
        await user.type(textarea, "Test message");
        await user.keyboard("{Enter}");
        expect(textarea).toHaveValue("");
    });
    it("disables send button for empty input", () => {
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_input_1.ChatInput, { onSend: mockOnSend }));
        const sendButton = react_2.screen.getByRole("button", { name: /send message/i });
        expect(sendButton).toBeDisabled();
    });
    it("disables send button for whitespace-only input", async () => {
        const user = user_event_1.default.setup();
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_input_1.ChatInput, { onSend: mockOnSend }));
        const textarea = react_2.screen.getByRole("textbox");
        const sendButton = react_2.screen.getByRole("button", { name: /send message/i });
        await user.type(textarea, "   ");
        expect(sendButton).toBeDisabled();
    });
    it("enables send button for valid input", async () => {
        const user = user_event_1.default.setup();
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_input_1.ChatInput, { onSend: mockOnSend }));
        const textarea = react_2.screen.getByRole("textbox");
        const sendButton = react_2.screen.getByRole("button", { name: /send message/i });
        await user.type(textarea, "Valid message");
        expect(sendButton).not.toBeDisabled();
    });
    it("calls onStop when stop button is clicked", async () => {
        const user = user_event_1.default.setup();
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_input_1.ChatInput, { onSend: mockOnSend, onStop: mockOnStop, isStreaming: true }));
        const stopButton = react_2.screen.getByRole("button", { name: /stop streaming response/i });
        await user.click(stopButton);
        expect(mockOnStop).toHaveBeenCalled();
    });
    it("auto-resizes textarea as content grows", async () => {
        const user = user_event_1.default.setup();
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_input_1.ChatInput, { onSend: mockOnSend, maxLines: 5 }));
        const textarea = react_2.screen.getByRole("textbox");
        const initialHeight = textarea.style.height;
        // Add multiple lines
        await user.type(textarea, "Line 1\nLine 2\nLine 3\nLine 4");
        // Height should have increased
        expect(textarea.style.height).not.toBe(initialHeight);
    });
    it("does not send empty messages", async () => {
        const user = user_event_1.default.setup();
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_input_1.ChatInput, { onSend: mockOnSend }));
        const textarea = react_2.screen.getByRole("textbox");
        await user.keyboard("{Enter}");
        expect(mockOnSend).not.toHaveBeenCalled();
    });
    it("trims whitespace from messages before sending", async () => {
        const user = user_event_1.default.setup();
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_input_1.ChatInput, { onSend: mockOnSend }));
        const textarea = react_2.screen.getByRole("textbox");
        await user.type(textarea, "  Test message  ");
        await user.keyboard("{Enter}");
        expect(mockOnSend).toHaveBeenCalledWith("Test message");
    });
    it("prevents sending when streaming", async () => {
        const user = user_event_1.default.setup();
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_input_1.ChatInput, { onSend: mockOnSend, isStreaming: true }));
        const textarea = react_2.screen.getByRole("textbox");
        await user.type(textarea, "Test message");
        await user.keyboard("{Enter}");
        expect(mockOnSend).not.toHaveBeenCalled();
    });
    it("maintains focus after sending message", async () => {
        const user = user_event_1.default.setup();
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_input_1.ChatInput, { onSend: mockOnSend }));
        const textarea = react_2.screen.getByRole("textbox");
        await user.type(textarea, "Test message");
        await user.keyboard("{Enter}");
        await (0, react_2.waitFor)(() => {
            expect(textarea).toHaveFocus();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxzYXJhaFxcUmVwb3NcXENDSCBBeGNlc3MgSW50ZWxsaWdlbmNlIFZpYmVkXFx0ZXN0c1xcdW5pdFxcY2hhdC1pbnB1dC50ZXN0LnRzeCIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxrREFBMEI7QUFDMUIsa0RBQTRFO0FBQzVFLDZFQUFvRDtBQUNwRCxtRUFBK0Q7QUFFL0QsUUFBUSxDQUFDLFdBQVcsRUFBRSxHQUFHLEVBQUU7SUFDekIsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO0lBQzdCLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztJQUU3QixVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLDZDQUE2QyxFQUFFLEdBQUcsRUFBRTtRQUNyRCxJQUFBLGNBQU0sRUFBQyx1QkFBQyxzQkFBUyxJQUFDLE1BQU0sRUFBRSxVQUFVLEdBQUksQ0FBQyxDQUFDO1FBRTFDLE1BQU0sUUFBUSxHQUFHLGNBQU0sQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDN0MsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDckMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLGVBQWUsQ0FDOUIsYUFBYSxFQUNiLGdFQUFnRSxDQUNqRSxDQUFDO0lBQ0osQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMseUNBQXlDLEVBQUUsR0FBRyxFQUFFO1FBQ2pELElBQUEsY0FBTSxFQUFDLHVCQUFDLHNCQUFTLElBQUMsTUFBTSxFQUFFLFVBQVUsRUFBRSxXQUFXLEVBQUUsS0FBSyxHQUFJLENBQUMsQ0FBQztRQUU5RCxNQUFNLFVBQVUsR0FBRyxjQUFNLENBQUMsU0FBUyxDQUFDLFFBQVEsRUFBRSxFQUFFLElBQUksRUFBRSxlQUFlLEVBQUUsQ0FBQyxDQUFDO1FBQ3pFLE1BQU0sQ0FBQyxV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dUMsRUFBRSxLQUFLLElBQUksRUFBRTtRQUNyRCxNQUFNLElBQUksR0FBRyxvQkFBUyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQy9CLElBQUEsY0FBTSxFQUFDLHVCQUFDLHNCQUFTLElBQUMsTUFBTSxFQUFFLFVBQVUsR0FBSSxDQUFDLENBQUM7UUFFMUMsTUFBTSxRQUFRLEdBQUcsY0FBTSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUM3QyxNQUFNLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLGNBQWMsQ0FBQyxDQUFDO1FBQzFDLE1BQU0sSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUUvQixNQUFNLElBQUEsZUFBTyxFQUFDLEdBQUcsRUFBRTtZQUNqQixNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDakMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcc2FyYWhcXFJlcG9zXFxDQ0ggQXhjZXNzIEludGVsbGlnZW5jZSBWaWJlZFxcdGVzdHNcXHVuaXRcXGNoYXQtaW5wdXQudGVzdC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgcmVuZGVyLCBzY3JlZW4sIGZpcmVFdmVudCwgd2FpdEZvciB9IGZyb20gXCJAdGVzdGluZy1saWJyYXJ5L3JlYWN0XCI7XG5pbXBvcnQgdXNlckV2ZW50IGZyb20gXCJAdGVzdGluZy1saWJyYXJ5L3VzZXItZXZlbnRcIjtcbmltcG9ydCB7IENoYXRJbnB1dCB9IGZyb20gXCIuLi8uLi9zcmMvY29tcG9uZW50cy91aS9jaGF0LWlucHV0XCI7XG5cbmRlc2NyaWJlKFwiQ2hhdElucHV0XCIsICgpID0+IHtcbiAgY29uc3QgbW9ja09uU2VuZCA9IGplc3QuZm4oKTtcbiAgY29uc3QgbW9ja09uU3RvcCA9IGplc3QuZm4oKTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgaXQoXCJyZW5kZXJzIGNoYXQgaW5wdXQgd2l0aCBjb3JyZWN0IHBsYWNlaG9sZGVyXCIsICgpID0+IHtcbiAgICByZW5kZXIoPENoYXRJbnB1dCBvblNlbmQ9e21vY2tPblNlbmR9IC8+KTtcblxuICAgIGNvbnN0IHRleHRhcmVhID0gc2NyZWVuLmdldEJ5Um9sZShcInRleHRib3hcIik7XG4gICAgZXhwZWN0KHRleHRhcmVhKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgIGV4cGVjdCh0ZXh0YXJlYSkudG9IYXZlQXR0cmlidXRlKFxuICAgICAgXCJwbGFjZWhvbGRlclwiLFxuICAgICAgXCJUeXBlIHlvdXIgbWVzc2FnZS4uLiAoRW50ZXIgdG8gc2VuZCwgU2hpZnQrRW50ZXIgZm9yIG5ldyBsaW5lKVwiXG4gICAgKTtcbiAgfSk7XG5cbiAgaXQoXCJkaXNwbGF5cyBzZW5kIGJ1dHRvbiB3aGVuIG5vdCBzdHJlYW1pbmdcIiwgKCkgPT4ge1xuICAgIHJlbmRlcig8Q2hhdElucHV0IG9uU2VuZD17bW9ja09uU2VuZH0gaXNTdHJlYW1pbmc9e2ZhbHNlfSAvPik7XG5cbiAgICBjb25zdCBzZW5kQnV0dG9uID0gc2NyZWVuLmdldEJ5Um9sZShcImJ1dHRvblwiLCB7IG5hbWU6IC9zZW5kIG1lc3NhZ2UvaSB9KTtcbiAgICBleHBlY3Qoc2VuZEJ1dHRvbikudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICBleHBlY3Qoc2VuZEJ1dHRvbikudG9IYXZlVGV4dENvbnRlbnQoXCJTZW5kXCIpO1xuICB9KTtcblxuICBpdChcImRpc3BsYXlzIHN0b3AgYnV0dG9uIHdoZW4gc3RyZWFtaW5nXCIsICgpID0+IHtcbiAgICByZW5kZXIoPENoYXRJbnB1dCBvblNlbmQ9e21vY2tPblNlbmR9IG9uU3RvcD17bW9ja09uU3RvcH0gaXNTdHJlYW1pbmc9e3RydWV9IC8+KTtcblxuICAgIGNvbnN0IHN0b3BCdXR0b24gPSBzY3JlZW4uZ2V0QnlSb2xlKFwiYnV0dG9uXCIsIHsgbmFtZTogL3N0b3Agc3RyZWFtaW5nIHJlc3BvbnNlL2kgfSk7XG4gICAgZXhwZWN0KHN0b3BCdXR0b24pLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgZXhwZWN0KHN0b3BCdXR0b24pLnRvSGF2ZVRleHRDb250ZW50KFwiU3RvcFwiKTtcbiAgfSk7XG5cbiAgaXQoXCJzZW5kcyBtZXNzYWdlIG9uIEVudGVyIGtleSBwcmVzc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgdXNlciA9IHVzZXJFdmVudC5zZXR1cCgpO1xuICAgIHJlbmRlcig8Q2hhdElucHV0IG9uU2VuZD17bW9ja09uU2VuZH0gLz4pO1xuXG4gICAgY29uc3QgdGV4dGFyZWEgPSBzY3JlZW4uZ2V0QnlSb2xlKFwidGV4dGJveFwiKTtcbiAgICBhd2FpdCB1c2VyLnR5cGUodGV4dGFyZWEsIFwiVGVzdCBtZXNzYWdlXCIpO1xuICAgIGF3YWl0IHVzZXIua2V5Ym9hcmQoXCJ7RW50ZXJ9XCIpO1xuXG4gICAgZXhwZWN0KG1vY2tPblNlbmQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFwiVGVzdCBtZXNzYWdlXCIpO1xuICB9KTtcblxuICBpdChcImFkZHMgbmV3IGxpbmUgb24gU2hpZnQrRW50ZXJcIiwgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHVzZXIgPSB1c2VyRXZlbnQuc2V0dXAoKTtcbiAgICByZW5kZXIoPENoYXRJbnB1dCBvblNlbmQ9e21vY2tPblNlbmR9IC8+KTtcblxuICAgIGNvbnN0IHRleHRhcmVhID0gc2NyZWVuLmdldEJ5Um9sZShcInRleHRib3hcIik7XG4gICAgYXdhaXQgdXNlci50eXBlKHRleHRhcmVhLCBcIkxpbmUgMVwiKTtcbiAgICBhd2FpdCB1c2VyLmtleWJvYXJkKFwie1NoaWZ0Pn17RW50ZXJ9ey9TaGlmdH1cIik7XG4gICAgYXdhaXQgdXNlci50eXBlKHRleHRhcmVhLCBcIkxpbmUgMlwiKTtcblxuICAgIGV4cGVjdCh0ZXh0YXJlYSkudG9IYXZlVmFsdWUoXCJMaW5lIDFcXG5MaW5lIDJcIik7XG4gICAgZXhwZWN0KG1vY2tPblNlbmQpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gIH0pO1xuXG4gIGl0KFwic2VuZHMgbWVzc2FnZSBvbiBidXR0b24gY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHVzZXIgPSB1c2VyRXZlbnQuc2V0dXAoKTtcbiAgICByZW5kZXIoPENoYXRJbnB1dCBvblNlbmQ9e21vY2tPblNlbmR9IC8+KTtcblxuICAgIGNvbnN0IHRleHRhcmVhID0gc2NyZWVuLmdldEJ5Um9sZShcInRleHRib3hcIik7XG4gICAgY29uc3Qgc2VuZEJ1dHRvbiA9IHNjcmVlbi5nZXRCeVJvbGUoXCJidXR0b25cIiwgeyBuYW1lOiAvc2VuZCBtZXNzYWdlL2kgfSk7XG5cbiAgICBhd2FpdCB1c2VyLnR5cGUodGV4dGFyZWEsIFwiVGVzdCBtZXNzYWdlXCIpO1xuICAgIGF3YWl0IHVzZXIuY2xpY2soc2VuZEJ1dHRvbik7XG5cbiAgICBleHBlY3QobW9ja09uU2VuZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXCJUZXN0IG1lc3NhZ2VcIik7XG4gIH0pO1xuXG4gIGl0KFwiY2xlYXJzIGlucHV0IGFmdGVyIHNlbmRpbmcgbWVzc2FnZVwiLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgdXNlciA9IHVzZXJFdmVudC5zZXR1cCgpO1xuICAgIHJlbmRlcig8Q2hhdElucHV0IG9uU2VuZD17bW9ja09uU2VuZH0gLz4pO1xuXG4gICAgY29uc3QgdGV4dGFyZWEgPSBzY3JlZW4uZ2V0QnlSb2xlKFwidGV4dGJveFwiKTtcbiAgICBhd2FpdCB1c2VyLnR5cGUodGV4dGFyZWEsIFwiVGVzdCBtZXNzYWdlXCIpO1xuICAgIGF3YWl0IHVzZXIua2V5Ym9hcmQoXCJ7RW50ZXJ9XCIpO1xuXG4gICAgZXhwZWN0KHRleHRhcmVhKS50b0hhdmVWYWx1ZShcIlwiKTtcbiAgfSk7XG5cbiAgaXQoXCJkaXNhYmxlcyBzZW5kIGJ1dHRvbiBmb3IgZW1wdHkgaW5wdXRcIiwgKCkgPT4ge1xuICAgIHJlbmRlcig8Q2hhdElucHV0IG9uU2VuZD17bW9ja09uU2VuZH0gLz4pO1xuXG4gICAgY29uc3Qgc2VuZEJ1dHRvbiA9IHNjcmVlbi5nZXRCeVJvbGUoXCJidXR0b25cIiwgeyBuYW1lOiAvc2VuZCBtZXNzYWdlL2kgfSk7XG4gICAgZXhwZWN0KHNlbmRCdXR0b24pLnRvQmVEaXNhYmxlZCgpO1xuICB9KTtcblxuICBpdChcImRpc2FibGVzIHNlbmQgYnV0dG9uIGZvciB3aGl0ZXNwYWNlLW9ubHkgaW5wdXRcIiwgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHVzZXIgPSB1c2VyRXZlbnQuc2V0dXAoKTtcbiAgICByZW5kZXIoPENoYXRJbnB1dCBvblNlbmQ9e21vY2tPblNlbmR9IC8+KTtcblxuICAgIGNvbnN0IHRleHRhcmVhID0gc2NyZWVuLmdldEJ5Um9sZShcInRleHRib3hcIik7XG4gICAgY29uc3Qgc2VuZEJ1dHRvbiA9IHNjcmVlbi5nZXRCeVJvbGUoXCJidXR0b25cIiwgeyBuYW1lOiAvc2VuZCBtZXNzYWdlL2kgfSk7XG5cbiAgICBhd2FpdCB1c2VyLnR5cGUodGV4dGFyZWEsIFwiICAgXCIpO1xuICAgIGV4cGVjdChzZW5kQnV0dG9uKS50b0JlRGlzYWJsZWQoKTtcbiAgfSk7XG5cbiAgaXQoXCJlbmFibGVzIHNlbmQgYnV0dG9uIGZvciB2YWxpZCBpbnB1dFwiLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgdXNlciA9IHVzZXJFdmVudC5zZXR1cCgpO1xuICAgIHJlbmRlcig8Q2hhdElucHV0IG9uU2VuZD17bW9ja09uU2VuZH0gLz4pO1xuXG4gICAgY29uc3QgdGV4dGFyZWEgPSBzY3JlZW4uZ2V0QnlSb2xlKFwidGV4dGJveFwiKTtcbiAgICBjb25zdCBzZW5kQnV0dG9uID0gc2NyZWVuLmdldEJ5Um9sZShcImJ1dHRvblwiLCB7IG5hbWU6IC9zZW5kIG1lc3NhZ2UvaSB9KTtcblxuICAgIGF3YWl0IHVzZXIudHlwZSh0ZXh0YXJlYSwgXCJWYWxpZCBtZXNzYWdlXCIpO1xuICAgIGV4cGVjdChzZW5kQnV0dG9uKS5ub3QudG9CZURpc2FibGVkKCk7XG4gIH0pO1xuXG4gIGl0KFwiY2FsbHMgb25TdG9wIHdoZW4gc3RvcCBidXR0b24gaXMgY2xpY2tlZFwiLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgdXNlciA9IHVzZXJFdmVudC5zZXR1cCgpO1xuICAgIHJlbmRlcig8Q2hhdElucHV0IG9uU2VuZD17bW9ja09uU2VuZH0gb25TdG9wPXttb2NrT25TdG9wfSBpc1N0cmVhbWluZz17dHJ1ZX0gLz4pO1xuXG4gICAgY29uc3Qgc3RvcEJ1dHRvbiA9IHNjcmVlbi5nZXRCeVJvbGUoXCJidXR0b25cIiwgeyBuYW1lOiAvc3RvcCBzdHJlYW1pbmcgcmVzcG9uc2UvaSB9KTtcbiAgICBhd2FpdCB1c2VyLmNsaWNrKHN0b3BCdXR0b24pO1xuXG4gICAgZXhwZWN0KG1vY2tPblN0b3ApLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgfSk7XG5cbiAgaXQoXCJhdXRvLXJlc2l6ZXMgdGV4dGFyZWEgYXMgY29udGVudCBncm93c1wiLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgdXNlciA9IHVzZXJFdmVudC5zZXR1cCgpO1xuICAgIHJlbmRlcig8Q2hhdElucHV0IG9uU2VuZD17bW9ja09uU2VuZH0gbWF4TGluZXM9ezV9IC8+KTtcblxuICAgIGNvbnN0IHRleHRhcmVhID0gc2NyZWVuLmdldEJ5Um9sZShcInRleHRib3hcIik7XG4gICAgY29uc3QgaW5pdGlhbEhlaWdodCA9IHRleHRhcmVhLnN0eWxlLmhlaWdodDtcblxuICAgIC8vIEFkZCBtdWx0aXBsZSBsaW5lc1xuICAgIGF3YWl0IHVzZXIudHlwZSh0ZXh0YXJlYSwgXCJMaW5lIDFcXG5MaW5lIDJcXG5MaW5lIDNcXG5MaW5lIDRcIik7XG5cbiAgICAvLyBIZWlnaHQgc2hvdWxkIGhhdmUgaW5jcmVhc2VkXG4gICAgZXhwZWN0KHRleHRhcmVhLnN0eWxlLmhlaWdodCkubm90LnRvQmUoaW5pdGlhbEhlaWdodCk7XG4gIH0pO1xuXG4gIGl0KFwiZG9lcyBub3Qgc2VuZCBlbXB0eSBtZXNzYWdlc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgdXNlciA9IHVzZXJFdmVudC5zZXR1cCgpO1xuICAgIHJlbmRlcig8Q2hhdElucHV0IG9uU2VuZD17bW9ja09uU2VuZH0gLz4pO1xuXG4gICAgY29uc3QgdGV4dGFyZWEgPSBzY3JlZW4uZ2V0QnlSb2xlKFwidGV4dGJveFwiKTtcbiAgICBhd2FpdCB1c2VyLmtleWJvYXJkKFwie0VudGVyfVwiKTtcblxuICAgIGV4cGVjdChtb2NrT25TZW5kKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICB9KTtcblxuICBpdChcInRyaW1zIHdoaXRlc3BhY2UgZnJvbSBtZXNzYWdlcyBiZWZvcmUgc2VuZGluZ1wiLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgdXNlciA9IHVzZXJFdmVudC5zZXR1cCgpO1xuICAgIHJlbmRlcig8Q2hhdElucHV0IG9uU2VuZD17bW9ja09uU2VuZH0gLz4pO1xuXG4gICAgY29uc3QgdGV4dGFyZWEgPSBzY3JlZW4uZ2V0QnlSb2xlKFwidGV4dGJveFwiKTtcbiAgICBhd2FpdCB1c2VyLnR5cGUodGV4dGFyZWEsIFwiICBUZXN0IG1lc3NhZ2UgIFwiKTtcbiAgICBhd2FpdCB1c2VyLmtleWJvYXJkKFwie0VudGVyfVwiKTtcblxuICAgIGV4cGVjdChtb2NrT25TZW5kKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcIlRlc3QgbWVzc2FnZVwiKTtcbiAgfSk7XG5cbiAgaXQoXCJwcmV2ZW50cyBzZW5kaW5nIHdoZW4gc3RyZWFtaW5nXCIsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCB1c2VyID0gdXNlckV2ZW50LnNldHVwKCk7XG4gICAgcmVuZGVyKDxDaGF0SW5wdXQgb25TZW5kPXttb2NrT25TZW5kfSBpc1N0cmVhbWluZz17dHJ1ZX0gLz4pO1xuXG4gICAgY29uc3QgdGV4dGFyZWEgPSBzY3JlZW4uZ2V0QnlSb2xlKFwidGV4dGJveFwiKTtcbiAgICBhd2FpdCB1c2VyLnR5cGUodGV4dGFyZWEsIFwiVGVzdCBtZXNzYWdlXCIpO1xuICAgIGF3YWl0IHVzZXIua2V5Ym9hcmQoXCJ7RW50ZXJ9XCIpO1xuXG4gICAgZXhwZWN0KG1vY2tPblNlbmQpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gIH0pO1xuXG4gIGl0KFwibWFpbnRhaW5zIGZvY3VzIGFmdGVyIHNlbmRpbmcgbWVzc2FnZVwiLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgdXNlciA9IHVzZXJFdmVudC5zZXR1cCgpO1xuICAgIHJlbmRlcig8Q2hhdElucHV0IG9uU2VuZD17bW9ja09uU2VuZH0gLz4pO1xuXG4gICAgY29uc3QgdGV4dGFyZWEgPSBzY3JlZW4uZ2V0QnlSb2xlKFwidGV4dGJveFwiKTtcbiAgICBhd2FpdCB1c2VyLnR5cGUodGV4dGFyZWEsIFwiVGVzdCBtZXNzYWdlXCIpO1xuICAgIGF3YWl0IHVzZXIua2V5Ym9hcmQoXCJ7RW50ZXJ9XCIpO1xuXG4gICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XG4gICAgICBleHBlY3QodGV4dGFyZWEpLnRvSGF2ZUZvY3VzKCk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9