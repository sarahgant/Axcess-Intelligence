{"version":3,"names":["isElementType","require","trackValue","UI","Interceptor","Symbol","prepareInterceptor","element","propName","interceptorImpl","prototypeDescriptor","Object","getOwnPropertyDescriptor","constructor","prototype","objectDescriptor","target","undefined","set","Error","tagName","String","intercept","args","applyNative","realArgs","then","call","realFunc","defineProperty","prepareValueInterceptor","v","isUI","isUIValue","startTrackValue","sanitizeValue","trackOrSetValue","type","Number","isNaN","prepareSelectionInterceptor","start","others","isUISelectionStart","setUISelectionClean","setUISelectionRaw","anchorOffset","focusOffset","getUIValue","length","prepareRangeTextInterceptor","setUIValueClean","exports"],"sources":["interceptor.js"],"sourcesContent":["'use strict';\n\nvar isElementType = require('../utils/misc/isElementType.js');\nrequire('../utils/dataTransfer/Clipboard.js');\nvar trackValue = require('./trackValue.js');\nvar UI = require('./UI.js');\n\nconst Interceptor = Symbol('Interceptor for programmatical calls');\nfunction prepareInterceptor(element, propName, interceptorImpl) {\n    const prototypeDescriptor = Object.getOwnPropertyDescriptor(element.constructor.prototype, propName);\n    const objectDescriptor = Object.getOwnPropertyDescriptor(element, propName);\n    const target = (prototypeDescriptor === null || prototypeDescriptor === undefined ? undefined : prototypeDescriptor.set) ? 'set' : 'value';\n    /* istanbul ignore if */ if (typeof (prototypeDescriptor === null || prototypeDescriptor === undefined ? undefined : prototypeDescriptor[target]) !== 'function' || prototypeDescriptor[target][Interceptor]) {\n        throw new Error(`Element ${element.tagName} does not implement \"${String(propName)}\".`);\n    }\n    function intercept(...args) {\n        const { applyNative = false, realArgs, then } = interceptorImpl.call(this, ...args);\n        const realFunc = (!applyNative && objectDescriptor || prototypeDescriptor)[target];\n        if (target === 'set') {\n            realFunc.call(this, realArgs);\n        } else {\n            realFunc.call(this, ...realArgs);\n        }\n        then === null || then === undefined ? undefined : then();\n    }\n    intercept[Interceptor] = Interceptor;\n    Object.defineProperty(element, propName, {\n        ...objectDescriptor !== null && objectDescriptor !== undefined ? objectDescriptor : prototypeDescriptor,\n        [target]: intercept\n    });\n}\nfunction prepareValueInterceptor(element) {\n    prepareInterceptor(element, 'value', function interceptorImpl(v) {\n        const isUI = UI.isUIValue(v);\n        if (isUI) {\n            trackValue.startTrackValue(this);\n        }\n        return {\n            applyNative: !!isUI,\n            realArgs: sanitizeValue(this, v),\n            then: isUI ? undefined : ()=>trackValue.trackOrSetValue(this, String(v))\n        };\n    });\n}\nfunction sanitizeValue(element, v) {\n    // Workaround for JSDOM\n    if (isElementType.isElementType(element, 'input', {\n        type: 'number'\n    }) && String(v) !== '' && !Number.isNaN(Number(v))) {\n        // Setting value to \"1.\" results in `null` in JSDOM\n        return String(Number(v));\n    }\n    return String(v);\n}\nfunction prepareSelectionInterceptor(element) {\n    prepareInterceptor(element, 'setSelectionRange', function interceptorImpl(start, ...others) {\n        const isUI = UI.isUISelectionStart(start);\n        return {\n            applyNative: !!isUI,\n            realArgs: [\n                Number(start),\n                ...others\n            ],\n            then: ()=>isUI ? undefined : UI.setUISelectionClean(element)\n        };\n    });\n    prepareInterceptor(element, 'selectionStart', function interceptorImpl(v) {\n        return {\n            realArgs: v,\n            then: ()=>UI.setUISelectionClean(element)\n        };\n    });\n    prepareInterceptor(element, 'selectionEnd', function interceptorImpl(v) {\n        return {\n            realArgs: v,\n            then: ()=>UI.setUISelectionClean(element)\n        };\n    });\n    prepareInterceptor(element, 'select', function interceptorImpl() {\n        return {\n            realArgs: [],\n            then: ()=>UI.setUISelectionRaw(element, {\n                    anchorOffset: 0,\n                    focusOffset: UI.getUIValue(element).length\n                })\n        };\n    });\n}\nfunction prepareRangeTextInterceptor(element) {\n    prepareInterceptor(element, 'setRangeText', function interceptorImpl(...realArgs) {\n        return {\n            realArgs,\n            then: ()=>{\n                UI.setUIValueClean(element);\n                UI.setUISelectionClean(element);\n            }\n        };\n    });\n}\n\nexports.prepareInterceptor = prepareInterceptor;\nexports.prepareRangeTextInterceptor = prepareRangeTextInterceptor;\nexports.prepareSelectionInterceptor = prepareSelectionInterceptor;\nexports.prepareValueInterceptor = prepareValueInterceptor;\n"],"mappings":"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","ignoreList":[]}