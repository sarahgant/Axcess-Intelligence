ac6f274f6032c262271c48d14873d1c9
"use strict";
/**
 * Unit tests for ConfigLoader
 * Tests configuration loading, validation, and error handling
 */
Object.defineProperty(exports, "__esModule", { value: true });
const vitest_1 = require("vitest");
const loader_1 = require("../../src/config/loader");
const defaults_1 = require("../../src/config/defaults");
// Mock environment variables
const mockEnv = {
    ANTHROPIC_API_KEY: 'test-anthropic-key-1234567890',
    OPENAI_API_KEY: 'test-openai-key-1234567890',
    ENCRYPTION_KEY: 'test-encryption-key-32-characters',
    NODE_ENV: 'test',
    ENABLE_STREAMING: 'true',
    MAX_DOCUMENTS_PER_SESSION: '5'
};
(0, vitest_1.describe)('ConfigLoader', () => {
    let originalEnv;
    (0, vitest_1.beforeEach)(() => {
        // Save original environment
        originalEnv = { ...process.env };
        // Reset ConfigLoader instance
        loader_1.ConfigLoader.instance = null;
        loader_1.ConfigLoader.loadPromise = null;
        // Clear environment
        Object.keys(process.env).forEach(key => {
            if (key.startsWith('ANTHROPIC_') || key.startsWith('OPENAI_') || key.startsWith('ENABLE_')) {
                delete process.env[key];
            }
        });
    });
    (0, vitest_1.afterEach)(() => {
        // Restore original environment
        process.env = originalEnv;
    });
    (0, vitest_1.describe)('load()', () => {
        (0, vitest_1.it)('should load configuration with valid environment variables', async () => {
            // Set up test environment
            Object.assign(process.env, mockEnv);
            const config = await loader_1.ConfigLoader.load();
            (0, vitest_1.expect)(config).toBeDefined();
            (0, vitest_1.expect)(config.providers.anthropic.apiKey).toBe('test-anthropic-key-1234567890');
            (0, vitest_1.expect)(config.providers.openai.apiKey).toBe('test-openai-key-1234567890');
            (0, vitest_1.expect)(config.security.encryptionKey).toBe('test-encryption-key-32-characters');
            (0, vitest_1.expect)(config.environment).toBe('test');
        });
        (0, vitest_1.it)('should return cached instance on subsequent calls', async () => {
            Object.assign(process.env, mockEnv);
            const config1 = await loader_1.ConfigLoader.load();
            const config2 = await loader_1.ConfigLoader.load();
            (0, vitest_1.expect)(config1).toBe(config2); // Same instance
        });
        (0, vitest_1.it)('should throw error for missing required API keys', async () => {
            // Set up environment without API keys
            process.env.ENCRYPTION_KEY = 'test-encryption-key-32-characters';
            process.env.NODE_ENV = 'test';
            await (0, vitest_1.expect)(loader_1.ConfigLoader.load()).rejects.toThrow(/API key is required/);
        });
        (0, vitest_1.it)('should throw error for invalid encryption key', async () => {
            Object.assign(process.env, {
                ...mockEnv,
                ENCRYPTION_KEY: 'short' // Too short
            });
            await (0, vitest_1.expect)(loader_1.ConfigLoader.load()).rejects.toThrow(/at least 32 characters/);
        });
        (0, vitest_1.it)('should merge environment variables with defaults', async () => {
            Object.assign(process.env, {
                ...mockEnv,
                ENABLE_STREAMING: 'false',
                MAX_DOCUMENTS_PER_SESSION: '15'
            });
            const config = await loader_1.ConfigLoader.load();
            (0, vitest_1.expect)(config.features.enableStreaming).toBe(false);
            (0, vitest_1.expect)(config.features.maxDocumentsPerSession).toBe(15);
            (0, vitest_1.expect)(config.features.enableDocumentAnalysis).toBe(defaults_1.DEFAULT_CONFIG.features.enableDocumentAnalysis);
        });
    });
    (0, vitest_1.describe)('reload()', () => {
        (0, vitest_1.it)('should reload configuration with new environment variables', async () => {
            // Initial load
            Object.assign(process.env, mockEnv);
            const config1 = await loader_1.ConfigLoader.load();
            // Change environment
            process.env.ANTHROPIC_DEFAULT_MODEL = 'claude-sonnet-4-20250514';
            // Reload
            const config2 = await loader_1.ConfigLoader.reload();
            (0, vitest_1.expect)(config2.providers.anthropic.defaultModel).toBe('claude-sonnet-4-20250514');
        });
    });
    (0, vitest_1.describe)('getInstance()', () => {
        (0, vitest_1.it)('should return loaded configuration', async () => {
            Object.assign(process.env, mockEnv);
            await loader_1.ConfigLoader.load();
            const config = loader_1.ConfigLoader.getInstance();
            (0, vitest_1.expect)(config).toBeDefined();
            (0, vitest_1.expect)(config.providers.anthropic.apiKey).toBe('test-anthropic-key-1234567890');
        });
        (0, vitest_1.it)('should throw error if not loaded', () => {
            (0, vitest_1.expect)(() => loader_1.ConfigLoader.getInstance()).toThrow(/Configuration not loaded/);
        });
    });
    (0, vitest_1.describe)('isLoaded()', () => {
        (0, vitest_1.it)('should return false initially', () => {
            (0, vitest_1.expect)(loader_1.ConfigLoader.isLoaded()).toBe(false);
        });
        (0, vitest_1.it)('should return true after loading', async () => {
            Object.assign(process.env, mockEnv);
            await loader_1.ConfigLoader.load();
            (0, vitest_1.expect)(loader_1.ConfigLoader.isLoaded()).toBe(true);
        });
    });
    (0, vitest_1.describe)('getConfigSummary()', () => {
        (0, vitest_1.it)('should return not loaded status initially', () => {
            const summary = loader_1.ConfigLoader.getConfigSummary();
            (0, vitest_1.expect)(summary.loaded).toBe(false);
        });
        (0, vitest_1.it)('should return masked configuration after loading', async () => {
            Object.assign(process.env, mockEnv);
            await loader_1.ConfigLoader.load();
            const summary = loader_1.ConfigLoader.getConfigSummary();
            (0, vitest_1.expect)(summary.loaded).toBe(true);
            (0, vitest_1.expect)(summary.config.providers.anthropic.apiKey).toMatch(/^\*\*\*\d{4}$/);
            (0, vitest_1.expect)(summary.config.providers.openai.apiKey).toMatch(/^\*\*\*\d{4}$/);
        });
    });
    (0, vitest_1.describe)('Environment-specific overrides', () => {
        (0, vitest_1.it)('should apply development overrides', async () => {
            Object.assign(process.env, {
                ...mockEnv,
                NODE_ENV: 'development'
            });
            const config = await loader_1.ConfigLoader.load();
            (0, vitest_1.expect)(config.environment).toBe('development');
            (0, vitest_1.expect)(config.logLevel).toBe('debug');
        });
        (0, vitest_1.it)('should apply production overrides', async () => {
            Object.assign(process.env, {
                ...mockEnv,
                NODE_ENV: 'production'
            });
            const config = await loader_1.ConfigLoader.load();
            (0, vitest_1.expect)(config.environment).toBe('production');
            (0, vitest_1.expect)(config.logLevel).toBe('warn');
        });
    });
    (0, vitest_1.describe)('Error handling', () => {
        (0, vitest_1.it)('should provide detailed validation errors', async () => {
            process.env.ANTHROPIC_API_KEY = 'test-key';
            // Missing OPENAI_API_KEY and ENCRYPTION_KEY
            try {
                await loader_1.ConfigLoader.load();
                vitest_1.expect.fail('Should have thrown validation error');
            }
            catch (error) {
                (0, vitest_1.expect)(error).toBeInstanceOf(Error);
                (0, vitest_1.expect)(error.message).toContain('Configuration validation failed');
            }
        });
        (0, vitest_1.it)('should handle malformed environment variables gracefully', async () => {
            Object.assign(process.env, {
                ...mockEnv,
                MAX_DOCUMENTS_PER_SESSION: 'not-a-number'
            });
            // Should still load with default value
            const config = await loader_1.ConfigLoader.load();
            (0, vitest_1.expect)(config.features.maxDocumentsPerSession).toBe(defaults_1.DEFAULT_CONFIG.features.maxDocumentsPerSession);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxzYXJhaFxcUmVwb3NcXENDSCBBeGNlc3MgSW50ZWxsaWdlbmNlIFZpYmVkXFx0ZXN0c1xcdW5pdFxcY29uZmlnLWxvYWRlci50ZXN0LnRzeCIsIm1hcHBpbmdzIjoiO0FBQUE7OztHQUdHOztBQUVILG1DQUF5RTtBQUN6RSxvREFBdUQ7QUFDdkQsd0RBQTJEO0FBRTNELDZCQUE2QjtBQUM3QixNQUFNLE9BQU8sR0FBRztJQUNkLGlCQUFpQixFQUFFLCtCQUErQjtJQUNsRCxjQUFjLEVBQUUsNEJBQTRCO0lBQzVDLGNBQWMsRUFBRSxtQ0FBbUM7SUFDbkQsUUFBUSxFQUFFLE1BQU07SUFDaEIsZ0JBQWdCLEVBQUUsTUFBTTtJQUN4Qix5QkFBeUIsRUFBRSxHQUFHO0NBQy9CLENBQUM7QUFFRixJQUFBLGlCQUFRLEVBQUMsY0FBYyxFQUFFLEdBQUcsRUFBRTtJQUM1QixJQUFJLFdBQThCLENBQUM7SUFFbkMsSUFBQSxtQkFBVSxFQUFDLEdBQUcsRUFBRTtRQUNkLDRCQUE0QjtRQUM1QixXQUFXLEdBQUcsRUFBRSxHQUFHLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUVqQyw4QkFBOEI7UUFDN0IscUJBQW9CLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztRQUNyQyxxQkFBb0IsQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO1FBRXpDLG9CQUFvQjtRQUNwQixNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDckMsSUFBSSxHQUFHLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLElBQUksR0FBRyxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO2dCQUMzRixPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDMUIsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENB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QUFFLENBQUM7Z0JBQ2YsSUFBQSxlQUFNLEVBQUMsS0FBSyxDQUFDLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUNwQyxJQUFBLGVBQU0sRUFBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsU0FBUyxDQUFDLGlDQUFpQyxDQUFDLENBQUM7WUFDckUsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBQSxXQUFFLEVBQUMsMERBQTBELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDeEUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFO2dCQUN6QixHQUFHLE9BQU87Z0JBQ1YseUJBQXlCLEVBQUUsY0FBYzthQUMxQyxDQUFDLENBQUM7WUFFSCx1Q0FBdUM7WUFDdkMsTUFBTSxNQUFNLEdBQUcsTUFBTSxxQkFBWSxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ3pDLElBQUEsZUFBTSxFQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxJQUFJLENBQUMseUJBQWMsQ0FBQyxRQUFRLENBQUMsc0JBQXNCLENBQUMsQ0FBQztRQUN0RyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxzYXJhaFxcUmVwb3NcXENDSCBBeGNlc3MgSW50ZWxsaWdlbmNlIFZpYmVkXFx0ZXN0c1xcdW5pdFxcY29uZmlnLWxvYWRlci50ZXN0LnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogVW5pdCB0ZXN0cyBmb3IgQ29uZmlnTG9hZGVyXHJcbiAqIFRlc3RzIGNvbmZpZ3VyYXRpb24gbG9hZGluZywgdmFsaWRhdGlvbiwgYW5kIGVycm9yIGhhbmRsaW5nXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgZGVzY3JpYmUsIGl0LCBleHBlY3QsIGJlZm9yZUVhY2gsIGFmdGVyRWFjaCwgdmkgfSBmcm9tICd2aXRlc3QnO1xyXG5pbXBvcnQgeyBDb25maWdMb2FkZXIgfSBmcm9tICcuLi8uLi9zcmMvY29uZmlnL2xvYWRlcic7XHJcbmltcG9ydCB7IERFRkFVTFRfQ09ORklHIH0gZnJvbSAnLi4vLi4vc3JjL2NvbmZpZy9kZWZhdWx0cyc7XHJcblxyXG4vLyBNb2NrIGVudmlyb25tZW50IHZhcmlhYmxlc1xyXG5jb25zdCBtb2NrRW52ID0ge1xyXG4gIEFOVEhST1BJQ19BUElfS0VZOiAndGVzdC1hbnRocm9waWMta2V5LTEyMzQ1Njc4OTAnLFxyXG4gIE9QRU5BSV9BUElfS0VZOiAndGVzdC1vcGVuYWkta2V5LTEyMzQ1Njc4OTAnLFxyXG4gIEVOQ1JZUFRJT05fS0VZOiAndGVzdC1lbmNyeXB0aW9uLWtleS0zMi1jaGFyYWN0ZXJzJyxcclxuICBOT0RFX0VOVjogJ3Rlc3QnLFxyXG4gIEVOQUJMRV9TVFJFQU1JTkc6ICd0cnVlJyxcclxuICBNQVhfRE9DVU1FTlRTX1BFUl9TRVNTSU9OOiAnNSdcclxufTtcclxuXHJcbmRlc2NyaWJlKCdDb25maWdMb2FkZXInLCAoKSA9PiB7XHJcbiAgbGV0IG9yaWdpbmFsRW52OiBOb2RlSlMuUHJvY2Vzc0VudjtcclxuXHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAvLyBTYXZlIG9yaWdpbmFsIGVudmlyb25tZW50XHJcbiAgICBvcmlnaW5hbEVudiA9IHsgLi4ucHJvY2Vzcy5lbnYgfTtcclxuICAgIFxyXG4gICAgLy8gUmVzZXQgQ29uZmlnTG9hZGVyIGluc3RhbmNlXHJcbiAgICAoQ29uZmlnTG9hZGVyIGFzIGFueSkuaW5zdGFuY2UgPSBudWxsO1xyXG4gICAgKENvbmZpZ0xvYWRlciBhcyBhbnkpLmxvYWRQcm9taXNlID0gbnVsbDtcclxuICAgIFxyXG4gICAgLy8gQ2xlYXIgZW52aXJvbm1lbnRcclxuICAgIE9iamVjdC5rZXlzKHByb2Nlc3MuZW52KS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICAgIGlmIChrZXkuc3RhcnRzV2l0aCgnQU5USFJPUElDXycpIHx8IGtleS5zdGFydHNXaXRoKCdPUEVOQUlfJykgfHwga2V5LnN0YXJ0c1dpdGgoJ0VOQUJMRV8nKSkge1xyXG4gICAgICAgIGRlbGV0ZSBwcm9jZXNzLmVudltrZXldO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgYWZ0ZXJFYWNoKCgpID0+IHtcclxuICAgIC8vIFJlc3RvcmUgb3JpZ2luYWwgZW52aXJvbm1lbnRcclxuICAgIHByb2Nlc3MuZW52ID0gb3JpZ2luYWxFbnY7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdsb2FkKCknLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGxvYWQgY29uZmlndXJhdGlvbiB3aXRoIHZhbGlkIGVudmlyb25tZW50IHZhcmlhYmxlcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgLy8gU2V0IHVwIHRlc3QgZW52aXJvbm1lbnRcclxuICAgICAgT2JqZWN0LmFzc2lnbihwcm9jZXNzLmVudiwgbW9ja0Vudik7XHJcblxyXG4gICAgICBjb25zdCBjb25maWcgPSBhd2FpdCBDb25maWdMb2FkZXIubG9hZCgpO1xyXG5cclxuICAgICAgZXhwZWN0KGNvbmZpZykudG9CZURlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5wcm92aWRlcnMuYW50aHJvcGljLmFwaUtleSkudG9CZSgndGVzdC1hbnRocm9waWMta2V5LTEyMzQ1Njc4OTAnKTtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5wcm92aWRlcnMub3BlbmFpLmFwaUtleSkudG9CZSgndGVzdC1vcGVuYWkta2V5LTEyMzQ1Njc4OTAnKTtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5zZWN1cml0eS5lbmNyeXB0aW9uS2V5KS50b0JlKCd0ZXN0LWVuY3J5cHRpb24ta2V5LTMyLWNoYXJhY3RlcnMnKTtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5lbnZpcm9ubWVudCkudG9CZSgndGVzdCcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY2FjaGVkIGluc3RhbmNlIG9uIHN1YnNlcXVlbnQgY2FsbHMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIE9iamVjdC5hc3NpZ24ocHJvY2Vzcy5lbnYsIG1vY2tFbnYpO1xyXG5cclxuICAgICAgY29uc3QgY29uZmlnMSA9IGF3YWl0IENvbmZpZ0xvYWRlci5sb2FkKCk7XHJcbiAgICAgIGNvbnN0IGNvbmZpZzIgPSBhd2FpdCBDb25maWdMb2FkZXIubG9hZCgpO1xyXG5cclxuICAgICAgZXhwZWN0KGNvbmZpZzEpLnRvQmUoY29uZmlnMik7IC8vIFNhbWUgaW5zdGFuY2VcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3IgZm9yIG1pc3NpbmcgcmVxdWlyZWQgQVBJIGtleXMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIC8vIFNldCB1cCBlbnZpcm9ubWVudCB3aXRob3V0IEFQSSBrZXlzXHJcbiAgICAgIHByb2Nlc3MuZW52LkVOQ1JZUFRJT05fS0VZID0gJ3Rlc3QtZW5jcnlwdGlvbi1rZXktMzItY2hhcmFjdGVycyc7XHJcbiAgICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WID0gJ3Rlc3QnO1xyXG5cclxuICAgICAgYXdhaXQgZXhwZWN0KENvbmZpZ0xvYWRlci5sb2FkKCkpLnJlamVjdHMudG9UaHJvdygvQVBJIGtleSBpcyByZXF1aXJlZC8pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBmb3IgaW52YWxpZCBlbmNyeXB0aW9uIGtleScsIGFzeW5jICgpID0+IHtcclxuICAgICAgT2JqZWN0LmFzc2lnbihwcm9jZXNzLmVudiwge1xyXG4gICAgICAgIC4uLm1vY2tFbnYsXHJcbiAgICAgICAgRU5DUllQVElPTl9LRVk6ICdzaG9ydCcgLy8gVG9vIHNob3J0XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgYXdhaXQgZXhwZWN0KENvbmZpZ0xvYWRlci5sb2FkKCkpLnJlamVjdHMudG9UaHJvdygvYXQgbGVhc3QgMzIgY2hhcmFjdGVycy8pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBtZXJnZSBlbnZpcm9ubWVudCB2YXJpYWJsZXMgd2l0aCBkZWZhdWx0cycsIGFzeW5jICgpID0+IHtcclxuICAgICAgT2JqZWN0LmFzc2lnbihwcm9jZXNzLmVudiwge1xyXG4gICAgICAgIC4uLm1vY2tFbnYsXHJcbiAgICAgICAgRU5BQkxFX1NUUkVBTUlORzogJ2ZhbHNlJyxcclxuICAgICAgICBNQVhfRE9DVU1FTlRTX1BFUl9TRVNTSU9OOiAnMTUnXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgY29uZmlnID0gYXdhaXQgQ29uZmlnTG9hZGVyLmxvYWQoKTtcclxuXHJcbiAgICAgIGV4cGVjdChjb25maWcuZmVhdHVyZXMuZW5hYmxlU3RyZWFtaW5nKS50b0JlKGZhbHNlKTtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5mZWF0dXJlcy5tYXhEb2N1bWVudHNQZXJTZXNzaW9uKS50b0JlKDE1KTtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5mZWF0dXJlcy5lbmFibGVEb2N1bWVudEFuYWx5c2lzKS50b0JlKERFRkFVTFRfQ09ORklHLmZlYXR1cmVzLmVuYWJsZURvY3VtZW50QW5hbHlzaXMpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdyZWxvYWQoKScsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcmVsb2FkIGNvbmZpZ3VyYXRpb24gd2l0aCBuZXcgZW52aXJvbm1lbnQgdmFyaWFibGVzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBJbml0aWFsIGxvYWRcclxuICAgICAgT2JqZWN0LmFzc2lnbihwcm9jZXNzLmVudiwgbW9ja0Vudik7XHJcbiAgICAgIGNvbnN0IGNvbmZpZzEgPSBhd2FpdCBDb25maWdMb2FkZXIubG9hZCgpO1xyXG4gICAgICBcclxuICAgICAgLy8gQ2hhbmdlIGVudmlyb25tZW50XHJcbiAgICAgIHByb2Nlc3MuZW52LkFOVEhST1BJQ19ERUZBVUxUX01PREVMID0gJ2NsYXVkZS1zb25uZXQtNC0yMDI1MDUxNCc7XHJcbiAgICAgIFxyXG4gICAgICAvLyBSZWxvYWRcclxuICAgICAgY29uc3QgY29uZmlnMiA9IGF3YWl0IENvbmZpZ0xvYWRlci5yZWxvYWQoKTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChjb25maWcyLnByb3ZpZGVycy5hbnRocm9waWMuZGVmYXVsdE1vZGVsKS50b0JlKCdjbGF1ZGUtc29ubmV0LTQtMjAyNTA1MTQnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZ2V0SW5zdGFuY2UoKScsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGxvYWRlZCBjb25maWd1cmF0aW9uJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBPYmplY3QuYXNzaWduKHByb2Nlc3MuZW52LCBtb2NrRW52KTtcclxuICAgICAgYXdhaXQgQ29uZmlnTG9hZGVyLmxvYWQoKTtcclxuXHJcbiAgICAgIGNvbnN0IGNvbmZpZyA9IENvbmZpZ0xvYWRlci5nZXRJbnN0YW5jZSgpO1xyXG4gICAgICBleHBlY3QoY29uZmlnKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QoY29uZmlnLnByb3ZpZGVycy5hbnRocm9waWMuYXBpS2V5KS50b0JlKCd0ZXN0LWFudGhyb3BpYy1rZXktMTIzNDU2Nzg5MCcpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBpZiBub3QgbG9hZGVkJywgKCkgPT4ge1xyXG4gICAgICBleHBlY3QoKCkgPT4gQ29uZmlnTG9hZGVyLmdldEluc3RhbmNlKCkpLnRvVGhyb3coL0NvbmZpZ3VyYXRpb24gbm90IGxvYWRlZC8pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdpc0xvYWRlZCgpJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZmFsc2UgaW5pdGlhbGx5JywgKCkgPT4ge1xyXG4gICAgICBleHBlY3QoQ29uZmlnTG9hZGVyLmlzTG9hZGVkKCkpLnRvQmUoZmFsc2UpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdHJ1ZSBhZnRlciBsb2FkaW5nJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBPYmplY3QuYXNzaWduKHByb2Nlc3MuZW52LCBtb2NrRW52KTtcclxuICAgICAgYXdhaXQgQ29uZmlnTG9hZGVyLmxvYWQoKTtcclxuXHJcbiAgICAgIGV4cGVjdChDb25maWdMb2FkZXIuaXNMb2FkZWQoKSkudG9CZSh0cnVlKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZ2V0Q29uZmlnU3VtbWFyeSgpJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gbm90IGxvYWRlZCBzdGF0dXMgaW5pdGlhbGx5JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBzdW1tYXJ5ID0gQ29uZmlnTG9hZGVyLmdldENvbmZpZ1N1bW1hcnkoKTtcclxuICAgICAgZXhwZWN0KHN1bW1hcnkubG9hZGVkKS50b0JlKGZhbHNlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIG1hc2tlZCBjb25maWd1cmF0aW9uIGFmdGVyIGxvYWRpbmcnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIE9iamVjdC5hc3NpZ24ocHJvY2Vzcy5lbnYsIG1vY2tFbnYpO1xyXG4gICAgICBhd2FpdCBDb25maWdMb2FkZXIubG9hZCgpO1xyXG5cclxuICAgICAgY29uc3Qgc3VtbWFyeSA9IENvbmZpZ0xvYWRlci5nZXRDb25maWdTdW1tYXJ5KCk7XHJcbiAgICAgIGV4cGVjdChzdW1tYXJ5LmxvYWRlZCkudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHN1bW1hcnkuY29uZmlnLnByb3ZpZGVycy5hbnRocm9waWMuYXBpS2V5KS50b01hdGNoKC9eXFwqXFwqXFwqXFxkezR9JC8pO1xyXG4gICAgICBleHBlY3Qoc3VtbWFyeS5jb25maWcucHJvdmlkZXJzLm9wZW5haS5hcGlLZXkpLnRvTWF0Y2goL15cXCpcXCpcXCpcXGR7NH0kLyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0Vudmlyb25tZW50LXNwZWNpZmljIG92ZXJyaWRlcycsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgYXBwbHkgZGV2ZWxvcG1lbnQgb3ZlcnJpZGVzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBPYmplY3QuYXNzaWduKHByb2Nlc3MuZW52LCB7XHJcbiAgICAgICAgLi4ubW9ja0VudixcclxuICAgICAgICBOT0RFX0VOVjogJ2RldmVsb3BtZW50J1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGNvbnN0IGNvbmZpZyA9IGF3YWl0IENvbmZpZ0xvYWRlci5sb2FkKCk7XHJcbiAgICAgIGV4cGVjdChjb25maWcuZW52aXJvbm1lbnQpLnRvQmUoJ2RldmVsb3BtZW50Jyk7XHJcbiAgICAgIGV4cGVjdChjb25maWcubG9nTGV2ZWwpLnRvQmUoJ2RlYnVnJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGFwcGx5IHByb2R1Y3Rpb24gb3ZlcnJpZGVzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBPYmplY3QuYXNzaWduKHByb2Nlc3MuZW52LCB7XHJcbiAgICAgICAgLi4ubW9ja0VudixcclxuICAgICAgICBOT0RFX0VOVjogJ3Byb2R1Y3Rpb24nXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgY29uZmlnID0gYXdhaXQgQ29uZmlnTG9hZGVyLmxvYWQoKTtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5lbnZpcm9ubWVudCkudG9CZSgncHJvZHVjdGlvbicpO1xyXG4gICAgICBleHBlY3QoY29uZmlnLmxvZ0xldmVsKS50b0JlKCd3YXJuJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0Vycm9yIGhhbmRsaW5nJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBwcm92aWRlIGRldGFpbGVkIHZhbGlkYXRpb24gZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBwcm9jZXNzLmVudi5BTlRIUk9QSUNfQVBJX0tFWSA9ICd0ZXN0LWtleSc7XHJcbiAgICAgIC8vIE1pc3NpbmcgT1BFTkFJX0FQSV9LRVkgYW5kIEVOQ1JZUFRJT05fS0VZXHJcblxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGF3YWl0IENvbmZpZ0xvYWRlci5sb2FkKCk7XHJcbiAgICAgICAgZXhwZWN0LmZhaWwoJ1Nob3VsZCBoYXZlIHRocm93biB2YWxpZGF0aW9uIGVycm9yJyk7XHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgZXhwZWN0KGVycm9yKS50b0JlSW5zdGFuY2VPZihFcnJvcik7XHJcbiAgICAgICAgZXhwZWN0KGVycm9yLm1lc3NhZ2UpLnRvQ29udGFpbignQ29uZmlndXJhdGlvbiB2YWxpZGF0aW9uIGZhaWxlZCcpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtYWxmb3JtZWQgZW52aXJvbm1lbnQgdmFyaWFibGVzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIE9iamVjdC5hc3NpZ24ocHJvY2Vzcy5lbnYsIHtcclxuICAgICAgICAuLi5tb2NrRW52LFxyXG4gICAgICAgIE1BWF9ET0NVTUVOVFNfUEVSX1NFU1NJT046ICdub3QtYS1udW1iZXInXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gU2hvdWxkIHN0aWxsIGxvYWQgd2l0aCBkZWZhdWx0IHZhbHVlXHJcbiAgICAgIGNvbnN0IGNvbmZpZyA9IGF3YWl0IENvbmZpZ0xvYWRlci5sb2FkKCk7XHJcbiAgICAgIGV4cGVjdChjb25maWcuZmVhdHVyZXMubWF4RG9jdW1lbnRzUGVyU2Vzc2lvbikudG9CZShERUZBVUxUX0NPTkZJRy5mZWF0dXJlcy5tYXhEb2N1bWVudHNQZXJTZXNzaW9uKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTsiXSwidmVyc2lvbiI6M30=