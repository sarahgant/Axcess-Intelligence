{"version":3,"names":["UI","require","selection","resolveCaretPosition","setSelectionPerMouseDown","document","target","clickCount","node","offset","hasNoSelection","targetHasOwnSelection","hasOwnSelection","text","String","getUIValue","textContent","start","end","getTextRange","setUISelection","anchorOffset","undefined","length","focusOffset","startNode","startOffset","endNode","endOffset","range","ownerDocument","createRange","setStart","setEnd","e","Error","getSelection","removeAllRanges","addRange","cloneRange","pos","textPos","substr","match","exports"],"sources":["setSelectionPerMouse.js"],"sourcesContent":["'use strict';\n\nvar UI = require('../../document/UI.js');\nrequire('../../utils/dataTransfer/Clipboard.js');\nvar selection = require('../../utils/focus/selection.js');\nvar resolveCaretPosition = require('./resolveCaretPosition.js');\n\nfunction setSelectionPerMouseDown({ document, target, clickCount, node, offset }) {\n    if (selection.hasNoSelection(target)) {\n        return;\n    }\n    const targetHasOwnSelection = selection.hasOwnSelection(target);\n    // On non-input elements the text selection per multiple click\n    // can extend beyond the target boundaries.\n    // The exact mechanism what is considered in the same line is unclear.\n    // Looks it might be every inline element.\n    // TODO: Check what might be considered part of the same line of text.\n    const text = String(targetHasOwnSelection ? UI.getUIValue(target) : target.textContent);\n    const [start, end] = node ? // which elements might be considered in the same line of text.\n    // TODO: support expanding initial range on multiple clicks if node is given\n    [\n        offset,\n        offset\n    ] : getTextRange(text, offset, clickCount);\n    // TODO: implement modifying selection per shift/ctrl+mouse\n    if (targetHasOwnSelection) {\n        UI.setUISelection(target, {\n            anchorOffset: start !== null && start !== undefined ? start : text.length,\n            focusOffset: end !== null && end !== undefined ? end : text.length\n        });\n        return {\n            node: target,\n            start: start !== null && start !== undefined ? start : 0,\n            end: end !== null && end !== undefined ? end : text.length\n        };\n    } else {\n        const { node: startNode, offset: startOffset } = resolveCaretPosition.resolveCaretPosition({\n            target,\n            node,\n            offset: start\n        });\n        const { node: endNode, offset: endOffset } = resolveCaretPosition.resolveCaretPosition({\n            target,\n            node,\n            offset: end\n        });\n        const range = target.ownerDocument.createRange();\n        try {\n            range.setStart(startNode, startOffset);\n            range.setEnd(endNode, endOffset);\n        } catch (e) {\n            throw new Error('The given offset is out of bounds.');\n        }\n        const selection = document.getSelection();\n        selection === null || selection === undefined ? undefined : selection.removeAllRanges();\n        selection === null || selection === undefined ? undefined : selection.addRange(range.cloneRange());\n        return range;\n    }\n}\nfunction getTextRange(text, pos, clickCount) {\n    if (clickCount % 3 === 1 || text.length === 0) {\n        return [\n            pos,\n            pos\n        ];\n    }\n    const textPos = pos !== null && pos !== undefined ? pos : text.length;\n    if (clickCount % 3 === 2) {\n        return [\n            textPos - text.substr(0, pos).match(/(\\w+|\\s+|\\W)?$/)[0].length,\n            pos === undefined ? pos : pos + text.substr(pos).match(/^(\\w+|\\s+|\\W)?/)[0].length\n        ];\n    }\n    // triple click\n    return [\n        textPos - text.substr(0, pos).match(/[^\\r\\n]*$/)[0].length,\n        pos === undefined ? pos : pos + text.substr(pos).match(/^[^\\r\\n]*/)[0].length\n    ];\n}\n\nexports.setSelectionPerMouseDown = setSelectionPerMouseDown;\n"],"mappings":"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","ignoreList":[]}