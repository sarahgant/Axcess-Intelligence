0aa9615648e6c4408ccffde67b826f4f
'use strict';

var UI = require('../../document/UI.js');
require('../../utils/dataTransfer/Clipboard.js');
var selection = require('../../utils/focus/selection.js');
var resolveCaretPosition = require('./resolveCaretPosition.js');
function setSelectionPerMouseDown({
  document,
  target,
  clickCount,
  node,
  offset
}) {
  if (selection.hasNoSelection(target)) {
    return;
  }
  const targetHasOwnSelection = selection.hasOwnSelection(target);
  // On non-input elements the text selection per multiple click
  // can extend beyond the target boundaries.
  // The exact mechanism what is considered in the same line is unclear.
  // Looks it might be every inline element.
  // TODO: Check what might be considered part of the same line of text.
  const text = String(targetHasOwnSelection ? UI.getUIValue(target) : target.textContent);
  const [start, end] = node ?
  // which elements might be considered in the same line of text.
  // TODO: support expanding initial range on multiple clicks if node is given
  [offset, offset] : getTextRange(text, offset, clickCount);
  // TODO: implement modifying selection per shift/ctrl+mouse
  if (targetHasOwnSelection) {
    UI.setUISelection(target, {
      anchorOffset: start !== null && start !== undefined ? start : text.length,
      focusOffset: end !== null && end !== undefined ? end : text.length
    });
    return {
      node: target,
      start: start !== null && start !== undefined ? start : 0,
      end: end !== null && end !== undefined ? end : text.length
    };
  } else {
    const {
      node: startNode,
      offset: startOffset
    } = resolveCaretPosition.resolveCaretPosition({
      target,
      node,
      offset: start
    });
    const {
      node: endNode,
      offset: endOffset
    } = resolveCaretPosition.resolveCaretPosition({
      target,
      node,
      offset: end
    });
    const range = target.ownerDocument.createRange();
    try {
      range.setStart(startNode, startOffset);
      range.setEnd(endNode, endOffset);
    } catch (e) {
      throw new Error('The given offset is out of bounds.');
    }
    const selection = document.getSelection();
    selection === null || selection === undefined ? undefined : selection.removeAllRanges();
    selection === null || selection === undefined ? undefined : selection.addRange(range.cloneRange());
    return range;
  }
}
function getTextRange(text, pos, clickCount) {
  if (clickCount % 3 === 1 || text.length === 0) {
    return [pos, pos];
  }
  const textPos = pos !== null && pos !== undefined ? pos : text.length;
  if (clickCount % 3 === 2) {
    return [textPos - text.substr(0, pos).match(/(\w+|\s+|\W)?$/)[0].length, pos === undefined ? pos : pos + text.substr(pos).match(/^(\w+|\s+|\W)?/)[0].length];
  }
  // triple click
  return [textPos - text.substr(0, pos).match(/[^\r\n]*$/)[0].length, pos === undefined ? pos : pos + text.substr(pos).match(/^[^\r\n]*/)[0].length];
}
exports.setSelectionPerMouseDown = setSelectionPerMouseDown;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVSSIsInJlcXVpcmUiLCJzZWxlY3Rpb24iLCJyZXNvbHZlQ2FyZXRQb3NpdGlvbiIsInNldFNlbGVjdGlvblBlck1vdXNlRG93biIsImRvY3VtZW50IiwidGFyZ2V0IiwiY2xpY2tDb3VudCIsIm5vZGUiLCJvZmZzZXQiLCJoYXNOb1NlbGVjdGlvbiIsInRhcmdldEhhc093blNlbGVjdGlvbiIsImhhc093blNlbGVjdGlvbiIsInRleHQiLCJTdHJpbmciLCJnZXRVSVZhbHVlIiwidGV4dENvbnRlbnQiLCJzdGFydCIsImVuZCIsImdldFRleHRSYW5nZSIsInNldFVJU2VsZWN0aW9uIiwiYW5jaG9yT2Zmc2V0IiwidW5kZWZpbmVkIiwibGVuZ3RoIiwiZm9jdXNPZmZzZXQiLCJzdGFydE5vZGUiLCJzdGFydE9mZnNldCIsImVuZE5vZGUiLCJlbmRPZmZzZXQiLCJyYW5nZSIsIm93bmVyRG9jdW1lbnQiLCJjcmVhdGVSYW5nZSIsInNldFN0YXJ0Iiwic2V0RW5kIiwiZSIsIkVycm9yIiwiZ2V0U2VsZWN0aW9uIiwicmVtb3ZlQWxsUmFuZ2VzIiwiYWRkUmFuZ2UiLCJjbG9uZVJhbmdlIiwicG9zIiwidGV4dFBvcyIsInN1YnN0ciIsIm1hdGNoIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInNldFNlbGVjdGlvblBlck1vdXNlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxudmFyIFVJID0gcmVxdWlyZSgnLi4vLi4vZG9jdW1lbnQvVUkuanMnKTtcbnJlcXVpcmUoJy4uLy4uL3V0aWxzL2RhdGFUcmFuc2Zlci9DbGlwYm9hcmQuanMnKTtcbnZhciBzZWxlY3Rpb24gPSByZXF1aXJlKCcuLi8uLi91dGlscy9mb2N1cy9zZWxlY3Rpb24uanMnKTtcbnZhciByZXNvbHZlQ2FyZXRQb3NpdGlvbiA9IHJlcXVpcmUoJy4vcmVzb2x2ZUNhcmV0UG9zaXRpb24uanMnKTtcblxuZnVuY3Rpb24gc2V0U2VsZWN0aW9uUGVyTW91c2VEb3duKHsgZG9jdW1lbnQsIHRhcmdldCwgY2xpY2tDb3VudCwgbm9kZSwgb2Zmc2V0IH0pIHtcbiAgICBpZiAoc2VsZWN0aW9uLmhhc05vU2VsZWN0aW9uKHRhcmdldCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCB0YXJnZXRIYXNPd25TZWxlY3Rpb24gPSBzZWxlY3Rpb24uaGFzT3duU2VsZWN0aW9uKHRhcmdldCk7XG4gICAgLy8gT24gbm9uLWlucHV0IGVsZW1lbnRzIHRoZSB0ZXh0IHNlbGVjdGlvbiBwZXIgbXVsdGlwbGUgY2xpY2tcbiAgICAvLyBjYW4gZXh0ZW5kIGJleW9uZCB0aGUgdGFyZ2V0IGJvdW5kYXJpZXMuXG4gICAgLy8gVGhlIGV4YWN0IG1lY2hhbmlzbSB3aGF0IGlzIGNvbnNpZGVyZWQgaW4gdGhlIHNhbWUgbGluZSBpcyB1bmNsZWFyLlxuICAgIC8vIExvb2tzIGl0IG1pZ2h0IGJlIGV2ZXJ5IGlubGluZSBlbGVtZW50LlxuICAgIC8vIFRPRE86IENoZWNrIHdoYXQgbWlnaHQgYmUgY29uc2lkZXJlZCBwYXJ0IG9mIHRoZSBzYW1lIGxpbmUgb2YgdGV4dC5cbiAgICBjb25zdCB0ZXh0ID0gU3RyaW5nKHRhcmdldEhhc093blNlbGVjdGlvbiA/IFVJLmdldFVJVmFsdWUodGFyZ2V0KSA6IHRhcmdldC50ZXh0Q29udGVudCk7XG4gICAgY29uc3QgW3N0YXJ0LCBlbmRdID0gbm9kZSA/IC8vIHdoaWNoIGVsZW1lbnRzIG1pZ2h0IGJlIGNvbnNpZGVyZWQgaW4gdGhlIHNhbWUgbGluZSBvZiB0ZXh0LlxuICAgIC8vIFRPRE86IHN1cHBvcnQgZXhwYW5kaW5nIGluaXRpYWwgcmFuZ2Ugb24gbXVsdGlwbGUgY2xpY2tzIGlmIG5vZGUgaXMgZ2l2ZW5cbiAgICBbXG4gICAgICAgIG9mZnNldCxcbiAgICAgICAgb2Zmc2V0XG4gICAgXSA6IGdldFRleHRSYW5nZSh0ZXh0LCBvZmZzZXQsIGNsaWNrQ291bnQpO1xuICAgIC8vIFRPRE86IGltcGxlbWVudCBtb2RpZnlpbmcgc2VsZWN0aW9uIHBlciBzaGlmdC9jdHJsK21vdXNlXG4gICAgaWYgKHRhcmdldEhhc093blNlbGVjdGlvbikge1xuICAgICAgICBVSS5zZXRVSVNlbGVjdGlvbih0YXJnZXQsIHtcbiAgICAgICAgICAgIGFuY2hvck9mZnNldDogc3RhcnQgIT09IG51bGwgJiYgc3RhcnQgIT09IHVuZGVmaW5lZCA/IHN0YXJ0IDogdGV4dC5sZW5ndGgsXG4gICAgICAgICAgICBmb2N1c09mZnNldDogZW5kICE9PSBudWxsICYmIGVuZCAhPT0gdW5kZWZpbmVkID8gZW5kIDogdGV4dC5sZW5ndGhcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBub2RlOiB0YXJnZXQsXG4gICAgICAgICAgICBzdGFydDogc3RhcnQgIT09IG51bGwgJiYgc3RhcnQgIT09IHVuZGVmaW5lZCA/IHN0YXJ0IDogMCxcbiAgICAgICAgICAgIGVuZDogZW5kICE9PSBudWxsICYmIGVuZCAhPT0gdW5kZWZpbmVkID8gZW5kIDogdGV4dC5sZW5ndGhcbiAgICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCB7IG5vZGU6IHN0YXJ0Tm9kZSwgb2Zmc2V0OiBzdGFydE9mZnNldCB9ID0gcmVzb2x2ZUNhcmV0UG9zaXRpb24ucmVzb2x2ZUNhcmV0UG9zaXRpb24oe1xuICAgICAgICAgICAgdGFyZ2V0LFxuICAgICAgICAgICAgbm9kZSxcbiAgICAgICAgICAgIG9mZnNldDogc3RhcnRcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHsgbm9kZTogZW5kTm9kZSwgb2Zmc2V0OiBlbmRPZmZzZXQgfSA9IHJlc29sdmVDYXJldFBvc2l0aW9uLnJlc29sdmVDYXJldFBvc2l0aW9uKHtcbiAgICAgICAgICAgIHRhcmdldCxcbiAgICAgICAgICAgIG5vZGUsXG4gICAgICAgICAgICBvZmZzZXQ6IGVuZFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgcmFuZ2UgPSB0YXJnZXQub3duZXJEb2N1bWVudC5jcmVhdGVSYW5nZSgpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmFuZ2Uuc2V0U3RhcnQoc3RhcnROb2RlLCBzdGFydE9mZnNldCk7XG4gICAgICAgICAgICByYW5nZS5zZXRFbmQoZW5kTm9kZSwgZW5kT2Zmc2V0KTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgZ2l2ZW4gb2Zmc2V0IGlzIG91dCBvZiBib3VuZHMuJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gZG9jdW1lbnQuZ2V0U2VsZWN0aW9uKCk7XG4gICAgICAgIHNlbGVjdGlvbiA9PT0gbnVsbCB8fCBzZWxlY3Rpb24gPT09IHVuZGVmaW5lZCA/IHVuZGVmaW5lZCA6IHNlbGVjdGlvbi5yZW1vdmVBbGxSYW5nZXMoKTtcbiAgICAgICAgc2VsZWN0aW9uID09PSBudWxsIHx8IHNlbGVjdGlvbiA9PT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkIDogc2VsZWN0aW9uLmFkZFJhbmdlKHJhbmdlLmNsb25lUmFuZ2UoKSk7XG4gICAgICAgIHJldHVybiByYW5nZTtcbiAgICB9XG59XG5mdW5jdGlvbiBnZXRUZXh0UmFuZ2UodGV4dCwgcG9zLCBjbGlja0NvdW50KSB7XG4gICAgaWYgKGNsaWNrQ291bnQgJSAzID09PSAxIHx8IHRleHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICBwb3MsXG4gICAgICAgICAgICBwb3NcbiAgICAgICAgXTtcbiAgICB9XG4gICAgY29uc3QgdGV4dFBvcyA9IHBvcyAhPT0gbnVsbCAmJiBwb3MgIT09IHVuZGVmaW5lZCA/IHBvcyA6IHRleHQubGVuZ3RoO1xuICAgIGlmIChjbGlja0NvdW50ICUgMyA9PT0gMikge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgdGV4dFBvcyAtIHRleHQuc3Vic3RyKDAsIHBvcykubWF0Y2goLyhcXHcrfFxccyt8XFxXKT8kLylbMF0ubGVuZ3RoLFxuICAgICAgICAgICAgcG9zID09PSB1bmRlZmluZWQgPyBwb3MgOiBwb3MgKyB0ZXh0LnN1YnN0cihwb3MpLm1hdGNoKC9eKFxcdyt8XFxzK3xcXFcpPy8pWzBdLmxlbmd0aFxuICAgICAgICBdO1xuICAgIH1cbiAgICAvLyB0cmlwbGUgY2xpY2tcbiAgICByZXR1cm4gW1xuICAgICAgICB0ZXh0UG9zIC0gdGV4dC5zdWJzdHIoMCwgcG9zKS5tYXRjaCgvW15cXHJcXG5dKiQvKVswXS5sZW5ndGgsXG4gICAgICAgIHBvcyA9PT0gdW5kZWZpbmVkID8gcG9zIDogcG9zICsgdGV4dC5zdWJzdHIocG9zKS5tYXRjaCgvXlteXFxyXFxuXSovKVswXS5sZW5ndGhcbiAgICBdO1xufVxuXG5leHBvcnRzLnNldFNlbGVjdGlvblBlck1vdXNlRG93biA9IHNldFNlbGVjdGlvblBlck1vdXNlRG93bjtcbiJdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWTs7QUFFWixJQUFJQSxFQUFFLEdBQUdDLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQztBQUN4Q0EsT0FBTyxDQUFDLHVDQUF1QyxDQUFDO0FBQ2hELElBQUlDLFNBQVMsR0FBR0QsT0FBTyxDQUFDLGdDQUFnQyxDQUFDO0FBQ3pELElBQUlFLG9CQUFvQixHQUFHRixPQUFPLENBQUMsMkJBQTJCLENBQUM7QUFFL0QsU0FBU0csd0JBQXdCQSxDQUFDO0VBQUVDLFFBQVE7RUFBRUMsTUFBTTtFQUFFQyxVQUFVO0VBQUVDLElBQUk7RUFBRUM7QUFBTyxDQUFDLEVBQUU7RUFDOUUsSUFBSVAsU0FBUyxDQUFDUSxjQUFjLENBQUNKLE1BQU0sQ0FBQyxFQUFFO0lBQ2xDO0VBQ0o7RUFDQSxNQUFNSyxxQkFBcUIsR0FBR1QsU0FBUyxDQUFDVSxlQUFlLENBQUNOLE1BQU0sQ0FBQztFQUMvRDtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0EsTUFBTU8sSUFBSSxHQUFHQyxNQUFNLENBQUNILHFCQUFxQixHQUFHWCxFQUFFLENBQUNlLFVBQVUsQ0FBQ1QsTUFBTSxDQUFDLEdBQUdBLE1B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