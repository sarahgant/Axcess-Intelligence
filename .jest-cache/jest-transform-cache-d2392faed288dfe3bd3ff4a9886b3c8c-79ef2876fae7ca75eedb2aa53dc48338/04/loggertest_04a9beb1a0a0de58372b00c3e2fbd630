06fc1875383cd466a1df52aebf367063
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const logger_1 = require("../../src/core/logging/logger");
// Mock console methods
const originalConsole = {
    log: console.log,
    error: console.error,
    warn: console.warn
};
beforeAll(() => {
    // Mock console methods
    console.log = jest.fn();
    console.error = jest.fn();
    console.warn = jest.fn();
});
afterAll(() => {
    // Restore console methods
    console.log = originalConsole.log;
    console.error = originalConsole.error;
    console.warn = originalConsole.warn;
});
beforeEach(() => {
    jest.clearAllMocks();
    // Set development environment for tests
    process.env.NODE_ENV = 'development';
    // Clear log buffer
    if (typeof window !== 'undefined') {
        window.__logBuffer = [];
    }
});
describe('Logger', () => {
    describe('Log Levels', () => {
        it('should log debug messages in development', () => {
            logger_1.logger.debug('Debug message', { test: 'data' });
            expect(console.log).toHaveBeenCalledWith(expect.stringContaining('[DEBUG]'), 'Debug message', { test: 'data' });
        });
        it('should log info messages', () => {
            logger_1.logger.info('Info message', { test: 'data' });
            expect(console.log).toHaveBeenCalledWith(expect.stringContaining('[INFO]'), 'Info message', { test: 'data' });
        });
        it('should log warning messages', () => {
            logger_1.logger.warn('Warning message', { test: 'data' });
            expect(console.log).toHaveBeenCalledWith(expect.stringContaining('[WARN]'), 'Warning message', { test: 'data' });
        });
        it('should log error messages', () => {
            logger_1.logger.error('Error message', { test: 'data' });
            expect(console.log).toHaveBeenCalledWith(expect.stringContaining('[ERROR]'), 'Error message', { test: 'data' });
        });
        it('should log fatal messages', () => {
            logger_1.logger.fatal('Fatal message', { test: 'data' });
            expect(console.log).toHaveBeenCalledWith(expect.stringContaining('[FATAL]'), 'Fatal message', { test: 'data' });
        });
    });
    describe('Component Logging', () => {
        it('should log with component context', () => {
            const componentLogger = logger_1.logger.component('TestComponent');
            componentLogger.info('Component message', { test: 'data' });
            expect(console.log).toHaveBeenCalledWith(expect.stringContaining('[INFO]'), 'Component message', { test: 'data' });
        });
    });
    describe('Action Logging', () => {
        it('should log with action context', () => {
            const actionLogger = logger_1.logger.action('TestAction');
            actionLogger.info('Action message', { test: 'data' });
            expect(console.log).toHaveBeenCalledWith(expect.stringContaining('[INFO]'), 'Action message', { test: 'data' });
        });
    });
    describe('Log Buffer', () => {
        it('should store logs in buffer', () => {
            logger_1.logger.info('Test message', { test: 'data' });
            const buffer = logger_1.logger.getLogBuffer();
            expect(buffer).toHaveLength(1);
            expect(buffer[0].message).toBe('Test message');
            expect(buffer[0].meta).toEqual({ test: 'data' });
        });
        it('should limit buffer to 100 entries', () => {
            // Add 101 logs
            for (let i = 0; i < 101; i++) {
                logger_1.logger.info(`Message ${i}`);
            }
            const buffer = logger_1.logger.getLogBuffer();
            expect(buffer).toHaveLength(100);
            expect(buffer[0].message).toBe('Message 1'); // First message should be removed
            expect(buffer[99].message).toBe('Message 100');
        });
        it('should clear buffer', () => {
            logger_1.logger.info('Test message');
            expect(logger_1.logger.getLogBuffer()).toHaveLength(1);
            logger_1.logger.clearLogBuffer();
            expect(logger_1.logger.getLogBuffer()).toHaveLength(0);
        });
    });
    describe('Log Export', () => {
        it('should export logs as JSON', () => {
            logger_1.logger.info('Test message', { test: 'data' });
            const exported = logger_1.logger.exportLogs();
            const parsed = JSON.parse(exported);
            expect(parsed).toHaveLength(1);
            expect(parsed[0].message).toBe('Test message');
            expect(parsed[0].meta).toEqual({ test: 'data' });
            expect(parsed[0]).toHaveProperty('timestamp');
            expect(parsed[0]).toHaveProperty('level');
        });
    });
    describe('Context Information', () => {
        it('should include correlation ID', () => {
            // Mock sessionStorage
            Object.defineProperty(window, 'sessionStorage', {
                value: {
                    getItem: jest.fn((key) => {
                        if (key === 'correlationId')
                            return 'test-correlation-id';
                        return null;
                    })
                },
                writable: true
            });
            logger_1.logger.info('Test message');
            const buffer = logger_1.logger.getLogBuffer();
            expect(buffer[0].correlationId).toBe('test-correlation-id');
        });
        it('should include user ID', () => {
            // Mock sessionStorage
            Object.defineProperty(window, 'sessionStorage', {
                value: {
                    getItem: jest.fn((key) => {
                        if (key === 'userId')
                            return 'test-user-id';
                        return null;
                    })
                },
                writable: true
            });
            logger_1.logger.info('Test message');
            const buffer = logger_1.logger.getLogBuffer();
            expect(buffer[0].userId).toBe('test-user-id');
        });
        it('should include session ID', () => {
            // Mock sessionStorage
            Object.defineProperty(window, 'sessionStorage', {
                value: {
                    getItem: jest.fn((key) => {
                        if (key === 'sessionId')
                            return 'test-session-id';
                        return null;
                    })
                },
                writable: true
            });
            logger_1.logger.info('Test message');
            const buffer = logger_1.logger.getLogBuffer();
            expect(buffer[0].sessionId).toBe('test-session-id');
        });
    });
    describe('Console Colors', () => {
        it('should use correct colors for different log levels', () => {
            const spy = jest.spyOn(console, 'log');
            logger_1.logger.debug('Debug message');
            logger_1.logger.info('Info message');
            logger_1.logger.warn('Warning message');
            logger_1.logger.error('Error message');
            logger_1.logger.fatal('Fatal message');
            expect(spy).toHaveBeenCalledWith(expect.stringContaining('[DEBUG]'), expect.stringContaining('color: gray'), 'Debug message', '');
            expect(spy).toHaveBeenCalledWith(expect.stringContaining('[INFO]'), expect.stringContaining('color: blue'), 'Info message', '');
            expect(spy).toHaveBeenCalledWith(expect.stringContaining('[WARN]'), expect.stringContaining('color: orange'), 'Warning message', '');
            expect(spy).toHaveBeenCalledWith(expect.stringContaining('[ERROR]'), expect.stringContaining('color: red'), 'Error message', '');
            expect(spy).toHaveBeenCalledWith(expect.stringContaining('[FATAL]'), expect.stringContaining('color: darkred'), 'Fatal message', '');
        });
    });
    describe('Global Access', () => {
        it('should be available on window object', () => {
            expect(window.__logger).toBeDefined();
            expect(window.__logger).toBe(logger_1.logger);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxzYXJhaFxcUmVwb3NcXENDSCBBeGNlc3MgSW50ZWxsaWdlbmNlIFZpYmVkXFx0ZXN0c1xcdW5pdFxcbG9nZ2VyLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSwwREFBaUU7QUFFakUsdUJBQXVCO0FBQ3ZCLE1BQU0sZUFBZSxHQUFHO0lBQ3BCLEdBQUcsRUFBRSxPQUFPLENBQUMsR0FBRztJQUNoQixLQUFLLEVBQUUsT0FBTyxDQUFDLEtBQUs7SUFDcEIsSUFBSSxFQUFFLE9BQU8sQ0FBQyxJQUFJO0NBQ3JCLENBQUM7QUFFRixTQUFTLENBQUMsR0FBRyxFQUFFO0lBQ1gsdUJBQXVCO0lBQ3ZCLE9BQU8sQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO0lBQ3hCLE9BQU8sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO0lBQzFCLE9BQU8sQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO0FBQzdCLENBQUMsQ0FBQyxDQUFDO0FBRUgsUUFBUSxDQUFDLEdBQUcsRUFBRTtJQUNWLDBCQUEwQjtJQUMxQixPQUFPLENBQUMsR0FBRyxHQUFHLGVBQWUsQ0FBQyxHQUFHLENBQUM7SUFDbEMsT0FBTyxDQUFDLEtBQUssR0FBRyxlQUFlLENBQUMsS0FBSyxDQUFDO0lBQ3RDLE9BQU8sQ0FBQyxJQUFJLEdBQUcsZUFBZSxDQUFDLElBQUksQ0FBQztBQUN4QyxDQUFDLENBQUMsQ0FBQztBQUVILFVBQVUsQ0FBQyxHQUFHLEVBQUU7SUFDZCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDckIsd0NBQXdDO0lBQ3hDLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxHQUFHLGFBQWEsQ0FBQztJQUNyQyxtQkFBbUI7SUFDbkIsSUFBSSxPQUFPLE1BQU0sS0FBSyxXQUFXLEVBQUUsQ0FBQztRQUNsQyxNQUFNLENBQUMsV0FBVyxHQUFHLEVBQUUsQ0FBQztJQUMxQixDQUFDO0FBQ0gsQ0FBQyxDQUFDLENBQUM7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TUFBTSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxFQUNqQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsZUFBZSxDQUFDLEVBQ3hDLGlCQUFpQixFQUNqQixFQUFFLENBQ0wsQ0FBQztZQUVGLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxvQkFBb0IsQ0FDNUIsTUFBTSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxFQUNsQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxDQUFDLEVBQ3JDLGVBQWUsRUFDZixFQUFFLENBQ0wsQ0FBQztZQUVGLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxvQkFBb0IsQ0FDNUIsTUFBTSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxFQUNsQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsZ0JBQWdCLENBQUMsRUFDekMsZUFBZSxFQUNmLEVBQUUsQ0FDTCxDQUFDO1FBQ04sQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFO1FBQzNCLEVBQUUsQ0FBQyxzQ0FBc0MsRUFBRSxHQUFHLEVBQUU7WUFDNUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUN0QyxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxlQUFNLENBQUMsQ0FBQztRQUN6QyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxzYXJhaFxcUmVwb3NcXENDSCBBeGNlc3MgSW50ZWxsaWdlbmNlIFZpYmVkXFx0ZXN0c1xcdW5pdFxcbG9nZ2VyLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbG9nZ2VyLCBMb2dMZXZlbCB9IGZyb20gJy4uLy4uL3NyYy9jb3JlL2xvZ2dpbmcvbG9nZ2VyJztcclxuXHJcbi8vIE1vY2sgY29uc29sZSBtZXRob2RzXHJcbmNvbnN0IG9yaWdpbmFsQ29uc29sZSA9IHtcclxuICAgIGxvZzogY29uc29sZS5sb2csXHJcbiAgICBlcnJvcjogY29uc29sZS5lcnJvcixcclxuICAgIHdhcm46IGNvbnNvbGUud2FyblxyXG59O1xyXG5cclxuYmVmb3JlQWxsKCgpID0+IHtcclxuICAgIC8vIE1vY2sgY29uc29sZSBtZXRob2RzXHJcbiAgICBjb25zb2xlLmxvZyA9IGplc3QuZm4oKTtcclxuICAgIGNvbnNvbGUuZXJyb3IgPSBqZXN0LmZuKCk7XHJcbiAgICBjb25zb2xlLndhcm4gPSBqZXN0LmZuKCk7XHJcbn0pO1xyXG5cclxuYWZ0ZXJBbGwoKCkgPT4ge1xyXG4gICAgLy8gUmVzdG9yZSBjb25zb2xlIG1ldGhvZHNcclxuICAgIGNvbnNvbGUubG9nID0gb3JpZ2luYWxDb25zb2xlLmxvZztcclxuICAgIGNvbnNvbGUuZXJyb3IgPSBvcmlnaW5hbENvbnNvbGUuZXJyb3I7XHJcbiAgICBjb25zb2xlLndhcm4gPSBvcmlnaW5hbENvbnNvbGUud2FybjtcclxufSk7XHJcblxyXG5iZWZvcmVFYWNoKCgpID0+IHtcclxuICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcclxuICAvLyBTZXQgZGV2ZWxvcG1lbnQgZW52aXJvbm1lbnQgZm9yIHRlc3RzXHJcbiAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPSAnZGV2ZWxvcG1lbnQnO1xyXG4gIC8vIENsZWFyIGxvZyBidWZmZXJcclxuICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgIHdpbmRvdy5fX2xvZ0J1ZmZlciA9IFtdO1xyXG4gIH1cclxufSk7XHJcblxyXG5kZXNjcmliZSgnTG9nZ2VyJywgKCkgPT4ge1xyXG4gICAgZGVzY3JpYmUoJ0xvZyBMZXZlbHMnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBsb2cgZGVidWcgbWVzc2FnZXMgaW4gZGV2ZWxvcG1lbnQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygnRGVidWcgbWVzc2FnZScsIHsgdGVzdDogJ2RhdGEnIH0pO1xyXG4gICAgICAgICAgICBleHBlY3QoY29uc29sZS5sb2cpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgICAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ1tERUJVR10nKSxcclxuICAgICAgICAgICAgICAgICdEZWJ1ZyBtZXNzYWdlJyxcclxuICAgICAgICAgICAgICAgIHsgdGVzdDogJ2RhdGEnIH1cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBsb2cgaW5mbyBtZXNzYWdlcycsICgpID0+IHtcclxuICAgICAgICAgICAgbG9nZ2VyLmluZm8oJ0luZm8gbWVzc2FnZScsIHsgdGVzdDogJ2RhdGEnIH0pO1xyXG4gICAgICAgICAgICBleHBlY3QoY29uc29sZS5sb2cpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgICAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ1tJTkZPXScpLFxyXG4gICAgICAgICAgICAgICAgJ0luZm8gbWVzc2FnZScsXHJcbiAgICAgICAgICAgICAgICB7IHRlc3Q6ICdkYXRhJyB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgbG9nIHdhcm5pbmcgbWVzc2FnZXMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGxvZ2dlci53YXJuKCdXYXJuaW5nIG1lc3NhZ2UnLCB7IHRlc3Q6ICdkYXRhJyB9KTtcclxuICAgICAgICAgICAgZXhwZWN0KGNvbnNvbGUubG9nKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICAgICAgICAgIGV4cGVjdC5zdHJpbmdDb250YWluaW5nKCdbV0FSTl0nKSxcclxuICAgICAgICAgICAgICAgICdXYXJuaW5nIG1lc3NhZ2UnLFxyXG4gICAgICAgICAgICAgICAgeyB0ZXN0OiAnZGF0YScgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGxvZyBlcnJvciBtZXNzYWdlcycsICgpID0+IHtcclxuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBtZXNzYWdlJywgeyB0ZXN0OiAnZGF0YScgfSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChjb25zb2xlLmxvZykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgICAgICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZygnW0VSUk9SXScpLFxyXG4gICAgICAgICAgICAgICAgJ0Vycm9yIG1lc3NhZ2UnLFxyXG4gICAgICAgICAgICAgICAgeyB0ZXN0OiAnZGF0YScgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGxvZyBmYXRhbCBtZXNzYWdlcycsICgpID0+IHtcclxuICAgICAgICAgICAgbG9nZ2VyLmZhdGFsKCdGYXRhbCBtZXNzYWdlJywgeyB0ZXN0OiAnZGF0YScgfSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChjb25zb2xlLmxvZykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgICAgICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZygnW0ZBVEFMXScpLFxyXG4gICAgICAgICAgICAgICAgJ0ZhdGFsIG1lc3NhZ2UnLFxyXG4gICAgICAgICAgICAgICAgeyB0ZXN0OiAnZGF0YScgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ0NvbXBvbmVudCBMb2dnaW5nJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgbG9nIHdpdGggY29tcG9uZW50IGNvbnRleHQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbXBvbmVudExvZ2dlciA9IGxvZ2dlci5jb21wb25lbnQoJ1Rlc3RDb21wb25lbnQnKTtcclxuICAgICAgICAgICAgY29tcG9uZW50TG9nZ2VyLmluZm8oJ0NvbXBvbmVudCBtZXNzYWdlJywgeyB0ZXN0OiAnZGF0YScgfSk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QoY29uc29sZS5sb2cpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgICAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ1tJTkZPXScpLFxyXG4gICAgICAgICAgICAgICAgJ0NvbXBvbmVudCBtZXNzYWdlJyxcclxuICAgICAgICAgICAgICAgIHsgdGVzdDogJ2RhdGEnIH1cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdBY3Rpb24gTG9nZ2luZycsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGxvZyB3aXRoIGFjdGlvbiBjb250ZXh0JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBhY3Rpb25Mb2dnZXIgPSBsb2dnZXIuYWN0aW9uKCdUZXN0QWN0aW9uJyk7XHJcbiAgICAgICAgICAgIGFjdGlvbkxvZ2dlci5pbmZvKCdBY3Rpb24gbWVzc2FnZScsIHsgdGVzdDogJ2RhdGEnIH0pO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KGNvbnNvbGUubG9nKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgICAgICAgICAgIGV4cGVjdC5zdHJpbmdDb250YWluaW5nKCdbSU5GT10nKSxcclxuICAgICAgICAgICAgICAgICdBY3Rpb24gbWVzc2FnZScsXHJcbiAgICAgICAgICAgICAgICB7IHRlc3Q6ICdkYXRhJyB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnTG9nIEJ1ZmZlcicsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIHN0b3JlIGxvZ3MgaW4gYnVmZmVyJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBsb2dnZXIuaW5mbygnVGVzdCBtZXNzYWdlJywgeyB0ZXN0OiAnZGF0YScgfSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBidWZmZXIgPSBsb2dnZXIuZ2V0TG9nQnVmZmVyKCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChidWZmZXIpLnRvSGF2ZUxlbmd0aCgxKTtcclxuICAgICAgICAgICAgZXhwZWN0KGJ1ZmZlclswXS5tZXNzYWdlKS50b0JlKCdUZXN0IG1lc3NhZ2UnKTtcclxuICAgICAgICAgICAgZXhwZWN0KGJ1ZmZlclswXS5tZXRhKS50b0VxdWFsKHsgdGVzdDogJ2RhdGEnIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGxpbWl0IGJ1ZmZlciB0byAxMDAgZW50cmllcycsICgpID0+IHtcclxuICAgICAgICAgICAgLy8gQWRkIDEwMSBsb2dzXHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTAxOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGBNZXNzYWdlICR7aX1gKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3QgYnVmZmVyID0gbG9nZ2VyLmdldExvZ0J1ZmZlcigpO1xyXG4gICAgICAgICAgICBleHBlY3QoYnVmZmVyKS50b0hhdmVMZW5ndGgoMTAwKTtcclxuICAgICAgICAgICAgZXhwZWN0KGJ1ZmZlclswXS5tZXNzYWdlKS50b0JlKCdNZXNzYWdlIDEnKTsgLy8gRmlyc3QgbWVzc2FnZSBzaG91bGQgYmUgcmVtb3ZlZFxyXG4gICAgICAgICAgICBleHBlY3QoYnVmZmVyWzk5XS5tZXNzYWdlKS50b0JlKCdNZXNzYWdlIDEwMCcpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGNsZWFyIGJ1ZmZlcicsICgpID0+IHtcclxuICAgICAgICAgICAgbG9nZ2VyLmluZm8oJ1Rlc3QgbWVzc2FnZScpO1xyXG4gICAgICAgICAgICBleHBlY3QobG9nZ2VyLmdldExvZ0J1ZmZlcigpKS50b0hhdmVMZW5ndGgoMSk7XHJcblxyXG4gICAgICAgICAgICBsb2dnZXIuY2xlYXJMb2dCdWZmZXIoKTtcclxuICAgICAgICAgICAgZXhwZWN0KGxvZ2dlci5nZXRMb2dCdWZmZXIoKSkudG9IYXZlTGVuZ3RoKDApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ0xvZyBFeHBvcnQnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBleHBvcnQgbG9ncyBhcyBKU09OJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBsb2dnZXIuaW5mbygnVGVzdCBtZXNzYWdlJywgeyB0ZXN0OiAnZGF0YScgfSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBleHBvcnRlZCA9IGxvZ2dlci5leHBvcnRMb2dzKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2UoZXhwb3J0ZWQpO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KHBhcnNlZCkudG9IYXZlTGVuZ3RoKDEpO1xyXG4gICAgICAgICAgICBleHBlY3QocGFyc2VkWzBdLm1lc3NhZ2UpLnRvQmUoJ1Rlc3QgbWVzc2FnZScpO1xyXG4gICAgICAgICAgICBleHBlY3QocGFyc2VkWzBdLm1ldGEpLnRvRXF1YWwoeyB0ZXN0OiAnZGF0YScgfSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChwYXJzZWRbMF0pLnRvSGF2ZVByb3BlcnR5KCd0aW1lc3RhbXAnKTtcclxuICAgICAgICAgICAgZXhwZWN0KHBhcnNlZFswXSkudG9IYXZlUHJvcGVydHkoJ2xldmVsJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnQ29udGV4dCBJbmZvcm1hdGlvbicsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGluY2x1ZGUgY29ycmVsYXRpb24gSUQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIC8vIE1vY2sgc2Vzc2lvblN0b3JhZ2VcclxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdywgJ3Nlc3Npb25TdG9yYWdlJywge1xyXG4gICAgICAgICAgICAgICAgdmFsdWU6IHtcclxuICAgICAgICAgICAgICAgICAgICBnZXRJdGVtOiBqZXN0LmZuKChrZXkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ2NvcnJlbGF0aW9uSWQnKSByZXR1cm4gJ3Rlc3QtY29ycmVsYXRpb24taWQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbG9nZ2VyLmluZm8oJ1Rlc3QgbWVzc2FnZScpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgYnVmZmVyID0gbG9nZ2VyLmdldExvZ0J1ZmZlcigpO1xyXG4gICAgICAgICAgICBleHBlY3QoYnVmZmVyWzBdLmNvcnJlbGF0aW9uSWQpLnRvQmUoJ3Rlc3QtY29ycmVsYXRpb24taWQnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBpbmNsdWRlIHVzZXIgSUQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIC8vIE1vY2sgc2Vzc2lvblN0b3JhZ2VcclxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdywgJ3Nlc3Npb25TdG9yYWdlJywge1xyXG4gICAgICAgICAgICAgICAgdmFsdWU6IHtcclxuICAgICAgICAgICAgICAgICAgICBnZXRJdGVtOiBqZXN0LmZuKChrZXkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3VzZXJJZCcpIHJldHVybiAndGVzdC11c2VyLWlkJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB3cml0YWJsZTogdHJ1ZVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCdUZXN0IG1lc3NhZ2UnKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGJ1ZmZlciA9IGxvZ2dlci5nZXRMb2dCdWZmZXIoKTtcclxuICAgICAgICAgICAgZXhwZWN0KGJ1ZmZlclswXS51c2VySWQpLnRvQmUoJ3Rlc3QtdXNlci1pZCcpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGluY2x1ZGUgc2Vzc2lvbiBJRCcsICgpID0+IHtcclxuICAgICAgICAgICAgLy8gTW9jayBzZXNzaW9uU3RvcmFnZVxyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAnc2Vzc2lvblN0b3JhZ2UnLCB7XHJcbiAgICAgICAgICAgICAgICB2YWx1ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGdldEl0ZW06IGplc3QuZm4oKGtleSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAnc2Vzc2lvbklkJykgcmV0dXJuICd0ZXN0LXNlc3Npb24taWQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgbG9nZ2VyLmluZm8oJ1Rlc3QgbWVzc2FnZScpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgYnVmZmVyID0gbG9nZ2VyLmdldExvZ0J1ZmZlcigpO1xyXG4gICAgICAgICAgICBleHBlY3QoYnVmZmVyWzBdLnNlc3Npb25JZCkudG9CZSgndGVzdC1zZXNzaW9uLWlkJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnQ29uc29sZSBDb2xvcnMnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCB1c2UgY29ycmVjdCBjb2xvcnMgZm9yIGRpZmZlcmVudCBsb2cgbGV2ZWxzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBzcHkgPSBqZXN0LnNweU9uKGNvbnNvbGUsICdsb2cnKTtcclxuXHJcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygnRGVidWcgbWVzc2FnZScpO1xyXG4gICAgICAgICAgICBsb2dnZXIuaW5mbygnSW5mbyBtZXNzYWdlJyk7XHJcbiAgICAgICAgICAgIGxvZ2dlci53YXJuKCdXYXJuaW5nIG1lc3NhZ2UnKTtcclxuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBtZXNzYWdlJyk7XHJcbiAgICAgICAgICAgIGxvZ2dlci5mYXRhbCgnRmF0YWwgbWVzc2FnZScpO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KHNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgICAgICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZygnW0RFQlVHXScpLFxyXG4gICAgICAgICAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ2NvbG9yOiBncmF5JyksXHJcbiAgICAgICAgICAgICAgICAnRGVidWcgbWVzc2FnZScsXHJcbiAgICAgICAgICAgICAgICAnJ1xyXG4gICAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KHNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgICAgICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZygnW0lORk9dJyksXHJcbiAgICAgICAgICAgICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZygnY29sb3I6IGJsdWUnKSxcclxuICAgICAgICAgICAgICAgICdJbmZvIG1lc3NhZ2UnLFxyXG4gICAgICAgICAgICAgICAgJydcclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChzcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgICAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ1tXQVJOXScpLFxyXG4gICAgICAgICAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ2NvbG9yOiBvcmFuZ2UnKSxcclxuICAgICAgICAgICAgICAgICdXYXJuaW5nIG1lc3NhZ2UnLFxyXG4gICAgICAgICAgICAgICAgJydcclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChzcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAgICAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ1tFUlJPUl0nKSxcclxuICAgICAgICAgICAgICAgIGV4cGVjdC5zdHJpbmdDb250YWluaW5nKCdjb2xvcjogcmVkJyksXHJcbiAgICAgICAgICAgICAgICAnRXJyb3IgbWVzc2FnZScsXHJcbiAgICAgICAgICAgICAgICAnJ1xyXG4gICAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KHNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICAgICAgICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZygnW0ZBVEFMXScpLFxyXG4gICAgICAgICAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ2NvbG9yOiBkYXJrcmVkJyksXHJcbiAgICAgICAgICAgICAgICAnRmF0YWwgbWVzc2FnZScsXHJcbiAgICAgICAgICAgICAgICAnJ1xyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ0dsb2JhbCBBY2Nlc3MnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBiZSBhdmFpbGFibGUgb24gd2luZG93IG9iamVjdCcsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KHdpbmRvdy5fX2xvZ2dlcikudG9CZURlZmluZWQoKTtcclxuICAgICAgICAgICAgZXhwZWN0KHdpbmRvdy5fX2xvZ2dlcikudG9CZShsb2dnZXIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn0pO1xyXG4iXSwidmVyc2lvbiI6M30=