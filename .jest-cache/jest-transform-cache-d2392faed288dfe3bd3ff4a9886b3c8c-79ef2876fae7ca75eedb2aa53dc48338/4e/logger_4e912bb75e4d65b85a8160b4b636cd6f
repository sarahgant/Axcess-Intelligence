00df72f99274a962b33a4cbd0c7a8359
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.logger = exports.LogLevel = void 0;
var LogLevel;
(function (LogLevel) {
    LogLevel[LogLevel["DEBUG"] = 0] = "DEBUG";
    LogLevel[LogLevel["INFO"] = 1] = "INFO";
    LogLevel[LogLevel["WARN"] = 2] = "WARN";
    LogLevel[LogLevel["ERROR"] = 3] = "ERROR";
    LogLevel[LogLevel["FATAL"] = 4] = "FATAL";
})(LogLevel || (exports.LogLevel = LogLevel = {}));
class Logger {
    constructor() {
        Object.defineProperty(this, "isDevelopment", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: process.env.NODE_ENV === 'development' || import.meta?.env?.DEV
        });
        Object.defineProperty(this, "logLevel", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: this.isDevelopment ? LogLevel.DEBUG : LogLevel.INFO
        });
    }
    formatLog(context) {
        return JSON.stringify(context);
    }
    shouldLog(level) {
        return level >= this.logLevel;
    }
    log(level, message, meta, context) {
        if (!this.shouldLog(level))
            return;
        const logContext = {
            timestamp: new Date().toISOString(),
            level,
            message,
            meta,
            correlationId: this.getCorrelationId(),
            userId: this.getUserId(),
            sessionId: this.getSessionId(),
            ...context
        };
        // In development, use console for readability
        if (this.isDevelopment) {
            const color = this.getConsoleColor(level);
            const levelName = LogLevel[level];
            console.log(`%c[${levelName}]`, color, message, meta || '');
        }
        else {
            // In production, send to monitoring service
            this.sendToMonitoring(logContext);
        }
        // Store in local buffer for debugging
        this.storeInBuffer(logContext);
    }
    debug(message, meta, context) {
        this.log(LogLevel.DEBUG, message, meta, context);
    }
    info(message, meta, context) {
        this.log(LogLevel.INFO, message, meta, context);
    }
    warn(message, meta, context) {
        this.log(LogLevel.WARN, message, meta, context);
    }
    error(message, meta, context) {
        this.log(LogLevel.ERROR, message, meta, context);
    }
    fatal(message, meta, context) {
        this.log(LogLevel.FATAL, message, meta, context);
    }
    // Component-specific logging methods
    component(componentName) {
        return {
            debug: (message, meta) => this.debug(message, meta, { component: componentName }),
            info: (message, meta) => this.info(message, meta, { component: componentName }),
            warn: (message, meta) => this.warn(message, meta, { component: componentName }),
            error: (message, meta) => this.error(message, meta, { component: componentName }),
            fatal: (message, meta) => this.fatal(message, meta, { component: componentName })
        };
    }
    // Action-specific logging methods
    action(actionName) {
        return {
            debug: (message, meta) => this.debug(message, meta, { action: actionName }),
            info: (message, meta) => this.info(message, meta, { action: actionName }),
            warn: (message, meta) => this.warn(message, meta, { action: actionName }),
            error: (message, meta) => this.error(message, meta, { action: actionName }),
            fatal: (message, meta) => this.fatal(message, meta, { action: actionName })
        };
    }
    // Helper methods
    getConsoleColor(level) {
        const colors = {
            [LogLevel.DEBUG]: 'color: gray',
            [LogLevel.INFO]: 'color: blue',
            [LogLevel.WARN]: 'color: orange',
            [LogLevel.ERROR]: 'color: red',
            [LogLevel.FATAL]: 'color: darkred; font-weight: bold'
        };
        return colors[level];
    }
    getCorrelationId() {
        if (typeof window === 'undefined')
            return 'server-side';
        return sessionStorage.getItem('correlationId') || 'no-correlation-id';
    }
    getUserId() {
        if (typeof window === 'undefined')
            return 'server-side';
        return sessionStorage.getItem('userId') || 'anonymous';
    }
    getSessionId() {
        if (typeof window === 'undefined')
            return 'server-side';
        return sessionStorage.getItem('sessionId') || 'no-session';
    }
    sendToMonitoring(context) {
        // Future: Send to Azure Application Insights
        // For now, store in IndexedDB for retrieval
        if (typeof window !== 'undefined') {
            this.storeInIndexedDB(context);
        }
    }
    storeInBuffer(context) {
        // Store last 100 logs in memory for debugging
        if (typeof window === 'undefined')
            return;
        if (!window.__logBuffer)
            window.__logBuffer = [];
        window.__logBuffer.push(context);
        if (window.__logBuffer.length > 100) {
            window.__logBuffer.shift();
        }
    }
    async storeInIndexedDB(context) {
        try {
            // Simple IndexedDB storage for production logs
            const dbName = 'CCHLogs';
            const storeName = 'logs';
            const request = indexedDB.open(dbName, 1);
            request.onupgradeneeded = (event) => {
                const db = event.target.result;
                if (!db.objectStoreNames.contains(storeName)) {
                    db.createObjectStore(storeName, { keyPath: 'timestamp' });
                }
            };
            request.onsuccess = (event) => {
                const db = event.target.result;
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                store.add(context);
            };
        }
        catch (error) {
            // Fallback to console if IndexedDB fails
            console.error('Failed to store log in IndexedDB:', error);
        }
    }
    // Utility methods for debugging
    getLogBuffer() {
        if (typeof window === 'undefined')
            return [];
        return window.__logBuffer || [];
    }
    clearLogBuffer() {
        if (typeof window === 'undefined')
            return;
        window.__logBuffer = [];
    }
    // Export logs for debugging
    exportLogs() {
        const logs = this.getLogBuffer();
        return JSON.stringify(logs, null, 2);
    }
}
exports.logger = new Logger();
// Add to window for debugging in production
if (typeof window !== 'undefined') {
    window.__logger = exports.logger;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxzYXJhaFxcUmVwb3NcXENDSCBBeGNlc3MgSW50ZWxsaWdlbmNlIFZpYmVkXFxzcmNcXGNvcmVcXGxvZ2dpbmdcXGxvZ2dlci50cyIsIm1hcHBpbmdzIjoiOzs7QUFBQSxJQUFZLFFBTVg7QUFORCxXQUFZLFFBQVE7SUFDbEIseUNBQVMsQ0FBQTtJQUNULHVDQUFRLENBQUE7SUFDUix1Q0FBUSxDQUFBO0lBQ1IseUNBQVMsQ0FBQTtJQUNULHlDQUFTLENBQUE7QUFDWCxDQUFDLEVBTlcsUUFBUSx3QkFBUixRQUFRLFFBTW5CO0FBc0JELE1BQU0sTUFBTTtJQUFaO1FBQ1U7Ozs7bUJBQWdCLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxLQUFLLGFBQWEsSUFBSSxNQUFNLENBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRSxHQUFHO1dBQUM7UUFDaEY7Ozs7bUJBQVcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUk7V0FBQztJQXlLekUsQ0FBQztJQXZLUyxTQUFTLENBQUMsT0FBbUI7UUFDbkMsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ2pDLENBQUM7SUFFTyxTQUFTLENBQUMsS0FBZTtRQUMvQixPQUFPLEtBQUssSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDO0lBQ2hDLENBQUM7SUFFTyxHQUFHLENBQUMsS0FBZSxFQUFFLE9BQWUsRUFBRSxJQUFVLEVBQUUsT0FBNkI7UUFDckYsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDO1lBQUUsT0FBTztRQUVuQyxNQUFNLFVBQVUsR0FBZTtZQUM3QixTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7WUFDbkMsS0FBSztZQUNMLE9BQU87WUFDUCxJQUFJO1lBQ0osYUFBYSxFQUFFLElBQUksQ0FBQyxnQkFBZ0IsRUFBRTtZQUN0QyxNQUFNLEVBQUUsSUFBSSxDQUFD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LENBQUM7SUFFRCxnQ0FBZ0M7SUFDaEMsWUFBWTtRQUNWLElBQUksT0FBTyxNQUFNLEtBQUssV0FBVztZQUFFLE9BQU8sRUFBRSxDQUFDO1FBQzdDLE9BQU8sTUFBTSxDQUFDLFdBQVcsSUFBSSxFQUFFLENBQUM7SUFDbEMsQ0FBQztJQUVELGNBQWM7UUFDWixJQUFJLE9BQU8sTUFBTSxLQUFLLFdBQVc7WUFBRSxPQUFPO1FBQzFDLE1BQU0sQ0FBQyxXQUFXLEdBQUcsRUFBRSxDQUFDO0lBQzFCLENBQUM7SUFFRCw0QkFBNEI7SUFDNUIsVUFBVTtRQUNSLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUNqQyxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztJQUN2QyxDQUFDO0NBQ0Y7QUFFWSxRQUFBLE1BQU0sR0FBRyxJQUFJLE1BQU0sRUFBRSxDQUFDO0FBRW5DLDRDQUE0QztBQUM1QyxJQUFJLE9BQU8sTUFBTSxLQUFLLFdBQVcsRUFBRSxDQUFDO0lBQ2xDLE1BQU0sQ0FBQyxRQUFRLEdBQUcsY0FBTSxDQUFDO0FBQzNCLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxzYXJhaFxcUmVwb3NcXENDSCBBeGNlc3MgSW50ZWxsaWdlbmNlIFZpYmVkXFxzcmNcXGNvcmVcXGxvZ2dpbmdcXGxvZ2dlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZW51bSBMb2dMZXZlbCB7XHJcbiAgREVCVUcgPSAwLFxyXG4gIElORk8gPSAxLFxyXG4gIFdBUk4gPSAyLFxyXG4gIEVSUk9SID0gMyxcclxuICBGQVRBTCA9IDRcclxufVxyXG5cclxuaW50ZXJmYWNlIExvZ0NvbnRleHQge1xyXG4gIHRpbWVzdGFtcDogc3RyaW5nO1xyXG4gIGxldmVsOiBMb2dMZXZlbDtcclxuICBtZXNzYWdlOiBzdHJpbmc7XHJcbiAgbWV0YT86IGFueTtcclxuICBjb3JyZWxhdGlvbklkPzogc3RyaW5nO1xyXG4gIHVzZXJJZD86IHN0cmluZztcclxuICBzZXNzaW9uSWQ/OiBzdHJpbmc7XHJcbiAgY29tcG9uZW50Pzogc3RyaW5nO1xyXG4gIGFjdGlvbj86IHN0cmluZztcclxufVxyXG5cclxuLy8gRXh0ZW5kIFdpbmRvdyBpbnRlcmZhY2UgZm9yIGRlYnVnZ2luZ1xyXG5kZWNsYXJlIGdsb2JhbCB7XHJcbiAgaW50ZXJmYWNlIFdpbmRvdyB7XHJcbiAgICBfX2xvZ0J1ZmZlcj86IExvZ0NvbnRleHRbXTtcclxuICAgIF9fbG9nZ2VyPzogTG9nZ2VyO1xyXG4gIH1cclxufVxyXG5cclxuY2xhc3MgTG9nZ2VyIHtcclxuICBwcml2YXRlIGlzRGV2ZWxvcG1lbnQgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JyB8fCBpbXBvcnQubWV0YT8uZW52Py5ERVY7XHJcbiAgcHJpdmF0ZSBsb2dMZXZlbCA9IHRoaXMuaXNEZXZlbG9wbWVudCA/IExvZ0xldmVsLkRFQlVHIDogTG9nTGV2ZWwuSU5GTztcclxuXHJcbiAgcHJpdmF0ZSBmb3JtYXRMb2coY29udGV4dDogTG9nQ29udGV4dCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoY29udGV4dCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNob3VsZExvZyhsZXZlbDogTG9nTGV2ZWwpOiBib29sZWFuIHtcclxuICAgIHJldHVybiBsZXZlbCA+PSB0aGlzLmxvZ0xldmVsO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBsb2cobGV2ZWw6IExvZ0xldmVsLCBtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBhbnksIGNvbnRleHQ/OiBQYXJ0aWFsPExvZ0NvbnRleHQ+KSB7XHJcbiAgICBpZiAoIXRoaXMuc2hvdWxkTG9nKGxldmVsKSkgcmV0dXJuO1xyXG5cclxuICAgIGNvbnN0IGxvZ0NvbnRleHQ6IExvZ0NvbnRleHQgPSB7XHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICBsZXZlbCxcclxuICAgICAgbWVzc2FnZSxcclxuICAgICAgbWV0YSxcclxuICAgICAgY29ycmVsYXRpb25JZDogdGhpcy5nZXRDb3JyZWxhdGlvbklkKCksXHJcbiAgICAgIHVzZXJJZDogdGhpcy5nZXRVc2VySWQoKSxcclxuICAgICAgc2Vzc2lvbklkOiB0aGlzLmdldFNlc3Npb25JZCgpLFxyXG4gICAgICAuLi5jb250ZXh0XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEluIGRldmVsb3BtZW50LCB1c2UgY29uc29sZSBmb3IgcmVhZGFiaWxpdHlcclxuICAgIGlmICh0aGlzLmlzRGV2ZWxvcG1lbnQpIHtcclxuICAgICAgY29uc3QgY29sb3IgPSB0aGlzLmdldENvbnNvbGVDb2xvcihsZXZlbCk7XHJcbiAgICAgIGNvbnN0IGxldmVsTmFtZSA9IExvZ0xldmVsW2xldmVsXTtcclxuICAgICAgY29uc29sZS5sb2coYCVjWyR7bGV2ZWxOYW1lfV1gLCBjb2xvciwgbWVzc2FnZSwgbWV0YSB8fCAnJyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBJbiBwcm9kdWN0aW9uLCBzZW5kIHRvIG1vbml0b3Jpbmcgc2VydmljZVxyXG4gICAgICB0aGlzLnNlbmRUb01vbml0b3JpbmcobG9nQ29udGV4dCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gU3RvcmUgaW4gbG9jYWwgYnVmZmVyIGZvciBkZWJ1Z2dpbmdcclxuICAgIHRoaXMuc3RvcmVJbkJ1ZmZlcihsb2dDb250ZXh0KTtcclxuICB9XHJcblxyXG4gIGRlYnVnKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IGFueSwgY29udGV4dD86IFBhcnRpYWw8TG9nQ29udGV4dD4pIHtcclxuICAgIHRoaXMubG9nKExvZ0xldmVsLkRFQlVHLCBtZXNzYWdlLCBtZXRhLCBjb250ZXh0KTtcclxuICB9XHJcblxyXG4gIGluZm8obWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55LCBjb250ZXh0PzogUGFydGlhbDxMb2dDb250ZXh0Pikge1xyXG4gICAgdGhpcy5sb2coTG9nTGV2ZWwuSU5GTywgbWVzc2FnZSwgbWV0YSwgY29udGV4dCk7XHJcbiAgfVxyXG5cclxuICB3YXJuKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IGFueSwgY29udGV4dD86IFBhcnRpYWw8TG9nQ29udGV4dD4pIHtcclxuICAgIHRoaXMubG9nKExvZ0xldmVsLldBUk4sIG1lc3NhZ2UsIG1ldGEsIGNvbnRleHQpO1xyXG4gIH1cclxuXHJcbiAgZXJyb3IobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55LCBjb250ZXh0PzogUGFydGlhbDxMb2dDb250ZXh0Pikge1xyXG4gICAgdGhpcy5sb2coTG9nTGV2ZWwuRVJST1IsIG1lc3NhZ2UsIG1ldGEsIGNvbnRleHQpO1xyXG4gIH1cclxuXHJcbiAgZmF0YWwobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55LCBjb250ZXh0PzogUGFydGlhbDxMb2dDb250ZXh0Pikge1xyXG4gICAgdGhpcy5sb2coTG9nTGV2ZWwuRkFUQUwsIG1lc3NhZ2UsIG1ldGEsIGNvbnRleHQpO1xyXG4gIH1cclxuXHJcbiAgLy8gQ29tcG9uZW50LXNwZWNpZmljIGxvZ2dpbmcgbWV0aG9kc1xyXG4gIGNvbXBvbmVudChjb21wb25lbnROYW1lOiBzdHJpbmcpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGRlYnVnOiAobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55KSA9PiB0aGlzLmRlYnVnKG1lc3NhZ2UsIG1ldGEsIHsgY29tcG9uZW50OiBjb21wb25lbnROYW1lIH0pLFxyXG4gICAgICBpbmZvOiAobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55KSA9PiB0aGlzLmluZm8obWVzc2FnZSwgbWV0YSwgeyBjb21wb25lbnQ6IGNvbXBvbmVudE5hbWUgfSksXHJcbiAgICAgIHdhcm46IChtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBhbnkpID0+IHRoaXMud2FybihtZXNzYWdlLCBtZXRhLCB7IGNvbXBvbmVudDogY29tcG9uZW50TmFtZSB9KSxcclxuICAgICAgZXJyb3I6IChtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBhbnkpID0+IHRoaXMuZXJyb3IobWVzc2FnZSwgbWV0YSwgeyBjb21wb25lbnQ6IGNvbXBvbmVudE5hbWUgfSksXHJcbiAgICAgIGZhdGFsOiAobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55KSA9PiB0aGlzLmZhdGFsKG1lc3NhZ2UsIG1ldGEsIHsgY29tcG9uZW50OiBjb21wb25lbnROYW1lIH0pXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLy8gQWN0aW9uLXNwZWNpZmljIGxvZ2dpbmcgbWV0aG9kc1xyXG4gIGFjdGlvbihhY3Rpb25OYW1lOiBzdHJpbmcpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGRlYnVnOiAobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55KSA9PiB0aGlzLmRlYnVnKG1lc3NhZ2UsIG1ldGEsIHsgYWN0aW9uOiBhY3Rpb25OYW1lIH0pLFxyXG4gICAgICBpbmZvOiAobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55KSA9PiB0aGlzLmluZm8obWVzc2FnZSwgbWV0YSwgeyBhY3Rpb246IGFjdGlvbk5hbWUgfSksXHJcbiAgICAgIHdhcm46IChtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBhbnkpID0+IHRoaXMud2FybihtZXNzYWdlLCBtZXRhLCB7IGFjdGlvbjogYWN0aW9uTmFtZSB9KSxcclxuICAgICAgZXJyb3I6IChtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBhbnkpID0+IHRoaXMuZXJyb3IobWVzc2FnZSwgbWV0YSwgeyBhY3Rpb246IGFjdGlvbk5hbWUgfSksXHJcbiAgICAgIGZhdGFsOiAobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55KSA9PiB0aGlzLmZhdGFsKG1lc3NhZ2UsIG1ldGEsIHsgYWN0aW9uOiBhY3Rpb25OYW1lIH0pXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLy8gSGVscGVyIG1ldGhvZHNcclxuICBwcml2YXRlIGdldENvbnNvbGVDb2xvcihsZXZlbDogTG9nTGV2ZWwpOiBzdHJpbmcge1xyXG4gICAgY29uc3QgY29sb3JzID0ge1xyXG4gICAgICBbTG9nTGV2ZWwuREVCVUddOiAnY29sb3I6IGdyYXknLFxyXG4gICAgICBbTG9nTGV2ZWwuSU5GT106ICdjb2xvcjogYmx1ZScsXHJcbiAgICAgIFtMb2dMZXZlbC5XQVJOXTogJ2NvbG9yOiBvcmFuZ2UnLFxyXG4gICAgICBbTG9nTGV2ZWwuRVJST1JdOiAnY29sb3I6IHJlZCcsXHJcbiAgICAgIFtMb2dMZXZlbC5GQVRBTF06ICdjb2xvcjogZGFya3JlZDsgZm9udC13ZWlnaHQ6IGJvbGQnXHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIGNvbG9yc1tsZXZlbF07XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldENvcnJlbGF0aW9uSWQoKTogc3RyaW5nIHtcclxuICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJykgcmV0dXJuICdzZXJ2ZXItc2lkZSc7XHJcbiAgICByZXR1cm4gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnY29ycmVsYXRpb25JZCcpIHx8ICduby1jb3JyZWxhdGlvbi1pZCc7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldFVzZXJJZCgpOiBzdHJpbmcge1xyXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnKSByZXR1cm4gJ3NlcnZlci1zaWRlJztcclxuICAgIHJldHVybiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VySWQnKSB8fCAnYW5vbnltb3VzJztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0U2Vzc2lvbklkKCk6IHN0cmluZyB7XHJcbiAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybiAnc2VydmVyLXNpZGUnO1xyXG4gICAgcmV0dXJuIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3Nlc3Npb25JZCcpIHx8ICduby1zZXNzaW9uJztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2VuZFRvTW9uaXRvcmluZyhjb250ZXh0OiBMb2dDb250ZXh0KSB7XHJcbiAgICAvLyBGdXR1cmU6IFNlbmQgdG8gQXp1cmUgQXBwbGljYXRpb24gSW5zaWdodHNcclxuICAgIC8vIEZvciBub3csIHN0b3JlIGluIEluZGV4ZWREQiBmb3IgcmV0cmlldmFsXHJcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgdGhpcy5zdG9yZUluSW5kZXhlZERCKGNvbnRleHQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzdG9yZUluQnVmZmVyKGNvbnRleHQ6IExvZ0NvbnRleHQpIHtcclxuICAgIC8vIFN0b3JlIGxhc3QgMTAwIGxvZ3MgaW4gbWVtb3J5IGZvciBkZWJ1Z2dpbmdcclxuICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJykgcmV0dXJuO1xyXG4gICAgXHJcbiAgICBpZiAoIXdpbmRvdy5fX2xvZ0J1ZmZlcikgd2luZG93Ll9fbG9nQnVmZmVyID0gW107XHJcbiAgICB3aW5kb3cuX19sb2dCdWZmZXIucHVzaChjb250ZXh0KTtcclxuICAgIGlmICh3aW5kb3cuX19sb2dCdWZmZXIubGVuZ3RoID4gMTAwKSB7XHJcbiAgICAgIHdpbmRvdy5fX2xvZ0J1ZmZlci5zaGlmdCgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBzdG9yZUluSW5kZXhlZERCKGNvbnRleHQ6IExvZ0NvbnRleHQpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIFNpbXBsZSBJbmRleGVkREIgc3RvcmFnZSBmb3IgcHJvZHVjdGlvbiBsb2dzXHJcbiAgICAgIGNvbnN0IGRiTmFtZSA9ICdDQ0hMb2dzJztcclxuICAgICAgY29uc3Qgc3RvcmVOYW1lID0gJ2xvZ3MnO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSwgMSk7XHJcbiAgICAgIFxyXG4gICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IChldmVudCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGRiID0gKGV2ZW50LnRhcmdldCBhcyBJREJPcGVuREJSZXF1ZXN0KS5yZXN1bHQ7XHJcbiAgICAgICAgaWYgKCFkYi5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKHN0b3JlTmFtZSkpIHtcclxuICAgICAgICAgIGRiLmNyZWF0ZU9iamVjdFN0b3JlKHN0b3JlTmFtZSwgeyBrZXlQYXRoOiAndGltZXN0YW1wJyB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IChldmVudCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGRiID0gKGV2ZW50LnRhcmdldCBhcyBJREJPcGVuREJSZXF1ZXN0KS5yZXN1bHQ7XHJcbiAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSBkYi50cmFuc2FjdGlvbihbc3RvcmVOYW1lXSwgJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgIGNvbnN0IHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuICAgICAgICBzdG9yZS5hZGQoY29udGV4dCk7XHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAvLyBGYWxsYmFjayB0byBjb25zb2xlIGlmIEluZGV4ZWREQiBmYWlsc1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gc3RvcmUgbG9nIGluIEluZGV4ZWREQjonLCBlcnJvcik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBVdGlsaXR5IG1ldGhvZHMgZm9yIGRlYnVnZ2luZ1xyXG4gIGdldExvZ0J1ZmZlcigpOiBMb2dDb250ZXh0W10ge1xyXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnKSByZXR1cm4gW107XHJcbiAgICByZXR1cm4gd2luZG93Ll9fbG9nQnVmZmVyIHx8IFtdO1xyXG4gIH1cclxuXHJcbiAgY2xlYXJMb2dCdWZmZXIoKTogdm9pZCB7XHJcbiAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybjtcclxuICAgIHdpbmRvdy5fX2xvZ0J1ZmZlciA9IFtdO1xyXG4gIH1cclxuXHJcbiAgLy8gRXhwb3J0IGxvZ3MgZm9yIGRlYnVnZ2luZ1xyXG4gIGV4cG9ydExvZ3MoKTogc3RyaW5nIHtcclxuICAgIGNvbnN0IGxvZ3MgPSB0aGlzLmdldExvZ0J1ZmZlcigpO1xyXG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGxvZ3MsIG51bGwsIDIpO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoKTtcclxuXHJcbi8vIEFkZCB0byB3aW5kb3cgZm9yIGRlYnVnZ2luZyBpbiBwcm9kdWN0aW9uXHJcbmlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xyXG4gIHdpbmRvdy5fX2xvZ2dlciA9IGxvZ2dlcjtcclxufVxyXG4iXSwidmVyc2lvbiI6M30=