cb624308655f2757492d58fbd5e9d67f
'use strict';

var isElementType = require('../utils/misc/isElementType.js');
var FileList = require('../utils/dataTransfer/FileList.js');
require('../utils/dataTransfer/Clipboard.js');
var setFiles = require('../utils/edit/setFiles.js');
var isDisabled = require('../utils/misc/isDisabled.js');
var getWindow = require('../utils/misc/getWindow.js');
async function upload(element, fileOrFiles) {
  const input = isElementType.isElementType(element, 'label') ? element.control : element;
  if (!input || !isElementType.isElementType(input, 'input', {
    type: 'file'
  })) {
    throw new TypeError(`The ${input === element ? 'given' : 'associated'} ${input === null || input === undefined ? undefined : input.tagName} element does not accept file uploads`);
  }
  if (isDisabled.isDisabled(element)) return;
  const files = (Array.isArray(fileOrFiles) ? fileOrFiles : [fileOrFiles]).filter(file => !this.config.applyAccept || isAcceptableFile(file, input.accept)).slice(0, input.multiple ? undefined : 1);
  const fileDialog = () => {
    var _input_files;
    // do not fire an input event if the file selection does not change
    if (files.length === ((_input_files = input.files) === null || _input_files === undefined ? undefined : _input_files.length) && files.every((f, i) => {
      var _input_files;
      return f === ((_input_files = input.files) === null || _input_files === undefined ? undefined : _input_files.item(i));
    })) {
      return;
    }
    setFiles.setFiles(input, FileList.createFileList(getWindow.getWindow(element), files));
    this.dispatchUIEvent(input, 'input');
    this.dispatchUIEvent(input, 'change');
  };
  input.addEventListener('fileDialog', fileDialog);
  await this.click(element);
  input.removeEventListener('fileDialog', fileDialog);
}
// When matching files, browsers ignore case and consider jpeg/jpg interchangeable.
function normalize(nameOrType) {
  return nameOrType.toLowerCase().replace(/(\.|\/)jpg\b/g, '$1jpeg');
}
function isAcceptableFile(file, accept) {
  if (!accept) {
    return true;
  }
  const wildcards = ['audio/*', 'image/*', 'video/*'];
  return normalize(accept).trim().split(/\s*,\s*/).some(acceptToken => {
    // tokens starting with a dot represent a file extension
    if (acceptToken.startsWith('.')) {
      return normalize(file.name).endsWith(acceptToken);
    } else if (wildcards.includes(acceptToken)) {
      return normalize(file.type).startsWith(acceptToken.replace('*', ''));
    }
    return normalize(file.type) === acceptToken;
  });
}
exports.upload = upload;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJpc0VsZW1lbnRUeXBlIiwicmVxdWlyZSIsIkZpbGVMaXN0Iiwic2V0RmlsZXMiLCJpc0Rpc2FibGVkIiwiZ2V0V2luZG93IiwidXBsb2FkIiwiZWxlbWVudCIsImZpbGVPckZpbGVzIiwiaW5wdXQiLCJjb250cm9sIiwidHlwZSIsIlR5cGVFcnJvciIsInVuZGVmaW5lZCIsInRhZ05hbWUiLCJmaWxlcyIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlciIsImZpbGUiLCJjb25maWciLCJhcHBseUFjY2VwdCIsImlzQWNjZXB0YWJsZUZpbGUiLCJhY2NlcHQiLCJzbGljZSIsIm11bHRpcGxlIiwiZmlsZURpYWxvZyIsIl9pbnB1dF9maWxlcyIsImxlbmd0aCIsImV2ZXJ5IiwiZiIsImkiLCJpdGVtIiwiY3JlYXRlRmlsZUxpc3QiLCJkaXNwYXRjaFVJRXZlbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiY2xpY2siLCJyZW1vdmVFdmVudExpc3RlbmVyIiwibm9ybWFsaXplIiwibmFtZU9yVHlwZSIsInRvTG93ZXJDYXNlIiwicmVwbGFjZSIsIndpbGRjYXJkcyIsInRyaW0iLCJzcGxpdCIsInNvbWUiLCJhY2NlcHRUb2tlbiIsInN0YXJ0c1dpdGgiLCJuYW1lIiwiZW5kc1dpdGgiLCJpbmNsdWRlcyIsImV4cG9ydHMiXSwic291cmNlcyI6WyJ1cGxvYWQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG52YXIgaXNFbGVtZW50VHlwZSA9IHJlcXVpcmUoJy4uL3V0aWxzL21pc2MvaXNFbGVtZW50VHlwZS5qcycpO1xudmFyIEZpbGVMaXN0ID0gcmVxdWlyZSgnLi4vdXRpbHMvZGF0YVRyYW5zZmVyL0ZpbGVMaXN0LmpzJyk7XG5yZXF1aXJlKCcuLi91dGlscy9kYXRhVHJhbnNmZXIvQ2xpcGJvYXJkLmpzJyk7XG52YXIgc2V0RmlsZXMgPSByZXF1aXJlKCcuLi91dGlscy9lZGl0L3NldEZpbGVzLmpzJyk7XG52YXIgaXNEaXNhYmxlZCA9IHJlcXVpcmUoJy4uL3V0aWxzL21pc2MvaXNEaXNhYmxlZC5qcycpO1xudmFyIGdldFdpbmRvdyA9IHJlcXVpcmUoJy4uL3V0aWxzL21pc2MvZ2V0V2luZG93LmpzJyk7XG5cbmFzeW5jIGZ1bmN0aW9uIHVwbG9hZChlbGVtZW50LCBmaWxlT3JGaWxlcykge1xuICAgIGNvbnN0IGlucHV0ID0gaXNFbGVtZW50VHlwZS5pc0VsZW1lbnRUeXBlKGVsZW1lbnQsICdsYWJlbCcpID8gZWxlbWVudC5jb250cm9sIDogZWxlbWVudDtcbiAgICBpZiAoIWlucHV0IHx8ICFpc0VsZW1lbnRUeXBlLmlzRWxlbWVudFR5cGUoaW5wdXQsICdpbnB1dCcsIHtcbiAgICAgICAgdHlwZTogJ2ZpbGUnXG4gICAgfSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihgVGhlICR7aW5wdXQgPT09IGVsZW1lbnQgPyAnZ2l2ZW4nIDogJ2Fzc29jaWF0ZWQnfSAke2lucHV0ID09PSBudWxsIHx8IGlucHV0ID09PSB1bmRlZmluZWQgPyB1bmRlZmluZWQgOiBpbnB1dC50YWdOYW1lfSBlbGVtZW50IGRvZXMgbm90IGFjY2VwdCBmaWxlIHVwbG9hZHNgKTtcbiAgICB9XG4gICAgaWYgKGlzRGlzYWJsZWQuaXNEaXNhYmxlZChlbGVtZW50KSkgcmV0dXJuO1xuICAgIGNvbnN0IGZpbGVzID0gKEFycmF5LmlzQXJyYXkoZmlsZU9yRmlsZXMpID8gZmlsZU9yRmlsZXMgOiBbXG4gICAgICAgIGZpbGVPckZpbGVzXG4gICAgXSkuZmlsdGVyKChmaWxlKT0+IXRoaXMuY29uZmlnLmFwcGx5QWNjZXB0IHx8IGlzQWNjZXB0YWJsZUZpbGUoZmlsZSwgaW5wdXQuYWNjZXB0KSkuc2xpY2UoMCwgaW5wdXQubXVsdGlwbGUgPyB1bmRlZmluZWQgOiAxKTtcbiAgICBjb25zdCBmaWxlRGlhbG9nID0gKCk9PntcbiAgICAgICAgdmFyIF9pbnB1dF9maWxlcztcbiAgICAgICAgLy8gZG8gbm90IGZpcmUgYW4gaW5wdXQgZXZlbnQgaWYgdGhlIGZpbGUgc2VsZWN0aW9uIGRvZXMgbm90IGNoYW5nZVxuICAgICAgICBpZiAoZmlsZXMubGVuZ3RoID09PSAoKF9pbnB1dF9maWxlcyA9IGlucHV0LmZpbGVzKSA9PT0gbnVsbCB8fCBfaW5wdXRfZmlsZXMgPT09IHVuZGVmaW5lZCA/IHVuZGVmaW5lZCA6IF9pbnB1dF9maWxlcy5sZW5ndGgpICYmIGZpbGVzLmV2ZXJ5KChmLCBpKT0+e1xuICAgICAgICAgICAgdmFyIF9pbnB1dF9maWxlcztcbiAgICAgICAgICAgIHJldHVybiBmID09PSAoKF9pbnB1dF9maWxlcyA9IGlucHV0LmZpbGVzKSA9PT0gbnVsbCB8fCBfaW5wdXRfZmlsZXMgPT09IHVuZGVmaW5lZCA/IHVuZGVmaW5lZCA6IF9pbnB1dF9maWxlcy5pdGVtKGkpKTtcbiAgICAgICAgfSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBzZXRGaWxlcy5zZXRGaWxlcyhpbnB1dCwgRmlsZUxpc3QuY3JlYXRlRmlsZUxpc3QoZ2V0V2luZG93LmdldFdpbmRvdyhlbGVtZW50KSwgZmlsZXMpKTtcbiAgICAgICAgdGhpcy5kaXNwYXRjaFVJRXZlbnQoaW5wdXQsICdpbnB1dCcpO1xuICAgICAgICB0aGlzLmRpc3BhdGNoVUlFdmVudChpbnB1dCwgJ2NoYW5nZScpO1xuICAgIH07XG4gICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignZmlsZURpYWxvZycsIGZpbGVEaWFsb2cpO1xuICAgIGF3YWl0IHRoaXMuY2xpY2soZWxlbWVudCk7XG4gICAgaW5wdXQucmVtb3ZlRXZlbnRMaXN0ZW5lcignZmlsZURpYWxvZycsIGZpbGVEaWFsb2cpO1xufVxuLy8gV2hlbiBtYXRjaGluZyBmaWxlcywgYnJvd3NlcnMgaWdub3JlIGNhc2UgYW5kIGNvbnNpZGVyIGpwZWcvanBnIGludGVyY2hhbmdlYWJsZS5cbmZ1bmN0aW9uIG5vcm1hbGl6ZShuYW1lT3JUeXBlKSB7XG4gICAgcmV0dXJuIG5hbWVPclR5cGUudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC8oXFwufFxcLylqcGdcXGIvZywgJyQxanBlZycpO1xufVxuZnVuY3Rpb24gaXNBY2NlcHRhYmxlRmlsZShmaWxlLCBhY2NlcHQpIHtcbiAgICBpZiAoIWFjY2VwdCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgY29uc3Qgd2lsZGNhcmRzID0gW1xuICAgICAgICAnYXVkaW8vKicsXG4gICAgICAgICdpbWFnZS8qJyxcbiAgICAgICAgJ3ZpZGVvLyonXG4gICAgXTtcbiAgICByZXR1cm4gbm9ybWFsaXplKGFjY2VwdCkudHJpbSgpLnNwbGl0KC9cXHMqLFxccyovKS5zb21lKChhY2NlcHRUb2tlbik9PntcbiAgICAgICAgLy8gdG9rZW5zIHN0YXJ0aW5nIHdpdGggYSBkb3QgcmVwcmVzZW50IGEgZmlsZSBleHRlbnNpb25cbiAgICAgICAgaWYgKGFjY2VwdFRva2VuLnN0YXJ0c1dpdGgoJy4nKSkge1xuICAgICAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZShmaWxlLm5hbWUpLmVuZHNXaXRoKGFjY2VwdFRva2VuKTtcbiAgICAgICAgfSBlbHNlIGlmICh3aWxkY2FyZHMuaW5jbHVkZXMoYWNjZXB0VG9rZW4pKSB7XG4gICAgICAgICAgICByZXR1cm4gbm9ybWFsaXplKGZpbGUudHlwZSkuc3RhcnRzV2l0aChhY2NlcHRUb2tlbi5yZXBsYWNlKCcqJywgJycpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbm9ybWFsaXplKGZpbGUudHlwZSkgPT09IGFjY2VwdFRva2VuO1xuICAgIH0pO1xufVxuXG5leHBvcnRzLnVwbG9hZCA9IHVwbG9hZDtcbiJdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWTs7QUFFWixJQUFJQSxhQUFhLEdBQUdDLE9BQU8sQ0FBQyxnQ0FBZ0MsQ0FBQztBQUM3RCxJQUFJQyxRQUFRLEdBQUdELE9BQU8sQ0FBQyxtQ0FBbUMsQ0FBQztBQUMzREEsT0FBTyxDQUFDLG9DQUFvQyxDQUFDO0FBQzdDLElBQUlFLFFBQVEsR0FBR0YsT0FBTyxDQUFDLDJCQUEyQixDQUFDO0FBQ25ELElBQUlHLFVBQVUsR0FBR0gsT0FBTyxDQUFDLDZCQUE2QixDQUFDO0FBQ3ZELElBQUlJLFNBQVMsR0FBR0osT0FBTyxDQUFDLDRCQUE0QixDQUFDO0FBRXJELGVBQWVLLE1BQU1BLENBQUNDLE9BQU8sRUFBRUMsV0FBVyxFQUFFO0VBQ3hDLE1BQU1DLEtBQUssR0FBR1QsYUFBYSxDQUFDQSxhQUFhLENBQUNPLE9BQU8sRUFBRSxPQUFPLENBQUMsR0FBR0EsT0FBTyxDQUFDRyxPQUFPLEdBQUdILE9BQU87RUFDdkYsSUFBSSxDQUFDRSxLQUFLLElBQUksQ0FBQ1QsYUFBYSxDQUFDQSxhQUFhLENBQUNTLEtBQUssRUFBRSxPQUFPLEVBQUU7SUFDdkRFLElBQUksRUFBRTtFQUNWLENBQUMsQ0FBQyxFQUFFO0lBQ0EsTUFBTSxJQUFJQyxTQUFTLENBQUMsT0FBT0gsS0FBSyxLQUFLRixPQUFPLEdBQUcsT0FBTyxHQUFHLFlBQVksSUFBSUUsS0FBSyxLQUFLLElBQUksSUFBSUEsS0FBSyxLQUFLSSxTQUFTLEdBQUdBLFNBQVMsR0FBR0osS0FBSyxDQUFDSyxPQUFPLHVDQUF1QyxDQUFDO0VBQ3RMO0VBQ0EsSUFBSVYsVUFBVSxDQUFDQSxVQUFVLENBQUNHLE9BQU8sQ0FBQyxFQUFFO0VBQ3BDLE1BQU1RLEtBQUssR0FBRyxDQUFDQyxLQUFLLENBQUNDLE9BQU8sQ0FBQ1QsV0FBVyxDQUFDLEdBQUdBLFdBQVcsR0FBRyxDQUN0REEsV0FBVyxDQUNkLEVBQUVVLE1BQU0sQ0FBRUMsSUFBSSxJQUFHLENBQUMsSUFBSSxDQUFDQyxNQUFNLENBQUNDLFdBQVcsSUFBSUMsZ0JBQWdCLENBQUNILElBQUksRUFBRVYsS0FBSyxDQUFDYyxNQUFNLENBQUMsQ0FBQyxDQUFDQyxLQUFLLENBQUMsQ0FBQyxFQUFFZixLQUFLLENBQUNnQixRQUFRLEdBQUdaLFNBQVMsR0FBRyxDQUFDLENBQUM7RUFDNUgsTUFBTWEsVUFBVSxHQUFHQSxDQUFBLEtBQUk7SUFDbkIsSUFBSUMsWUFBWTtJQUNoQjtJQUNBLElBQUlaLEtBQUssQ0FBQ2EsTUFBTSxNQUFNLENBQUNELFlBQVksR0FBR2xCLEtBQUssQ0FBQ00sS0FBSyxNQUFNLElBQUksSUFBSVksWUFBWSxLQUFLZCxTQUFTLEdBQUdBLFNBQVMsR0FBR2MsWUFBWSxDQUFDQyxNQUFNLENBQUMsSUFBSWIsS0FBSyxDQUFDYyxLQUFLLENBQUMsQ0FBQ0MsQ0FBQyxFQUFFQyxDQUFDLEtBQUc7TUFDaEosSUFBSUosWUFBWTtNQUNoQixPQUFPRyxDQUFDLE1BQU0sQ0FBQ0gsWUFBWSxHQUFHbEIsS0FBSyxDQUFDTSxLQUFLLE1BQU0sSUFBSSxJQUFJWSxZQUFZLEtBQUtkLFNBQVMsR0FBR0EsU0FBUyxHQUFHYyxZQUFZLENBQUNLLElBQUksQ0FBQ0QsQ0FBQyxDQUFDLENBQUM7SUFDekgsQ0FBQyxDQUFDLEVBQUU7TUFDQTtJQUNKO0lBQ0E1QixRQUFRLENBQUNBLFFBQVEsQ0FBQ00sS0FBSyxFQUFFUCxRQUFRLENBQUMrQixjQUFjLENBQUM1QixTQUFTLENBQUNBLFNBQVMsQ0FBQ0UsT0FBTyxDQUFDLEVBQUVRLEtBQUssQ0FBQyxDQUFDO0lBQ3RGLElBQUksQ0FBQ21CLGVBQWUsQ0FBQ3pCLEtBQUssRUFBRSxPQUFPLENBQUM7SUFDcEMsSUFBSSxDQUFDeUIsZUFBZSxDQUFDekIsS0FBSyxFQUFFLFFBQVEsQ0FBQztFQUN6QyxDQUFDO0VBQ0RBLEtBQUssQ0FBQzBCLGdCQUFnQixDQUFDLFlBQVksRUFBRVQsVUFBVSxDQUFDO0VBQ2hELE1BQU0sSUFBSSxDQUFDVSxLQUFLLENBQUM3QixPQUFPLENBQUM7RUFDekJFLEtBQUssQ0FBQzRCLG1CQUFtQixDQUFDLFlBQVksRUFBRVgsVUFBVSxDQUFDO0FBQ3ZEO0FBQ0E7QUFDQSxTQUFTWSxTQUFTQSxDQUFDQyxVQUFVLEVBQUU7RUFDM0IsT0FBT0EsVUFBVSxDQUFDQyxXQUFXLENBQUMsQ0FBQyxDQUFDQyxPQUFPLENBQUMsZUFBZSxFQUFFLFFBQVEsQ0FBQztBQUN0RTtBQUNBLFNBQVNuQixnQkFBZ0JBLENBQUNILElBQUksRUFBRUksTUFBTSxFQUFFO0VBQ3BDLElBQUksQ0FBQ0EsTUFBTSxFQUFFO0lBQ1QsT0FBTyxJQUFJO0VBQ2Y7RUFDQSxNQUFNbUIsU0FBUyxHQUFHLENBQ2QsU0FBUyxFQUNULFNBQVMsRUFDVCxTQUFTLENBQ1o7RUFDRCxPQUFPSixTQUFTLENBQUNmLE1BQU0sQ0FBQyxDQUFDb0IsSUFBSSxDQUFDLENBQUMsQ0FBQ0MsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDQyxJQUFJLENBQUVDLFdBQVcsSUFBRztJQUNqRTtJQUNBLElBQUlBLFdBQVcsQ0FBQ0MsVUFBVSxDQUFDLEdBQUcsQ0FBQyxFQUFFO01BQzdCLE9BQU9ULFNBQVMsQ0FBQ25CLElBQUksQ0FBQzZCLElBQUksQ0FBQyxDQUFDQyxRQUFRLENBQUNILFdBQVcsQ0FBQztJQUNyRCxDQUFDLE1BQU0sSUFBSUosU0FBUyxDQUFDUSxRQUFRLENBQUNKLFdBQVcsQ0FBQyxFQUFFO01BQ3hDLE9BQU9SLFNBQVMsQ0FBQ25CLElBQUksQ0FBQ1IsSUFBSSxDQUFDLENBQUNvQyxVQUFVLENBQUNELFdBQVcsQ0FBQ0wsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUN4RTtJQUNBLE9BQU9ILFNBQVMsQ0FBQ25CLElBQUksQ0FBQ1IsSUFBSSxDQUFDLEtBQUttQyxXQUFXO0VBQy9DLENBQUMsQ0FBQztBQUNOO0FBRUFLLE9BQU8sQ0FBQzdDLE1BQU0sR0FBR0EsTUFBTSIsImlnbm9yZUxpc3QiOltdfQ==