{"version":3,"names":["isElementType","require","FileList","setFiles","isDisabled","getWindow","upload","element","fileOrFiles","input","control","type","TypeError","undefined","tagName","files","Array","isArray","filter","file","config","applyAccept","isAcceptableFile","accept","slice","multiple","fileDialog","_input_files","length","every","f","i","item","createFileList","dispatchUIEvent","addEventListener","click","removeEventListener","normalize","nameOrType","toLowerCase","replace","wildcards","trim","split","some","acceptToken","startsWith","name","endsWith","includes","exports"],"sources":["upload.js"],"sourcesContent":["'use strict';\n\nvar isElementType = require('../utils/misc/isElementType.js');\nvar FileList = require('../utils/dataTransfer/FileList.js');\nrequire('../utils/dataTransfer/Clipboard.js');\nvar setFiles = require('../utils/edit/setFiles.js');\nvar isDisabled = require('../utils/misc/isDisabled.js');\nvar getWindow = require('../utils/misc/getWindow.js');\n\nasync function upload(element, fileOrFiles) {\n    const input = isElementType.isElementType(element, 'label') ? element.control : element;\n    if (!input || !isElementType.isElementType(input, 'input', {\n        type: 'file'\n    })) {\n        throw new TypeError(`The ${input === element ? 'given' : 'associated'} ${input === null || input === undefined ? undefined : input.tagName} element does not accept file uploads`);\n    }\n    if (isDisabled.isDisabled(element)) return;\n    const files = (Array.isArray(fileOrFiles) ? fileOrFiles : [\n        fileOrFiles\n    ]).filter((file)=>!this.config.applyAccept || isAcceptableFile(file, input.accept)).slice(0, input.multiple ? undefined : 1);\n    const fileDialog = ()=>{\n        var _input_files;\n        // do not fire an input event if the file selection does not change\n        if (files.length === ((_input_files = input.files) === null || _input_files === undefined ? undefined : _input_files.length) && files.every((f, i)=>{\n            var _input_files;\n            return f === ((_input_files = input.files) === null || _input_files === undefined ? undefined : _input_files.item(i));\n        })) {\n            return;\n        }\n        setFiles.setFiles(input, FileList.createFileList(getWindow.getWindow(element), files));\n        this.dispatchUIEvent(input, 'input');\n        this.dispatchUIEvent(input, 'change');\n    };\n    input.addEventListener('fileDialog', fileDialog);\n    await this.click(element);\n    input.removeEventListener('fileDialog', fileDialog);\n}\n// When matching files, browsers ignore case and consider jpeg/jpg interchangeable.\nfunction normalize(nameOrType) {\n    return nameOrType.toLowerCase().replace(/(\\.|\\/)jpg\\b/g, '$1jpeg');\n}\nfunction isAcceptableFile(file, accept) {\n    if (!accept) {\n        return true;\n    }\n    const wildcards = [\n        'audio/*',\n        'image/*',\n        'video/*'\n    ];\n    return normalize(accept).trim().split(/\\s*,\\s*/).some((acceptToken)=>{\n        // tokens starting with a dot represent a file extension\n        if (acceptToken.startsWith('.')) {\n            return normalize(file.name).endsWith(acceptToken);\n        } else if (wildcards.includes(acceptToken)) {\n            return normalize(file.type).startsWith(acceptToken.replace('*', ''));\n        }\n        return normalize(file.type) === acceptToken;\n    });\n}\n\nexports.upload = upload;\n"],"mappings":"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","ignoreList":[]}