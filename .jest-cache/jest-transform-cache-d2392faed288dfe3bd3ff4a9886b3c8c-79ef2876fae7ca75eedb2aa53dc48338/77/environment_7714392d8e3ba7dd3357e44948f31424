0c94d06e0b4e2135ea43c61f9c60bed3
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.env = exports.config = void 0;
exports.loadEnvironment = loadEnvironment;
exports.validateProductionEnvironment = validateProductionEnvironment;
exports.getEnvironmentSummary = getEnvironmentSummary;
const zod_1 = require("zod");
const logger_1 = require("../core/logging/logger");
/**
 * Environment schema with validation and defaults
 */
const envSchema = zod_1.z.object({
    // API Configuration
    API_BASE_URL: zod_1.z.string().url().default('http://localhost:3001'),
    API_TIMEOUT: zod_1.z.number().min(1000).max(30000).default(5000),
    // AI Providers
    ANTHROPIC_API_KEY: zod_1.z.string().optional(),
    OPENAI_API_KEY: zod_1.z.string().optional(),
    AI_PROVIDER: zod_1.z.enum(['anthropic', 'openai', 'azure']).default('anthropic'),
    // Security
    CORS_ORIGIN: zod_1.z.string().default('http://localhost:5173'),
    RATE_LIMIT_REQUESTS: zod_1.z.number().min(1).max(1000).default(100),
    RATE_LIMIT_WINDOW: zod_1.z.number().min(1000).max(3600000).default(60000), // 1 minute
    // Features
    ENABLE_LOGGING: zod_1.z.boolean().default(true),
    ENABLE_MONITORING: zod_1.z.boolean().default(false),
    ENABLE_CACHE: zod_1.z.boolean().default(true),
    // Performance
    MAX_FILE_SIZE: zod_1.z.number().min(1024 * 1024).max(100 * 1024 * 1024).default(20 * 1024 * 1024), // 20MB
    MAX_CONCURRENT_REQUESTS: zod_1.z.number().min(1).max(50).default(5),
    CACHE_TTL: zod_1.z.number().min(60).max(86400).default(3600), // 1 hour
    // Development
    NODE_ENV: zod_1.z.enum(['development', 'production', 'test']).default('development'),
    DEBUG: zod_1.z.boolean().default(false),
    // Retry Configuration
    RETRY_MAX_ATTEMPTS: zod_1.z.number().min(1).max(10).default(3),
    RETRY_INITIAL_DELAY: zod_1.z.number().min(100).max(10000).default(1000),
    RETRY_MAX_DELAY: zod_1.z.number().min(1000).max(60000).default(10000),
    // Circuit Breaker Configuration
    CIRCUIT_BREAKER_FAILURE_THRESHOLD: zod_1.z.number().min(1).max(20).default(5),
    CIRCUIT_BREAKER_RESET_TIMEOUT: zod_1.z.number().min(1000).max(300000).default(60000), // 1 minute
    CIRCUIT_BREAKER_SUCCESS_THRESHOLD: zod_1.z.number().min(1).max(10).default(2),
});
/**
 * Load and validate environment configuration
 */
function loadEnvironment() {
    // Get environment variables with fallback for testing
    const getEnvVar = (key) => {
        if (typeof import.meta !== 'undefined' && import.meta.env) {
            return import.meta.env[key];
        }
        // Fallback for testing environment
        return process.env[key];
    };
    const env = {
        API_BASE_URL: getEnvVar('VITE_API_BASE_URL'),
        API_TIMEOUT: Number(getEnvVar('VITE_API_TIMEOUT')),
        ANTHROPIC_API_KEY: getEnvVar('VITE_ANTHROPIC_API_KEY'),
        OPENAI_API_KEY: getEnvVar('VITE_OPENAI_API_KEY'),
        AI_PROVIDER: getEnvVar('VITE_AI_PROVIDER'),
        CORS_ORIGIN: getEnvVar('VITE_CORS_ORIGIN'),
        RATE_LIMIT_REQUESTS: Number(getEnvVar('VITE_RATE_LIMIT_REQUESTS')),
        RATE_LIMIT_WINDOW: Number(getEnvVar('VITE_RATE_LIMIT_WINDOW')),
        ENABLE_LOGGING: getEnvVar('VITE_ENABLE_LOGGING') === 'true',
        ENABLE_MONITORING: getEnvVar('VITE_ENABLE_MONITORING') === 'true',
        ENABLE_CACHE: getEnvVar('VITE_ENABLE_CACHE') === 'true',
        MAX_FILE_SIZE: Number(getEnvVar('VITE_MAX_FILE_SIZE')),
        MAX_CONCURRENT_REQUESTS: Number(getEnvVar('VITE_MAX_CONCURRENT_REQUESTS')),
        CACHE_TTL: Number(getEnvVar('VITE_CACHE_TTL')),
        NODE_ENV: getEnvVar('MODE') || 'development',
        DEBUG: getEnvVar('VITE_DEBUG') === 'true',
        RETRY_MAX_ATTEMPTS: Number(getEnvVar('VITE_RETRY_MAX_ATTEMPTS')),
        RETRY_INITIAL_DELAY: Number(getEnvVar('VITE_RETRY_INITIAL_DELAY')),
        RETRY_MAX_DELAY: Number(getEnvVar('VITE_RETRY_MAX_DELAY')),
        CIRCUIT_BREAKER_FAILURE_THRESHOLD: Number(getEnvVar('VITE_CIRCUIT_BREAKER_FAILURE_THRESHOLD')),
        CIRCUIT_BREAKER_RESET_TIMEOUT: Number(getEnvVar('VITE_CIRCUIT_BREAKER_RESET_TIMEOUT')),
        CIRCUIT_BREAKER_SUCCESS_THRESHOLD: Number(getEnvVar('VITE_CIRCUIT_BREAKER_SUCCESS_THRESHOLD')),
    };
    try {
        const validatedEnv = envSchema.parse(env);
        logger_1.logger.info('Environment configuration loaded successfully', {
            nodeEnv: validatedEnv.NODE_ENV,
            apiBaseUrl: validatedEnv.API_BASE_URL,
            aiProvider: validatedEnv.AI_PROVIDER,
            enableLogging: validatedEnv.ENABLE_LOGGING,
            enableCache: validatedEnv.ENABLE_CACHE,
            debug: validatedEnv.DEBUG
        });
        return validatedEnv;
    }
    catch (error) {
        logger_1.logger.error('Environment validation failed', {
            error: error instanceof Error ? error.message : String(error),
            env: Object.keys(env).filter(key => env[key] !== undefined)
        });
        throw new Error(`Invalid environment configuration: ${error instanceof Error ? error.message : String(error)}`);
    }
}
/**
 * Get environment configuration with validation
 */
exports.config = loadEnvironment();
/**
 * Environment configuration helpers
 */
exports.env = {
    /**
     * Check if running in development mode
     */
    isDevelopment: () => exports.config.NODE_ENV === 'development',
    /**
     * Check if running in production mode
     */
    isProduction: () => exports.config.NODE_ENV === 'production',
    /**
     * Check if running in test mode
     */
    isTest: () => exports.config.NODE_ENV === 'test',
    /**
     * Check if debug mode is enabled
     */
    isDebug: () => exports.config.DEBUG,
    /**
     * Get API configuration
     */
    api: {
        baseUrl: () => exports.config.API_BASE_URL,
        timeout: () => exports.config.API_TIMEOUT,
    },
    /**
     * Get AI provider configuration
     */
    ai: {
        provider: () => exports.config.AI_PROVIDER,
        anthropicKey: () => exports.config.ANTHROPIC_API_KEY,
        openaiKey: () => exports.config.OPENAI_API_KEY,
    },
    /**
     * Get security configuration
     */
    security: {
        corsOrigin: () => exports.config.CORS_ORIGIN,
        rateLimitRequests: () => exports.config.RATE_LIMIT_REQUESTS,
        rateLimitWindow: () => exports.config.RATE_LIMIT_WINDOW,
    },
    /**
     * Get feature flags
     */
    features: {
        logging: () => exports.config.ENABLE_LOGGING,
        monitoring: () => exports.config.ENABLE_MONITORING,
        cache: () => exports.config.ENABLE_CACHE,
    },
    /**
     * Get performance configuration
     */
    performance: {
        maxFileSize: () => exports.config.MAX_FILE_SIZE,
        maxConcurrentRequests: () => exports.config.MAX_CONCURRENT_REQUESTS,
        cacheTTL: () => exports.config.CACHE_TTL,
    },
    /**
     * Get retry configuration
     */
    retry: {
        maxAttempts: () => exports.config.RETRY_MAX_ATTEMPTS,
        initialDelay: () => exports.config.RETRY_INITIAL_DELAY,
        maxDelay: () => exports.config.RETRY_MAX_DELAY,
    },
    /**
     * Get circuit breaker configuration
     */
    circuitBreaker: {
        failureThreshold: () => exports.config.CIRCUIT_BREAKER_FAILURE_THRESHOLD,
        resetTimeout: () => exports.config.CIRCUIT_BREAKER_RESET_TIMEOUT,
        successThreshold: () => exports.config.CIRCUIT_BREAKER_SUCCESS_THRESHOLD,
    },
};
/**
 * Validate required environment variables for production
 */
function validateProductionEnvironment() {
    if (exports.env.isProduction()) {
        const requiredVars = [
            'API_BASE_URL',
            'ANTHROPIC_API_KEY',
            'OPENAI_API_KEY',
            'CORS_ORIGIN'
        ];
        const missingVars = requiredVars.filter(varName => {
            const value = exports.config[varName];
            return value === undefined || value === '';
        });
        if (missingVars.length > 0) {
            throw new Error(`Missing required environment variables for production: ${missingVars.join(', ')}`);
        }
        logger_1.logger.info('Production environment validation passed');
    }
}
/**
 * Get environment summary for debugging
 */
function getEnvironmentSummary() {
    return {
        nodeEnv: exports.config.NODE_ENV,
        debug: exports.config.DEBUG,
        apiBaseUrl: exports.config.API_BASE_URL,
        aiProvider: exports.config.AI_PROVIDER,
        features: {
            logging: exports.config.ENABLE_LOGGING,
            monitoring: exports.config.ENABLE_MONITORING,
            cache: exports.config.ENABLE_CACHE,
        },
        performance: {
            maxFileSize: `${exports.config.MAX_FILE_SIZE / (1024 * 1024)}MB`,
            maxConcurrentRequests: exports.config.MAX_CONCURRENT_REQUESTS,
            cacheTTL: `${exports.config.CACHE_TTL}s`,
        },
        retry: {
            maxAttempts: exports.config.RETRY_MAX_ATTEMPTS,
            initialDelay: `${exports.config.RETRY_INITIAL_DELAY}ms`,
            maxDelay: `${exports.config.RETRY_MAX_DELAY}ms`,
        },
        circuitBreaker: {
            failureThreshold: exports.config.CIRCUIT_BREAKER_FAILURE_THRESHOLD,
            resetTimeout: `${exports.config.CIRCUIT_BREAKER_RESET_TIMEOUT}ms`,
            successThreshold: exports.config.CIRCUIT_BREAKER_SUCCESS_THRESHOLD,
        },
    };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxzYXJhaFxcUmVwb3NcXENDSCBBeGNlc3MgSW50ZWxsaWdlbmNlIFZpYmVkXFxzcmNcXGNvbmZpZ1xcZW52aXJvbm1lbnQudHMiLCJtYXBwaW5ncyI6Ijs7O0FBbURBLDBDQXVEQztBQWlHRCxzRUFvQkM7QUFLRCxzREEyQkM7QUEvUEQsNkJBQXdCO0FBQ3hCLG1EQUFnRDtBQUVoRDs7R0FFRztBQUNILE1BQU0sU0FBUyxHQUFHLE9BQUMsQ0FBQyxNQUFNLENBQUM7SUFDekIsb0JBQW9CO0lBQ3BCLFlBQVksRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLHVCQUF1QixDQUFDO0lBQy9ELFdBQVcsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDO0lBRTFELGVBQWU7SUFDZixpQkFBaUIsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFO0lBQ3hDLGNBQWMsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFO0lBQ3JDLFdBQVcsRUFBRSxPQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsV0FBVyxFQUFFLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUM7SUFFMUUsV0FBVztJQUNYLFdBQVcsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsT0FBTyxDQUFDLHVCQUF1QixDQUFDO0lBQ3hELG1CQUFtQixFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUM7SUFDN0QsaUJBQWlCLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFH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RyxjQUFNLENBQUMsbUJBQW1CLElBQUk7WUFDL0MsUUFBUSxFQUFFLEdBQUcsY0FBTSxDQUFDLGVBQWUsSUFBSTtTQUN4QztRQUNELGNBQWMsRUFBRTtZQUNkLGdCQUFnQixFQUFFLGNBQU0sQ0FBQyxpQ0FBaUM7WUFDMUQsWUFBWSxFQUFFLEdBQUcsY0FBTSxDQUFDLDZCQUE2QixJQUFJO1lBQ3pELGdCQUFnQixFQUFFLGNBQU0sQ0FBQyxpQ0FBaUM7U0FDM0Q7S0FDRixDQUFDO0FBQ0osQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXHNhcmFoXFxSZXBvc1xcQ0NIIEF4Y2VzcyBJbnRlbGxpZ2VuY2UgVmliZWRcXHNyY1xcY29uZmlnXFxlbnZpcm9ubWVudC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcclxuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnLi4vY29yZS9sb2dnaW5nL2xvZ2dlcic7XHJcblxyXG4vKipcclxuICogRW52aXJvbm1lbnQgc2NoZW1hIHdpdGggdmFsaWRhdGlvbiBhbmQgZGVmYXVsdHNcclxuICovXHJcbmNvbnN0IGVudlNjaGVtYSA9IHoub2JqZWN0KHtcclxuICAvLyBBUEkgQ29uZmlndXJhdGlvblxyXG4gIEFQSV9CQVNFX1VSTDogei5zdHJpbmcoKS51cmwoKS5kZWZhdWx0KCdodHRwOi8vbG9jYWxob3N0OjMwMDEnKSxcclxuICBBUElfVElNRU9VVDogei5udW1iZXIoKS5taW4oMTAwMCkubWF4KDMwMDAwKS5kZWZhdWx0KDUwMDApLFxyXG4gIFxyXG4gIC8vIEFJIFByb3ZpZGVyc1xyXG4gIEFOVEhST1BJQ19BUElfS0VZOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXHJcbiAgT1BFTkFJX0FQSV9LRVk6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcclxuICBBSV9QUk9WSURFUjogei5lbnVtKFsnYW50aHJvcGljJywgJ29wZW5haScsICdhenVyZSddKS5kZWZhdWx0KCdhbnRocm9waWMnKSxcclxuICBcclxuICAvLyBTZWN1cml0eVxyXG4gIENPUlNfT1JJR0lOOiB6LnN0cmluZygpLmRlZmF1bHQoJ2h0dHA6Ly9sb2NhbGhvc3Q6NTE3MycpLFxyXG4gIFJBVEVfTElNSVRfUkVRVUVTVFM6IHoubnVtYmVyKCkubWluKDEpLm1heCgxMDAwKS5kZWZhdWx0KDEwMCksXHJcbiAgUkFURV9MSU1JVF9XSU5ET1c6IHoubnVtYmVyKCkubWluKDEwMDApLm1heCgzNjAwMDAwKS5kZWZhdWx0KDYwMDAwKSwgLy8gMSBtaW51dGVcclxuICBcclxuICAvLyBGZWF0dXJlc1xyXG4gIEVOQUJMRV9MT0dHSU5HOiB6LmJvb2xlYW4oKS5kZWZhdWx0KHRydWUpLFxyXG4gIEVOQUJMRV9NT05JVE9SSU5HOiB6LmJvb2xlYW4oKS5kZWZhdWx0KGZhbHNlKSxcclxuICBFTkFCTEVfQ0FDSEU6IHouYm9vbGVhbigpLmRlZmF1bHQodHJ1ZSksXHJcbiAgXHJcbiAgLy8gUGVyZm9ybWFuY2VcclxuICBNQVhfRklMRV9TSVpFOiB6Lm51bWJlcigpLm1pbigxMDI0ICogMTAyNCkubWF4KDEwMCAqIDEwMjQgKiAxMDI0KS5kZWZhdWx0KDIwICogMTAyNCAqIDEwMjQpLCAvLyAyME1CXHJcbiAgTUFYX0NPTkNVUlJFTlRfUkVRVUVTVFM6IHoubnVtYmVyKCkubWluKDEpLm1heCg1MCkuZGVmYXVsdCg1KSxcclxuICBDQUNIRV9UVEw6IHoubnVtYmVyKCkubWluKDYwKS5tYXgoODY0MDApLmRlZmF1bHQoMzYwMCksIC8vIDEgaG91clxyXG4gIFxyXG4gIC8vIERldmVsb3BtZW50XHJcbiAgTk9ERV9FTlY6IHouZW51bShbJ2RldmVsb3BtZW50JywgJ3Byb2R1Y3Rpb24nLCAndGVzdCddKS5kZWZhdWx0KCdkZXZlbG9wbWVudCcpLFxyXG4gIERFQlVHOiB6LmJvb2xlYW4oKS5kZWZhdWx0KGZhbHNlKSxcclxuICBcclxuICAvLyBSZXRyeSBDb25maWd1cmF0aW9uXHJcbiAgUkVUUllfTUFYX0FUVEVNUFRTOiB6Lm51bWJlcigpLm1pbigxKS5tYXgoMTApLmRlZmF1bHQoMyksXHJcbiAgUkVUUllfSU5JVElBTF9ERUxBWTogei5udW1iZXIoKS5taW4oMTAwKS5tYXgoMTAwMDApLmRlZmF1bHQoMTAwMCksXHJcbiAgUkVUUllfTUFYX0RFTEFZOiB6Lm51bWJlcigpLm1pbigxMDAwKS5tYXgoNjAwMDApLmRlZmF1bHQoMTAwMDApLFxyXG4gIFxyXG4gIC8vIENpcmN1aXQgQnJlYWtlciBDb25maWd1cmF0aW9uXHJcbiAgQ0lSQ1VJVF9CUkVBS0VSX0ZBSUxVUkVfVEhSRVNIT0xEOiB6Lm51bWJlcigpLm1pbigxKS5tYXgoMjApLmRlZmF1bHQoNSksXHJcbiAgQ0lSQ1VJVF9CUkVBS0VSX1JFU0VUX1RJTUVPVVQ6IHoubnVtYmVyKCkubWluKDEwMDApLm1heCgzMDAwMDApLmRlZmF1bHQoNjAwMDApLCAvLyAxIG1pbnV0ZVxyXG4gIENJUkNVSVRfQlJFQUtFUl9TVUNDRVNTX1RIUkVTSE9MRDogei5udW1iZXIoKS5taW4oMSkubWF4KDEwKS5kZWZhdWx0KDIpLFxyXG59KTtcclxuXHJcbmV4cG9ydCB0eXBlIEVudmlyb25tZW50ID0gei5pbmZlcjx0eXBlb2YgZW52U2NoZW1hPjtcclxuXHJcbi8qKlxyXG4gKiBMb2FkIGFuZCB2YWxpZGF0ZSBlbnZpcm9ubWVudCBjb25maWd1cmF0aW9uXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gbG9hZEVudmlyb25tZW50KCk6IEVudmlyb25tZW50IHtcclxuICAvLyBHZXQgZW52aXJvbm1lbnQgdmFyaWFibGVzIHdpdGggZmFsbGJhY2sgZm9yIHRlc3RpbmdcclxuICBjb25zdCBnZXRFbnZWYXIgPSAoa2V5OiBzdHJpbmcpOiBzdHJpbmcgfCB1bmRlZmluZWQgPT4ge1xyXG4gICAgaWYgKHR5cGVvZiBpbXBvcnQubWV0YSAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1wb3J0Lm1ldGEuZW52KSB7XHJcbiAgICAgIHJldHVybiBpbXBvcnQubWV0YS5lbnZba2V5XTtcclxuICAgIH1cclxuICAgIC8vIEZhbGxiYWNrIGZvciB0ZXN0aW5nIGVudmlyb25tZW50XHJcbiAgICByZXR1cm4gcHJvY2Vzcy5lbnZba2V5XTtcclxuICB9O1xyXG5cclxuICBjb25zdCBlbnYgPSB7XHJcbiAgICBBUElfQkFTRV9VUkw6IGdldEVudlZhcignVklURV9BUElfQkFTRV9VUkwnKSxcclxuICAgIEFQSV9USU1FT1VUOiBOdW1iZXIoZ2V0RW52VmFyKCdWSVRFX0FQSV9USU1FT1VUJykpLFxyXG4gICAgQU5USFJPUElDX0FQSV9LRVk6IGdldEVudlZhcignVklURV9BTlRIUk9QSUNfQVBJX0tFWScpLFxyXG4gICAgT1BFTkFJX0FQSV9LRVk6IGdldEVudlZhcignVklURV9PUEVOQUlfQVBJX0tFWScpLFxyXG4gICAgQUlfUFJPVklERVI6IGdldEVudlZhcignVklURV9BSV9QUk9WSURFUicpLFxyXG4gICAgQ09SU19PUklHSU46IGdldEVudlZhcignVklURV9DT1JTX09SSUdJTicpLFxyXG4gICAgUkFURV9MSU1JVF9SRVFVRVNUUzogTnVtYmVyKGdldEVudlZhcignVklURV9SQVRFX0xJTUlUX1JFUVVFU1RTJykpLFxyXG4gICAgUkFURV9MSU1JVF9XSU5ET1c6IE51bWJlcihnZXRFbnZWYXIoJ1ZJVEVfUkFURV9MSU1JVF9XSU5ET1cnKSksXHJcbiAgICBFTkFCTEVfTE9HR0lORzogZ2V0RW52VmFyKCdWSVRFX0VOQUJMRV9MT0dHSU5HJykgPT09ICd0cnVlJyxcclxuICAgIEVOQUJMRV9NT05JVE9SSU5HOiBnZXRFbnZWYXIoJ1ZJVEVfRU5BQkxFX01PTklUT1JJTkcnKSA9PT0gJ3RydWUnLFxyXG4gICAgRU5BQkxFX0NBQ0hFOiBnZXRFbnZWYXIoJ1ZJVEVfRU5BQkxFX0NBQ0hFJykgPT09ICd0cnVlJyxcclxuICAgIE1BWF9GSUxFX1NJWkU6IE51bWJlcihnZXRFbnZWYXIoJ1ZJVEVfTUFYX0ZJTEVfU0laRScpKSxcclxuICAgIE1BWF9DT05DVVJSRU5UX1JFUVVFU1RTOiBOdW1iZXIoZ2V0RW52VmFyKCdWSVRFX01BWF9DT05DVVJSRU5UX1JFUVVFU1RTJykpLFxyXG4gICAgQ0FDSEVfVFRMOiBOdW1iZXIoZ2V0RW52VmFyKCdWSVRFX0NBQ0hFX1RUTCcpKSxcclxuICAgIE5PREVfRU5WOiBnZXRFbnZWYXIoJ01PREUnKSB8fCAnZGV2ZWxvcG1lbnQnLFxyXG4gICAgREVCVUc6IGdldEVudlZhcignVklURV9ERUJVRycpID09PSAndHJ1ZScsXHJcbiAgICBSRVRSWV9NQVhfQVRURU1QVFM6IE51bWJlcihnZXRFbnZWYXIoJ1ZJVEVfUkVUUllfTUFYX0FUVEVNUFRTJykpLFxyXG4gICAgUkVUUllfSU5JVElBTF9ERUxBWTogTnVtYmVyKGdldEVudlZhcignVklURV9SRVRSWV9JTklUSUFMX0RFTEFZJykpLFxyXG4gICAgUkVUUllfTUFYX0RFTEFZOiBOdW1iZXIoZ2V0RW52VmFyKCdWSVRFX1JFVFJZX01BWF9ERUxBWScpKSxcclxuICAgIENJUkNVSVRfQlJFQUtFUl9GQUlMVVJFX1RIUkVTSE9MRDogTnVtYmVyKGdldEVudlZhcignVklURV9DSVJDVUlUX0JSRUFLRVJfRkFJTFVSRV9USFJFU0hPTEQnKSksXHJcbiAgICBDSVJDVUlUX0JSRUFLRVJfUkVTRVRfVElNRU9VVDogTnVtYmVyKGdldEVudlZhcignVklURV9DSVJDVUlUX0JSRUFLRVJfUkVTRVRfVElNRU9VVCcpKSxcclxuICAgIENJUkNVSVRfQlJFQUtFUl9TVUNDRVNTX1RIUkVTSE9MRDogTnVtYmVyKGdldEVudlZhcignVklURV9DSVJDVUlUX0JSRUFLRVJfU1VDQ0VTU19USFJFU0hPTEQnKSksXHJcbiAgfTtcclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHZhbGlkYXRlZEVudiA9IGVudlNjaGVtYS5wYXJzZShlbnYpO1xyXG4gICAgXHJcbiAgICBsb2dnZXIuaW5mbygnRW52aXJvbm1lbnQgY29uZmlndXJhdGlvbiBsb2FkZWQgc3VjY2Vzc2Z1bGx5Jywge1xyXG4gICAgICBub2RlRW52OiB2YWxpZGF0ZWRFbnYuTk9ERV9FTlYsXHJcbiAgICAgIGFwaUJhc2VVcmw6IHZhbGlkYXRlZEVudi5BUElfQkFTRV9VUkwsXHJcbiAgICAgIGFpUHJvdmlkZXI6IHZhbGlkYXRlZEVudi5BSV9QUk9WSURFUixcclxuICAgICAgZW5hYmxlTG9nZ2luZzogdmFsaWRhdGVkRW52LkVOQUJMRV9MT0dHSU5HLFxyXG4gICAgICBlbmFibGVDYWNoZTogdmFsaWRhdGVkRW52LkVOQUJMRV9DQUNIRSxcclxuICAgICAgZGVidWc6IHZhbGlkYXRlZEVudi5ERUJVR1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIHJldHVybiB2YWxpZGF0ZWRFbnY7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGxvZ2dlci5lcnJvcignRW52aXJvbm1lbnQgdmFsaWRhdGlvbiBmYWlsZWQnLCB7IFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpLFxyXG4gICAgICBlbnY6IE9iamVjdC5rZXlzKGVudikuZmlsdGVyKGtleSA9PiBlbnZba2V5IGFzIGtleW9mIHR5cGVvZiBlbnZdICE9PSB1bmRlZmluZWQpXHJcbiAgICB9KTtcclxuICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBlbnZpcm9ubWVudCBjb25maWd1cmF0aW9uOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKX1gKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHZXQgZW52aXJvbm1lbnQgY29uZmlndXJhdGlvbiB3aXRoIHZhbGlkYXRpb25cclxuICovXHJcbmV4cG9ydCBjb25zdCBjb25maWcgPSBsb2FkRW52aXJvbm1lbnQoKTtcclxuXHJcbi8qKlxyXG4gKiBFbnZpcm9ubWVudCBjb25maWd1cmF0aW9uIGhlbHBlcnNcclxuICovXHJcbmV4cG9ydCBjb25zdCBlbnYgPSB7XHJcbiAgLyoqXHJcbiAgICogQ2hlY2sgaWYgcnVubmluZyBpbiBkZXZlbG9wbWVudCBtb2RlXHJcbiAgICovXHJcbiAgaXNEZXZlbG9wbWVudDogKCkgPT4gY29uZmlnLk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnLFxyXG4gIFxyXG4gIC8qKlxyXG4gICAqIENoZWNrIGlmIHJ1bm5pbmcgaW4gcHJvZHVjdGlvbiBtb2RlXHJcbiAgICovXHJcbiAgaXNQcm9kdWN0aW9uOiAoKSA9PiBjb25maWcuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJyxcclxuICBcclxuICAvKipcclxuICAgKiBDaGVjayBpZiBydW5uaW5nIGluIHRlc3QgbW9kZVxyXG4gICAqL1xyXG4gIGlzVGVzdDogKCkgPT4gY29uZmlnLk5PREVfRU5WID09PSAndGVzdCcsXHJcbiAgXHJcbiAgLyoqXHJcbiAgICogQ2hlY2sgaWYgZGVidWcgbW9kZSBpcyBlbmFibGVkXHJcbiAgICovXHJcbiAgaXNEZWJ1ZzogKCkgPT4gY29uZmlnLkRFQlVHLFxyXG4gIFxyXG4gIC8qKlxyXG4gICAqIEdldCBBUEkgY29uZmlndXJhdGlvblxyXG4gICAqL1xyXG4gIGFwaToge1xyXG4gICAgYmFzZVVybDogKCkgPT4gY29uZmlnLkFQSV9CQVNFX1VSTCxcclxuICAgIHRpbWVvdXQ6ICgpID0+IGNvbmZpZy5BUElfVElNRU9VVCxcclxuICB9LFxyXG4gIFxyXG4gIC8qKlxyXG4gICAqIEdldCBBSSBwcm92aWRlciBjb25maWd1cmF0aW9uXHJcbiAgICovXHJcbiAgYWk6IHtcclxuICAgIHByb3ZpZGVyOiAoKSA9PiBjb25maWcuQUlfUFJPVklERVIsXHJcbiAgICBhbnRocm9waWNLZXk6ICgpID0+IGNvbmZpZy5BTlRIUk9QSUNfQVBJX0tFWSxcclxuICAgIG9wZW5haUtleTogKCkgPT4gY29uZmlnLk9QRU5BSV9BUElfS0VZLFxyXG4gIH0sXHJcbiAgXHJcbiAgLyoqXHJcbiAgICogR2V0IHNlY3VyaXR5IGNvbmZpZ3VyYXRpb25cclxuICAgKi9cclxuICBzZWN1cml0eToge1xyXG4gICAgY29yc09yaWdpbjogKCkgPT4gY29uZmlnLkNPUlNfT1JJR0lOLFxyXG4gICAgcmF0ZUxpbWl0UmVxdWVzdHM6ICgpID0+IGNvbmZpZy5SQVRFX0xJTUlUX1JFUVVFU1RTLFxyXG4gICAgcmF0ZUxpbWl0V2luZG93OiAoKSA9PiBjb25maWcuUkFURV9MSU1JVF9XSU5ET1csXHJcbiAgfSxcclxuICBcclxuICAvKipcclxuICAgKiBHZXQgZmVhdHVyZSBmbGFnc1xyXG4gICAqL1xyXG4gIGZlYXR1cmVzOiB7XHJcbiAgICBsb2dnaW5nOiAoKSA9PiBjb25maWcuRU5BQkxFX0xPR0dJTkcsXHJcbiAgICBtb25pdG9yaW5nOiAoKSA9PiBjb25maWcuRU5BQkxFX01PTklUT1JJTkcsXHJcbiAgICBjYWNoZTogKCkgPT4gY29uZmlnLkVOQUJMRV9DQUNIRSxcclxuICB9LFxyXG4gIFxyXG4gIC8qKlxyXG4gICAqIEdldCBwZXJmb3JtYW5jZSBjb25maWd1cmF0aW9uXHJcbiAgICovXHJcbiAgcGVyZm9ybWFuY2U6IHtcclxuICAgIG1heEZpbGVTaXplOiAoKSA9PiBjb25maWcuTUFYX0ZJTEVfU0laRSxcclxuICAgIG1heENvbmN1cnJlbnRSZXF1ZXN0czogKCkgPT4gY29uZmlnLk1BWF9DT05DVVJSRU5UX1JFUVVFU1RTLFxyXG4gICAgY2FjaGVUVEw6ICgpID0+IGNvbmZpZy5DQUNIRV9UVEwsXHJcbiAgfSxcclxuICBcclxuICAvKipcclxuICAgKiBHZXQgcmV0cnkgY29uZmlndXJhdGlvblxyXG4gICAqL1xyXG4gIHJldHJ5OiB7XHJcbiAgICBtYXhBdHRlbXB0czogKCkgPT4gY29uZmlnLlJFVFJZX01BWF9BVFRFTVBUUyxcclxuICAgIGluaXRpYWxEZWxheTogKCkgPT4gY29uZmlnLlJFVFJZX0lOSVRJQUxfREVMQVksXHJcbiAgICBtYXhEZWxheTogKCkgPT4gY29uZmlnLlJFVFJZX01BWF9ERUxBWSxcclxuICB9LFxyXG4gIFxyXG4gIC8qKlxyXG4gICAqIEdldCBjaXJjdWl0IGJyZWFrZXIgY29uZmlndXJhdGlvblxyXG4gICAqL1xyXG4gIGNpcmN1aXRCcmVha2VyOiB7XHJcbiAgICBmYWlsdXJlVGhyZXNob2xkOiAoKSA9PiBjb25maWcuQ0lSQ1VJVF9CUkVBS0VSX0ZBSUxVUkVfVEhSRVNIT0xELFxyXG4gICAgcmVzZXRUaW1lb3V0OiAoKSA9PiBjb25maWcuQ0lSQ1VJVF9CUkVBS0VSX1JFU0VUX1RJTUVPVVQsXHJcbiAgICBzdWNjZXNzVGhyZXNob2xkOiAoKSA9PiBjb25maWcuQ0lSQ1VJVF9CUkVBS0VSX1NVQ0NFU1NfVEhSRVNIT0xELFxyXG4gIH0sXHJcbn07XHJcblxyXG4vKipcclxuICogVmFsaWRhdGUgcmVxdWlyZWQgZW52aXJvbm1lbnQgdmFyaWFibGVzIGZvciBwcm9kdWN0aW9uXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVQcm9kdWN0aW9uRW52aXJvbm1lbnQoKTogdm9pZCB7XHJcbiAgaWYgKGVudi5pc1Byb2R1Y3Rpb24oKSkge1xyXG4gICAgY29uc3QgcmVxdWlyZWRWYXJzID0gW1xyXG4gICAgICAnQVBJX0JBU0VfVVJMJyxcclxuICAgICAgJ0FOVEhST1BJQ19BUElfS0VZJyxcclxuICAgICAgJ09QRU5BSV9BUElfS0VZJyxcclxuICAgICAgJ0NPUlNfT1JJR0lOJ1xyXG4gICAgXTtcclxuICAgIFxyXG4gICAgY29uc3QgbWlzc2luZ1ZhcnMgPSByZXF1aXJlZFZhcnMuZmlsdGVyKHZhck5hbWUgPT4ge1xyXG4gICAgICBjb25zdCB2YWx1ZSA9IGNvbmZpZ1t2YXJOYW1lIGFzIGtleW9mIEVudmlyb25tZW50XTtcclxuICAgICAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09ICcnO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGlmIChtaXNzaW5nVmFycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgTWlzc2luZyByZXF1aXJlZCBlbnZpcm9ubWVudCB2YXJpYWJsZXMgZm9yIHByb2R1Y3Rpb246ICR7bWlzc2luZ1ZhcnMuam9pbignLCAnKX1gKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgbG9nZ2VyLmluZm8oJ1Byb2R1Y3Rpb24gZW52aXJvbm1lbnQgdmFsaWRhdGlvbiBwYXNzZWQnKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHZXQgZW52aXJvbm1lbnQgc3VtbWFyeSBmb3IgZGVidWdnaW5nXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RW52aXJvbm1lbnRTdW1tYXJ5KCk6IFJlY29yZDxzdHJpbmcsIHVua25vd24+IHtcclxuICByZXR1cm4ge1xyXG4gICAgbm9kZUVudjogY29uZmlnLk5PREVfRU5WLFxyXG4gICAgZGVidWc6IGNvbmZpZy5ERUJVRyxcclxuICAgIGFwaUJhc2VVcmw6IGNvbmZpZy5BUElfQkFTRV9VUkwsXHJcbiAgICBhaVByb3ZpZGVyOiBjb25maWcuQUlfUFJPVklERVIsXHJcbiAgICBmZWF0dXJlczoge1xyXG4gICAgICBsb2dnaW5nOiBjb25maWcuRU5BQkxFX0xPR0dJTkcsXHJcbiAgICAgIG1vbml0b3Jpbmc6IGNvbmZpZy5FTkFCTEVfTU9OSVRPUklORyxcclxuICAgICAgY2FjaGU6IGNvbmZpZy5FTkFCTEVfQ0FDSEUsXHJcbiAgICB9LFxyXG4gICAgcGVyZm9ybWFuY2U6IHtcclxuICAgICAgbWF4RmlsZVNpemU6IGAke2NvbmZpZy5NQVhfRklMRV9TSVpFIC8gKDEwMjQgKiAxMDI0KX1NQmAsXHJcbiAgICAgIG1heENvbmN1cnJlbnRSZXF1ZXN0czogY29uZmlnLk1BWF9DT05DVVJSRU5UX1JFUVVFU1RTLFxyXG4gICAgICBjYWNoZVRUTDogYCR7Y29uZmlnLkNBQ0hFX1RUTH1zYCxcclxuICAgIH0sXHJcbiAgICByZXRyeToge1xyXG4gICAgICBtYXhBdHRlbXB0czogY29uZmlnLlJFVFJZX01BWF9BVFRFTVBUUyxcclxuICAgICAgaW5pdGlhbERlbGF5OiBgJHtjb25maWcuUkVUUllfSU5JVElBTF9ERUxBWX1tc2AsXHJcbiAgICAgIG1heERlbGF5OiBgJHtjb25maWcuUkVUUllfTUFYX0RFTEFZfW1zYCxcclxuICAgIH0sXHJcbiAgICBjaXJjdWl0QnJlYWtlcjoge1xyXG4gICAgICBmYWlsdXJlVGhyZXNob2xkOiBjb25maWcuQ0lSQ1VJVF9CUkVBS0VSX0ZBSUxVUkVfVEhSRVNIT0xELFxyXG4gICAgICByZXNldFRpbWVvdXQ6IGAke2NvbmZpZy5DSVJDVUlUX0JSRUFLRVJfUkVTRVRfVElNRU9VVH1tc2AsXHJcbiAgICAgIHN1Y2Nlc3NUaHJlc2hvbGQ6IGNvbmZpZy5DSVJDVUlUX0JSRUFLRVJfU1VDQ0VTU19USFJFU0hPTEQsXHJcbiAgICB9LFxyXG4gIH07XHJcbn1cclxuIl0sInZlcnNpb24iOjN9