{"version":3,"names":["UI","require","isElementType","timeValue","maxLength","cursor","trackValue","getInputRange","setSelection","isDateOrTime","element","includes","type","input","instance","data","inputType","inputRange","unprevented","dispatchUIEvent","editContenteditable","editInputElement","del","collapsed","deleteContents","nextPosition","getNextCursorPosition","startContainer","startOffset","delRange","cloneRange","comparePoint","node","offset","setStart","setEnd","endContainer","nodeType","endOffset","insertData","length","text","ownerDocument","createTextNode","insertNode","dataToInsert","supportsMaxLength","maxLength$1","getMaxLength","undefined","spaceUntilMaxLength","value","substring","newValue","newOffset","oldValue","calculateNewValue","isValidNumberInput","setUIValue","focusNode","anchorOffset","focusOffset","isValidDateOrTimeValue","commitInput","clearInitialValue","inputData","getUIValue","prologEnd","Math","max","prolog","epilogStart","min","epilog","builtValue","buildTimeValue","inputInit","commitValueAfterInput","_value_match","_value_match1","valueParts","split","test","Number","match","exports"],"sources":["input.js"],"sourcesContent":["'use strict';\n\nvar UI = require('../document/UI.js');\nvar isElementType = require('../utils/misc/isElementType.js');\nrequire('../utils/dataTransfer/Clipboard.js');\nvar timeValue = require('../utils/edit/timeValue.js');\nvar maxLength = require('../utils/edit/maxLength.js');\nvar cursor = require('../utils/focus/cursor.js');\nvar trackValue = require('../document/trackValue.js');\nvar getInputRange = require('./selection/getInputRange.js');\nvar setSelection = require('./selection/setSelection.js');\n\nfunction isDateOrTime(element) {\n    return isElementType.isElementType(element, 'input') && [\n        'date',\n        'time'\n    ].includes(element.type);\n}\nfunction input(instance, element, data, inputType = 'insertText') {\n    const inputRange = getInputRange.getInputRange(element);\n    /* istanbul ignore if */ if (!inputRange) {\n        return;\n    }\n    // There is no `beforeinput` event on `date` and `time` input\n    if (!isDateOrTime(element)) {\n        const unprevented = instance.dispatchUIEvent(element, 'beforeinput', {\n            inputType,\n            data\n        });\n        if (!unprevented) {\n            return;\n        }\n    }\n    if ('startContainer' in inputRange) {\n        editContenteditable(instance, element, inputRange, data, inputType);\n    } else {\n        editInputElement(instance, element, inputRange, data, inputType);\n    }\n}\nfunction editContenteditable(instance, element, inputRange, data, inputType) {\n    let del = false;\n    if (!inputRange.collapsed) {\n        del = true;\n        inputRange.deleteContents();\n    } else if ([\n        'deleteContentBackward',\n        'deleteContentForward'\n    ].includes(inputType)) {\n        const nextPosition = cursor.getNextCursorPosition(inputRange.startContainer, inputRange.startOffset, inputType === 'deleteContentBackward' ? -1 : 1, inputType);\n        if (nextPosition) {\n            del = true;\n            const delRange = inputRange.cloneRange();\n            if (delRange.comparePoint(nextPosition.node, nextPosition.offset) < 0) {\n                delRange.setStart(nextPosition.node, nextPosition.offset);\n            } else {\n                delRange.setEnd(nextPosition.node, nextPosition.offset);\n            }\n            delRange.deleteContents();\n        }\n    }\n    if (data) {\n        if (inputRange.endContainer.nodeType === 3) {\n            const offset = inputRange.endOffset;\n            inputRange.endContainer.insertData(offset, data);\n            inputRange.setStart(inputRange.endContainer, offset + data.length);\n            inputRange.setEnd(inputRange.endContainer, offset + data.length);\n        } else {\n            const text = element.ownerDocument.createTextNode(data);\n            inputRange.insertNode(text);\n            inputRange.setStart(text, data.length);\n            inputRange.setEnd(text, data.length);\n        }\n    }\n    if (del || data) {\n        instance.dispatchUIEvent(element, 'input', {\n            inputType\n        });\n    }\n}\nfunction editInputElement(instance, element, inputRange, data, inputType) {\n    let dataToInsert = data;\n    if (maxLength.supportsMaxLength(element)) {\n        const maxLength$1 = maxLength.getMaxLength(element);\n        if (maxLength$1 !== undefined && data.length > 0) {\n            const spaceUntilMaxLength = maxLength$1 - element.value.length;\n            if (spaceUntilMaxLength > 0) {\n                dataToInsert = data.substring(0, spaceUntilMaxLength);\n            } else {\n                return;\n            }\n        }\n    }\n    const { newValue, newOffset, oldValue } = calculateNewValue(dataToInsert, element, inputRange, inputType);\n    if (newValue === oldValue && newOffset === inputRange.startOffset && newOffset === inputRange.endOffset) {\n        return;\n    }\n    if (isElementType.isElementType(element, 'input', {\n        type: 'number'\n    }) && !isValidNumberInput(newValue)) {\n        return;\n    }\n    UI.setUIValue(element, newValue);\n    setSelection.setSelection({\n        focusNode: element,\n        anchorOffset: newOffset,\n        focusOffset: newOffset\n    });\n    if (isDateOrTime(element)) {\n        if (timeValue.isValidDateOrTimeValue(element, newValue)) {\n            commitInput(instance, element, newOffset, {});\n            instance.dispatchUIEvent(element, 'change');\n            UI.clearInitialValue(element);\n        }\n    } else {\n        commitInput(instance, element, newOffset, {\n            data,\n            inputType\n        });\n    }\n}\nfunction calculateNewValue(inputData, node, { startOffset, endOffset }, inputType) {\n    const value = UI.getUIValue(node);\n    const prologEnd = Math.max(0, startOffset === endOffset && inputType === 'deleteContentBackward' ? startOffset - 1 : startOffset);\n    const prolog = value.substring(0, prologEnd);\n    const epilogStart = Math.min(value.length, startOffset === endOffset && inputType === 'deleteContentForward' ? startOffset + 1 : endOffset);\n    const epilog = value.substring(epilogStart, value.length);\n    let newValue = `${prolog}${inputData}${epilog}`;\n    let newOffset = prologEnd + inputData.length;\n    if (isElementType.isElementType(node, 'input', {\n        type: 'time'\n    })) {\n        const builtValue = timeValue.buildTimeValue(newValue);\n        if (builtValue !== '' && timeValue.isValidDateOrTimeValue(node, builtValue)) {\n            newValue = builtValue;\n            newOffset = builtValue.length;\n        }\n    }\n    return {\n        oldValue: value,\n        newValue,\n        newOffset\n    };\n}\nfunction commitInput(instance, element, newOffset, inputInit) {\n    instance.dispatchUIEvent(element, 'input', inputInit);\n    trackValue.commitValueAfterInput(element, newOffset);\n}\nfunction isValidNumberInput(value) {\n    var _value_match, _value_match1;\n    // the browser allows some invalid input but not others\n    // it allows up to two '-' at any place before any 'e' or one directly following 'e'\n    // it allows one '.' at any place before e\n    const valueParts = value.split('e', 2);\n    return !(/[^\\d.\\-e]/.test(value) || Number((_value_match = value.match(/-/g)) === null || _value_match === undefined ? undefined : _value_match.length) > 2 || Number((_value_match1 = value.match(/\\./g)) === null || _value_match1 === undefined ? undefined : _value_match1.length) > 1 || valueParts[1] && !/^-?\\d*$/.test(valueParts[1]));\n}\n\nexports.input = input;\n"],"mappings":"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","ignoreList":[]}