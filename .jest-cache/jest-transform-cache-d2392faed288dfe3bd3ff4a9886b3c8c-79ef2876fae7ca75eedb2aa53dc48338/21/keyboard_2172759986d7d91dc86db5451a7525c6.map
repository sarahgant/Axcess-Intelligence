{"version":3,"names":["require","getActiveElement","_define_property","obj","key","value","Object","defineProperty","enumerable","configurable","writable","DOM_KEY_LOCATION","modifierKeys","isModifierKey","includes","modifierLocks","isModifierLock","KeyboardHost","isKeyPressed","keyDef","pressed","has","String","code","getPressedKeys","values","map","p","keydown","instance","target","getActiveElementOrBody","config","document","setKeydownTarget","add","modifiers","unprevented","dispatchUIEvent","modifierLockStart","setUnprevented","hasKeyPress","charCode","charCodeAt","keyup","isUnprevented","delete","find","lastKeydownTarget","carryChar","length","Control","Alt","constructor","system","undefined","AltGraph","CapsLock","Fn","FnLock","Meta","NumLock","ScrollLock","Shift","Symbol","SymbolLock","_this_registry","_code","_","registry","unpreventedDefault","o","_this_registry_code","exports"],"sources":["keyboard.js"],"sourcesContent":["'use strict';\n\nrequire('../utils/dataTransfer/Clipboard.js');\nvar getActiveElement = require('../utils/focus/getActiveElement.js');\n\nfunction _define_property(obj, key, value) {\n    if (key in obj) {\n        Object.defineProperty(obj, key, {\n            value: value,\n            enumerable: true,\n            configurable: true,\n            writable: true\n        });\n    } else {\n        obj[key] = value;\n    }\n    return obj;\n}\nvar DOM_KEY_LOCATION = /*#__PURE__*/ function(DOM_KEY_LOCATION) {\n    DOM_KEY_LOCATION[DOM_KEY_LOCATION[\"STANDARD\"] = 0] = \"STANDARD\";\n    DOM_KEY_LOCATION[DOM_KEY_LOCATION[\"LEFT\"] = 1] = \"LEFT\";\n    DOM_KEY_LOCATION[DOM_KEY_LOCATION[\"RIGHT\"] = 2] = \"RIGHT\";\n    DOM_KEY_LOCATION[DOM_KEY_LOCATION[\"NUMPAD\"] = 3] = \"NUMPAD\";\n    return DOM_KEY_LOCATION;\n}({});\nconst modifierKeys = [\n    'Alt',\n    'AltGraph',\n    'Control',\n    'Fn',\n    'Meta',\n    'Shift',\n    'Symbol'\n];\nfunction isModifierKey(key) {\n    return modifierKeys.includes(key);\n}\nconst modifierLocks = [\n    'CapsLock',\n    'FnLock',\n    'NumLock',\n    'ScrollLock',\n    'SymbolLock'\n];\nfunction isModifierLock(key) {\n    return modifierLocks.includes(key);\n}\nclass KeyboardHost {\n    isKeyPressed(keyDef) {\n        return this.pressed.has(String(keyDef.code));\n    }\n    getPressedKeys() {\n        return this.pressed.values().map((p)=>p.keyDef);\n    }\n    /** Press a key */ async keydown(instance, keyDef) {\n        const key = String(keyDef.key);\n        const code = String(keyDef.code);\n        const target = getActiveElement.getActiveElementOrBody(instance.config.document);\n        this.setKeydownTarget(target);\n        this.pressed.add(code, keyDef);\n        if (isModifierKey(key)) {\n            this.modifiers[key] = true;\n        }\n        const unprevented = instance.dispatchUIEvent(target, 'keydown', {\n            key,\n            code\n        });\n        if (isModifierLock(key) && !this.modifiers[key]) {\n            this.modifiers[key] = true;\n            this.modifierLockStart[key] = true;\n        }\n        if (unprevented) {\n            this.pressed.setUnprevented(code);\n        }\n        if (unprevented && this.hasKeyPress(key)) {\n            instance.dispatchUIEvent(getActiveElement.getActiveElementOrBody(instance.config.document), 'keypress', {\n                key,\n                code,\n                charCode: keyDef.key === 'Enter' ? 13 : String(keyDef.key).charCodeAt(0)\n            });\n        }\n    }\n    /** Release a key */ async keyup(instance, keyDef) {\n        const key = String(keyDef.key);\n        const code = String(keyDef.code);\n        const unprevented = this.pressed.isUnprevented(code);\n        this.pressed.delete(code);\n        if (isModifierKey(key) && !this.pressed.values().find((p)=>p.keyDef.key === key)) {\n            this.modifiers[key] = false;\n        }\n        instance.dispatchUIEvent(getActiveElement.getActiveElementOrBody(instance.config.document), 'keyup', {\n            key,\n            code\n        }, !unprevented);\n        if (isModifierLock(key) && this.modifiers[key]) {\n            if (this.modifierLockStart[key]) {\n                this.modifierLockStart[key] = false;\n            } else {\n                this.modifiers[key] = false;\n            }\n        }\n    }\n    setKeydownTarget(target) {\n        if (target !== this.lastKeydownTarget) {\n            this.carryChar = '';\n        }\n        this.lastKeydownTarget = target;\n    }\n    hasKeyPress(key) {\n        return (key.length === 1 || key === 'Enter') && !this.modifiers.Control && !this.modifiers.Alt;\n    }\n    constructor(system){\n        _define_property(this, \"system\", undefined);\n        _define_property(this, \"modifiers\", {\n            Alt: false,\n            AltGraph: false,\n            CapsLock: false,\n            Control: false,\n            Fn: false,\n            FnLock: false,\n            Meta: false,\n            NumLock: false,\n            ScrollLock: false,\n            Shift: false,\n            Symbol: false,\n            SymbolLock: false\n        });\n        _define_property(this, \"pressed\", new class {\n            add(code, keyDef) {\n                var _this_registry, _code;\n                var _;\n                (_ = (_this_registry = this.registry)[_code = code]) !== null && _ !== undefined ? _ : _this_registry[_code] = {\n                    keyDef,\n                    unpreventedDefault: false\n                };\n            }\n            has(code) {\n                return !!this.registry[code];\n            }\n            setUnprevented(code) {\n                const o = this.registry[code];\n                if (o) {\n                    o.unpreventedDefault = true;\n                }\n            }\n            isUnprevented(code) {\n                var _this_registry_code;\n                return !!((_this_registry_code = this.registry[code]) === null || _this_registry_code === undefined ? undefined : _this_registry_code.unpreventedDefault);\n            }\n            delete(code) {\n                // eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n                delete this.registry[code];\n            }\n            values() {\n                return Object.values(this.registry);\n            }\n            constructor(){\n                _define_property(this, \"registry\", {});\n            }\n        }());\n        _define_property(this, \"carryChar\", '');\n        _define_property(this, \"lastKeydownTarget\", undefined);\n        _define_property(this, \"modifierLockStart\", {});\n        this.system = system;\n    }\n}\n\nexports.DOM_KEY_LOCATION = DOM_KEY_LOCATION;\nexports.KeyboardHost = KeyboardHost;\n"],"mappings":"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","ignoreList":[]}