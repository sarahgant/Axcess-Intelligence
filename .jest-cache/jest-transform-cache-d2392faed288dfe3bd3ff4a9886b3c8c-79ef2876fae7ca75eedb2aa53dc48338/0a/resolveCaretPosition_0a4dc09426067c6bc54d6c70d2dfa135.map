{"version":3,"names":["UI","require","selection","resolveCaretPosition","target","node","offset","hasOwnSelection","undefined","getUIValue","length","nodeType","nodeValue","childNodes","findNodeAtTextOffset","isRoot","i","step","Math","max","Error","c","item","text","String","textContent","exports"],"sources":["resolveCaretPosition.js"],"sourcesContent":["'use strict';\n\nvar UI = require('../../document/UI.js');\nrequire('../../utils/dataTransfer/Clipboard.js');\nvar selection = require('../../utils/focus/selection.js');\n\nfunction resolveCaretPosition({ target, node, offset }) {\n    if (selection.hasOwnSelection(target)) {\n        return {\n            node: target,\n            offset: offset !== null && offset !== undefined ? offset : UI.getUIValue(target).length\n        };\n    } else if (node) {\n        return {\n            node,\n            offset: offset !== null && offset !== undefined ? offset : node.nodeType === 3 ? node.nodeValue.length : node.childNodes.length\n        };\n    }\n    return findNodeAtTextOffset(target, offset);\n}\nfunction findNodeAtTextOffset(node, offset, isRoot = true) {\n    // When clicking after the content the browser behavior can be complicated:\n    // 1. If there is textContent after the last element child,\n    // the cursor is moved there.\n    // 2. If there is textContent in the last element child,\n    // the browser moves the cursor to the last non-empty text node inside this element.\n    // 3. Otherwise the cursor is moved to the end of the target.\n    let i = offset === undefined ? node.childNodes.length - 1 : 0;\n    const step = offset === undefined ? -1 : 1;\n    while(offset === undefined ? i >= (isRoot ? Math.max(node.childNodes.length - 1, 0) : 0) : i <= node.childNodes.length){\n        if (offset && i === node.childNodes.length) {\n            throw new Error('The given offset is out of bounds.');\n        }\n        const c = node.childNodes.item(i);\n        const text = String(c.textContent);\n        if (text.length) {\n            if (offset !== undefined && text.length < offset) {\n                offset -= text.length;\n            } else if (c.nodeType === 1) {\n                return findNodeAtTextOffset(c, offset, false);\n            } else {\n                // The pre-commit hooks keeps changing this\n                // See https://github.com/kentcdodds/kcd-scripts/issues/218\n                /* istanbul ignore else */ // eslint-disable-next-line no-lonely-if\n                if (c.nodeType === 3) {\n                    return {\n                        node: c,\n                        offset: offset !== null && offset !== undefined ? offset : c.nodeValue.length\n                    };\n                }\n            }\n        }\n        i += step;\n    }\n    return {\n        node,\n        offset: node.childNodes.length\n    };\n}\n\nexports.resolveCaretPosition = resolveCaretPosition;\n"],"mappings":"AAAA,YAAY;;AAEZ,IAAIA,EAAE,GAAGC,OAAO,CAAC,sBAAsB,CAAC;AACxCA,OAAO,CAAC,uCAAuC,CAAC;AAChD,IAAIC,SAAS,GAAGD,OAAO,CAAC,gCAAgC,CAAC;AAEzD,SAASE,oBAAoBA,CAAC;EAAEC,MAAM;EAAEC,IAAI;EAAEC;AAAO,CAAC,EAAE;EACpD,IAAIJ,SAAS,CAACK,eAAe,CAACH,MAAM,CAAC,EAAE;IACnC,OAAO;MACHC,IAAI,EAAED,MAAM;MACZE,MAAM,EAAEA,MAAM,KAAK,IAAI,IAAIA,MAAM,KAAKE,SAAS,GAAGF,MAAM,GAAGN,EAAE,CAACS,UAAU,CAACL,MAAM,CAAC,CAACM;IACrF,CAAC;EACL,CAAC,MAAM,IAAIL,IAAI,EAAE;IACb,OAAO;MACHA,IAAI;MACJC,MAAM,EAAEA,MAAM,KAAK,IAAI,IAAIA,MAAM,KAAKE,SAAS,GAAGF,MAAM,GAAGD,IAAI,CAACM,QAAQ,KAAK,CAAC,GAAGN,IAAI,CAACO,SAAS,CAACF,MAAM,GAAGL,IAAI,CAACQ,UAAU,CAACH;IAC7H,CAAC;EACL;EACA,OAAOI,oBAAoB,CAACV,MAAM,EAAEE,MAAM,CAAC;AAC/C;AACA,SAASQ,oBAAoBA,CAACT,IAAI,EAAEC,MAAM,EAAES,MAAM,GAAG,IAAI,EAAE;EACvD;EACA;EACA;EACA;EACA;EACA;EACA,IAAIC,CAAC,GAAGV,MAAM,KAAKE,SAAS,GAAGH,IAAI,CAACQ,UAAU,CAACH,MAAM,GAAG,CAAC,GAAG,CAAC;EAC7D,MAAMO,IAAI,GAAGX,MAAM,KAAKE,SAAS,GAAG,CAAC,CAAC,GAAG,CAAC;EAC1C,OAAMF,MAAM,KAAKE,SAAS,GAAGQ,CAAC,KAAKD,MAAM,GAAGG,IAAI,CAACC,GAAG,CAACd,IAAI,CAACQ,UAAU,CAACH,MAAM,GAAG,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,GAAGM,CAAC,IAAIX,IAAI,CAACQ,UAAU,CAACH,MAAM,EAAC;IACnH,IAAIJ,MAAM,IAAIU,CAAC,KAAKX,IAAI,CAACQ,UAAU,CAACH,MAAM,EAAE;MACxC,MAAM,IAAIU,KAAK,CAAC,oCAAoC,CAAC;IACzD;IACA,MAAMC,CAAC,GAAGhB,IAAI,CAACQ,UAAU,CAACS,IAAI,CAACN,CAAC,CAAC;IACjC,MAAMO,IAAI,GAAGC,MAAM,CAACH,CAAC,CAACI,WAAW,CAAC;IAClC,IAAIF,IAAI,CAACb,MAAM,EAAE;MACb,IAAIJ,MAAM,KAAKE,SAAS,IAAIe,IAAI,CAACb,MAAM,GAAGJ,MAAM,EAAE;QAC9CA,MAAM,IAAIiB,IAAI,CAACb,MAAM;MACzB,CAAC,MAAM,IAAIW,CAAC,CAACV,QAAQ,KAAK,CAAC,EAAE;QACzB,OAAOG,oBAAoB,CAACO,CAAC,EAAEf,MAAM,EAAE,KAAK,CAAC;MACjD,CAAC,MAAM;QACH;QACA;QACA,2BAA2B;QAC3B,IAAIe,CAAC,CAACV,QAAQ,KAAK,CAAC,EAAE;UAClB,OAAO;YACHN,IAAI,EAAEgB,CAAC;YACPf,MAAM,EAAEA,MAAM,KAAK,IAAI,IAAIA,MAAM,KAAKE,SAAS,GAAGF,MAAM,GAAGe,CAAC,CAACT,SAAS,CAACF;UAC3E,CAAC;QACL;MACJ;IACJ;IACAM,CAAC,IAAIC,IAAI;EACb;EACA,OAAO;IACHZ,IAAI;IACJC,MAAM,EAAED,IAAI,CAACQ,UAAU,CAACH;EAC5B,CAAC;AACL;AAEAgB,OAAO,CAACvB,oBAAoB,GAAGA,oBAAoB","ignoreList":[]}