ea6f64d8b952178060ad56db665e544c
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.logger = exports.LogLevel = void 0;
var LogLevel;
(function (LogLevel) {
    LogLevel[LogLevel["DEBUG"] = 0] = "DEBUG";
    LogLevel[LogLevel["INFO"] = 1] = "INFO";
    LogLevel[LogLevel["WARN"] = 2] = "WARN";
    LogLevel[LogLevel["ERROR"] = 3] = "ERROR";
    LogLevel[LogLevel["FATAL"] = 4] = "FATAL";
})(LogLevel || (exports.LogLevel = LogLevel = {}));
class Logger {
    constructor() {
        Object.defineProperty(this, "isDevelopment", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: process.env.NODE_ENV === 'development'
        });
        Object.defineProperty(this, "logLevel", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: this.isDevelopment ? LogLevel.DEBUG : LogLevel.INFO
        });
    }
    formatLog(context) {
        return JSON.stringify(context);
    }
    shouldLog(level) {
        return level >= this.logLevel;
    }
    log(level, message, meta, context) {
        if (!this.shouldLog(level))
            return;
        const logContext = {
            timestamp: new Date().toISOString(),
            level,
            message,
            meta,
            correlationId: this.getCorrelationId(),
            userId: this.getUserId(),
            sessionId: this.getSessionId(),
            ...context
        };
        // In development, use console for readability
        if (this.isDevelopment) {
            const color = this.getConsoleColor(level);
            const levelName = LogLevel[level];
            console.log(`%c[${levelName}]`, color, message, meta || '');
        }
        else {
            // In production, send to monitoring service
            this.sendToMonitoring(logContext);
        }
        // Store in local buffer for debugging
        this.storeInBuffer(logContext);
    }
    debug(message, meta, context) {
        this.log(LogLevel.DEBUG, message, meta, context);
    }
    info(message, meta, context) {
        this.log(LogLevel.INFO, message, meta, context);
    }
    warn(message, meta, context) {
        this.log(LogLevel.WARN, message, meta, context);
    }
    error(message, meta, context) {
        this.log(LogLevel.ERROR, message, meta, context);
    }
    fatal(message, meta, context) {
        this.log(LogLevel.FATAL, message, meta, context);
    }
    // Component-specific logging methods
    component(componentName) {
        return {
            debug: (message, meta) => this.debug(message, meta, { component: componentName }),
            info: (message, meta) => this.info(message, meta, { component: componentName }),
            warn: (message, meta) => this.warn(message, meta, { component: componentName }),
            error: (message, meta) => this.error(message, meta, { component: componentName }),
            fatal: (message, meta) => this.fatal(message, meta, { component: componentName })
        };
    }
    // Action-specific logging methods
    action(actionName) {
        return {
            debug: (message, meta) => this.debug(message, meta, { action: actionName }),
            info: (message, meta) => this.info(message, meta, { action: actionName }),
            warn: (message, meta) => this.warn(message, meta, { action: actionName }),
            error: (message, meta) => this.error(message, meta, { action: actionName }),
            fatal: (message, meta) => this.fatal(message, meta, { action: actionName })
        };
    }
    // Helper methods
    getConsoleColor(level) {
        const colors = {
            [LogLevel.DEBUG]: 'color: gray',
            [LogLevel.INFO]: 'color: blue',
            [LogLevel.WARN]: 'color: orange',
            [LogLevel.ERROR]: 'color: red',
            [LogLevel.FATAL]: 'color: darkred; font-weight: bold'
        };
        return colors[level];
    }
    getCorrelationId() {
        if (typeof window === 'undefined')
            return 'server-side';
        return sessionStorage.getItem('correlationId') || 'no-correlation-id';
    }
    getUserId() {
        if (typeof window === 'undefined')
            return 'server-side';
        return sessionStorage.getItem('userId') || 'anonymous';
    }
    getSessionId() {
        if (typeof window === 'undefined')
            return 'server-side';
        return sessionStorage.getItem('sessionId') || 'no-session';
    }
    sendToMonitoring(context) {
        // Future: Send to Azure Application Insights
        // For now, store in IndexedDB for retrieval
        if (typeof window !== 'undefined') {
            this.storeInIndexedDB(context);
        }
    }
    storeInBuffer(context) {
        // Store last 100 logs in memory for debugging
        if (typeof window === 'undefined')
            return;
        if (!window.__logBuffer)
            window.__logBuffer = [];
        window.__logBuffer.push(context);
        if (window.__logBuffer.length > 100) {
            window.__logBuffer.shift();
        }
    }
    async storeInIndexedDB(context) {
        try {
            // Simple IndexedDB storage for production logs
            const dbName = 'CCHLogs';
            const storeName = 'logs';
            const request = indexedDB.open(dbName, 1);
            request.onupgradeneeded = (event) => {
                const db = event.target.result;
                if (!db.objectStoreNames.contains(storeName)) {
                    db.createObjectStore(storeName, { keyPath: 'timestamp' });
                }
            };
            request.onsuccess = (event) => {
                const db = event.target.result;
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                store.add(context);
            };
        }
        catch (error) {
            // Fallback to console if IndexedDB fails
            console.error('Failed to store log in IndexedDB:', error);
        }
    }
    // Utility methods for debugging
    getLogBuffer() {
        if (typeof window === 'undefined')
            return [];
        return window.__logBuffer || [];
    }
    clearLogBuffer() {
        if (typeof window === 'undefined')
            return;
        window.__logBuffer = [];
    }
    // Export logs for debugging
    exportLogs() {
        const logs = this.getLogBuffer();
        return JSON.stringify(logs, null, 2);
    }
}
exports.logger = new Logger();
// Add to window for debugging in production
if (typeof window !== 'undefined') {
    window.__logger = exports.logger;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxzYXJhaFxcUmVwb3NcXENDSCBBeGNlc3MgSW50ZWxsaWdlbmNlIFZpYmVkXFxzcmNcXGNvcmVcXGxvZ2dpbmdcXGxvZ2dlci50cyIsIm1hcHBpbmdzIjoiOzs7QUFBQSxJQUFZLFFBTVg7QUFORCxXQUFZLFFBQVE7SUFDbEIseUNBQVMsQ0FBQTtJQUNULHVDQUFRLENBQUE7SUFDUix1Q0FBUSxDQUFBO0lBQ1IseUNBQVMsQ0FBQTtJQUNULHlDQUFTLENBQUE7QUFDWCxDQUFDLEVBTlcsUUFBUSx3QkFBUixRQUFRLFFBTW5CO0FBc0JELE1BQU0sTUFBTTtJQUFaO1FBQ1U7Ozs7bUJBQWdCLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxLQUFLLGFBQWE7V0FBQztRQUN2RDs7OzttQkFBVyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSTtXQUFDO0lBeUt6RSxDQUFDO0lBdktTLFNBQVMsQ0FBQyxPQUFtQjtRQUNuQyxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDakMsQ0FBQztJQUVPLFNBQVMsQ0FBQyxLQUFlO1FBQy9CLE9BQU8sS0FBSyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUM7SUFDaEMsQ0FBQztJQUVPLEdBQUcsQ0FBQyxLQUFlLEVBQUUsT0FBZSxFQUFFLElBQVUsRUFBRSxPQUE2QjtRQUNyRixJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUM7WUFBRSxPQUFPO1FBRW5DLE1BQU0sVUFBVSxHQUFlO1lBQzdCLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRTtZQUNuQyxLQUFLO1lBQ0wsT0FBTztZQUNQLElBQUk7WUFDSixhQUFhLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixFQUFFO1lBQ3RDLE1BQU0sRUFBRSxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQ3hCLFNBQVMsRUFBRSxJQUFJLENBQUMsWUFB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QUFPLE1BQU0sS0FBSyxXQUFXO1lBQUUsT0FBTyxFQUFFLENBQUM7UUFDN0MsT0FBTyxNQUFNLENBQUMsV0FBVyxJQUFJLEVBQUUsQ0FBQztJQUNsQyxDQUFDO0lBRUQsY0FBYztRQUNaLElBQUksT0FBTyxNQUFNLEtBQUssV0FBVztZQUFFLE9BQU87UUFDMUMsTUFBTSxDQUFDLFdBQVcsR0FBRyxFQUFFLENBQUM7SUFDMUIsQ0FBQztJQUVELDRCQUE0QjtJQUM1QixVQUFVO1FBQ1IsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ2pDLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7Q0FDRjtBQUVZLFFBQUEsTUFBTSxHQUFHLElBQUksTUFBTSxFQUFFLENBQUM7QUFFbkMsNENBQTRDO0FBQzVDLElBQUksT0FBTyxNQUFNLEtBQUssV0FBVyxFQUFFLENBQUM7SUFDbEMsTUFBTSxDQUFDLFFBQVEsR0FBRyxjQUFNLENBQUM7QUFDM0IsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXHNhcmFoXFxSZXBvc1xcQ0NIIEF4Y2VzcyBJbnRlbGxpZ2VuY2UgVmliZWRcXHNyY1xcY29yZVxcbG9nZ2luZ1xcbG9nZ2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBlbnVtIExvZ0xldmVsIHtcclxuICBERUJVRyA9IDAsXHJcbiAgSU5GTyA9IDEsXHJcbiAgV0FSTiA9IDIsXHJcbiAgRVJST1IgPSAzLFxyXG4gIEZBVEFMID0gNFxyXG59XHJcblxyXG5pbnRlcmZhY2UgTG9nQ29udGV4dCB7XHJcbiAgdGltZXN0YW1wOiBzdHJpbmc7XHJcbiAgbGV2ZWw6IExvZ0xldmVsO1xyXG4gIG1lc3NhZ2U6IHN0cmluZztcclxuICBtZXRhPzogYW55O1xyXG4gIGNvcnJlbGF0aW9uSWQ/OiBzdHJpbmc7XHJcbiAgdXNlcklkPzogc3RyaW5nO1xyXG4gIHNlc3Npb25JZD86IHN0cmluZztcclxuICBjb21wb25lbnQ/OiBzdHJpbmc7XHJcbiAgYWN0aW9uPzogc3RyaW5nO1xyXG59XHJcblxyXG4vLyBFeHRlbmQgV2luZG93IGludGVyZmFjZSBmb3IgZGVidWdnaW5nXHJcbmRlY2xhcmUgZ2xvYmFsIHtcclxuICBpbnRlcmZhY2UgV2luZG93IHtcclxuICAgIF9fbG9nQnVmZmVyPzogTG9nQ29udGV4dFtdO1xyXG4gICAgX19sb2dnZXI/OiBMb2dnZXI7XHJcbiAgfVxyXG59XHJcblxyXG5jbGFzcyBMb2dnZXIge1xyXG4gIHByaXZhdGUgaXNEZXZlbG9wbWVudCA9IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnO1xyXG4gIHByaXZhdGUgbG9nTGV2ZWwgPSB0aGlzLmlzRGV2ZWxvcG1lbnQgPyBMb2dMZXZlbC5ERUJVRyA6IExvZ0xldmVsLklORk87XHJcblxyXG4gIHByaXZhdGUgZm9ybWF0TG9nKGNvbnRleHQ6IExvZ0NvbnRleHQpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGNvbnRleHQpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzaG91bGRMb2cobGV2ZWw6IExvZ0xldmVsKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gbGV2ZWwgPj0gdGhpcy5sb2dMZXZlbDtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgbG9nKGxldmVsOiBMb2dMZXZlbCwgbWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55LCBjb250ZXh0PzogUGFydGlhbDxMb2dDb250ZXh0Pikge1xyXG4gICAgaWYgKCF0aGlzLnNob3VsZExvZyhsZXZlbCkpIHJldHVybjtcclxuXHJcbiAgICBjb25zdCBsb2dDb250ZXh0OiBMb2dDb250ZXh0ID0ge1xyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgbGV2ZWwsXHJcbiAgICAgIG1lc3NhZ2UsXHJcbiAgICAgIG1ldGEsXHJcbiAgICAgIGNvcnJlbGF0aW9uSWQ6IHRoaXMuZ2V0Q29ycmVsYXRpb25JZCgpLFxyXG4gICAgICB1c2VySWQ6IHRoaXMuZ2V0VXNlcklkKCksXHJcbiAgICAgIHNlc3Npb25JZDogdGhpcy5nZXRTZXNzaW9uSWQoKSxcclxuICAgICAgLi4uY29udGV4dFxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBJbiBkZXZlbG9wbWVudCwgdXNlIGNvbnNvbGUgZm9yIHJlYWRhYmlsaXR5XHJcbiAgICBpZiAodGhpcy5pc0RldmVsb3BtZW50KSB7XHJcbiAgICAgIGNvbnN0IGNvbG9yID0gdGhpcy5nZXRDb25zb2xlQ29sb3IobGV2ZWwpO1xyXG4gICAgICBjb25zdCBsZXZlbE5hbWUgPSBMb2dMZXZlbFtsZXZlbF07XHJcbiAgICAgIGNvbnNvbGUubG9nKGAlY1ske2xldmVsTmFtZX1dYCwgY29sb3IsIG1lc3NhZ2UsIG1ldGEgfHwgJycpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gSW4gcHJvZHVjdGlvbiwgc2VuZCB0byBtb25pdG9yaW5nIHNlcnZpY2VcclxuICAgICAgdGhpcy5zZW5kVG9Nb25pdG9yaW5nKGxvZ0NvbnRleHQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFN0b3JlIGluIGxvY2FsIGJ1ZmZlciBmb3IgZGVidWdnaW5nXHJcbiAgICB0aGlzLnN0b3JlSW5CdWZmZXIobG9nQ29udGV4dCk7XHJcbiAgfVxyXG5cclxuICBkZWJ1ZyhtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBhbnksIGNvbnRleHQ/OiBQYXJ0aWFsPExvZ0NvbnRleHQ+KSB7XHJcbiAgICB0aGlzLmxvZyhMb2dMZXZlbC5ERUJVRywgbWVzc2FnZSwgbWV0YSwgY29udGV4dCk7XHJcbiAgfVxyXG5cclxuICBpbmZvKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IGFueSwgY29udGV4dD86IFBhcnRpYWw8TG9nQ29udGV4dD4pIHtcclxuICAgIHRoaXMubG9nKExvZ0xldmVsLklORk8sIG1lc3NhZ2UsIG1ldGEsIGNvbnRleHQpO1xyXG4gIH1cclxuXHJcbiAgd2FybihtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBhbnksIGNvbnRleHQ/OiBQYXJ0aWFsPExvZ0NvbnRleHQ+KSB7XHJcbiAgICB0aGlzLmxvZyhMb2dMZXZlbC5XQVJOLCBtZXNzYWdlLCBtZXRhLCBjb250ZXh0KTtcclxuICB9XHJcblxyXG4gIGVycm9yKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IGFueSwgY29udGV4dD86IFBhcnRpYWw8TG9nQ29udGV4dD4pIHtcclxuICAgIHRoaXMubG9nKExvZ0xldmVsLkVSUk9SLCBtZXNzYWdlLCBtZXRhLCBjb250ZXh0KTtcclxuICB9XHJcblxyXG4gIGZhdGFsKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IGFueSwgY29udGV4dD86IFBhcnRpYWw8TG9nQ29udGV4dD4pIHtcclxuICAgIHRoaXMubG9nKExvZ0xldmVsLkZBVEFMLCBtZXNzYWdlLCBtZXRhLCBjb250ZXh0KTtcclxuICB9XHJcblxyXG4gIC8vIENvbXBvbmVudC1zcGVjaWZpYyBsb2dnaW5nIG1ldGhvZHNcclxuICBjb21wb25lbnQoY29tcG9uZW50TmFtZTogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBkZWJ1ZzogKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IGFueSkgPT4gdGhpcy5kZWJ1ZyhtZXNzYWdlLCBtZXRhLCB7IGNvbXBvbmVudDogY29tcG9uZW50TmFtZSB9KSxcclxuICAgICAgaW5mbzogKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IGFueSkgPT4gdGhpcy5pbmZvKG1lc3NhZ2UsIG1ldGEsIHsgY29tcG9uZW50OiBjb21wb25lbnROYW1lIH0pLFxyXG4gICAgICB3YXJuOiAobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55KSA9PiB0aGlzLndhcm4obWVzc2FnZSwgbWV0YSwgeyBjb21wb25lbnQ6IGNvbXBvbmVudE5hbWUgfSksXHJcbiAgICAgIGVycm9yOiAobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55KSA9PiB0aGlzLmVycm9yKG1lc3NhZ2UsIG1ldGEsIHsgY29tcG9uZW50OiBjb21wb25lbnROYW1lIH0pLFxyXG4gICAgICBmYXRhbDogKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IGFueSkgPT4gdGhpcy5mYXRhbChtZXNzYWdlLCBtZXRhLCB7IGNvbXBvbmVudDogY29tcG9uZW50TmFtZSB9KVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8vIEFjdGlvbi1zcGVjaWZpYyBsb2dnaW5nIG1ldGhvZHNcclxuICBhY3Rpb24oYWN0aW9uTmFtZTogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBkZWJ1ZzogKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IGFueSkgPT4gdGhpcy5kZWJ1ZyhtZXNzYWdlLCBtZXRhLCB7IGFjdGlvbjogYWN0aW9uTmFtZSB9KSxcclxuICAgICAgaW5mbzogKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IGFueSkgPT4gdGhpcy5pbmZvKG1lc3NhZ2UsIG1ldGEsIHsgYWN0aW9uOiBhY3Rpb25OYW1lIH0pLFxyXG4gICAgICB3YXJuOiAobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55KSA9PiB0aGlzLndhcm4obWVzc2FnZSwgbWV0YSwgeyBhY3Rpb246IGFjdGlvbk5hbWUgfSksXHJcbiAgICAgIGVycm9yOiAobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogYW55KSA9PiB0aGlzLmVycm9yKG1lc3NhZ2UsIG1ldGEsIHsgYWN0aW9uOiBhY3Rpb25OYW1lIH0pLFxyXG4gICAgICBmYXRhbDogKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IGFueSkgPT4gdGhpcy5mYXRhbChtZXNzYWdlLCBtZXRhLCB7IGFjdGlvbjogYWN0aW9uTmFtZSB9KVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8vIEhlbHBlciBtZXRob2RzXHJcbiAgcHJpdmF0ZSBnZXRDb25zb2xlQ29sb3IobGV2ZWw6IExvZ0xldmVsKTogc3RyaW5nIHtcclxuICAgIGNvbnN0IGNvbG9ycyA9IHtcclxuICAgICAgW0xvZ0xldmVsLkRFQlVHXTogJ2NvbG9yOiBncmF5JyxcclxuICAgICAgW0xvZ0xldmVsLklORk9dOiAnY29sb3I6IGJsdWUnLFxyXG4gICAgICBbTG9nTGV2ZWwuV0FSTl06ICdjb2xvcjogb3JhbmdlJyxcclxuICAgICAgW0xvZ0xldmVsLkVSUk9SXTogJ2NvbG9yOiByZWQnLFxyXG4gICAgICBbTG9nTGV2ZWwuRkFUQUxdOiAnY29sb3I6IGRhcmtyZWQ7IGZvbnQtd2VpZ2h0OiBib2xkJ1xyXG4gICAgfTtcclxuICAgIHJldHVybiBjb2xvcnNbbGV2ZWxdO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRDb3JyZWxhdGlvbklkKCk6IHN0cmluZyB7XHJcbiAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybiAnc2VydmVyLXNpZGUnO1xyXG4gICAgcmV0dXJuIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2NvcnJlbGF0aW9uSWQnKSB8fCAnbm8tY29ycmVsYXRpb24taWQnO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRVc2VySWQoKTogc3RyaW5nIHtcclxuICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJykgcmV0dXJuICdzZXJ2ZXItc2lkZSc7XHJcbiAgICByZXR1cm4gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlcklkJykgfHwgJ2Fub255bW91cyc7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldFNlc3Npb25JZCgpOiBzdHJpbmcge1xyXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnKSByZXR1cm4gJ3NlcnZlci1zaWRlJztcclxuICAgIHJldHVybiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdzZXNzaW9uSWQnKSB8fCAnbm8tc2Vzc2lvbic7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNlbmRUb01vbml0b3JpbmcoY29udGV4dDogTG9nQ29udGV4dCkge1xyXG4gICAgLy8gRnV0dXJlOiBTZW5kIHRvIEF6dXJlIEFwcGxpY2F0aW9uIEluc2lnaHRzXHJcbiAgICAvLyBGb3Igbm93LCBzdG9yZSBpbiBJbmRleGVkREIgZm9yIHJldHJpZXZhbFxyXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHRoaXMuc3RvcmVJbkluZGV4ZWREQihjb250ZXh0KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgc3RvcmVJbkJ1ZmZlcihjb250ZXh0OiBMb2dDb250ZXh0KSB7XHJcbiAgICAvLyBTdG9yZSBsYXN0IDEwMCBsb2dzIGluIG1lbW9yeSBmb3IgZGVidWdnaW5nXHJcbiAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybjtcclxuICAgIFxyXG4gICAgaWYgKCF3aW5kb3cuX19sb2dCdWZmZXIpIHdpbmRvdy5fX2xvZ0J1ZmZlciA9IFtdO1xyXG4gICAgd2luZG93Ll9fbG9nQnVmZmVyLnB1c2goY29udGV4dCk7XHJcbiAgICBpZiAod2luZG93Ll9fbG9nQnVmZmVyLmxlbmd0aCA+IDEwMCkge1xyXG4gICAgICB3aW5kb3cuX19sb2dCdWZmZXIuc2hpZnQoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgc3RvcmVJbkluZGV4ZWREQihjb250ZXh0OiBMb2dDb250ZXh0KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBTaW1wbGUgSW5kZXhlZERCIHN0b3JhZ2UgZm9yIHByb2R1Y3Rpb24gbG9nc1xyXG4gICAgICBjb25zdCBkYk5hbWUgPSAnQ0NITG9ncyc7XHJcbiAgICAgIGNvbnN0IHN0b3JlTmFtZSA9ICdsb2dzJztcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihkYk5hbWUsIDEpO1xyXG4gICAgICBcclxuICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSAoZXZlbnQpID0+IHtcclxuICAgICAgICBjb25zdCBkYiA9IChldmVudC50YXJnZXQgYXMgSURCT3BlbkRCUmVxdWVzdCkucmVzdWx0O1xyXG4gICAgICAgIGlmICghZGIub2JqZWN0U3RvcmVOYW1lcy5jb250YWlucyhzdG9yZU5hbWUpKSB7XHJcbiAgICAgICAgICBkYi5jcmVhdGVPYmplY3RTdG9yZShzdG9yZU5hbWUsIHsga2V5UGF0aDogJ3RpbWVzdGFtcCcgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSAoZXZlbnQpID0+IHtcclxuICAgICAgICBjb25zdCBkYiA9IChldmVudC50YXJnZXQgYXMgSURCT3BlbkRCUmVxdWVzdCkucmVzdWx0O1xyXG4gICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gZGIudHJhbnNhY3Rpb24oW3N0b3JlTmFtZV0sICdyZWFkd3JpdGUnKTtcclxuICAgICAgICBjb25zdCBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XHJcbiAgICAgICAgc3RvcmUuYWRkKGNvbnRleHQpO1xyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgLy8gRmFsbGJhY2sgdG8gY29uc29sZSBpZiBJbmRleGVkREIgZmFpbHNcclxuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHN0b3JlIGxvZyBpbiBJbmRleGVkREI6JywgZXJyb3IpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gVXRpbGl0eSBtZXRob2RzIGZvciBkZWJ1Z2dpbmdcclxuICBnZXRMb2dCdWZmZXIoKTogTG9nQ29udGV4dFtdIHtcclxuICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJykgcmV0dXJuIFtdO1xyXG4gICAgcmV0dXJuIHdpbmRvdy5fX2xvZ0J1ZmZlciB8fCBbXTtcclxuICB9XHJcblxyXG4gIGNsZWFyTG9nQnVmZmVyKCk6IHZvaWQge1xyXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnKSByZXR1cm47XHJcbiAgICB3aW5kb3cuX19sb2dCdWZmZXIgPSBbXTtcclxuICB9XHJcblxyXG4gIC8vIEV4cG9ydCBsb2dzIGZvciBkZWJ1Z2dpbmdcclxuICBleHBvcnRMb2dzKCk6IHN0cmluZyB7XHJcbiAgICBjb25zdCBsb2dzID0gdGhpcy5nZXRMb2dCdWZmZXIoKTtcclxuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShsb2dzLCBudWxsLCAyKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKCk7XHJcblxyXG4vLyBBZGQgdG8gd2luZG93IGZvciBkZWJ1Z2dpbmcgaW4gcHJvZHVjdGlvblxyXG5pZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICB3aW5kb3cuX19sb2dnZXIgPSBsb2dnZXI7XHJcbn1cclxuIl0sInZlcnNpb24iOjN9