1b7b184228a6f36fa4a57ce9f195cee0
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.logger = exports.LogLevel = void 0;
var LogLevel;
(function (LogLevel) {
    LogLevel[LogLevel["DEBUG"] = 0] = "DEBUG";
    LogLevel[LogLevel["INFO"] = 1] = "INFO";
    LogLevel[LogLevel["WARN"] = 2] = "WARN";
    LogLevel[LogLevel["ERROR"] = 3] = "ERROR";
    LogLevel[LogLevel["FATAL"] = 4] = "FATAL";
})(LogLevel || (exports.LogLevel = LogLevel = {}));
class Logger {
    constructor() {
        Object.defineProperty(this, "isDevelopment", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: process.env.NODE_ENV === 'development'
        });
        Object.defineProperty(this, "isLoggingEnabled", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: true
        }); // Will be set by environment config
        Object.defineProperty(this, "logLevel", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: this.isDevelopment ? LogLevel.DEBUG : LogLevel.INFO
        });
    }
    formatLog(context) {
        return JSON.stringify(context);
    }
    shouldLog(level) {
        return level >= this.logLevel;
    }
    log(level, message, meta, context) {
        if (!this.shouldLog(level) || !this.isLoggingEnabled)
            return;
        const logContext = {
            timestamp: new Date().toISOString(),
            level,
            message,
            meta,
            correlationId: this.getCorrelationId(),
            userId: this.getUserId(),
            sessionId: this.getSessionId(),
            ...context
        };
        // In development, use console for readability
        if (this.isDevelopment) {
            const color = this.getConsoleColor(level);
            const levelName = LogLevel[level];
            console.log(`%c[${levelName}]`, color, message, meta || '');
        }
        else {
            // In production, send to monitoring service
            this.sendToMonitoring(logContext);
        }
        // Store in local buffer for debugging
        this.storeInBuffer(logContext);
    }
    debug(message, meta, context) {
        this.log(LogLevel.DEBUG, message, meta, context);
    }
    info(message, meta, context) {
        this.log(LogLevel.INFO, message, meta, context);
    }
    warn(message, meta, context) {
        this.log(LogLevel.WARN, message, meta, context);
    }
    error(message, meta, context) {
        this.log(LogLevel.ERROR, message, meta, context);
    }
    fatal(message, meta, context) {
        this.log(LogLevel.FATAL, message, meta, context);
    }
    // Component-specific logging methods
    component(componentName) {
        return {
            debug: (message, meta) => this.debug(message, meta, { component: componentName }),
            info: (message, meta) => this.info(message, meta, { component: componentName }),
            warn: (message, meta) => this.warn(message, meta, { component: componentName }),
            error: (message, meta) => this.error(message, meta, { component: componentName }),
            fatal: (message, meta) => this.fatal(message, meta, { component: componentName })
        };
    }
    // Action-specific logging methods
    action(actionName) {
        return {
            debug: (message, meta) => this.debug(message, meta, { action: actionName }),
            info: (message, meta) => this.info(message, meta, { action: actionName }),
            warn: (message, meta) => this.warn(message, meta, { action: actionName }),
            error: (message, meta) => this.error(message, meta, { action: actionName }),
            fatal: (message, meta) => this.fatal(message, meta, { action: actionName })
        };
    }
    // Helper methods
    getConsoleColor(level) {
        const colors = {
            [LogLevel.DEBUG]: 'color: gray',
            [LogLevel.INFO]: 'color: blue',
            [LogLevel.WARN]: 'color: orange',
            [LogLevel.ERROR]: 'color: red',
            [LogLevel.FATAL]: 'color: darkred; font-weight: bold'
        };
        return colors[level];
    }
    getCorrelationId() {
        if (typeof window === 'undefined')
            return 'server-side';
        return sessionStorage.getItem('correlationId') || 'no-correlation-id';
    }
    getUserId() {
        if (typeof window === 'undefined')
            return 'server-side';
        return sessionStorage.getItem('userId') || 'anonymous';
    }
    getSessionId() {
        if (typeof window === 'undefined')
            return 'server-side';
        return sessionStorage.getItem('sessionId') || 'no-session';
    }
    sendToMonitoring(context) {
        // Future: Send to Azure Application Insights
        // For now, store in IndexedDB for retrieval
        if (typeof window !== 'undefined') {
            this.storeInIndexedDB(context);
        }
    }
    storeInBuffer(context) {
        // Store last 100 logs in memory for debugging
        if (typeof window === 'undefined')
            return;
        if (!window.__logBuffer)
            window.__logBuffer = [];
        window.__logBuffer.push(context);
        if (window.__logBuffer.length > 100) {
            window.__logBuffer.shift();
        }
    }
    async storeInIndexedDB(context) {
        try {
            // Simple IndexedDB storage for production logs
            const dbName = 'CCHLogs';
            const storeName = 'logs';
            const request = indexedDB.open(dbName, 1);
            request.onupgradeneeded = (event) => {
                const db = event.target.result;
                if (!db.objectStoreNames.contains(storeName)) {
                    db.createObjectStore(storeName, { keyPath: 'timestamp' });
                }
            };
            request.onsuccess = (event) => {
                const db = event.target.result;
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                store.add(context);
            };
        }
        catch (error) {
            // Fallback to console if IndexedDB fails
            console.error('Failed to store log in IndexedDB:', error);
        }
    }
    // Utility methods for debugging
    getLogBuffer() {
        if (typeof window === 'undefined')
            return [];
        return window.__logBuffer || [];
    }
    clearLogBuffer() {
        if (typeof window === 'undefined')
            return;
        window.__logBuffer = [];
    }
    // Export logs for debugging
    exportLogs() {
        const logs = this.getLogBuffer();
        return JSON.stringify(logs, null, 2);
    }
}
exports.logger = new Logger();
// Add to window for debugging in production
if (typeof window !== 'undefined') {
    window.__logger = exports.logger;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxzYXJhaFxcUmVwb3NcXENDSCBBeGNlc3MgSW50ZWxsaWdlbmNlIFZpYmVkXFxzcmNcXGNvcmVcXGxvZ2dpbmdcXGxvZ2dlci50cyIsIm1hcHBpbmdzIjoiOzs7QUFBQSxJQUFZLFFBTVg7QUFORCxXQUFZLFFBQVE7SUFDbEIseUNBQVMsQ0FBQTtJQUNULHVDQUFRLENBQUE7SUFDUix1Q0FBUSxDQUFBO0lBQ1IseUNBQVMsQ0FBQTtJQUNULHlDQUFTLENBQUE7QUFDWCxDQUFDLEVBTlcsUUFBUSx3QkFBUixRQUFRLFFBTW5CO0FBZ0NELE1BQU0sTUFBTTtJQUFaO1FBQ1U7Ozs7bUJBQWdCLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxLQUFLLGFBQWE7V0FBQztRQUN2RDs7OzttQkFBbUIsSUFBSTtXQUFDLENBQUMsb0NBQW9DO1FBQzdEOzs7O21CQUFXLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJO1dBQUM7SUF5S3pFLENBQUM7SUF2S1MsU0FBUyxDQUFDLE9BQW1CO1FBQ25DLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNqQyxDQUFDO0lBRU8sU0FBUyxDQUFDLEtBQWU7UUFDL0IsT0FBTyxLQUFLLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQztJQUNoQyxDQUFDO0lBRU8sR0FBRyxDQUFDLEtBQWUsRUFBRSxPQUFlLEVBQUUsSUFBa0IsRUFBRSxPQUE2QjtRQUM3RixJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0I7WUFBRSxPQUFPO1FBRTdELE1BQU0sVUFBVSxHQUFlO1lBQzdCLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRTtZQUNuQyxLQUFLO1lBQ0wsT0FBTztZQUNQLElBQUk7WUFDSixhQUFhLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixFQUFF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Q0FBbUMsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUM1RCxDQUFDO0lBQ0gsQ0FBQztJQUVELGdDQUFnQztJQUNoQyxZQUFZO1FBQ1YsSUFBSSxPQUFPLE1BQU0sS0FBSyxXQUFXO1lBQUUsT0FBTyxFQUFFLENBQUM7UUFDN0MsT0FBTyxNQUFNLENBQUMsV0FBVyxJQUFJLEVBQUUsQ0FBQztJQUNsQyxDQUFDO0lBRUQsY0FBYztRQUNaLElBQUksT0FBTyxNQUFNLEtBQUssV0FBVztZQUFFLE9BQU87UUFDMUMsTUFBTSxDQUFDLFdBQVcsR0FBRyxFQUFFLENBQUM7SUFDMUIsQ0FBQztJQUVELDRCQUE0QjtJQUM1QixVQUFVO1FBQ1IsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ2pDLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7Q0FDRjtBQUVZLFFBQUEsTUFBTSxHQUFHLElBQUksTUFBTSxFQUFFLENBQUM7QUFFbkMsNENBQTRDO0FBQzVDLElBQUksT0FBTyxNQUFNLEtBQUssV0FBVyxFQUFFLENBQUM7SUFDbEMsTUFBTSxDQUFDLFFBQVEsR0FBRyxjQUFNLENBQUM7QUFDM0IsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXHNhcmFoXFxSZXBvc1xcQ0NIIEF4Y2VzcyBJbnRlbGxpZ2VuY2UgVmliZWRcXHNyY1xcY29yZVxcbG9nZ2luZ1xcbG9nZ2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBlbnVtIExvZ0xldmVsIHtcclxuICBERUJVRyA9IDAsXHJcbiAgSU5GTyA9IDEsXHJcbiAgV0FSTiA9IDIsXHJcbiAgRVJST1IgPSAzLFxyXG4gIEZBVEFMID0gNFxyXG59XHJcblxyXG4vKipcclxuICogTG9nIG1ldGFkYXRhIGludGVyZmFjZSBmb3Igc3RydWN0dXJlZCBsb2dnaW5nXHJcbiAqL1xyXG5pbnRlcmZhY2UgTG9nTWV0YWRhdGEge1xyXG4gIFtrZXk6IHN0cmluZ106IHN0cmluZyB8IG51bWJlciB8IGJvb2xlYW4gfCBudWxsIHwgdW5kZWZpbmVkIHwgUmVjb3JkPHN0cmluZywgdW5rbm93bj4gfCB1bmtub3duW107XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBMb2cgY29udGV4dCBpbnRlcmZhY2UgZm9yIHN0cnVjdHVyZWQgbG9nZ2luZ1xyXG4gKi9cclxuaW50ZXJmYWNlIExvZ0NvbnRleHQge1xyXG4gIHRpbWVzdGFtcDogc3RyaW5nO1xyXG4gIGxldmVsOiBMb2dMZXZlbDtcclxuICBtZXNzYWdlOiBzdHJpbmc7XHJcbiAgbWV0YT86IExvZ01ldGFkYXRhO1xyXG4gIGNvcnJlbGF0aW9uSWQ/OiBzdHJpbmc7XHJcbiAgdXNlcklkPzogc3RyaW5nO1xyXG4gIHNlc3Npb25JZD86IHN0cmluZztcclxuICBjb21wb25lbnQ/OiBzdHJpbmc7IC8vIEFkZGVkIGZvciBjb21wb25lbnQtc3BlY2lmaWMgbG9nZ2luZ1xyXG4gIGFjdGlvbj86IHN0cmluZzsgICAgLy8gQWRkZWQgZm9yIGFjdGlvbi1zcGVjaWZpYyBsb2dnaW5nXHJcbn1cclxuXHJcbi8vIEV4dGVuZCBXaW5kb3cgaW50ZXJmYWNlIGZvciBkZWJ1Z2dpbmdcclxuZGVjbGFyZSBnbG9iYWwge1xyXG4gIGludGVyZmFjZSBXaW5kb3cge1xyXG4gICAgX19sb2dCdWZmZXI/OiBMb2dDb250ZXh0W107XHJcbiAgICBfX2xvZ2dlcj86IExvZ2dlcjtcclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIExvZ2dlciB7XHJcbiAgcHJpdmF0ZSBpc0RldmVsb3BtZW50ID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCc7XHJcbiAgcHJpdmF0ZSBpc0xvZ2dpbmdFbmFibGVkID0gdHJ1ZTsgLy8gV2lsbCBiZSBzZXQgYnkgZW52aXJvbm1lbnQgY29uZmlnXHJcbiAgcHJpdmF0ZSBsb2dMZXZlbCA9IHRoaXMuaXNEZXZlbG9wbWVudCA/IExvZ0xldmVsLkRFQlVHIDogTG9nTGV2ZWwuSU5GTztcclxuXHJcbiAgcHJpdmF0ZSBmb3JtYXRMb2coY29udGV4dDogTG9nQ29udGV4dCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoY29udGV4dCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNob3VsZExvZyhsZXZlbDogTG9nTGV2ZWwpOiBib29sZWFuIHtcclxuICAgIHJldHVybiBsZXZlbCA+PSB0aGlzLmxvZ0xldmVsO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBsb2cobGV2ZWw6IExvZ0xldmVsLCBtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBMb2dNZXRhZGF0YSwgY29udGV4dD86IFBhcnRpYWw8TG9nQ29udGV4dD4pIHtcclxuICAgIGlmICghdGhpcy5zaG91bGRMb2cobGV2ZWwpIHx8ICF0aGlzLmlzTG9nZ2luZ0VuYWJsZWQpIHJldHVybjtcclxuXHJcbiAgICBjb25zdCBsb2dDb250ZXh0OiBMb2dDb250ZXh0ID0ge1xyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgbGV2ZWwsXHJcbiAgICAgIG1lc3NhZ2UsXHJcbiAgICAgIG1ldGEsXHJcbiAgICAgIGNvcnJlbGF0aW9uSWQ6IHRoaXMuZ2V0Q29ycmVsYXRpb25JZCgpLFxyXG4gICAgICB1c2VySWQ6IHRoaXMuZ2V0VXNlcklkKCksXHJcbiAgICAgIHNlc3Npb25JZDogdGhpcy5nZXRTZXNzaW9uSWQoKSxcclxuICAgICAgLi4uY29udGV4dFxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBJbiBkZXZlbG9wbWVudCwgdXNlIGNvbnNvbGUgZm9yIHJlYWRhYmlsaXR5XHJcbiAgICBpZiAodGhpcy5pc0RldmVsb3BtZW50KSB7XHJcbiAgICAgIGNvbnN0IGNvbG9yID0gdGhpcy5nZXRDb25zb2xlQ29sb3IobGV2ZWwpO1xyXG4gICAgICBjb25zdCBsZXZlbE5hbWUgPSBMb2dMZXZlbFtsZXZlbF07XHJcbiAgICAgIGNvbnNvbGUubG9nKGAlY1ske2xldmVsTmFtZX1dYCwgY29sb3IsIG1lc3NhZ2UsIG1ldGEgfHwgJycpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gSW4gcHJvZHVjdGlvbiwgc2VuZCB0byBtb25pdG9yaW5nIHNlcnZpY2VcclxuICAgICAgdGhpcy5zZW5kVG9Nb25pdG9yaW5nKGxvZ0NvbnRleHQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFN0b3JlIGluIGxvY2FsIGJ1ZmZlciBmb3IgZGVidWdnaW5nXHJcbiAgICB0aGlzLnN0b3JlSW5CdWZmZXIobG9nQ29udGV4dCk7XHJcbiAgfVxyXG5cclxuICBkZWJ1ZyhtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBMb2dNZXRhZGF0YSwgY29udGV4dD86IFBhcnRpYWw8TG9nQ29udGV4dD4pIHtcclxuICAgIHRoaXMubG9nKExvZ0xldmVsLkRFQlVHLCBtZXNzYWdlLCBtZXRhLCBjb250ZXh0KTtcclxuICB9XHJcblxyXG4gIGluZm8obWVzc2FnZTogc3RyaW5nLCBtZXRhPzogTG9nTWV0YWRhdGEsIGNvbnRleHQ/OiBQYXJ0aWFsPExvZ0NvbnRleHQ+KSB7XHJcbiAgICB0aGlzLmxvZyhMb2dMZXZlbC5JTkZPLCBtZXNzYWdlLCBtZXRhLCBjb250ZXh0KTtcclxuICB9XHJcblxyXG4gIHdhcm4obWVzc2FnZTogc3RyaW5nLCBtZXRhPzogTG9nTWV0YWRhdGEsIGNvbnRleHQ/OiBQYXJ0aWFsPExvZ0NvbnRleHQ+KSB7XHJcbiAgICB0aGlzLmxvZyhMb2dMZXZlbC5XQVJOLCBtZXNzYWdlLCBtZXRhLCBjb250ZXh0KTtcclxuICB9XHJcblxyXG4gIGVycm9yKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IExvZ01ldGFkYXRhLCBjb250ZXh0PzogUGFydGlhbDxMb2dDb250ZXh0Pikge1xyXG4gICAgdGhpcy5sb2coTG9nTGV2ZWwuRVJST1IsIG1lc3NhZ2UsIG1ldGEsIGNvbnRleHQpO1xyXG4gIH1cclxuXHJcbiAgZmF0YWwobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogTG9nTWV0YWRhdGEsIGNvbnRleHQ/OiBQYXJ0aWFsPExvZ0NvbnRleHQ+KSB7XHJcbiAgICB0aGlzLmxvZyhMb2dMZXZlbC5GQVRBTCwgbWVzc2FnZSwgbWV0YSwgY29udGV4dCk7XHJcbiAgfVxyXG5cclxuICAvLyBDb21wb25lbnQtc3BlY2lmaWMgbG9nZ2luZyBtZXRob2RzXHJcbiAgY29tcG9uZW50KGNvbXBvbmVudE5hbWU6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgZGVidWc6IChtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBMb2dNZXRhZGF0YSkgPT4gdGhpcy5kZWJ1ZyhtZXNzYWdlLCBtZXRhLCB7IGNvbXBvbmVudDogY29tcG9uZW50TmFtZSB9KSxcclxuICAgICAgaW5mbzogKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IExvZ01ldGFkYXRhKSA9PiB0aGlzLmluZm8obWVzc2FnZSwgbWV0YSwgeyBjb21wb25lbnQ6IGNvbXBvbmVudE5hbWUgfSksXHJcbiAgICAgIHdhcm46IChtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBMb2dNZXRhZGF0YSkgPT4gdGhpcy53YXJuKG1lc3NhZ2UsIG1ldGEsIHsgY29tcG9uZW50OiBjb21wb25lbnROYW1lIH0pLFxyXG4gICAgICBlcnJvcjogKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IExvZ01ldGFkYXRhKSA9PiB0aGlzLmVycm9yKG1lc3NhZ2UsIG1ldGEsIHsgY29tcG9uZW50OiBjb21wb25lbnROYW1lIH0pLFxyXG4gICAgICBmYXRhbDogKG1lc3NhZ2U6IHN0cmluZywgbWV0YT86IExvZ01ldGFkYXRhKSA9PiB0aGlzLmZhdGFsKG1lc3NhZ2UsIG1ldGEsIHsgY29tcG9uZW50OiBjb21wb25lbnROYW1lIH0pXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLy8gQWN0aW9uLXNwZWNpZmljIGxvZ2dpbmcgbWV0aG9kc1xyXG4gIGFjdGlvbihhY3Rpb25OYW1lOiBzdHJpbmcpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGRlYnVnOiAobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogTG9nTWV0YWRhdGEpID0+IHRoaXMuZGVidWcobWVzc2FnZSwgbWV0YSwgeyBhY3Rpb246IGFjdGlvbk5hbWUgfSksXHJcbiAgICAgIGluZm86IChtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBMb2dNZXRhZGF0YSkgPT4gdGhpcy5pbmZvKG1lc3NhZ2UsIG1ldGEsIHsgYWN0aW9uOiBhY3Rpb25OYW1lIH0pLFxyXG4gICAgICB3YXJuOiAobWVzc2FnZTogc3RyaW5nLCBtZXRhPzogTG9nTWV0YWRhdGEpID0+IHRoaXMud2FybihtZXNzYWdlLCBtZXRhLCB7IGFjdGlvbjogYWN0aW9uTmFtZSB9KSxcclxuICAgICAgZXJyb3I6IChtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBMb2dNZXRhZGF0YSkgPT4gdGhpcy5lcnJvcihtZXNzYWdlLCBtZXRhLCB7IGFjdGlvbjogYWN0aW9uTmFtZSB9KSxcclxuICAgICAgZmF0YWw6IChtZXNzYWdlOiBzdHJpbmcsIG1ldGE/OiBMb2dNZXRhZGF0YSkgPT4gdGhpcy5mYXRhbChtZXNzYWdlLCBtZXRhLCB7IGFjdGlvbjogYWN0aW9uTmFtZSB9KVxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8vIEhlbHBlciBtZXRob2RzXHJcbiAgcHJpdmF0ZSBnZXRDb25zb2xlQ29sb3IobGV2ZWw6IExvZ0xldmVsKTogc3RyaW5nIHtcclxuICAgIGNvbnN0IGNvbG9ycyA9IHtcclxuICAgICAgW0xvZ0xldmVsLkRFQlVHXTogJ2NvbG9yOiBncmF5JyxcclxuICAgICAgW0xvZ0xldmVsLklORk9dOiAnY29sb3I6IGJsdWUnLFxyXG4gICAgICBbTG9nTGV2ZWwuV0FSTl06ICdjb2xvcjogb3JhbmdlJyxcclxuICAgICAgW0xvZ0xldmVsLkVSUk9SXTogJ2NvbG9yOiByZWQnLFxyXG4gICAgICBbTG9nTGV2ZWwuRkFUQUxdOiAnY29sb3I6IGRhcmtyZWQ7IGZvbnQtd2VpZ2h0OiBib2xkJ1xyXG4gICAgfTtcclxuICAgIHJldHVybiBjb2xvcnNbbGV2ZWxdO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRDb3JyZWxhdGlvbklkKCk6IHN0cmluZyB7XHJcbiAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybiAnc2VydmVyLXNpZGUnO1xyXG4gICAgcmV0dXJuIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2NvcnJlbGF0aW9uSWQnKSB8fCAnbm8tY29ycmVsYXRpb24taWQnO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRVc2VySWQoKTogc3RyaW5nIHtcclxuICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJykgcmV0dXJuICdzZXJ2ZXItc2lkZSc7XHJcbiAgICByZXR1cm4gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndXNlcklkJykgfHwgJ2Fub255bW91cyc7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldFNlc3Npb25JZCgpOiBzdHJpbmcge1xyXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnKSByZXR1cm4gJ3NlcnZlci1zaWRlJztcclxuICAgIHJldHVybiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdzZXNzaW9uSWQnKSB8fCAnbm8tc2Vzc2lvbic7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNlbmRUb01vbml0b3JpbmcoY29udGV4dDogTG9nQ29udGV4dCkge1xyXG4gICAgLy8gRnV0dXJlOiBTZW5kIHRvIEF6dXJlIEFwcGxpY2F0aW9uIEluc2lnaHRzXHJcbiAgICAvLyBGb3Igbm93LCBzdG9yZSBpbiBJbmRleGVkREIgZm9yIHJldHJpZXZhbFxyXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHRoaXMuc3RvcmVJbkluZGV4ZWREQihjb250ZXh0KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgc3RvcmVJbkJ1ZmZlcihjb250ZXh0OiBMb2dDb250ZXh0KSB7XHJcbiAgICAvLyBTdG9yZSBsYXN0IDEwMCBsb2dzIGluIG1lbW9yeSBmb3IgZGVidWdnaW5nXHJcbiAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybjtcclxuXHJcbiAgICBpZiAoIXdpbmRvdy5fX2xvZ0J1ZmZlcikgd2luZG93Ll9fbG9nQnVmZmVyID0gW107XHJcbiAgICB3aW5kb3cuX19sb2dCdWZmZXIucHVzaChjb250ZXh0KTtcclxuICAgIGlmICh3aW5kb3cuX19sb2dCdWZmZXIubGVuZ3RoID4gMTAwKSB7XHJcbiAgICAgIHdpbmRvdy5fX2xvZ0J1ZmZlci5zaGlmdCgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBzdG9yZUluSW5kZXhlZERCKGNvbnRleHQ6IExvZ0NvbnRleHQpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIFNpbXBsZSBJbmRleGVkREIgc3RvcmFnZSBmb3IgcHJvZHVjdGlvbiBsb2dzXHJcbiAgICAgIGNvbnN0IGRiTmFtZSA9ICdDQ0hMb2dzJztcclxuICAgICAgY29uc3Qgc3RvcmVOYW1lID0gJ2xvZ3MnO1xyXG5cclxuICAgICAgY29uc3QgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKGRiTmFtZSwgMSk7XHJcblxyXG4gICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IChldmVudCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGRiID0gKGV2ZW50LnRhcmdldCBhcyBJREJPcGVuREJSZXF1ZXN0KS5yZXN1bHQ7XHJcbiAgICAgICAgaWYgKCFkYi5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKHN0b3JlTmFtZSkpIHtcclxuICAgICAgICAgIGRiLmNyZWF0ZU9iamVjdFN0b3JlKHN0b3JlTmFtZSwgeyBrZXlQYXRoOiAndGltZXN0YW1wJyB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IChldmVudCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGRiID0gKGV2ZW50LnRhcmdldCBhcyBJREJPcGVuREJSZXF1ZXN0KS5yZXN1bHQ7XHJcbiAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSBkYi50cmFuc2FjdGlvbihbc3RvcmVOYW1lXSwgJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgIGNvbnN0IHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcclxuICAgICAgICBzdG9yZS5hZGQoY29udGV4dCk7XHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAvLyBGYWxsYmFjayB0byBjb25zb2xlIGlmIEluZGV4ZWREQiBmYWlsc1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gc3RvcmUgbG9nIGluIEluZGV4ZWREQjonLCBlcnJvcik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBVdGlsaXR5IG1ldGhvZHMgZm9yIGRlYnVnZ2luZ1xyXG4gIGdldExvZ0J1ZmZlcigpOiBMb2dDb250ZXh0W10ge1xyXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnKSByZXR1cm4gW107XHJcbiAgICByZXR1cm4gd2luZG93Ll9fbG9nQnVmZmVyIHx8IFtdO1xyXG4gIH1cclxuXHJcbiAgY2xlYXJMb2dCdWZmZXIoKTogdm9pZCB7XHJcbiAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybjtcclxuICAgIHdpbmRvdy5fX2xvZ0J1ZmZlciA9IFtdO1xyXG4gIH1cclxuXHJcbiAgLy8gRXhwb3J0IGxvZ3MgZm9yIGRlYnVnZ2luZ1xyXG4gIGV4cG9ydExvZ3MoKTogc3RyaW5nIHtcclxuICAgIGNvbnN0IGxvZ3MgPSB0aGlzLmdldExvZ0J1ZmZlcigpO1xyXG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGxvZ3MsIG51bGwsIDIpO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoKTtcclxuXHJcbi8vIEFkZCB0byB3aW5kb3cgZm9yIGRlYnVnZ2luZyBpbiBwcm9kdWN0aW9uXHJcbmlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xyXG4gIHdpbmRvdy5fX2xvZ2dlciA9IGxvZ2dlcjtcclxufVxyXG4iXSwidmVyc2lvbiI6M30=