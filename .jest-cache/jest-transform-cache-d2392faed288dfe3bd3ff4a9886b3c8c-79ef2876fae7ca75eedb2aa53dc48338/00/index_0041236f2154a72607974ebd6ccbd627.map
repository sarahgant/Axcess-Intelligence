{"version":3,"names":["buttons","require","device","mouse","pointer","_define_property","obj","key","value","Object","defineProperty","enumerable","configurable","writable","PointerHost","isKeyPressed","keyDef","devices","get","pointerType","isPressed","press","instance","position","addPressed","down","pointerName","getPointerName","pointers","new","init","button","isPrevented","move","pointermove","mousemove","undefined","leave","enter","release","removePressed","up","countPressed","isMultitouch","name","getPreviousPosition","has","resetClickCount","getMouseTarget","_this_mouse_position_target","target","config","document","body","setMousePosition","constructor","system","k","_this_registry","_k","_","registry","Device","isPrimary","values","some","p","isCancelled","forEach","Pointer","pointerId","nextId","Error","Buttons","Mouse","exports"],"sources":["index.js"],"sourcesContent":["'use strict';\n\nvar buttons = require('./buttons.js');\nvar device = require('./device.js');\nvar mouse = require('./mouse.js');\nvar pointer = require('./pointer.js');\n\nfunction _define_property(obj, key, value) {\n    if (key in obj) {\n        Object.defineProperty(obj, key, {\n            value: value,\n            enumerable: true,\n            configurable: true,\n            writable: true\n        });\n    } else {\n        obj[key] = value;\n    }\n    return obj;\n}\nclass PointerHost {\n    isKeyPressed(keyDef) {\n        return this.devices.get(keyDef.pointerType).isPressed(keyDef);\n    }\n    async press(instance, keyDef, position) {\n        this.devices.get(keyDef.pointerType).addPressed(keyDef);\n        this.buttons.down(keyDef);\n        const pointerName = this.getPointerName(keyDef);\n        const pointer = keyDef.pointerType === 'touch' ? this.pointers.new(pointerName, keyDef.pointerType, this.buttons) : this.pointers.get(pointerName);\n        // TODO: deprecate the following implicit setting of position\n        pointer.position = position;\n        if (pointer.pointerType !== 'touch') {\n            this.mouse.position = position;\n        }\n        if (pointer.pointerType === 'touch') {\n            pointer.init(instance);\n        }\n        pointer.down(instance, keyDef.button);\n        if (pointer.pointerType !== 'touch') {\n            this.mouse.down(instance, keyDef, pointer.isPrevented);\n        }\n    }\n    async move(instance, pointerName, position) {\n        const pointer = this.pointers.get(pointerName);\n        // In (some?) browsers this order of events can be observed.\n        // This interweaving of events is probably unnecessary.\n        // While the order of mouse (or pointer) events is defined per spec,\n        // the order in which they interweave/follow on a user interaction depends on the implementation.\n        const pointermove = pointer.move(instance, position);\n        const mousemove = pointer.pointerType === 'touch' ? undefined : this.mouse.move(instance, position, pointer.isPrevented);\n        pointermove === null || pointermove === undefined ? undefined : pointermove.leave();\n        mousemove === null || mousemove === undefined ? undefined : mousemove.leave();\n        pointermove === null || pointermove === undefined ? undefined : pointermove.enter();\n        mousemove === null || mousemove === undefined ? undefined : mousemove.enter();\n        pointermove === null || pointermove === undefined ? undefined : pointermove.move();\n        mousemove === null || mousemove === undefined ? undefined : mousemove.move();\n    }\n    async release(instance, keyDef, position) {\n        const device = this.devices.get(keyDef.pointerType);\n        device.removePressed(keyDef);\n        this.buttons.up(keyDef);\n        const pointer = this.pointers.get(this.getPointerName(keyDef));\n        const isPrevented = pointer.isPrevented;\n        // TODO: deprecate the following implicit setting of position\n        pointer.position = position;\n        if (pointer.pointerType !== 'touch') {\n            this.mouse.position = position;\n        }\n        if (device.countPressed === 0) {\n            pointer.up(instance, keyDef.button);\n        }\n        if (pointer.pointerType === 'touch') {\n            pointer.release(instance);\n        }\n        if (pointer.pointerType === 'touch' && !pointer.isMultitouch) {\n            const mousemove = this.mouse.move(instance, position, isPrevented);\n            mousemove === null || mousemove === undefined ? undefined : mousemove.leave();\n            mousemove === null || mousemove === undefined ? undefined : mousemove.enter();\n            mousemove === null || mousemove === undefined ? undefined : mousemove.move();\n            this.mouse.down(instance, keyDef, isPrevented);\n        }\n        if (!pointer.isMultitouch) {\n            const mousemove = this.mouse.move(instance, position, isPrevented);\n            mousemove === null || mousemove === undefined ? undefined : mousemove.leave();\n            mousemove === null || mousemove === undefined ? undefined : mousemove.enter();\n            mousemove === null || mousemove === undefined ? undefined : mousemove.move();\n            this.mouse.up(instance, keyDef, isPrevented);\n        }\n    }\n    getPointerName(keyDef) {\n        return keyDef.pointerType === 'touch' ? keyDef.name : keyDef.pointerType;\n    }\n    getPreviousPosition(pointerName) {\n        return this.pointers.has(pointerName) ? this.pointers.get(pointerName).position : undefined;\n    }\n    resetClickCount() {\n        this.mouse.resetClickCount();\n    }\n    getMouseTarget(instance) {\n        var _this_mouse_position_target;\n        return (_this_mouse_position_target = this.mouse.position.target) !== null && _this_mouse_position_target !== undefined ? _this_mouse_position_target : instance.config.document.body;\n    }\n    setMousePosition(position) {\n        this.mouse.position = position;\n        this.pointers.get('mouse').position = position;\n    }\n    constructor(system){\n        _define_property(this, \"system\", undefined);\n        _define_property(this, \"mouse\", undefined);\n        _define_property(this, \"buttons\", undefined);\n        _define_property(this, \"devices\", new class {\n            get(k) {\n                var _this_registry, _k;\n                var _;\n                return (_ = (_this_registry = this.registry)[_k = k]) !== null && _ !== undefined ? _ : _this_registry[_k] = new device.Device();\n            }\n            constructor(){\n                _define_property(this, \"registry\", {});\n            }\n        }());\n        _define_property(this, \"pointers\", new class {\n            new(pointerName, pointerType, buttons) {\n                const isPrimary = pointerType !== 'touch' || !Object.values(this.registry).some((p)=>p.pointerType === 'touch' && !p.isCancelled);\n                if (!isPrimary) {\n                    Object.values(this.registry).forEach((p)=>{\n                        if (p.pointerType === pointerType && !p.isCancelled) {\n                            p.isMultitouch = true;\n                        }\n                    });\n                }\n                this.registry[pointerName] = new pointer.Pointer({\n                    pointerId: this.nextId++,\n                    pointerType,\n                    isPrimary\n                }, buttons);\n                return this.registry[pointerName];\n            }\n            get(pointerName) {\n                if (!this.has(pointerName)) {\n                    throw new Error(`Trying to access pointer \"${pointerName}\" which does not exist.`);\n                }\n                return this.registry[pointerName];\n            }\n            has(pointerName) {\n                return pointerName in this.registry;\n            }\n            constructor(){\n                _define_property(this, \"registry\", {});\n                _define_property(this, \"nextId\", 1);\n            }\n        }());\n        this.system = system;\n        this.buttons = new buttons.Buttons();\n        this.mouse = new mouse.Mouse();\n        this.pointers.new('mouse', 'mouse', this.buttons);\n    }\n}\n\nexports.PointerHost = PointerHost;\n"],"mappings":"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","ignoreList":[]}