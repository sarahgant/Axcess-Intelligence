a346ffc7e7a75d882e43038b8a792445
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.buildQueries = buildQueries;
exports.getElementError = getElementError;
exports.getMultipleElementsFoundError = getMultipleElementsFoundError;
exports.makeFindQuery = makeFindQuery;
exports.makeGetAllQuery = makeGetAllQuery;
exports.makeSingleQuery = makeSingleQuery;
exports.queryAllByAttribute = queryAllByAttribute;
exports.queryByAttribute = queryByAttribute;
exports.wrapSingleQueryWithSuggestion = exports.wrapAllByQueryWithSuggestion = void 0;
var _suggestions = require("./suggestions");
var _matches = require("./matches");
var _waitFor = require("./wait-for");
var _config = require("./config");
function getElementError(message, container) {
  return (0, _config.getConfig)().getElementError(message, container);
}
function getMultipleElementsFoundError(message, container) {
  return getElementError(`${message}\n\n(If this is intentional, then use the \`*AllBy*\` variant of the query (like \`queryAllByText\`, \`getAllByText\`, or \`findAllByText\`)).`, container);
}
function queryAllByAttribute(attribute, container, text, {
  exact = true,
  collapseWhitespace,
  trim,
  normalizer
} = {}) {
  const matcher = exact ? _matches.matches : _matches.fuzzyMatches;
  const matchNormalizer = (0, _matches.makeNormalizer)({
    collapseWhitespace,
    trim,
    normalizer
  });
  return Array.from(container.querySelectorAll(`[${attribute}]`)).filter(node => matcher(node.getAttribute(attribute), node, text, matchNormalizer));
}
function queryByAttribute(attribute, container, text, options) {
  const els = queryAllByAttribute(attribute, container, text, options);
  if (els.length > 1) {
    throw getMultipleElementsFoundError(`Found multiple elements by [${attribute}=${text}]`, container);
  }
  return els[0] || null;
}

// this accepts a query function and returns a function which throws an error
// if more than one elements is returned, otherwise it returns the first
// element or null
function makeSingleQuery(allQuery, getMultipleError) {
  return (container, ...args) => {
    const els = allQuery(container, ...args);
    if (els.length > 1) {
      const elementStrings = els.map(element => getElementError(null, element).message).join('\n\n');
      throw getMultipleElementsFoundError(`${getMultipleError(container, ...args)}

Here are the matching elements:

${elementStrings}`, container);
    }
    return els[0] || null;
  };
}
function getSuggestionError(suggestion, container) {
  return (0, _config.getConfig)().getElementError(`A better query is available, try this:
${suggestion.toString()}
`, container);
}

// this accepts a query function and returns a function which throws an error
// if an empty list of elements is returned
function makeGetAllQuery(allQuery, getMissingError) {
  return (container, ...args) => {
    const els = allQuery(container, ...args);
    if (!els.length) {
      throw (0, _config.getConfig)().getElementError(getMissingError(container, ...args), container);
    }
    return els;
  };
}

// this accepts a getter query function and returns a function which calls
// waitFor and passing a function which invokes the getter.
function makeFindQuery(getter) {
  return (container, text, options, waitForOptions) => {
    return (0, _waitFor.waitFor)(() => {
      return getter(container, text, options);
    }, {
      container,
      ...waitForOptions
    });
  };
}
const wrapSingleQueryWithSuggestion = (query, queryAllByName, variant) => (container, ...args) => {
  const element = query(container, ...args);
  const [{
    suggest = (0, _config.getConfig)().throwSuggestions
  } = {}] = args.slice(-1);
  if (element && suggest) {
    const suggestion = (0, _suggestions.getSuggestedQuery)(element, variant);
    if (suggestion && !queryAllByName.endsWith(suggestion.queryName)) {
      throw getSuggestionError(suggestion.toString(), container);
    }
  }
  return element;
};
exports.wrapSingleQueryWithSuggestion = wrapSingleQueryWithSuggestion;
const wrapAllByQueryWithSuggestion = (query, queryAllByName, variant) => (container, ...args) => {
  const els = query(container, ...args);
  const [{
    suggest = (0, _config.getConfig)().throwSuggestions
  } = {}] = args.slice(-1);
  if (els.length && suggest) {
    // get a unique list of all suggestion messages.  We are only going to make a suggestion if
    // all the suggestions are the same
    const uniqueSuggestionMessages = [...new Set(els.map(element => {
      var _getSuggestedQuery;
      return (_getSuggestedQuery = (0, _suggestions.getSuggestedQuery)(element, variant)) == null ? void 0 : _getSuggestedQuery.toString();
    }))];
    if (
    // only want to suggest if all the els have the same suggestion.
    uniqueSuggestionMessages.length === 1 && !queryAllByName.endsWith(
    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion -- TODO: Can this be null at runtime?
    (0, _suggestions.getSuggestedQuery)(els[0], variant).queryName)) {
      throw getSuggestionError(uniqueSuggestionMessages[0], container);
    }
  }
  return els;
};

// TODO: This deviates from the published declarations
// However, the implementation always required a dyadic (after `container`) not variadic `queryAllBy` considering the implementation of `makeFindQuery`
// This is at least statically true and can be verified by accepting `QueryMethod<Arguments, HTMLElement[]>`
exports.wrapAllByQueryWithSuggestion = wrapAllByQueryWithSuggestion;
function buildQueries(queryAllBy, getMultipleError, getMissingError) {
  const queryBy = wrapSingleQueryWithSuggestion(makeSingleQuery(queryAllBy, getMultipleError), queryAllBy.name, 'query');
  const getAllBy = makeGetAllQuery(queryAllBy, getMissingError);
  const getBy = makeSingleQuery(getAllBy, getMultipleError);
  const getByWithSuggestions = wrapSingleQueryWithSuggestion(getBy, queryAllBy.name, 'get');
  const getAllWithSuggestions = wrapAllByQueryWithSuggestion(getAllBy, queryAllBy.name.replace('query', 'get'), 'getAll');
  const findAllBy = makeFindQuery(wrapAllByQueryWithSuggestion(getAllBy, queryAllBy.name, 'findAll'));
  const findBy = makeFindQuery(wrapSingleQueryWithSuggestion(getBy, queryAllBy.name, 'find'));
  return [queryBy, getAllWithSuggestions, getByWithSuggestions, findAllBy, findBy];
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImJ1aWxkUXVlcmllcyIsImdldEVsZW1lbnRFcnJvciIsImdldE11bHRpcGxlRWxlbWVudHNGb3VuZEVycm9yIiwibWFrZUZpbmRRdWVyeSIsIm1ha2VHZXRBbGxRdWVyeSIsIm1ha2VTaW5nbGVRdWVyeSIsInF1ZXJ5QWxsQnlBdHRyaWJ1dGUiLCJxdWVyeUJ5QXR0cmlidXRlIiwid3JhcFNpbmdsZVF1ZXJ5V2l0aFN1Z2dlc3Rpb24iLCJ3cmFwQWxsQnlRdWVyeVdpdGhTdWdnZXN0aW9uIiwiX3N1Z2dlc3Rpb25zIiwicmVxdWlyZSIsIl9tYXRjaGVzIiwiX3dhaXRGb3IiLCJfY29uZmlnIiwibWVzc2FnZSIsImNvbnRhaW5lciIsImdldENvbmZpZyIsImF0dHJpYnV0ZSIsInRleHQiLCJleGFjdCIsImNvbGxhcHNlV2hpdGVzcGFjZSIsInRyaW0iLCJub3JtYWxpemVyIiwibWF0Y2hlciIsIm1hdGNoZXMiLCJmdXp6eU1hdGNoZXMiLCJtYXRjaE5vcm1hbGl6ZXIiLCJtYWtlTm9ybWFsaXplciIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmaWx0ZXIiLCJub2RlIiwiZ2V0QXR0cmlidXRlIiwib3B0aW9ucyIsImVscyIsImxlbmd0aCIsImFsbFF1ZXJ5IiwiZ2V0TXVsdGlwbGVFcnJvciIsImFyZ3MiLCJlbGVtZW50U3RyaW5ncyIsIm1hcCIsImVsZW1lbnQiLCJqb2luIiwiZ2V0U3VnZ2VzdGlvbkVycm9yIiwic3VnZ2VzdGlvbiIsInRvU3RyaW5nIiwiZ2V0TWlzc2luZ0Vycm9yIiwiZ2V0dGVyIiwid2FpdEZvck9wdGlvbnMiLCJ3YWl0Rm9yIiwicXVlcnkiLCJxdWVyeUFsbEJ5TmFtZSIsInZhcmlhbnQiLCJzdWdnZXN0IiwidGhyb3dTdWdnZXN0aW9ucyIsInNsaWNlIiwiZ2V0U3VnZ2VzdGVkUXVlcnkiLCJlbmRzV2l0aCIsInF1ZXJ5TmFtZSIsInVuaXF1ZVN1Z2dlc3Rpb25NZXNzYWdlcyIsIlNldCIsIl9nZXRTdWdnZXN0ZWRRdWVyeSIsInF1ZXJ5QWxsQnkiLCJxdWVyeUJ5IiwibmFtZSIsImdldEFsbEJ5IiwiZ2V0QnkiLCJnZXRCeVdpdGhTdWdnZXN0aW9ucyIsImdldEFsbFdpdGhTdWdnZXN0aW9ucyIsInJlcGxhY2UiLCJmaW5kQWxsQnkiLCJmaW5kQnkiXSwic291cmNlcyI6WyJxdWVyeS1oZWxwZXJzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5idWlsZFF1ZXJpZXMgPSBidWlsZFF1ZXJpZXM7XG5leHBvcnRzLmdldEVsZW1lbnRFcnJvciA9IGdldEVsZW1lbnRFcnJvcjtcbmV4cG9ydHMuZ2V0TXVsdGlwbGVFbGVtZW50c0ZvdW5kRXJyb3IgPSBnZXRNdWx0aXBsZUVsZW1lbnRzRm91bmRFcnJvcjtcbmV4cG9ydHMubWFrZUZpbmRRdWVyeSA9IG1ha2VGaW5kUXVlcnk7XG5leHBvcnRzLm1ha2VHZXRBbGxRdWVyeSA9IG1ha2VHZXRBbGxRdWVyeTtcbmV4cG9ydHMubWFrZVNpbmdsZVF1ZXJ5ID0gbWFrZVNpbmdsZVF1ZXJ5O1xuZXhwb3J0cy5xdWVyeUFsbEJ5QXR0cmlidXRlID0gcXVlcnlBbGxCeUF0dHJpYnV0ZTtcbmV4cG9ydHMucXVlcnlCeUF0dHJpYnV0ZSA9IHF1ZXJ5QnlBdHRyaWJ1dGU7XG5leHBvcnRzLndyYXBTaW5nbGVRdWVyeVdpdGhTdWdnZXN0aW9uID0gZXhwb3J0cy53cmFwQWxsQnlRdWVyeVdpdGhTdWdnZXN0aW9uID0gdm9pZCAwO1xudmFyIF9zdWdnZXN0aW9ucyA9IHJlcXVpcmUoXCIuL3N1Z2dlc3Rpb25zXCIpO1xudmFyIF9tYXRjaGVzID0gcmVxdWlyZShcIi4vbWF0Y2hlc1wiKTtcbnZhciBfd2FpdEZvciA9IHJlcXVpcmUoXCIuL3dhaXQtZm9yXCIpO1xudmFyIF9jb25maWcgPSByZXF1aXJlKFwiLi9jb25maWdcIik7XG5mdW5jdGlvbiBnZXRFbGVtZW50RXJyb3IobWVzc2FnZSwgY29udGFpbmVyKSB7XG4gIHJldHVybiAoMCwgX2NvbmZpZy5nZXRDb25maWcpKCkuZ2V0RWxlbWVudEVycm9yKG1lc3NhZ2UsIGNvbnRhaW5lcik7XG59XG5mdW5jdGlvbiBnZXRNdWx0aXBsZUVsZW1lbnRzRm91bmRFcnJvcihtZXNzYWdlLCBjb250YWluZXIpIHtcbiAgcmV0dXJuIGdldEVsZW1lbnRFcnJvcihgJHttZXNzYWdlfVxcblxcbihJZiB0aGlzIGlzIGludGVudGlvbmFsLCB0aGVuIHVzZSB0aGUgXFxgKkFsbEJ5KlxcYCB2YXJpYW50IG9mIHRoZSBxdWVyeSAobGlrZSBcXGBxdWVyeUFsbEJ5VGV4dFxcYCwgXFxgZ2V0QWxsQnlUZXh0XFxgLCBvciBcXGBmaW5kQWxsQnlUZXh0XFxgKSkuYCwgY29udGFpbmVyKTtcbn1cbmZ1bmN0aW9uIHF1ZXJ5QWxsQnlBdHRyaWJ1dGUoYXR0cmlidXRlLCBjb250YWluZXIsIHRleHQsIHtcbiAgZXhhY3QgPSB0cnVlLFxuICBjb2xsYXBzZVdoaXRlc3BhY2UsXG4gIHRyaW0sXG4gIG5vcm1hbGl6ZXJcbn0gPSB7fSkge1xuICBjb25zdCBtYXRjaGVyID0gZXhhY3QgPyBfbWF0Y2hlcy5tYXRjaGVzIDogX21hdGNoZXMuZnV6enlNYXRjaGVzO1xuICBjb25zdCBtYXRjaE5vcm1hbGl6ZXIgPSAoMCwgX21hdGNoZXMubWFrZU5vcm1hbGl6ZXIpKHtcbiAgICBjb2xsYXBzZVdoaXRlc3BhY2UsXG4gICAgdHJpbSxcbiAgICBub3JtYWxpemVyXG4gIH0pO1xuICByZXR1cm4gQXJyYXkuZnJvbShjb250YWluZXIucXVlcnlTZWxlY3RvckFsbChgWyR7YXR0cmlidXRlfV1gKSkuZmlsdGVyKG5vZGUgPT4gbWF0Y2hlcihub2RlLmdldEF0dHJpYnV0ZShhdHRyaWJ1dGUpLCBub2RlLCB0ZXh0LCBtYXRjaE5vcm1hbGl6ZXIpKTtcbn1cbmZ1bmN0aW9uIHF1ZXJ5QnlBdHRyaWJ1dGUoYXR0cmlidXRlLCBjb250YWluZXIsIHRleHQsIG9wdGlvbnMpIHtcbiAgY29uc3QgZWxzID0gcXVlcnlBbGxCeUF0dHJpYnV0ZShhdHRyaWJ1dGUsIGNvbnRhaW5lciwgdGV4dCwgb3B0aW9ucyk7XG4gIGlmIChlbHMubGVuZ3RoID4gMSkge1xuICAgIHRocm93IGdldE11bHRpcGxlRWxlbWVudHNGb3VuZEVycm9yKGBGb3VuZCBtdWx0aXBsZSBlbGVtZW50cyBieSBbJHthdHRyaWJ1dGV9PSR7dGV4dH1dYCwgY29udGFpbmVyKTtcbiAgfVxuICByZXR1cm4gZWxzWzBdIHx8IG51bGw7XG59XG5cbi8vIHRoaXMgYWNjZXB0cyBhIHF1ZXJ5IGZ1bmN0aW9uIGFuZCByZXR1cm5zIGEgZnVuY3Rpb24gd2hpY2ggdGhyb3dzIGFuIGVycm9yXG4vLyBpZiBtb3JlIHRoYW4gb25lIGVsZW1lbnRzIGlzIHJldHVybmVkLCBvdGhlcndpc2UgaXQgcmV0dXJucyB0aGUgZmlyc3Rcbi8vIGVsZW1lbnQgb3IgbnVsbFxuZnVuY3Rpb24gbWFrZVNpbmdsZVF1ZXJ5KGFsbFF1ZXJ5LCBnZXRNdWx0aXBsZUVycm9yKSB7XG4gIHJldHVybiAoY29udGFpbmVyLCAuLi5hcmdzKSA9PiB7XG4gICAgY29uc3QgZWxzID0gYWxsUXVlcnkoY29udGFpbmVyLCAuLi5hcmdzKTtcbiAgICBpZiAoZWxzLmxlbmd0aCA+IDEpIHtcbiAgICAgIGNvbnN0IGVsZW1lbnRTdHJpbmdzID0gZWxzLm1hcChlbGVtZW50ID0+IGdldEVsZW1lbnRFcnJvcihudWxsLCBlbGVtZW50KS5tZXNzYWdlKS5qb2luKCdcXG5cXG4nKTtcbiAgICAgIHRocm93IGdldE11bHRpcGxlRWxlbWVudHNGb3VuZEVycm9yKGAke2dldE11bHRpcGxlRXJyb3IoY29udGFpbmVyLCAuLi5hcmdzKX1cblxuSGVyZSBhcmUgdGhlIG1hdGNoaW5nIGVsZW1lbnRzOlxuXG4ke2VsZW1lbnRTdHJpbmdzfWAsIGNvbnRhaW5lcik7XG4gICAgfVxuICAgIHJldHVybiBlbHNbMF0gfHwgbnVsbDtcbiAgfTtcbn1cbmZ1bmN0aW9uIGdldFN1Z2dlc3Rpb25FcnJvcihzdWdnZXN0aW9uLCBjb250YWluZXIpIHtcbiAgcmV0dXJuICgwLCBfY29uZmlnLmdldENvbmZpZykoKS5nZXRFbGVtZW50RXJyb3IoYEEgYmV0dGVyIHF1ZXJ5IGlzIGF2YWlsYWJsZSwgdHJ5IHRoaXM6XG4ke3N1Z2dlc3Rpb24udG9TdHJpbmcoKX1cbmAsIGNvbnRhaW5lcik7XG59XG5cbi8vIHRoaXMgYWNjZXB0cyBhIHF1ZXJ5IGZ1bmN0aW9uIGFuZCByZXR1cm5zIGEgZnVuY3Rpb24gd2hpY2ggdGhyb3dzIGFuIGVycm9yXG4vLyBpZiBhbiBlbXB0eSBsaXN0IG9mIGVsZW1lbnRzIGlzIHJldHVybmVkXG5mdW5jdGlvbiBtYWtlR2V0QWxsUXVlcnkoYWxsUXVlcnksIGdldE1pc3NpbmdFcnJvcikge1xuICByZXR1cm4gKGNvbnRhaW5lciwgLi4uYXJncykgPT4ge1xuICAgIGNvbnN0IGVscyA9IGFsbFF1ZXJ5KGNvbnRhaW5lciwgLi4uYXJncyk7XG4gICAgaWYgKCFlbHMubGVuZ3RoKSB7XG4gICAgICB0aHJvdyAoMCwgX2NvbmZpZy5nZXRDb25maWcpKCkuZ2V0RWxlbWVudEVycm9yKGdldE1pc3NpbmdFcnJvcihjb250YWluZXIsIC4uLmFyZ3MpLCBjb250YWluZXIpO1xuICAgIH1cbiAgICByZXR1cm4gZWxzO1xuICB9O1xufVxuXG4vLyB0aGlzIGFjY2VwdHMgYSBnZXR0ZXIgcXVlcnkgZnVuY3Rpb24gYW5kIHJldHVybnMgYSBmdW5jdGlvbiB3aGljaCBjYWxsc1xuLy8gd2FpdEZvciBhbmQgcGFzc2luZyBhIGZ1bmN0aW9uIHdoaWNoIGludm9rZXMgdGhlIGdldHRlci5cbmZ1bmN0aW9uIG1ha2VGaW5kUXVlcnkoZ2V0dGVyKSB7XG4gIHJldHVybiAoY29udGFpbmVyLCB0ZXh0LCBvcHRpb25zLCB3YWl0Rm9yT3B0aW9ucykgPT4ge1xuICAgIHJldHVybiAoMCwgX3dhaXRGb3Iud2FpdEZvcikoKCkgPT4ge1xuICAgICAgcmV0dXJuIGdldHRlcihjb250YWluZXIsIHRleHQsIG9wdGlvbnMpO1xuICAgIH0sIHtcbiAgICAgIGNvbnRhaW5lcixcbiAgICAgIC4uLndhaXRGb3JPcHRpb25zXG4gICAgfSk7XG4gIH07XG59XG5jb25zdCB3cmFwU2luZ2xlUXVlcnlXaXRoU3VnZ2VzdGlvbiA9IChxdWVyeSwgcXVlcnlBbGxCeU5hbWUsIHZhcmlhbnQpID0+IChjb250YWluZXIsIC4uLmFyZ3MpID0+IHtcbiAgY29uc3QgZWxlbWVudCA9IHF1ZXJ5KGNvbnRhaW5lciwgLi4uYXJncyk7XG4gIGNvbnN0IFt7XG4gICAgc3VnZ2VzdCA9ICgwLCBfY29uZmlnLmdldENvbmZpZykoKS50aHJvd1N1Z2dlc3Rpb25zXG4gIH0gPSB7fV0gPSBhcmdzLnNsaWNlKC0xKTtcbiAgaWYgKGVsZW1lbnQgJiYgc3VnZ2VzdCkge1xuICAgIGNvbnN0IHN1Z2dlc3Rpb24gPSAoMCwgX3N1Z2dlc3Rpb25zLmdldFN1Z2dlc3RlZFF1ZXJ5KShlbGVtZW50LCB2YXJpYW50KTtcbiAgICBpZiAoc3VnZ2VzdGlvbiAmJiAhcXVlcnlBbGxCeU5hbWUuZW5kc1dpdGgoc3VnZ2VzdGlvbi5xdWVyeU5hbWUpKSB7XG4gICAgICB0aHJvdyBnZXRTdWdnZXN0aW9uRXJyb3Ioc3VnZ2VzdGlvbi50b1N0cmluZygpLCBjb250YWluZXIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZWxlbWVudDtcbn07XG5leHBvcnRzLndyYXBTaW5nbGVRdWVyeVdpdGhTdWdnZXN0aW9uID0gd3JhcFNpbmdsZVF1ZXJ5V2l0aFN1Z2dlc3Rpb247XG5jb25zdCB3cmFwQWxsQnlRdWVyeVdpdGhTdWdnZXN0aW9uID0gKHF1ZXJ5LCBxdWVyeUFsbEJ5TmFtZSwgdmFyaWFudCkgPT4gKGNvbnRhaW5lciwgLi4uYXJncykgPT4ge1xuICBjb25zdCBlbHMgPSBxdWVyeShjb250YWluZXIsIC4uLmFyZ3MpO1xuICBjb25zdCBbe1xuICAgIHN1Z2dlc3QgPSAoMCwgX2NvbmZpZy5nZXRDb25maWcpKCkudGhyb3dTdWdnZXN0aW9uc1xuICB9ID0ge31dID0gYXJncy5zbGljZSgtMSk7XG4gIGlmIChlbHMubGVuZ3RoICYmIHN1Z2dlc3QpIHtcbiAgICAvLyBnZXQgYSB1bmlxdWUgbGlzdCBvZiBhbGwgc3VnZ2VzdGlvbiBtZXNzYWdlcy4gIFdlIGFyZSBvbmx5IGdvaW5nIHRvIG1ha2UgYSBzdWdnZXN0aW9uIGlmXG4gICAgLy8gYWxsIHRoZSBzdWdnZXN0aW9ucyBhcmUgdGhlIHNhbWVcbiAgICBjb25zdCB1bmlxdWVTdWdnZXN0aW9uTWVzc2FnZXMgPSBbLi4ubmV3IFNldChlbHMubWFwKGVsZW1lbnQgPT4ge1xuICAgICAgdmFyIF9nZXRTdWdnZXN0ZWRRdWVyeTtcbiAgICAgIHJldHVybiAoX2dldFN1Z2dlc3RlZFF1ZXJ5ID0gKDAsIF9zdWdnZXN0aW9ucy5nZXRTdWdnZXN0ZWRRdWVyeSkoZWxlbWVudCwgdmFyaWFudCkpID09IG51bGwgPyB2b2lkIDAgOiBfZ2V0U3VnZ2VzdGVkUXVlcnkudG9TdHJpbmcoKTtcbiAgICB9KSldO1xuICAgIGlmIChcbiAgICAvLyBvbmx5IHdhbnQgdG8gc3VnZ2VzdCBpZiBhbGwgdGhlIGVscyBoYXZlIHRoZSBzYW1lIHN1Z2dlc3Rpb24uXG4gICAgdW5pcXVlU3VnZ2VzdGlvbk1lc3NhZ2VzLmxlbmd0aCA9PT0gMSAmJiAhcXVlcnlBbGxCeU5hbWUuZW5kc1dpdGgoXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb24gLS0gVE9ETzogQ2FuIHRoaXMgYmUgbnVsbCBhdCBydW50aW1lP1xuICAgICgwLCBfc3VnZ2VzdGlvbnMuZ2V0U3VnZ2VzdGVkUXVlcnkpKGVsc1swXSwgdmFyaWFudCkucXVlcnlOYW1lKSkge1xuICAgICAgdGhyb3cgZ2V0U3VnZ2VzdGlvbkVycm9yKHVuaXF1ZVN1Z2dlc3Rpb25NZXNzYWdlc1swXSwgY29udGFpbmVyKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGVscztcbn07XG5cbi8vIFRPRE86IFRoaXMgZGV2aWF0ZXMgZnJvbSB0aGUgcHVibGlzaGVkIGRlY2xhcmF0aW9uc1xuLy8gSG93ZXZlciwgdGhlIGltcGxlbWVudGF0aW9uIGFsd2F5cyByZXF1aXJlZCBhIGR5YWRpYyAoYWZ0ZXIgYGNvbnRhaW5lcmApIG5vdCB2YXJpYWRpYyBgcXVlcnlBbGxCeWAgY29uc2lkZXJpbmcgdGhlIGltcGxlbWVudGF0aW9uIG9mIGBtYWtlRmluZFF1ZXJ5YFxuLy8gVGhpcyBpcyBhdCBsZWFzdCBzdGF0aWNhbGx5IHRydWUgYW5kIGNhbiBiZSB2ZXJpZmllZCBieSBhY2NlcHRpbmcgYFF1ZXJ5TWV0aG9kPEFyZ3VtZW50cywgSFRNTEVsZW1lbnRbXT5gXG5leHBvcnRzLndyYXBBbGxCeVF1ZXJ5V2l0aFN1Z2dlc3Rpb24gPSB3cmFwQWxsQnlRdWVyeVdpdGhTdWdnZXN0aW9uO1xuZnVuY3Rpb24gYnVpbGRRdWVyaWVzKHF1ZXJ5QWxsQnksIGdldE11bHRpcGxlRXJyb3IsIGdldE1pc3NpbmdFcnJvcikge1xuICBjb25zdCBxdWVyeUJ5ID0gd3JhcFNpbmdsZVF1ZXJ5V2l0aFN1Z2dlc3Rpb24obWFrZVNpbmdsZVF1ZXJ5KHF1ZXJ5QWxsQnksIGdldE11bHRpcGxlRXJyb3IpLCBxdWVyeUFsbEJ5Lm5hbWUsICdxdWVyeScpO1xuICBjb25zdCBnZXRBbGxCeSA9IG1ha2VHZXRBbGxRdWVyeShxdWVyeUFsbEJ5LCBnZXRNaXNzaW5nRXJyb3IpO1xuICBjb25zdCBnZXRCeSA9IG1ha2VTaW5nbGVRdWVyeShnZXRBbGxCeSwgZ2V0TXVsdGlwbGVFcnJvcik7XG4gIGNvbnN0IGdldEJ5V2l0aFN1Z2dlc3Rpb25zID0gd3JhcFNpbmdsZVF1ZXJ5V2l0aFN1Z2dlc3Rpb24oZ2V0QnksIHF1ZXJ5QWxsQnkubmFtZSwgJ2dldCcpO1xuICBjb25zdCBnZXRBbGxXaXRoU3VnZ2VzdGlvbnMgPSB3cmFwQWxsQnlRdWVyeVdpdGhTdWdnZXN0aW9uKGdldEFsbEJ5LCBxdWVyeUFsbEJ5Lm5hbWUucmVwbGFjZSgncXVlcnknLCAnZ2V0JyksICdnZXRBbGwnKTtcbiAgY29uc3QgZmluZEFsbEJ5ID0gbWFrZUZpbmRRdWVyeSh3cmFwQWxsQnlRdWVyeVdpdGhTdWdnZXN0aW9uKGdldEFsbEJ5LCBxdWVyeUFsbEJ5Lm5hbWUsICdmaW5kQWxsJykpO1xuICBjb25zdCBmaW5kQnkgPSBtYWtlRmluZFF1ZXJ5KHdyYXBTaW5nbGVRdWVyeVdpdGhTdWdnZXN0aW9uKGdldEJ5LCBxdWVyeUFsbEJ5Lm5hbWUsICdmaW5kJykpO1xuICByZXR1cm4gW3F1ZXJ5QnksIGdldEFsbFdpdGhTdWdnZXN0aW9ucywgZ2V0QnlXaXRoU3VnZ2VzdGlvbnMsIGZpbmRBbGxCeSwgZmluZEJ5XTtcbn0iXSwibWFwcGluZ3MiOiJBQUFBLFlBQVk7O0FBRVpBLE1BQU0sQ0FBQ0MsY0FBYyxDQUFDQyxPQUFPLEVBQUUsWUFBWSxFQUFFO0VBQzNDQyxLQUFLLEVBQUU7QUFDVCxDQUFDLENBQUM7QUFDRkQsT0FBTyxDQUFDRSxZQUFZLEdBQUdBLFlBQVk7QUFDbkNGLE9BQU8sQ0FBQ0csZUFBZSxHQUFHQSxlQUFlO0FBQ3pDSCxPQUFPLENBQUNJLDZCQUE2QixHQUFHQSw2QkFBNkI7QUFDckVKLE9BQU8sQ0FBQ0ssYUFBYSxHQUFHQSxhQUFhO0FBQ3JDTCxPQUFPLENBQUNNLGVBQWUsR0FBR0EsZUFBZTtBQUN6Q04sT0FBTyxDQUFDTyxlQUFlLEdBQUdBLGVBQWU7QUFDekNQLE9BQU8sQ0FBQ1EsbUJBQW1CLEdBQUdBLG1CQUFtQjtBQUNqRFIsT0FBTyxDQUFDUyxnQkFBZ0IsR0FBR0EsZ0JBQWdCO0FBQzNDVCxPQUFPLENBQUNVLDZCQUE2QixHQUFHVixPQUFPLENBQUNXLDRCQUE0QixHQUFHLEtBQUssQ0FBQztBQUNyRixJQUFJQyxZQUFZLEdBQUdDLE9BQU8sQ0FBQyxlQUFlLENBQUM7QUFDM0MsSUFB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