{"version":3,"names":["dispatchEvent","require","getActiveElement","patched","Symbol","patchFocus","HTMLElement","prototype","focus","blur","Object","defineProperties","configurable","get","patchedFocus","patchedBlur","activeCall","options","ownerDocument","visibilityState","call","blurred","getActiveTarget","thisCall","dispatchDOMEvent","relatedTarget","document","active","undefined","tagName","restoreFocus","exports"],"sources":["patchFocus.js"],"sourcesContent":["'use strict';\n\nvar dispatchEvent = require('../event/dispatchEvent.js');\nrequire('../utils/dataTransfer/Clipboard.js');\nvar getActiveElement = require('../utils/focus/getActiveElement.js');\nrequire('@testing-library/dom');\n\nconst patched = Symbol('patched focus/blur methods');\nfunction patchFocus(HTMLElement) {\n    if (HTMLElement.prototype[patched]) {\n        return;\n    }\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    const { focus, blur } = HTMLElement.prototype;\n    Object.defineProperties(HTMLElement.prototype, {\n        focus: {\n            configurable: true,\n            get: ()=>patchedFocus\n        },\n        blur: {\n            configurable: true,\n            get: ()=>patchedBlur\n        },\n        [patched]: {\n            configurable: true,\n            get: ()=>({\n                    focus,\n                    blur\n                })\n        }\n    });\n    let activeCall;\n    function patchedFocus(options) {\n        if (this.ownerDocument.visibilityState !== 'hidden') {\n            return focus.call(this, options);\n        }\n        const blurred = getActiveTarget(this.ownerDocument);\n        if (blurred === this) {\n            return;\n        }\n        const thisCall = Symbol('focus call');\n        activeCall = thisCall;\n        if (blurred) {\n            blur.call(blurred);\n            dispatchEvent.dispatchDOMEvent(blurred, 'blur', {\n                relatedTarget: this\n            });\n            dispatchEvent.dispatchDOMEvent(blurred, 'focusout', {\n                relatedTarget: activeCall === thisCall ? this : null\n            });\n        }\n        if (activeCall === thisCall) {\n            focus.call(this, options);\n            dispatchEvent.dispatchDOMEvent(this, 'focus', {\n                relatedTarget: blurred\n            });\n        }\n        if (activeCall === thisCall) {\n            dispatchEvent.dispatchDOMEvent(this, 'focusin', {\n                relatedTarget: blurred\n            });\n        }\n    }\n    function patchedBlur() {\n        if (this.ownerDocument.visibilityState !== 'hidden') {\n            return blur.call(this);\n        }\n        const blurred = getActiveTarget(this.ownerDocument);\n        if (blurred !== this) {\n            return;\n        }\n        const thisCall = Symbol('blur call');\n        activeCall = thisCall;\n        blur.call(this);\n        dispatchEvent.dispatchDOMEvent(blurred, 'blur', {\n            relatedTarget: null\n        });\n        dispatchEvent.dispatchDOMEvent(blurred, 'focusout', {\n            relatedTarget: null\n        });\n    }\n}\nfunction getActiveTarget(document) {\n    const active = getActiveElement.getActiveElement(document);\n    return (active === null || active === undefined ? undefined : active.tagName) === 'BODY' ? null : active;\n}\nfunction restoreFocus(HTMLElement) {\n    if (HTMLElement.prototype[patched]) {\n        const { focus, blur } = HTMLElement.prototype[patched];\n        Object.defineProperties(HTMLElement.prototype, {\n            focus: {\n                configurable: true,\n                get: ()=>focus\n            },\n            blur: {\n                configurable: true,\n                get: ()=>blur\n            }\n        });\n    }\n}\n\nexports.patchFocus = patchFocus;\nexports.restoreFocus = restoreFocus;\n"],"mappings":"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","ignoreList":[]}