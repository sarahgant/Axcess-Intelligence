8ff61b5f914419c6ca6646e287cadd20
'use strict';

var isDisabled = require('../misc/isDisabled.js');
var isElementType = require('../misc/isElementType.js');
var isVisible = require('../misc/isVisible.js');
var selector = require('./selector.js');
function getTabDestination(activeElement, shift) {
  const document = activeElement.ownerDocument;
  const focusableElements = document.querySelectorAll(selector.FOCUSABLE_SELECTOR);
  const enabledElements = Array.from(focusableElements).filter(el => el === activeElement || !(Number(el.getAttribute('tabindex')) < 0 || isDisabled.isDisabled(el)));
  // tabindex has no effect if the active element has negative tabindex
  if (Number(activeElement.getAttribute('tabindex')) >= 0) {
    enabledElements.sort((a, b) => {
      const i = Number(a.getAttribute('tabindex'));
      const j = Number(b.getAttribute('tabindex'));
      if (i === j) {
        return 0;
      } else if (i === 0) {
        return 1;
      } else if (j === 0) {
        return -1;
      }
      return i - j;
    });
  }
  const checkedRadio = {};
  let prunedElements = [document.body];
  const activeRadioGroup = isElementType.isElementType(activeElement, 'input', {
    type: 'radio'
  }) ? activeElement.name : undefined;
  enabledElements.forEach(currentElement => {
    const el = currentElement;
    // For radio groups keep only the active radio
    // If there is no active radio, keep only the checked radio
    // If there is no checked radio, treat like everything else
    if (isElementType.isElementType(el, 'input', {
      type: 'radio'
    }) && el.name) {
      // If the active element is part of the group, add only that
      if (el === activeElement) {
        prunedElements.push(el);
        return;
      } else if (el.name === activeRadioGroup) {
        return;
      }
      // If we stumble upon a checked radio, remove the others
      if (el.checked) {
        prunedElements = prunedElements.filter(e => !isElementType.isElementType(e, 'input', {
          type: 'radio',
          name: el.name
        }));
        prunedElements.push(el);
        checkedRadio[el.name] = el;
        return;
      }
      // If we already found the checked one, skip
      if (typeof checkedRadio[el.name] !== 'undefined') {
        return;
      }
    }
    prunedElements.push(el);
  });
  for (let index = prunedElements.findIndex(el => el === activeElement);;) {
    index += shift ? -1 : 1;
    // loop at overflow
    if (index === prunedElements.length) {
      index = 0;
    } else if (index === -1) {
      index = prunedElements.length - 1;
    }
    if (prunedElements[index] === activeElement || prunedElements[index] === document.body || isVisible.isVisible(prunedElements[index])) {
      return prunedElements[index];
    }
  }
}
exports.getTabDestination = getTabDestination;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJpc0Rpc2FibGVkIiwicmVxdWlyZSIsImlzRWxlbWVudFR5cGUiLCJpc1Zpc2libGUiLCJzZWxlY3RvciIsImdldFRhYkRlc3RpbmF0aW9uIiwiYWN0aXZlRWxlbWVudCIsInNoaWZ0IiwiZG9jdW1lbnQiLCJvd25lckRvY3VtZW50IiwiZm9jdXNhYmxlRWxlbWVudHMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiRk9DVVNBQkxFX1NFTEVDVE9SIiwiZW5hYmxlZEVsZW1lbnRzIiwiQXJyYXkiLCJmcm9tIiwiZmlsdGVyIiwiZWwiLCJOdW1iZXIiLCJnZXRBdHRyaWJ1dGUiLCJzb3J0IiwiYSIsImIiLCJpIiwiaiIsImNoZWNrZWRSYWRpbyIsInBydW5lZEVsZW1lbnRzIiwiYm9keSIsImFjdGl2ZVJhZGlvR3JvdXAiLCJ0eXBlIiwibmFtZSIsInVuZGVmaW5lZCIsImZvckVhY2giLCJjdXJyZW50RWxlbWVudCIsInB1c2giLCJjaGVja2VkIiwiZSIsImluZGV4IiwiZmluZEluZGV4IiwibGVuZ3RoIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbImdldFRhYkRlc3RpbmF0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxudmFyIGlzRGlzYWJsZWQgPSByZXF1aXJlKCcuLi9taXNjL2lzRGlzYWJsZWQuanMnKTtcbnZhciBpc0VsZW1lbnRUeXBlID0gcmVxdWlyZSgnLi4vbWlzYy9pc0VsZW1lbnRUeXBlLmpzJyk7XG52YXIgaXNWaXNpYmxlID0gcmVxdWlyZSgnLi4vbWlzYy9pc1Zpc2libGUuanMnKTtcbnZhciBzZWxlY3RvciA9IHJlcXVpcmUoJy4vc2VsZWN0b3IuanMnKTtcblxuZnVuY3Rpb24gZ2V0VGFiRGVzdGluYXRpb24oYWN0aXZlRWxlbWVudCwgc2hpZnQpIHtcbiAgICBjb25zdCBkb2N1bWVudCA9IGFjdGl2ZUVsZW1lbnQub3duZXJEb2N1bWVudDtcbiAgICBjb25zdCBmb2N1c2FibGVFbGVtZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IuRk9DVVNBQkxFX1NFTEVDVE9SKTtcbiAgICBjb25zdCBlbmFibGVkRWxlbWVudHMgPSBBcnJheS5mcm9tKGZvY3VzYWJsZUVsZW1lbnRzKS5maWx0ZXIoKGVsKT0+ZWwgPT09IGFjdGl2ZUVsZW1lbnQgfHwgIShOdW1iZXIoZWwuZ2V0QXR0cmlidXRlKCd0YWJpbmRleCcpKSA8IDAgfHwgaXNEaXNhYmxlZC5pc0Rpc2FibGVkKGVsKSkpO1xuICAgIC8vIHRhYmluZGV4IGhhcyBubyBlZmZlY3QgaWYgdGhlIGFjdGl2ZSBlbGVtZW50IGhhcyBuZWdhdGl2ZSB0YWJpbmRleFxuICAgIGlmIChOdW1iZXIoYWN0aXZlRWxlbWVudC5nZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JykpID49IDApIHtcbiAgICAgICAgZW5hYmxlZEVsZW1lbnRzLnNvcnQoKGEsIGIpPT57XG4gICAgICAgICAgICBjb25zdCBpID0gTnVtYmVyKGEuZ2V0QXR0cmlidXRlKCd0YWJpbmRleCcpKTtcbiAgICAgICAgICAgIGNvbnN0IGogPSBOdW1iZXIoYi5nZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JykpO1xuICAgICAgICAgICAgaWYgKGkgPT09IGopIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChqID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGkgLSBqO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgY2hlY2tlZFJhZGlvID0ge307XG4gICAgbGV0IHBydW5lZEVsZW1lbnRzID0gW1xuICAgICAgICBkb2N1bWVudC5ib2R5XG4gICAgXTtcbiAgICBjb25zdCBhY3RpdmVSYWRpb0dyb3VwID0gaXNFbGVtZW50VHlwZS5pc0VsZW1lbnRUeXBlKGFjdGl2ZUVsZW1lbnQsICdpbnB1dCcsIHtcbiAgICAgICAgdHlwZTogJ3JhZGlvJ1xuICAgIH0pID8gYWN0aXZlRWxlbWVudC5uYW1lIDogdW5kZWZpbmVkO1xuICAgIGVuYWJsZWRFbGVtZW50cy5mb3JFYWNoKChjdXJyZW50RWxlbWVudCk9PntcbiAgICAgICAgY29uc3QgZWwgPSBjdXJyZW50RWxlbWVudDtcbiAgICAgICAgLy8gRm9yIHJhZGlvIGdyb3VwcyBrZWVwIG9ubHkgdGhlIGFjdGl2ZSByYWRpb1xuICAgICAgICAvLyBJZiB0aGVyZSBpcyBubyBhY3RpdmUgcmFkaW8sIGtlZXAgb25seSB0aGUgY2hlY2tlZCByYWRpb1xuICAgICAgICAvLyBJZiB0aGVyZSBpcyBubyBjaGVja2VkIHJhZGlvLCB0cmVhdCBsaWtlIGV2ZXJ5dGhpbmcgZWxzZVxuICAgICAgICBpZiAoaXNFbGVtZW50VHlwZS5pc0VsZW1lbnRUeXBlKGVsLCAnaW5wdXQnLCB7XG4gICAgICAgICAgICB0eXBlOiAncmFkaW8nXG4gICAgICAgIH0pICYmIGVsLm5hbWUpIHtcbiAgICAgICAgICAgIC8vIElmIHRoZSBhY3RpdmUgZWxlbWVudCBpcyBwYXJ0IG9mIHRoZSBncm91cCwgYWRkIG9ubHkgdGhhdFxuICAgICAgICAgICAgaWYgKGVsID09PSBhY3RpdmVFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgcHJ1bmVkRWxlbWVudHMucHVzaChlbCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlbC5uYW1lID09PSBhY3RpdmVSYWRpb0dyb3VwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gSWYgd2Ugc3R1bWJsZSB1cG9uIGEgY2hlY2tlZCByYWRpbywgcmVtb3ZlIHRoZSBvdGhlcnNcbiAgICAgICAgICAgIGlmIChlbC5jaGVja2VkKSB7XG4gICAgICAgICAgICAgICAgcHJ1bmVkRWxlbWVudHMgPSBwcnVuZWRFbGVtZW50cy5maWx0ZXIoKGUpPT4haXNFbGVtZW50VHlwZS5pc0VsZW1lbnRUeXBlKGUsICdpbnB1dCcsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdyYWRpbycsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBlbC5uYW1lXG4gICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICBwcnVuZWRFbGVtZW50cy5wdXNoKGVsKTtcbiAgICAgICAgICAgICAgICBjaGVja2VkUmFkaW9bZWwubmFtZV0gPSBlbDtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBJZiB3ZSBhbHJlYWR5IGZvdW5kIHRoZSBjaGVja2VkIG9uZSwgc2tpcFxuICAgICAgICAgICAgaWYgKHR5cGVvZiBjaGVja2VkUmFkaW9bZWwubmFtZV0gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHBydW5lZEVsZW1lbnRzLnB1c2goZWwpO1xuICAgIH0pO1xuICAgIGZvcihsZXQgaW5kZXggPSBwcnVuZWRFbGVtZW50cy5maW5kSW5kZXgoKGVsKT0+ZWwgPT09IGFjdGl2ZUVsZW1lbnQpOzspe1xuICAgICAgICBpbmRleCArPSBzaGlmdCA/IC0xIDogMTtcbiAgICAgICAgLy8gbG9vcCBhdCBvdmVyZmxvd1xuICAgICAgICBpZiAoaW5kZXggPT09IHBydW5lZEVsZW1lbnRzLmxlbmd0aCkge1xuICAgICAgICAgICAgaW5kZXggPSAwO1xuICAgICAgICB9IGVsc2UgaWYgKGluZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgaW5kZXggPSBwcnVuZWRFbGVtZW50cy5sZW5ndGggLSAxO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwcnVuZWRFbGVtZW50c1tpbmRleF0gPT09IGFjdGl2ZUVsZW1lbnQgfHwgcHJ1bmVkRWxlbWVudHNbaW5kZXhdID09PSBkb2N1bWVudC5ib2R5IHx8IGlzVmlzaWJsZS5pc1Zpc2libGUocHJ1bmVkRWxlbWVudHNbaW5kZXhdKSkge1xuICAgICAgICAgICAgcmV0dXJuIHBydW5lZEVsZW1lbnRzW2luZGV4XTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0cy5nZXRUYWJEZXN0aW5hdGlvbiA9IGdldFRhYkRlc3RpbmF0aW9uO1xuIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZOztBQUVaLElBQUlBLFVBQVUsR0FBR0MsT0FBTyxDQUFDLHVCQUF1QixDQUFDO0FBQ2pELElBQUlDLGFBQWEsR0FBR0QsT0FBTyxDQUFDLDBCQUEwQixDQUFDO0FBQ3ZELElBQUlFLFNBQVMsR0FBR0YsT0FBTyxDQUFDLHNCQUFzQixDQUFDO0FBQy9DLElBQUlHLFFBQVEsR0FBR0gsT0FBTyxDQUFDLGVBQWUsQ0FBQztBQUV2QyxTQUFTSSxpQkFBaUJBLENBQUNDLGFBQWEsRUFBRUMsS0FBSyxFQUFFO0VBQzdDLE1BQU1DLFFBQVEsR0FBR0YsYUFBYSxDQUFDRyxhQUFhO0VBQzVDLE1BQU1DLGlCQUFpQixHQUFHRixRQUFRLENBQUNHLGdCQUFnQixDQUFDUCxRQUFRLENBQUNRLGtCQUFrQixDQUFDO0VBQ2hGLE1BQU1DLGVBQWUsR0FBR0MsS0FBSyxDQUFDQyxJQUFJLENBQUNMLGlCQUFpQixDQUFDLENBQUNNLE1BQU0sQ0FBRUMsRUFBRSxJQUFHQSxFQUFFLEtBQUtYLGFBQWEsSUFBSSxFQUFFWSxNQUFNLENBQUNELEVBQUUsQ0FBQ0UsWUFBWSxDQUFDLFVBQVUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJbkIsVUFBVSxDQUFDQSxVQUFVLENBQUNpQixFQUFFLENBQUMsQ0FBQyxDQUFDO0VBQ25LO0VBQ0EsSUFBSUMsTUFBTSxDQUFDWixhQUFhLENBQUNhLFlBQVksQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRTtJQUNyRE4sZUFBZSxDQUFDTyxJQUFJLENBQUMsQ0FBQ0MsQ0FBQyxFQUFFQyxDQUFDLEtBQUc7TUFDekIs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