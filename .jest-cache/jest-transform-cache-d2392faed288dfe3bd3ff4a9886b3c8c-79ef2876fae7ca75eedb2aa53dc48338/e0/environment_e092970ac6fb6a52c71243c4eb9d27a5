98cfcb81162fd8620cd5423ae56104f9
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.env = exports.config = void 0;
exports.loadEnvironment = loadEnvironment;
exports.validateProductionEnvironment = validateProductionEnvironment;
exports.getEnvironmentSummary = getEnvironmentSummary;
const zod_1 = require("zod");
const logger_1 = require("../core/logging/logger");
/**
 * ðŸš¨ CRITICAL ARCHITECTURE REMINDER ðŸš¨
 *
 * ENVIRONMENT FILES ALREADY EXIST - DO NOT CREATE OR MODIFY THEM!
 *
 * - Frontend (/.env): Configuration only, NO API keys
 * - Backend (/server/.env): All API keys and secrets
 * - Frontend uses: import.meta.env.VITE_*
 * - Backend uses: process.env.*
 * - All AI calls go through backend proxy
 *
 * See: docs/ARCHITECTURE_CONSTRAINTS.md for complete details
 */
/**
 * Environment schema with validation and defaults
 */
const envSchema = zod_1.z.object({
    // API Configuration
    API_BASE_URL: zod_1.z.string().url().default('http://localhost:3001/api'),
    API_TIMEOUT: zod_1.z.number().min(1000).max(30000).default(5000),
    // AI Provider Selection (frontend only knows about provider choice, not keys)
    AI_PROVIDER: zod_1.z.enum(['anthropic', 'openai', 'azure']).default('anthropic'),
    // Security
    CORS_ORIGIN: zod_1.z.string().default('http://localhost:5173'),
    RATE_LIMIT_REQUESTS: zod_1.z.number().min(1).max(1000).default(100),
    RATE_LIMIT_WINDOW: zod_1.z.number().min(1000).max(3600000).default(60000), // 1 minute
    // Features
    ENABLE_LOGGING: zod_1.z.boolean().default(true),
    ENABLE_MONITORING: zod_1.z.boolean().default(false),
    ENABLE_CACHE: zod_1.z.boolean().default(true),
    // Performance
    MAX_FILE_SIZE: zod_1.z.number().min(1024 * 1024).max(100 * 1024 * 1024).default(20 * 1024 * 1024), // 20MB
    MAX_CONCURRENT_REQUESTS: zod_1.z.number().min(1).max(50).default(5),
    CACHE_TTL: zod_1.z.number().min(60).max(86400).default(3600), // 1 hour
    // Development
    NODE_ENV: zod_1.z.enum(['development', 'production', 'test']).default('development'),
    DEBUG: zod_1.z.boolean().default(false),
    // Retry Configuration
    RETRY_MAX_ATTEMPTS: zod_1.z.number().min(1).max(10).default(3),
    RETRY_INITIAL_DELAY: zod_1.z.number().min(100).max(10000).default(1000),
    RETRY_MAX_DELAY: zod_1.z.number().min(1000).max(60000).default(10000),
    // Circuit Breaker Configuration
    CIRCUIT_BREAKER_FAILURE_THRESHOLD: zod_1.z.number().min(1).max(20).default(5),
    CIRCUIT_BREAKER_RESET_TIMEOUT: zod_1.z.number().min(1000).max(300000).default(60000), // 1 minute
    CIRCUIT_BREAKER_SUCCESS_THRESHOLD: zod_1.z.number().min(1).max(10).default(2),
});
/**
 * Safely parse numeric environment variables with fallbacks
 */
function parseNumber(value, defaultValue) {
    if (!value || value.trim() === '') {
        return defaultValue;
    }
    const parsed = Number(value);
    if (isNaN(parsed)) {
        logger_1.logger.warn(`Invalid numeric value for environment variable: ${value}, using default: ${defaultValue}`);
        return defaultValue;
    }
    return parsed;
}
/**
 * Safely parse boolean environment variables
 */
function parseBoolean(value, defaultValue) {
    if (!value || value.trim() === '') {
        return defaultValue;
    }
    return value.toLowerCase() === 'true';
}
/**
 * Load and validate environment configuration
 */
function loadEnvironment() {
    // Get environment variables with fallback for testing
    const getEnvVar = (key) => {
        if (typeof import.meta !== 'undefined' && import.meta.env) {
            return import.meta.env[key];
        }
        // Fallback for testing environment
        return process.env?.[key];
    };
    const env = {
        API_BASE_URL: (getEnvVar('VITE_API_BASE_URL') || 'http://localhost:3001') + (getEnvVar('VITE_API_BASE_URL')?.includes('/api') ? '' : '/api'),
        API_TIMEOUT: parseNumber(getEnvVar('VITE_API_TIMEOUT'), 5000),
        AI_PROVIDER: getEnvVar('VITE_AI_PROVIDER') || 'anthropic',
        CORS_ORIGIN: getEnvVar('VITE_CORS_ORIGIN') || 'http://localhost:5173',
        RATE_LIMIT_REQUESTS: parseNumber(getEnvVar('VITE_RATE_LIMIT_REQUESTS'), 100),
        RATE_LIMIT_WINDOW: parseNumber(getEnvVar('VITE_RATE_LIMIT_WINDOW'), 60000),
        ENABLE_LOGGING: parseBoolean(getEnvVar('VITE_ENABLE_LOGGING'), true),
        ENABLE_MONITORING: parseBoolean(getEnvVar('VITE_ENABLE_MONITORING'), false),
        ENABLE_CACHE: parseBoolean(getEnvVar('VITE_ENABLE_CACHE'), true),
        MAX_FILE_SIZE: parseNumber(getEnvVar('VITE_MAX_FILE_SIZE'), 20 * 1024 * 1024),
        MAX_CONCURRENT_REQUESTS: parseNumber(getEnvVar('VITE_MAX_CONCURRENT_REQUESTS'), 5),
        CACHE_TTL: parseNumber(getEnvVar('VITE_CACHE_TTL'), 3600),
        NODE_ENV: getEnvVar('MODE') || 'development',
        DEBUG: parseBoolean(getEnvVar('VITE_DEBUG'), false),
        RETRY_MAX_ATTEMPTS: parseNumber(getEnvVar('VITE_RETRY_MAX_ATTEMPTS'), 3),
        RETRY_INITIAL_DELAY: parseNumber(getEnvVar('VITE_RETRY_INITIAL_DELAY'), 1000),
        RETRY_MAX_DELAY: parseNumber(getEnvVar('VITE_RETRY_MAX_DELAY'), 10000),
        CIRCUIT_BREAKER_FAILURE_THRESHOLD: parseNumber(getEnvVar('VITE_CIRCUIT_BREAKER_FAILURE_THRESHOLD'), 5),
        CIRCUIT_BREAKER_RESET_TIMEOUT: parseNumber(getEnvVar('VITE_CIRCUIT_BREAKER_RESET_TIMEOUT'), 60000),
        CIRCUIT_BREAKER_SUCCESS_THRESHOLD: parseNumber(getEnvVar('VITE_CIRCUIT_BREAKER_SUCCESS_THRESHOLD'), 2)
    };
    try {
        const validatedEnv = envSchema.parse(env);
        logger_1.logger.info('Environment configuration loaded successfully', {
            nodeEnv: validatedEnv.NODE_ENV,
            apiBaseUrl: validatedEnv.API_BASE_URL,
            aiProvider: validatedEnv.AI_PROVIDER,
            enableLogging: validatedEnv.ENABLE_LOGGING,
            enableCache: validatedEnv.ENABLE_CACHE,
            debug: validatedEnv.DEBUG
        });
        return validatedEnv;
    }
    catch (error) {
        logger_1.logger.error('Environment validation failed', {
            error: error instanceof Error ? error.message : String(error),
            env: Object.keys(env).filter(key => env[key] !== undefined)
        });
        throw new Error(`Invalid environment configuration: ${error instanceof Error ? error.message : String(error)}`);
    }
}
/**
 * Get environment configuration with validation
 */
exports.config = loadEnvironment();
/**
 * Environment configuration helpers
 */
exports.env = {
    /**
     * Check if running in development mode
     */
    isDevelopment: () => exports.config.NODE_ENV === 'development',
    /**
     * Check if running in production mode
     */
    isProduction: () => exports.config.NODE_ENV === 'production',
    /**
     * Check if running in test mode
     */
    isTest: () => exports.config.NODE_ENV === 'test',
    /**
     * Check if debug mode is enabled
     */
    isDebug: () => exports.config.DEBUG,
    /**
     * Get API configuration
     */
    api: {
        baseUrl: () => exports.config.API_BASE_URL,
        timeout: () => exports.config.API_TIMEOUT,
    },
    /**
     * Get AI provider configuration
     */
    ai: {
        provider: () => exports.config.AI_PROVIDER,
    },
    /**
     * Get security configuration
     */
    security: {
        corsOrigin: () => exports.config.CORS_ORIGIN,
        rateLimitRequests: () => exports.config.RATE_LIMIT_REQUESTS,
        rateLimitWindow: () => exports.config.RATE_LIMIT_WINDOW,
    },
    /**
     * Get feature flags
     */
    features: {
        logging: () => exports.config.ENABLE_LOGGING,
        monitoring: () => exports.config.ENABLE_MONITORING,
        cache: () => exports.config.ENABLE_CACHE,
    },
    /**
     * Get performance configuration
     */
    performance: {
        maxFileSize: () => exports.config.MAX_FILE_SIZE,
        maxConcurrentRequests: () => exports.config.MAX_CONCURRENT_REQUESTS,
        cacheTTL: () => exports.config.CACHE_TTL,
    },
    /**
     * Get retry configuration
     */
    retry: {
        maxAttempts: () => exports.config.RETRY_MAX_ATTEMPTS,
        initialDelay: () => exports.config.RETRY_INITIAL_DELAY,
        maxDelay: () => exports.config.RETRY_MAX_DELAY,
    },
    /**
     * Get circuit breaker configuration
     */
    circuitBreaker: {
        failureThreshold: () => exports.config.CIRCUIT_BREAKER_FAILURE_THRESHOLD,
        resetTimeout: () => exports.config.CIRCUIT_BREAKER_RESET_TIMEOUT,
        successThreshold: () => exports.config.CIRCUIT_BREAKER_SUCCESS_THRESHOLD,
    },
};
/**
 * Validate required environment variables for production
 */
function validateProductionEnvironment() {
    if (exports.env.isProduction()) {
        const requiredVars = [
            'API_BASE_URL',
            'CORS_ORIGIN'
        ];
        const missingVars = requiredVars.filter(varName => {
            const value = exports.config[varName];
            return value === undefined || value === '';
        });
        if (missingVars.length > 0) {
            throw new Error(`Missing required environment variables for production: ${missingVars.join(', ')}`);
        }
        logger_1.logger.info('Production environment validation passed');
    }
}
/**
 * Get environment summary for debugging
 */
function getEnvironmentSummary() {
    return {
        nodeEnv: exports.config.NODE_ENV,
        debug: exports.config.DEBUG,
        apiBaseUrl: exports.config.API_BASE_URL,
        aiProvider: exports.config.AI_PROVIDER,
        features: {
            logging: exports.config.ENABLE_LOGGING,
            monitoring: exports.config.ENABLE_MONITORING,
            cache: exports.config.ENABLE_CACHE,
        },
        performance: {
            maxFileSize: `${exports.config.MAX_FILE_SIZE / (1024 * 1024)}MB`,
            maxConcurrentRequests: exports.config.MAX_CONCURRENT_REQUESTS,
            cacheTTL: `${exports.config.CACHE_TTL}s`,
        },
        retry: {
            maxAttempts: exports.config.RETRY_MAX_ATTEMPTS,
            initialDelay: `${exports.config.RETRY_INITIAL_DELAY}ms`,
            maxDelay: `${exports.config.RETRY_MAX_DELAY}ms`,
        },
        circuitBreaker: {
            failureThreshold: exports.config.CIRCUIT_BREAKER_FAILURE_THRESHOLD,
            resetTimeout: `${exports.config.CIRCUIT_BREAKER_RESET_TIMEOUT}ms`,
            successThreshold: exports.config.CIRCUIT_BREAKER_SUCCESS_THRESHOLD,
        },
    };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxzYXJhaFxcUmVwb3NcXENDSCBBeGNlc3MgSW50ZWxsaWdlbmNlIFZpYmVkXFxzcmNcXGNvbmZpZ1xcZW52aXJvbm1lbnQudHMiLCJtYXBwaW5ncyI6Ijs7O0FBMkZBLDBDQXFEQztBQStGRCxzRUFrQkM7QUFLRCxzREEyQkM7QUFqU0QsNkJBQXdCO0FBQ3hCLG1EQUFnRDtBQUVoRDs7Ozs7Ozs7Ozs7O0dBWUc7QUFFSDs7R0FFRztBQUNILE1BQU0sU0FBUyxHQUFHLE9BQUMsQ0FBQyxNQUFNLENBQUM7SUFDekIsb0JBQW9CO0lBQ3BCLFlBQVksRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLDJCQUEyQixDQUFDO0lBQ25FLFdBQVcsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDO0lBRTFELDhFQUE4RTtJQUM5RSxXQUFXLEVBQUUsT0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLFdBQVcsRUFBRSxRQUFRLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDO0lBRTFFLFdBQVc7SUFDWCxXQUFXLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQztJQUN4RCxtQkFBbUIsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDO0lBQzdELGlCQUFpQixFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRSxXQUFXO0lBRWhGLFdBQVc7SUFDWCxjQUFjLEVBQUUsT0FB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XFJlcG9zXFxDQ0ggQXhjZXNzIEludGVsbGlnZW5jZSBWaWJlZFxcc3JjXFxjb25maWdcXGVudmlyb25tZW50LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xyXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICcuLi9jb3JlL2xvZ2dpbmcvbG9nZ2VyJztcclxuXHJcbi8qKlxyXG4gKiDwn5qoIENSSVRJQ0FMIEFSQ0hJVEVDVFVSRSBSRU1JTkRFUiDwn5qoXHJcbiAqIFxyXG4gKiBFTlZJUk9OTUVOVCBGSUxFUyBBTFJFQURZIEVYSVNUIC0gRE8gTk9UIENSRUFURSBPUiBNT0RJRlkgVEhFTSFcclxuICogXHJcbiAqIC0gRnJvbnRlbmQgKC8uZW52KTogQ29uZmlndXJhdGlvbiBvbmx5LCBOTyBBUEkga2V5c1xyXG4gKiAtIEJhY2tlbmQgKC9zZXJ2ZXIvLmVudik6IEFsbCBBUEkga2V5cyBhbmQgc2VjcmV0c1xyXG4gKiAtIEZyb250ZW5kIHVzZXM6IGltcG9ydC5tZXRhLmVudi5WSVRFXypcclxuICogLSBCYWNrZW5kIHVzZXM6IHByb2Nlc3MuZW52LipcclxuICogLSBBbGwgQUkgY2FsbHMgZ28gdGhyb3VnaCBiYWNrZW5kIHByb3h5XHJcbiAqIFxyXG4gKiBTZWU6IGRvY3MvQVJDSElURUNUVVJFX0NPTlNUUkFJTlRTLm1kIGZvciBjb21wbGV0ZSBkZXRhaWxzXHJcbiAqL1xyXG5cclxuLyoqXHJcbiAqIEVudmlyb25tZW50IHNjaGVtYSB3aXRoIHZhbGlkYXRpb24gYW5kIGRlZmF1bHRzXHJcbiAqL1xyXG5jb25zdCBlbnZTY2hlbWEgPSB6Lm9iamVjdCh7XHJcbiAgLy8gQVBJIENvbmZpZ3VyYXRpb25cclxuICBBUElfQkFTRV9VUkw6IHouc3RyaW5nKCkudXJsKCkuZGVmYXVsdCgnaHR0cDovL2xvY2FsaG9zdDozMDAxL2FwaScpLFxyXG4gIEFQSV9USU1FT1VUOiB6Lm51bWJlcigpLm1pbigxMDAwKS5tYXgoMzAwMDApLmRlZmF1bHQoNTAwMCksXHJcblxyXG4gIC8vIEFJIFByb3ZpZGVyIFNlbGVjdGlvbiAoZnJvbnRlbmQgb25seSBrbm93cyBhYm91dCBwcm92aWRlciBjaG9pY2UsIG5vdCBrZXlzKVxyXG4gIEFJX1BST1ZJREVSOiB6LmVudW0oWydhbnRocm9waWMnLCAnb3BlbmFpJywgJ2F6dXJlJ10pLmRlZmF1bHQoJ2FudGhyb3BpYycpLFxyXG5cclxuICAvLyBTZWN1cml0eVxyXG4gIENPUlNfT1JJR0lOOiB6LnN0cmluZygpLmRlZmF1bHQoJ2h0dHA6Ly9sb2NhbGhvc3Q6NTE3MycpLFxyXG4gIFJBVEVfTElNSVRfUkVRVUVTVFM6IHoubnVtYmVyKCkubWluKDEpLm1heCgxMDAwKS5kZWZhdWx0KDEwMCksXHJcbiAgUkFURV9MSU1JVF9XSU5ET1c6IHoubnVtYmVyKCkubWluKDEwMDApLm1heCgzNjAwMDAwKS5kZWZhdWx0KDYwMDAwKSwgLy8gMSBtaW51dGVcclxuXHJcbiAgLy8gRmVhdHVyZXNcclxuICBFTkFCTEVfTE9HR0lORzogei5ib29sZWFuKCkuZGVmYXVsdCh0cnVlKSxcclxuICBFTkFCTEVfTU9OSVRPUklORzogei5ib29sZWFuKCkuZGVmYXVsdChmYWxzZSksXHJcbiAgRU5BQkxFX0NBQ0hFOiB6LmJvb2xlYW4oKS5kZWZhdWx0KHRydWUpLFxyXG5cclxuICAvLyBQZXJmb3JtYW5jZVxyXG4gIE1BWF9GSUxFX1NJWkU6IHoubnVtYmVyKCkubWluKDEwMjQgKiAxMDI0KS5tYXgoMTAwICogMTAyNCAqIDEwMjQpLmRlZmF1bHQoMjAgKiAxMDI0ICogMTAyNCksIC8vIDIwTUJcclxuICBNQVhfQ09OQ1VSUkVOVF9SRVFVRVNUUzogei5udW1iZXIoKS5taW4oMSkubWF4KDUwKS5kZWZhdWx0KDUpLFxyXG4gIENBQ0hFX1RUTDogei5udW1iZXIoKS5taW4oNjApLm1heCg4NjQwMCkuZGVmYXVsdCgzNjAwKSwgLy8gMSBob3VyXHJcblxyXG4gIC8vIERldmVsb3BtZW50XHJcbiAgTk9ERV9FTlY6IHouZW51bShbJ2RldmVsb3BtZW50JywgJ3Byb2R1Y3Rpb24nLCAndGVzdCddKS5kZWZhdWx0KCdkZXZlbG9wbWVudCcpLFxyXG4gIERFQlVHOiB6LmJvb2xlYW4oKS5kZWZhdWx0KGZhbHNlKSxcclxuXHJcbiAgLy8gUmV0cnkgQ29uZmlndXJhdGlvblxyXG4gIFJFVFJZX01BWF9BVFRFTVBUUzogei5udW1iZXIoKS5taW4oMSkubWF4KDEwKS5kZWZhdWx0KDMpLFxyXG4gIFJFVFJZX0lOSVRJQUxfREVMQVk6IHoubnVtYmVyKCkubWluKDEwMCkubWF4KDEwMDAwKS5kZWZhdWx0KDEwMDApLFxyXG4gIFJFVFJZX01BWF9ERUxBWTogei5udW1iZXIoKS5taW4oMTAwMCkubWF4KDYwMDAwKS5kZWZhdWx0KDEwMDAwKSxcclxuXHJcbiAgLy8gQ2lyY3VpdCBCcmVha2VyIENvbmZpZ3VyYXRpb25cclxuICBDSVJDVUlUX0JSRUFLRVJfRkFJTFVSRV9USFJFU0hPTEQ6IHoubnVtYmVyKCkubWluKDEpLm1heCgyMCkuZGVmYXVsdCg1KSxcclxuICBDSVJDVUlUX0JSRUFLRVJfUkVTRVRfVElNRU9VVDogei5udW1iZXIoKS5taW4oMTAwMCkubWF4KDMwMDAwMCkuZGVmYXVsdCg2MDAwMCksIC8vIDEgbWludXRlXHJcbiAgQ0lSQ1VJVF9CUkVBS0VSX1NVQ0NFU1NfVEhSRVNIT0xEOiB6Lm51bWJlcigpLm1pbigxKS5tYXgoMTApLmRlZmF1bHQoMiksXHJcbn0pO1xyXG5cclxuZXhwb3J0IHR5cGUgRW52aXJvbm1lbnQgPSB6LmluZmVyPHR5cGVvZiBlbnZTY2hlbWE+O1xyXG5cclxuLyoqXHJcbiAqIFNhZmVseSBwYXJzZSBudW1lcmljIGVudmlyb25tZW50IHZhcmlhYmxlcyB3aXRoIGZhbGxiYWNrc1xyXG4gKi9cclxuZnVuY3Rpb24gcGFyc2VOdW1iZXIodmFsdWU6IHN0cmluZyB8IHVuZGVmaW5lZCwgZGVmYXVsdFZhbHVlOiBudW1iZXIpOiBudW1iZXIge1xyXG4gIGlmICghdmFsdWUgfHwgdmFsdWUudHJpbSgpID09PSAnJykge1xyXG4gICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcclxuICB9XHJcblxyXG4gIGNvbnN0IHBhcnNlZCA9IE51bWJlcih2YWx1ZSk7XHJcbiAgaWYgKGlzTmFOKHBhcnNlZCkpIHtcclxuICAgIGxvZ2dlci53YXJuKGBJbnZhbGlkIG51bWVyaWMgdmFsdWUgZm9yIGVudmlyb25tZW50IHZhcmlhYmxlOiAke3ZhbHVlfSwgdXNpbmcgZGVmYXVsdDogJHtkZWZhdWx0VmFsdWV9YCk7XHJcbiAgICByZXR1cm4gZGVmYXVsdFZhbHVlO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHBhcnNlZDtcclxufVxyXG5cclxuLyoqXHJcbiAqIFNhZmVseSBwYXJzZSBib29sZWFuIGVudmlyb25tZW50IHZhcmlhYmxlc1xyXG4gKi9cclxuZnVuY3Rpb24gcGFyc2VCb29sZWFuKHZhbHVlOiBzdHJpbmcgfCB1bmRlZmluZWQsIGRlZmF1bHRWYWx1ZTogYm9vbGVhbik6IGJvb2xlYW4ge1xyXG4gIGlmICghdmFsdWUgfHwgdmFsdWUudHJpbSgpID09PSAnJykge1xyXG4gICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcclxuICB9XHJcblxyXG4gIHJldHVybiB2YWx1ZS50b0xvd2VyQ2FzZSgpID09PSAndHJ1ZSc7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBMb2FkIGFuZCB2YWxpZGF0ZSBlbnZpcm9ubWVudCBjb25maWd1cmF0aW9uXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gbG9hZEVudmlyb25tZW50KCk6IEVudmlyb25tZW50IHtcclxuICAvLyBHZXQgZW52aXJvbm1lbnQgdmFyaWFibGVzIHdpdGggZmFsbGJhY2sgZm9yIHRlc3RpbmdcclxuICBjb25zdCBnZXRFbnZWYXIgPSAoa2V5OiBzdHJpbmcpOiBzdHJpbmcgfCB1bmRlZmluZWQgPT4ge1xyXG4gICAgaWYgKHR5cGVvZiBpbXBvcnQubWV0YSAhPT0gJ3VuZGVmaW5lZCcgJiYgKGltcG9ydC5tZXRhIGFzIGFueSkuZW52KSB7XHJcbiAgICAgIHJldHVybiAoaW1wb3J0Lm1ldGEgYXMgYW55KS5lbnZba2V5XTtcclxuICAgIH1cclxuICAgIC8vIEZhbGxiYWNrIGZvciB0ZXN0aW5nIGVudmlyb25tZW50XHJcbiAgICByZXR1cm4gKHByb2Nlc3MgYXMgYW55KS5lbnY/LltrZXldO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGVudiA9IHtcclxuICAgIEFQSV9CQVNFX1VSTDogKGdldEVudlZhcignVklURV9BUElfQkFTRV9VUkwnKSB8fCAnaHR0cDovL2xvY2FsaG9zdDozMDAxJykgKyAoZ2V0RW52VmFyKCdWSVRFX0FQSV9CQVNFX1VSTCcpPy5pbmNsdWRlcygnL2FwaScpID8gJycgOiAnL2FwaScpLFxyXG4gICAgQVBJX1RJTUVPVVQ6IHBhcnNlTnVtYmVyKGdldEVudlZhcignVklURV9BUElfVElNRU9VVCcpLCA1MDAwKSxcclxuICAgIEFJX1BST1ZJREVSOiBnZXRFbnZWYXIoJ1ZJVEVfQUlfUFJPVklERVInKSB8fCAnYW50aHJvcGljJyxcclxuICAgIENPUlNfT1JJR0lOOiBnZXRFbnZWYXIoJ1ZJVEVfQ09SU19PUklHSU4nKSB8fCAnaHR0cDovL2xvY2FsaG9zdDo1MTczJyxcclxuICAgIFJBVEVfTElNSVRfUkVRVUVTVFM6IHBhcnNlTnVtYmVyKGdldEVudlZhcignVklURV9SQVRFX0xJTUlUX1JFUVVFU1RTJyksIDEwMCksXHJcbiAgICBSQVRFX0xJTUlUX1dJTkRPVzogcGFyc2VOdW1iZXIoZ2V0RW52VmFyKCdWSVRFX1JBVEVfTElNSVRfV0lORE9XJyksIDYwMDAwKSxcclxuICAgIEVOQUJMRV9MT0dHSU5HOiBwYXJzZUJvb2xlYW4oZ2V0RW52VmFyKCdWSVRFX0VOQUJMRV9MT0dHSU5HJyksIHRydWUpLFxyXG4gICAgRU5BQkxFX01PTklUT1JJTkc6IHBhcnNlQm9vbGVhbihnZXRFbnZWYXIoJ1ZJVEVfRU5BQkxFX01PTklUT1JJTkcnKSwgZmFsc2UpLFxyXG4gICAgRU5BQkxFX0NBQ0hFOiBwYXJzZUJvb2xlYW4oZ2V0RW52VmFyKCdWSVRFX0VOQUJMRV9DQUNIRScpLCB0cnVlKSxcclxuICAgIE1BWF9GSUxFX1NJWkU6IHBhcnNlTnVtYmVyKGdldEVudlZhcignVklURV9NQVhfRklMRV9TSVpFJyksIDIwICogMTAyNCAqIDEwMjQpLFxyXG4gICAgTUFYX0NPTkNVUlJFTlRfUkVRVUVTVFM6IHBhcnNlTnVtYmVyKGdldEVudlZhcignVklURV9NQVhfQ09OQ1VSUkVOVF9SRVFVRVNUUycpLCA1KSxcclxuICAgIENBQ0hFX1RUTDogcGFyc2VOdW1iZXIoZ2V0RW52VmFyKCdWSVRFX0NBQ0hFX1RUTCcpLCAzNjAwKSxcclxuICAgIE5PREVfRU5WOiBnZXRFbnZWYXIoJ01PREUnKSB8fCAnZGV2ZWxvcG1lbnQnLFxyXG4gICAgREVCVUc6IHBhcnNlQm9vbGVhbihnZXRFbnZWYXIoJ1ZJVEVfREVCVUcnKSwgZmFsc2UpLFxyXG4gICAgUkVUUllfTUFYX0FUVEVNUFRTOiBwYXJzZU51bWJlcihnZXRFbnZWYXIoJ1ZJVEVfUkVUUllfTUFYX0FUVEVNUFRTJyksIDMpLFxyXG4gICAgUkVUUllfSU5JVElBTF9ERUxBWTogcGFyc2VOdW1iZXIoZ2V0RW52VmFyKCdWSVRFX1JFVFJZX0lOSVRJQUxfREVMQVknKSwgMTAwMCksXHJcbiAgICBSRVRSWV9NQVhfREVMQVk6IHBhcnNlTnVtYmVyKGdldEVudlZhcignVklURV9SRVRSWV9NQVhfREVMQVknKSwgMTAwMDApLFxyXG4gICAgQ0lSQ1VJVF9CUkVBS0VSX0ZBSUxVUkVfVEhSRVNIT0xEOiBwYXJzZU51bWJlcihnZXRFbnZWYXIoJ1ZJVEVfQ0lSQ1VJVF9CUkVBS0VSX0ZBSUxVUkVfVEhSRVNIT0xEJyksIDUpLFxyXG4gICAgQ0lSQ1VJVF9CUkVBS0VSX1JFU0VUX1RJTUVPVVQ6IHBhcnNlTnVtYmVyKGdldEVudlZhcignVklURV9DSVJDVUlUX0JSRUFLRVJfUkVTRVRfVElNRU9VVCcpLCA2MDAwMCksXHJcbiAgICBDSVJDVUlUX0JSRUFLRVJfU1VDQ0VTU19USFJFU0hPTEQ6IHBhcnNlTnVtYmVyKGdldEVudlZhcignVklURV9DSVJDVUlUX0JSRUFLRVJfU1VDQ0VTU19USFJFU0hPTEQnKSwgMilcclxuICB9O1xyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3QgdmFsaWRhdGVkRW52ID0gZW52U2NoZW1hLnBhcnNlKGVudik7XHJcblxyXG4gICAgbG9nZ2VyLmluZm8oJ0Vudmlyb25tZW50IGNvbmZpZ3VyYXRpb24gbG9hZGVkIHN1Y2Nlc3NmdWxseScsIHtcclxuICAgICAgbm9kZUVudjogdmFsaWRhdGVkRW52Lk5PREVfRU5WLFxyXG4gICAgICBhcGlCYXNlVXJsOiB2YWxpZGF0ZWRFbnYuQVBJX0JBU0VfVVJMLFxyXG4gICAgICBhaVByb3ZpZGVyOiB2YWxpZGF0ZWRFbnYuQUlfUFJPVklERVIsXHJcbiAgICAgIGVuYWJsZUxvZ2dpbmc6IHZhbGlkYXRlZEVudi5FTkFCTEVfTE9HR0lORyxcclxuICAgICAgZW5hYmxlQ2FjaGU6IHZhbGlkYXRlZEVudi5FTkFCTEVfQ0FDSEUsXHJcbiAgICAgIGRlYnVnOiB2YWxpZGF0ZWRFbnYuREVCVUdcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiB2YWxpZGF0ZWRFbnY7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGxvZ2dlci5lcnJvcignRW52aXJvbm1lbnQgdmFsaWRhdGlvbiBmYWlsZWQnLCB7XHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvciksXHJcbiAgICAgIGVudjogT2JqZWN0LmtleXMoZW52KS5maWx0ZXIoa2V5ID0+IGVudltrZXkgYXMga2V5b2YgdHlwZW9mIGVudl0gIT09IHVuZGVmaW5lZClcclxuICAgIH0pO1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIGVudmlyb25tZW50IGNvbmZpZ3VyYXRpb246ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpfWApO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCBlbnZpcm9ubWVudCBjb25maWd1cmF0aW9uIHdpdGggdmFsaWRhdGlvblxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGxvYWRFbnZpcm9ubWVudCgpO1xyXG5cclxuLyoqXHJcbiAqIEVudmlyb25tZW50IGNvbmZpZ3VyYXRpb24gaGVscGVyc1xyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGVudiA9IHtcclxuICAvKipcclxuICAgKiBDaGVjayBpZiBydW5uaW5nIGluIGRldmVsb3BtZW50IG1vZGVcclxuICAgKi9cclxuICBpc0RldmVsb3BtZW50OiAoKSA9PiBjb25maWcuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcsXHJcblxyXG4gIC8qKlxyXG4gICAqIENoZWNrIGlmIHJ1bm5pbmcgaW4gcHJvZHVjdGlvbiBtb2RlXHJcbiAgICovXHJcbiAgaXNQcm9kdWN0aW9uOiAoKSA9PiBjb25maWcuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJyxcclxuXHJcbiAgLyoqXHJcbiAgICogQ2hlY2sgaWYgcnVubmluZyBpbiB0ZXN0IG1vZGVcclxuICAgKi9cclxuICBpc1Rlc3Q6ICgpID0+IGNvbmZpZy5OT0RFX0VOViA9PT0gJ3Rlc3QnLFxyXG5cclxuICAvKipcclxuICAgKiBDaGVjayBpZiBkZWJ1ZyBtb2RlIGlzIGVuYWJsZWRcclxuICAgKi9cclxuICBpc0RlYnVnOiAoKSA9PiBjb25maWcuREVCVUcsXHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBBUEkgY29uZmlndXJhdGlvblxyXG4gICAqL1xyXG4gIGFwaToge1xyXG4gICAgYmFzZVVybDogKCkgPT4gY29uZmlnLkFQSV9CQVNFX1VSTCxcclxuICAgIHRpbWVvdXQ6ICgpID0+IGNvbmZpZy5BUElfVElNRU9VVCxcclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiBHZXQgQUkgcHJvdmlkZXIgY29uZmlndXJhdGlvblxyXG4gICAqL1xyXG4gIGFpOiB7XHJcbiAgICBwcm92aWRlcjogKCkgPT4gY29uZmlnLkFJX1BST1ZJREVSLFxyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBzZWN1cml0eSBjb25maWd1cmF0aW9uXHJcbiAgICovXHJcbiAgc2VjdXJpdHk6IHtcclxuICAgIGNvcnNPcmlnaW46ICgpID0+IGNvbmZpZy5DT1JTX09SSUdJTixcclxuICAgIHJhdGVMaW1pdFJlcXVlc3RzOiAoKSA9PiBjb25maWcuUkFURV9MSU1JVF9SRVFVRVNUUyxcclxuICAgIHJhdGVMaW1pdFdpbmRvdzogKCkgPT4gY29uZmlnLlJBVEVfTElNSVRfV0lORE9XLFxyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBmZWF0dXJlIGZsYWdzXHJcbiAgICovXHJcbiAgZmVhdHVyZXM6IHtcclxuICAgIGxvZ2dpbmc6ICgpID0+IGNvbmZpZy5FTkFCTEVfTE9HR0lORyxcclxuICAgIG1vbml0b3Jpbmc6ICgpID0+IGNvbmZpZy5FTkFCTEVfTU9OSVRPUklORyxcclxuICAgIGNhY2hlOiAoKSA9PiBjb25maWcuRU5BQkxFX0NBQ0hFLFxyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBwZXJmb3JtYW5jZSBjb25maWd1cmF0aW9uXHJcbiAgICovXHJcbiAgcGVyZm9ybWFuY2U6IHtcclxuICAgIG1heEZpbGVTaXplOiAoKSA9PiBjb25maWcuTUFYX0ZJTEVfU0laRSxcclxuICAgIG1heENvbmN1cnJlbnRSZXF1ZXN0czogKCkgPT4gY29uZmlnLk1BWF9DT05DVVJSRU5UX1JFUVVFU1RTLFxyXG4gICAgY2FjaGVUVEw6ICgpID0+IGNvbmZpZy5DQUNIRV9UVEwsXHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IHJldHJ5IGNvbmZpZ3VyYXRpb25cclxuICAgKi9cclxuICByZXRyeToge1xyXG4gICAgbWF4QXR0ZW1wdHM6ICgpID0+IGNvbmZpZy5SRVRSWV9NQVhfQVRURU1QVFMsXHJcbiAgICBpbml0aWFsRGVsYXk6ICgpID0+IGNvbmZpZy5SRVRSWV9JTklUSUFMX0RFTEFZLFxyXG4gICAgbWF4RGVsYXk6ICgpID0+IGNvbmZpZy5SRVRSWV9NQVhfREVMQVksXHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IGNpcmN1aXQgYnJlYWtlciBjb25maWd1cmF0aW9uXHJcbiAgICovXHJcbiAgY2lyY3VpdEJyZWFrZXI6IHtcclxuICAgIGZhaWx1cmVUaHJlc2hvbGQ6ICgpID0+IGNvbmZpZy5DSVJDVUlUX0JSRUFLRVJfRkFJTFVSRV9USFJFU0hPTEQsXHJcbiAgICByZXNldFRpbWVvdXQ6ICgpID0+IGNvbmZpZy5DSVJDVUlUX0JSRUFLRVJfUkVTRVRfVElNRU9VVCxcclxuICAgIHN1Y2Nlc3NUaHJlc2hvbGQ6ICgpID0+IGNvbmZpZy5DSVJDVUlUX0JSRUFLRVJfU1VDQ0VTU19USFJFU0hPTEQsXHJcbiAgfSxcclxufTtcclxuXHJcbi8qKlxyXG4gKiBWYWxpZGF0ZSByZXF1aXJlZCBlbnZpcm9ubWVudCB2YXJpYWJsZXMgZm9yIHByb2R1Y3Rpb25cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZVByb2R1Y3Rpb25FbnZpcm9ubWVudCgpOiB2b2lkIHtcclxuICBpZiAoZW52LmlzUHJvZHVjdGlvbigpKSB7XHJcbiAgICBjb25zdCByZXF1aXJlZFZhcnMgPSBbXHJcbiAgICAgICdBUElfQkFTRV9VUkwnLFxyXG4gICAgICAnQ09SU19PUklHSU4nXHJcbiAgICBdO1xyXG5cclxuICAgIGNvbnN0IG1pc3NpbmdWYXJzID0gcmVxdWlyZWRWYXJzLmZpbHRlcih2YXJOYW1lID0+IHtcclxuICAgICAgY29uc3QgdmFsdWUgPSBjb25maWdbdmFyTmFtZSBhcyBrZXlvZiBFbnZpcm9ubWVudF07XHJcbiAgICAgIHJldHVybiB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAnJztcclxuICAgIH0pO1xyXG5cclxuICAgIGlmIChtaXNzaW5nVmFycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgTWlzc2luZyByZXF1aXJlZCBlbnZpcm9ubWVudCB2YXJpYWJsZXMgZm9yIHByb2R1Y3Rpb246ICR7bWlzc2luZ1ZhcnMuam9pbignLCAnKX1gKTtcclxuICAgIH1cclxuXHJcbiAgICBsb2dnZXIuaW5mbygnUHJvZHVjdGlvbiBlbnZpcm9ubWVudCB2YWxpZGF0aW9uIHBhc3NlZCcpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCBlbnZpcm9ubWVudCBzdW1tYXJ5IGZvciBkZWJ1Z2dpbmdcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRFbnZpcm9ubWVudFN1bW1hcnkoKTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4ge1xyXG4gIHJldHVybiB7XHJcbiAgICBub2RlRW52OiBjb25maWcuTk9ERV9FTlYsXHJcbiAgICBkZWJ1ZzogY29uZmlnLkRFQlVHLFxyXG4gICAgYXBpQmFzZVVybDogY29uZmlnLkFQSV9CQVNFX1VSTCxcclxuICAgIGFpUHJvdmlkZXI6IGNvbmZpZy5BSV9QUk9WSURFUixcclxuICAgIGZlYXR1cmVzOiB7XHJcbiAgICAgIGxvZ2dpbmc6IGNvbmZpZy5FTkFCTEVfTE9HR0lORyxcclxuICAgICAgbW9uaXRvcmluZzogY29uZmlnLkVOQUJMRV9NT05JVE9SSU5HLFxyXG4gICAgICBjYWNoZTogY29uZmlnLkVOQUJMRV9DQUNIRSxcclxuICAgIH0sXHJcbiAgICBwZXJmb3JtYW5jZToge1xyXG4gICAgICBtYXhGaWxlU2l6ZTogYCR7Y29uZmlnLk1BWF9GSUxFX1NJWkUgLyAoMTAyNCAqIDEwMjQpfU1CYCxcclxuICAgICAgbWF4Q29uY3VycmVudFJlcXVlc3RzOiBjb25maWcuTUFYX0NPTkNVUlJFTlRfUkVRVUVTVFMsXHJcbiAgICAgIGNhY2hlVFRMOiBgJHtjb25maWcuQ0FDSEVfVFRMfXNgLFxyXG4gICAgfSxcclxuICAgIHJldHJ5OiB7XHJcbiAgICAgIG1heEF0dGVtcHRzOiBjb25maWcuUkVUUllfTUFYX0FUVEVNUFRTLFxyXG4gICAgICBpbml0aWFsRGVsYXk6IGAke2NvbmZpZy5SRVRSWV9JTklUSUFMX0RFTEFZfW1zYCxcclxuICAgICAgbWF4RGVsYXk6IGAke2NvbmZpZy5SRVRSWV9NQVhfREVMQVl9bXNgLFxyXG4gICAgfSxcclxuICAgIGNpcmN1aXRCcmVha2VyOiB7XHJcbiAgICAgIGZhaWx1cmVUaHJlc2hvbGQ6IGNvbmZpZy5DSVJDVUlUX0JSRUFLRVJfRkFJTFVSRV9USFJFU0hPTEQsXHJcbiAgICAgIHJlc2V0VGltZW91dDogYCR7Y29uZmlnLkNJUkNVSVRfQlJFQUtFUl9SRVNFVF9USU1FT1VUfW1zYCxcclxuICAgICAgc3VjY2Vzc1RocmVzaG9sZDogY29uZmlnLkNJUkNVSVRfQlJFQUtFUl9TVUNDRVNTX1RIUkVTSE9MRCxcclxuICAgIH0sXHJcbiAgfTtcclxufVxyXG4iXSwidmVyc2lvbiI6M30=