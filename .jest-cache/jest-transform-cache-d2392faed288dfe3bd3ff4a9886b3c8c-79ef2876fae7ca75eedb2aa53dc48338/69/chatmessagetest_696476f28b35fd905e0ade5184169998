5b28fb12fa54a4dfb3a3d8746ed112af
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = __importDefault(require("react"));
const react_2 = require("@testing-library/react");
const user_event_1 = __importDefault(require("@testing-library/user-event"));
const chat_message_1 = require("../../src/components/ui/chat-message");
// Mock clipboard API
Object.assign(navigator, {
    clipboard: {
        writeText: jest.fn(() => Promise.resolve()),
    },
});
describe("ChatMessage", () => {
    const mockOnCopy = jest.fn();
    const mockOnFeedback = jest.fn();
    beforeEach(() => {
        jest.clearAllMocks();
    });
    it("renders user message with correct styling", () => {
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_message_1.ChatMessage, { message: "Hello, this is a user message", isUser: true, timestamp: new Date("2024-01-01T12:00:00Z") }));
        const messageContainer = react_2.screen.getByText("Hello, this is a user message").closest("div");
        expect(messageContainer).toHaveClass("bg-primary", "text-primary-foreground");
    });
    it("renders AI message with correct styling", () => {
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_message_1.ChatMessage, { message: "Hello, this is an AI response", isUser: false, timestamp: new Date("2024-01-01T12:00:00Z") }));
        const messageContainer = react_2.screen.getByText("Hello, this is an AI response").closest("div");
        expect(messageContainer).toHaveClass("bg-muted", "text-muted-foreground");
    });
    it("displays timestamp in correct format", () => {
        const timestamp = new Date("2024-01-01T12:30:00Z");
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_message_1.ChatMessage, { message: "Test message", isUser: false, timestamp: timestamp }));
        // Should display time in HH:MM format
        expect(react_2.screen.getByText("12:30")).toBeInTheDocument();
    });
    it("shows streaming indicator for streaming messages", () => {
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_message_1.ChatMessage, { message: "Partial message", isUser: false, isStreaming: true }));
        // Streaming indicator should be present (animated cursor)
        const streamingIndicator = react_2.screen.getByText("Partial message").parentElement?.querySelector(".animate-pulse");
        expect(streamingIndicator).toBeInTheDocument();
    });
    it("displays citations with correct links", () => {
        const citations = [
            { text: "IRC Section 162", url: "https://www.irs.gov/pub/irs-pdf/p535.pdf" },
            { text: "Publication 535", url: "https://www.irs.gov/publications/p535" }
        ];
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_message_1.ChatMessage, { message: "Tax information with citations", isUser: false, citations: citations }));
        // Check sources section exists
        expect(react_2.screen.getByText("Sources:")).toBeInTheDocument();
        // Check citation links
        const ircLink = react_2.screen.getByRole("link", { name: "IRC Section 162" });
        const pubLink = react_2.screen.getByRole("link", { name: "Publication 535" });
        expect(ircLink).toHaveAttribute("href", "https://www.irs.gov/pub/irs-pdf/p535.pdf");
        expect(ircLink).toHaveAttribute("target", "_blank");
        expect(ircLink).toHaveAttribute("rel", "noopener noreferrer");
        expect(pubLink).toHaveAttribute("href", "https://www.irs.gov/publications/p535");
        expect(pubLink).toHaveAttribute("target", "_blank");
        expect(pubLink).toHaveAttribute("rel", "noopener noreferrer");
    });
    it("shows copy button for AI messages", () => {
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_message_1.ChatMessage, { message: "AI response message", isUser: false, onCopy: mockOnCopy }));
        const copyButton = react_2.screen.getByRole("button", { name: /copy message/i });
        expect(copyButton).toBeInTheDocument();
    });
    it("does not show copy button for user messages", () => {
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_message_1.ChatMessage, { message: "User message", isUser: true }));
        const copyButton = react_2.screen.queryByRole("button", { name: /copy message/i });
        expect(copyButton).not.toBeInTheDocument();
    });
    it("does not show action buttons for streaming messages", () => {
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_message_1.ChatMessage, { message: "Streaming message", isUser: false, isStreaming: true, onCopy: mockOnCopy, onFeedback: mockOnFeedback }));
        const copyButton = react_2.screen.queryByRole("button", { name: /copy message/i });
        const thumbsUpButton = react_2.screen.queryByRole("button", { name: /thumbs up/i });
        expect(copyButton).not.toBeInTheDocument();
        expect(thumbsUpButton).not.toBeInTheDocument();
    });
    it("copies message to clipboard when copy button is clicked", async () => {
        const user = user_event_1.default.setup();
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_message_1.ChatMessage, { message: "Message to copy", isUser: false, onCopy: mockOnCopy }));
        const copyButton = react_2.screen.getByRole("button", { name: /copy message/i });
        await user.click(copyButton);
        expect(navigator.clipboard.writeText).toHaveBeenCalledWith("Message to copy");
        expect(mockOnCopy).toHaveBeenCalled();
    });
    it("shows copy success toast after copying", async () => {
        const user = user_event_1.default.setup();
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_message_1.ChatMessage, { message: "Message to copy", isUser: false, onCopy: mockOnCopy }));
        const copyButton = react_2.screen.getByRole("button", { name: /copy message/i });
        await user.click(copyButton);
        expect(react_2.screen.getByText("Copied to clipboard")).toBeInTheDocument();
        // Toast should disappear after 2 seconds
        await (0, react_2.waitFor)(() => {
            expect(react_2.screen.queryByText("Copied to clipboard")).not.toBeInTheDocument();
        }, { timeout: 3000 });
    });
    it("shows feedback buttons for AI messages", () => {
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_message_1.ChatMessage, { message: "AI response", isUser: false, onFeedback: mockOnFeedback }));
        const thumbsUpButton = react_2.screen.getByRole("button", { name: /thumbs up/i });
        const thumbsDownButton = react_2.screen.getByRole("button", { name: /thumbs down/i });
        expect(thumbsUpButton).toBeInTheDocument();
        expect(thumbsDownButton).toBeInTheDocument();
    });
    it("calls onFeedback when thumbs up is clicked", async () => {
        const user = user_event_1.default.setup();
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_message_1.ChatMessage, { message: "AI response", isUser: false, onFeedback: mockOnFeedback }));
        const thumbsUpButton = react_2.screen.getByRole("button", { name: /thumbs up/i });
        await user.click(thumbsUpButton);
        expect(mockOnFeedback).toHaveBeenCalledWith("up");
    });
    it("calls onFeedback when thumbs down is clicked", async () => {
        const user = user_event_1.default.setup();
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_message_1.ChatMessage, { message: "AI response", isUser: false, onFeedback: mockOnFeedback }));
        const thumbsDownButton = react_2.screen.getByRole("button", { name: /thumbs down/i });
        await user.click(thumbsDownButton);
        expect(mockOnFeedback).toHaveBeenCalledWith("down");
    });
    it("highlights selected feedback button", () => {
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_message_1.ChatMessage, { message: "AI response", isUser: false, feedbackValue: "up", onFeedback: mockOnFeedback }));
        const thumbsUpButton = react_2.screen.getByRole("button", { name: /thumbs up/i });
        const thumbsDownButton = react_2.screen.getByRole("button", { name: /thumbs down/i });
        expect(thumbsUpButton).toHaveClass("text-green-600");
        expect(thumbsDownButton).not.toHaveClass("text-red-600");
    });
    it("preserves line breaks in message content", () => {
        const multilineMessage = "Line 1\nLine 2\nLine 3";
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_message_1.ChatMessage, { message: multilineMessage, isUser: false }));
        const messageElement = react_2.screen.getByText(multilineMessage);
        expect(messageElement).toHaveClass("whitespace-pre-wrap");
    });
    it("handles long messages with word wrapping", () => {
        const longMessage = "This is a very long message that should wrap to multiple lines when the container width is exceeded. It should break words appropriately and maintain readability.";
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_message_1.ChatMessage, { message: longMessage, isUser: false }));
        const messageElement = react_2.screen.getByText(longMessage);
        expect(messageElement).toHaveClass("break-words");
    });
    it("handles error when clipboard API fails", async () => {
        const consoleSpy = jest.spyOn(console, "error").mockImplementation(() => { });
        navigator.clipboard.writeText.mockRejectedValueOnce(new Error("Clipboard error"));
        const user = user_event_1.default.setup();
        (0, react_2.render)((0, jsx_runtime_1.jsx)(chat_message_1.ChatMessage, { message: "Message to copy", isUser: false, onCopy: mockOnCopy }));
        const copyButton = react_2.screen.getByRole("button", { name: /copy message/i });
        await user.click(copyButton);
        expect(consoleSpy).toHaveBeenCalledWith("Failed to copy message:", expect.any(Error));
        consoleSpy.mockRestore();
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxzYXJhaFxcUmVwb3NcXENDSCBBeGNlc3MgSW50ZWxsaWdlbmNlIFZpYmVkXFx0ZXN0c1xcdW5pdFxcY2hhdC1tZXNzYWdlLnRlc3QudHN4IiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLGtEQUEwQjtBQUMxQixrREFBNEU7QUFDNUUsNkVBQW9EO0FBQ3BELHVFQUFtRTtBQUVuRSxxQkFBcUI7QUFDckIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUU7SUFDdkIsU0FBUyxFQUFFO1FBQ1QsU0FBUyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDO0tBQzVDO0NBQ0YsQ0FBQyxDQUFDO0FBRUgsUUFBUSxDQUFDLGFBQWEsRUFBRSxHQUFHLEVBQUU7SUFDM0IsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO0lBQzdCLE1BQU0sY0FBYyxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztJQUVqQyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLDJDQUEyQyxFQUFFLEdBQUcsRUFBRTtRQUNuRCxJQUFBLGNBQU0sRUFDSix1QkFBQywwQkFBVyxJQUNWLE9BQU8sRUFBQywrQkFBK0IsRUFDdkMsTUFBTSxFQUFFLElBQUksRUFDWixTQUFTLEVBQUUsSUFBSSxJQUFJLENBQUMsc0JBQXNCLENBQUMsR0FDM0MsQ0FDSCxDQUFDO1FBRUYsTUFBTSxnQkFBZ0IsR0FBRyxjQUFNLENBQUMsU0FBUyxDQUFDLCtCQUErQixDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzFGLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxZQUFZLEVBQUUseUJBQXlCLENBQUMsQ0FBQztJQUNoRixDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyx5Q0FB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c1xcc2FyYWhcXFJlcG9zXFxDQ0ggQXhjZXNzIEludGVsbGlnZW5jZSBWaWJlZFxcdGVzdHNcXHVuaXRcXGNoYXQtbWVzc2FnZS50ZXN0LnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCI7XHJcbmltcG9ydCB7IHJlbmRlciwgc2NyZWVuLCBmaXJlRXZlbnQsIHdhaXRGb3IgfSBmcm9tIFwiQHRlc3RpbmctbGlicmFyeS9yZWFjdFwiO1xyXG5pbXBvcnQgdXNlckV2ZW50IGZyb20gXCJAdGVzdGluZy1saWJyYXJ5L3VzZXItZXZlbnRcIjtcclxuaW1wb3J0IHsgQ2hhdE1lc3NhZ2UgfSBmcm9tIFwiLi4vLi4vc3JjL2NvbXBvbmVudHMvdWkvY2hhdC1tZXNzYWdlXCI7XHJcblxyXG4vLyBNb2NrIGNsaXBib2FyZCBBUElcclxuT2JqZWN0LmFzc2lnbihuYXZpZ2F0b3IsIHtcclxuICBjbGlwYm9hcmQ6IHtcclxuICAgIHdyaXRlVGV4dDogamVzdC5mbigoKSA9PiBQcm9taXNlLnJlc29sdmUoKSksXHJcbiAgfSxcclxufSk7XHJcblxyXG5kZXNjcmliZShcIkNoYXRNZXNzYWdlXCIsICgpID0+IHtcclxuICBjb25zdCBtb2NrT25Db3B5ID0gamVzdC5mbigpO1xyXG4gIGNvbnN0IG1vY2tPbkZlZWRiYWNrID0gamVzdC5mbigpO1xyXG5cclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gIH0pO1xyXG5cclxuICBpdChcInJlbmRlcnMgdXNlciBtZXNzYWdlIHdpdGggY29ycmVjdCBzdHlsaW5nXCIsICgpID0+IHtcclxuICAgIHJlbmRlcihcclxuICAgICAgPENoYXRNZXNzYWdlXHJcbiAgICAgICAgbWVzc2FnZT1cIkhlbGxvLCB0aGlzIGlzIGEgdXNlciBtZXNzYWdlXCJcclxuICAgICAgICBpc1VzZXI9e3RydWV9XHJcbiAgICAgICAgdGltZXN0YW1wPXtuZXcgRGF0ZShcIjIwMjQtMDEtMDFUMTI6MDA6MDBaXCIpfVxyXG4gICAgICAvPlxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBtZXNzYWdlQ29udGFpbmVyID0gc2NyZWVuLmdldEJ5VGV4dChcIkhlbGxvLCB0aGlzIGlzIGEgdXNlciBtZXNzYWdlXCIpLmNsb3Nlc3QoXCJkaXZcIik7XHJcbiAgICBleHBlY3QobWVzc2FnZUNvbnRhaW5lcikudG9IYXZlQ2xhc3MoXCJiZy1wcmltYXJ5XCIsIFwidGV4dC1wcmltYXJ5LWZvcmVncm91bmRcIik7XHJcbiAgfSk7XHJcblxyXG4gIGl0KFwicmVuZGVycyBBSSBtZXNzYWdlIHdpdGggY29ycmVjdCBzdHlsaW5nXCIsICgpID0+IHtcclxuICAgIHJlbmRlcihcclxuICAgICAgPENoYXRNZXNzYWdlXHJcbiAgICAgICAgbWVzc2FnZT1cIkhlbGxvLCB0aGlzIGlzIGFuIEFJIHJlc3BvbnNlXCJcclxuICAgICAgICBpc1VzZXI9e2ZhbHNlfVxyXG4gICAgICAgIHRpbWVzdGFtcD17bmV3IERhdGUoXCIyMDI0LTAxLTAxVDEyOjAwOjAwWlwiKX1cclxuICAgICAgLz5cclxuICAgICk7XHJcblxyXG4gICAgY29uc3QgbWVzc2FnZUNvbnRhaW5lciA9IHNjcmVlbi5nZXRCeVRleHQoXCJIZWxsbywgdGhpcyBpcyBhbiBBSSByZXNwb25zZVwiKS5jbG9zZXN0KFwiZGl2XCIpO1xyXG4gICAgZXhwZWN0KG1lc3NhZ2VDb250YWluZXIpLnRvSGF2ZUNsYXNzKFwiYmctbXV0ZWRcIiwgXCJ0ZXh0LW11dGVkLWZvcmVncm91bmRcIik7XHJcbiAgfSk7XHJcblxyXG4gIGl0KFwiZGlzcGxheXMgdGltZXN0YW1wIGluIGNvcnJlY3QgZm9ybWF0XCIsICgpID0+IHtcclxuICAgIGNvbnN0IHRpbWVzdGFtcCA9IG5ldyBEYXRlKFwiMjAyNC0wMS0wMVQxMjozMDowMFpcIik7XHJcbiAgICByZW5kZXIoXHJcbiAgICAgIDxDaGF0TWVzc2FnZVxyXG4gICAgICAgIG1lc3NhZ2U9XCJUZXN0IG1lc3NhZ2VcIlxyXG4gICAgICAgIGlzVXNlcj17ZmFsc2V9XHJcbiAgICAgICAgdGltZXN0YW1wPXt0aW1lc3RhbXB9XHJcbiAgICAgIC8+XHJcbiAgICApO1xyXG5cclxuICAgIC8vIFNob3VsZCBkaXNwbGF5IHRpbWUgaW4gSEg6TU0gZm9ybWF0XHJcbiAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGV4dChcIjEyOjMwXCIpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xyXG4gIH0pO1xyXG5cclxuICBpdChcInNob3dzIHN0cmVhbWluZyBpbmRpY2F0b3IgZm9yIHN0cmVhbWluZyBtZXNzYWdlc1wiLCAoKSA9PiB7XHJcbiAgICByZW5kZXIoXHJcbiAgICAgIDxDaGF0TWVzc2FnZVxyXG4gICAgICAgIG1lc3NhZ2U9XCJQYXJ0aWFsIG1lc3NhZ2VcIlxyXG4gICAgICAgIGlzVXNlcj17ZmFsc2V9XHJcbiAgICAgICAgaXNTdHJlYW1pbmc9e3RydWV9XHJcbiAgICAgIC8+XHJcbiAgICApO1xyXG5cclxuICAgIC8vIFN0cmVhbWluZyBpbmRpY2F0b3Igc2hvdWxkIGJlIHByZXNlbnQgKGFuaW1hdGVkIGN1cnNvcilcclxuICAgIGNvbnN0IHN0cmVhbWluZ0luZGljYXRvciA9IHNjcmVlbi5nZXRCeVRleHQoXCJQYXJ0aWFsIG1lc3NhZ2VcIikucGFyZW50RWxlbWVudD8ucXVlcnlTZWxlY3RvcihcIi5hbmltYXRlLXB1bHNlXCIpO1xyXG4gICAgZXhwZWN0KHN0cmVhbWluZ0luZGljYXRvcikudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuICB9KTtcclxuXHJcbiAgaXQoXCJkaXNwbGF5cyBjaXRhdGlvbnMgd2l0aCBjb3JyZWN0IGxpbmtzXCIsICgpID0+IHtcclxuICAgIGNvbnN0IGNpdGF0aW9ucyA9IFtcclxuICAgICAgeyB0ZXh0OiBcIklSQyBTZWN0aW9uIDE2MlwiLCB1cmw6IFwiaHR0cHM6Ly93d3cuaXJzLmdvdi9wdWIvaXJzLXBkZi9wNTM1LnBkZlwiIH0sXHJcbiAgICAgIHsgdGV4dDogXCJQdWJsaWNhdGlvbiA1MzVcIiwgdXJsOiBcImh0dHBzOi8vd3d3Lmlycy5nb3YvcHVibGljYXRpb25zL3A1MzVcIiB9XHJcbiAgICBdO1xyXG5cclxuICAgIHJlbmRlcihcclxuICAgICAgPENoYXRNZXNzYWdlXHJcbiAgICAgICAgbWVzc2FnZT1cIlRheCBpbmZvcm1hdGlvbiB3aXRoIGNpdGF0aW9uc1wiXHJcbiAgICAgICAgaXNVc2VyPXtmYWxzZX1cclxuICAgICAgICBjaXRhdGlvbnM9e2NpdGF0aW9uc31cclxuICAgICAgLz5cclxuICAgICk7XHJcblxyXG4gICAgLy8gQ2hlY2sgc291cmNlcyBzZWN0aW9uIGV4aXN0c1xyXG4gICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRleHQoXCJTb3VyY2VzOlwiKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuICAgIFxyXG4gICAgLy8gQ2hlY2sgY2l0YXRpb24gbGlua3NcclxuICAgIGNvbnN0IGlyY0xpbmsgPSBzY3JlZW4uZ2V0QnlSb2xlKFwibGlua1wiLCB7IG5hbWU6IFwiSVJDIFNlY3Rpb24gMTYyXCIgfSk7XHJcbiAgICBjb25zdCBwdWJMaW5rID0gc2NyZWVuLmdldEJ5Um9sZShcImxpbmtcIiwgeyBuYW1lOiBcIlB1YmxpY2F0aW9uIDUzNVwiIH0pO1xyXG4gICAgXHJcbiAgICBleHBlY3QoaXJjTGluaykudG9IYXZlQXR0cmlidXRlKFwiaHJlZlwiLCBcImh0dHBzOi8vd3d3Lmlycy5nb3YvcHViL2lycy1wZGYvcDUzNS5wZGZcIik7XHJcbiAgICBleHBlY3QoaXJjTGluaykudG9IYXZlQXR0cmlidXRlKFwidGFyZ2V0XCIsIFwiX2JsYW5rXCIpO1xyXG4gICAgZXhwZWN0KGlyY0xpbmspLnRvSGF2ZUF0dHJpYnV0ZShcInJlbFwiLCBcIm5vb3BlbmVyIG5vcmVmZXJyZXJcIik7XHJcbiAgICBcclxuICAgIGV4cGVjdChwdWJMaW5rKS50b0hhdmVBdHRyaWJ1dGUoXCJocmVmXCIsIFwiaHR0cHM6Ly93d3cuaXJzLmdvdi9wdWJsaWNhdGlvbnMvcDUzNVwiKTtcclxuICAgIGV4cGVjdChwdWJMaW5rKS50b0hhdmVBdHRyaWJ1dGUoXCJ0YXJnZXRcIiwgXCJfYmxhbmtcIik7XHJcbiAgICBleHBlY3QocHViTGluaykudG9IYXZlQXR0cmlidXRlKFwicmVsXCIsIFwibm9vcGVuZXIgbm9yZWZlcnJlclwiKTtcclxuICB9KTtcclxuXHJcbiAgaXQoXCJzaG93cyBjb3B5IGJ1dHRvbiBmb3IgQUkgbWVzc2FnZXNcIiwgKCkgPT4ge1xyXG4gICAgcmVuZGVyKFxyXG4gICAgICA8Q2hhdE1lc3NhZ2VcclxuICAgICAgICBtZXNzYWdlPVwiQUkgcmVzcG9uc2UgbWVzc2FnZVwiXHJcbiAgICAgICAgaXNVc2VyPXtmYWxzZX1cclxuICAgICAgICBvbkNvcHk9e21vY2tPbkNvcHl9XHJcbiAgICAgIC8+XHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IGNvcHlCdXR0b24gPSBzY3JlZW4uZ2V0QnlSb2xlKFwiYnV0dG9uXCIsIHsgbmFtZTogL2NvcHkgbWVzc2FnZS9pIH0pO1xyXG4gICAgZXhwZWN0KGNvcHlCdXR0b24pLnRvQmVJblRoZURvY3VtZW50KCk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KFwiZG9lcyBub3Qgc2hvdyBjb3B5IGJ1dHRvbiBmb3IgdXNlciBtZXNzYWdlc1wiLCAoKSA9PiB7XHJcbiAgICByZW5kZXIoXHJcbiAgICAgIDxDaGF0TWVzc2FnZVxyXG4gICAgICAgIG1lc3NhZ2U9XCJVc2VyIG1lc3NhZ2VcIlxyXG4gICAgICAgIGlzVXNlcj17dHJ1ZX1cclxuICAgICAgLz5cclxuICAgICk7XHJcblxyXG4gICAgY29uc3QgY29weUJ1dHRvbiA9IHNjcmVlbi5xdWVyeUJ5Um9sZShcImJ1dHRvblwiLCB7IG5hbWU6IC9jb3B5IG1lc3NhZ2UvaSB9KTtcclxuICAgIGV4cGVjdChjb3B5QnV0dG9uKS5ub3QudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuICB9KTtcclxuXHJcbiAgaXQoXCJkb2VzIG5vdCBzaG93IGFjdGlvbiBidXR0b25zIGZvciBzdHJlYW1pbmcgbWVzc2FnZXNcIiwgKCkgPT4ge1xyXG4gICAgcmVuZGVyKFxyXG4gICAgICA8Q2hhdE1lc3NhZ2VcclxuICAgICAgICBtZXNzYWdlPVwiU3RyZWFtaW5nIG1lc3NhZ2VcIlxyXG4gICAgICAgIGlzVXNlcj17ZmFsc2V9XHJcbiAgICAgICAgaXNTdHJlYW1pbmc9e3RydWV9XHJcbiAgICAgICAgb25Db3B5PXttb2NrT25Db3B5fVxyXG4gICAgICAgIG9uRmVlZGJhY2s9e21vY2tPbkZlZWRiYWNrfVxyXG4gICAgICAvPlxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBjb3B5QnV0dG9uID0gc2NyZWVuLnF1ZXJ5QnlSb2xlKFwiYnV0dG9uXCIsIHsgbmFtZTogL2NvcHkgbWVzc2FnZS9pIH0pO1xyXG4gICAgY29uc3QgdGh1bWJzVXBCdXR0b24gPSBzY3JlZW4ucXVlcnlCeVJvbGUoXCJidXR0b25cIiwgeyBuYW1lOiAvdGh1bWJzIHVwL2kgfSk7XHJcbiAgICBcclxuICAgIGV4cGVjdChjb3B5QnV0dG9uKS5ub3QudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuICAgIGV4cGVjdCh0aHVtYnNVcEJ1dHRvbikubm90LnRvQmVJblRoZURvY3VtZW50KCk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KFwiY29waWVzIG1lc3NhZ2UgdG8gY2xpcGJvYXJkIHdoZW4gY29weSBidXR0b24gaXMgY2xpY2tlZFwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCB1c2VyID0gdXNlckV2ZW50LnNldHVwKCk7XHJcbiAgICByZW5kZXIoXHJcbiAgICAgIDxDaGF0TWVzc2FnZVxyXG4gICAgICAgIG1lc3NhZ2U9XCJNZXNzYWdlIHRvIGNvcHlcIlxyXG4gICAgICAgIGlzVXNlcj17ZmFsc2V9XHJcbiAgICAgICAgb25Db3B5PXttb2NrT25Db3B5fVxyXG4gICAgICAvPlxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBjb3B5QnV0dG9uID0gc2NyZWVuLmdldEJ5Um9sZShcImJ1dHRvblwiLCB7IG5hbWU6IC9jb3B5IG1lc3NhZ2UvaSB9KTtcclxuICAgIGF3YWl0IHVzZXIuY2xpY2soY29weUJ1dHRvbik7XHJcblxyXG4gICAgZXhwZWN0KG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcIk1lc3NhZ2UgdG8gY29weVwiKTtcclxuICAgIGV4cGVjdChtb2NrT25Db3B5KS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KFwic2hvd3MgY29weSBzdWNjZXNzIHRvYXN0IGFmdGVyIGNvcHlpbmdcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgdXNlciA9IHVzZXJFdmVudC5zZXR1cCgpO1xyXG4gICAgcmVuZGVyKFxyXG4gICAgICA8Q2hhdE1lc3NhZ2VcclxuICAgICAgICBtZXNzYWdlPVwiTWVzc2FnZSB0byBjb3B5XCJcclxuICAgICAgICBpc1VzZXI9e2ZhbHNlfVxyXG4gICAgICAgIG9uQ29weT17bW9ja09uQ29weX1cclxuICAgICAgLz5cclxuICAgICk7XHJcblxyXG4gICAgY29uc3QgY29weUJ1dHRvbiA9IHNjcmVlbi5nZXRCeVJvbGUoXCJidXR0b25cIiwgeyBuYW1lOiAvY29weSBtZXNzYWdlL2kgfSk7XHJcbiAgICBhd2FpdCB1c2VyLmNsaWNrKGNvcHlCdXR0b24pO1xyXG5cclxuICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXh0KFwiQ29waWVkIHRvIGNsaXBib2FyZFwiKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuICAgIFxyXG4gICAgLy8gVG9hc3Qgc2hvdWxkIGRpc2FwcGVhciBhZnRlciAyIHNlY29uZHNcclxuICAgIGF3YWl0IHdhaXRGb3IoXHJcbiAgICAgICgpID0+IHtcclxuICAgICAgICBleHBlY3Qoc2NyZWVuLnF1ZXJ5QnlUZXh0KFwiQ29waWVkIHRvIGNsaXBib2FyZFwiKSkubm90LnRvQmVJblRoZURvY3VtZW50KCk7XHJcbiAgICAgIH0sXHJcbiAgICAgIHsgdGltZW91dDogMzAwMCB9XHJcbiAgICApO1xyXG4gIH0pO1xyXG5cclxuICBpdChcInNob3dzIGZlZWRiYWNrIGJ1dHRvbnMgZm9yIEFJIG1lc3NhZ2VzXCIsICgpID0+IHtcclxuICAgIHJlbmRlcihcclxuICAgICAgPENoYXRNZXNzYWdlXHJcbiAgICAgICAgbWVzc2FnZT1cIkFJIHJlc3BvbnNlXCJcclxuICAgICAgICBpc1VzZXI9e2ZhbHNlfVxyXG4gICAgICAgIG9uRmVlZGJhY2s9e21vY2tPbkZlZWRiYWNrfVxyXG4gICAgICAvPlxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCB0aHVtYnNVcEJ1dHRvbiA9IHNjcmVlbi5nZXRCeVJvbGUoXCJidXR0b25cIiwgeyBuYW1lOiAvdGh1bWJzIHVwL2kgfSk7XHJcbiAgICBjb25zdCB0aHVtYnNEb3duQnV0dG9uID0gc2NyZWVuLmdldEJ5Um9sZShcImJ1dHRvblwiLCB7IG5hbWU6IC90aHVtYnMgZG93bi9pIH0pO1xyXG4gICAgXHJcbiAgICBleHBlY3QodGh1bWJzVXBCdXR0b24pLnRvQmVJblRoZURvY3VtZW50KCk7XHJcbiAgICBleHBlY3QodGh1bWJzRG93bkJ1dHRvbikudG9CZUluVGhlRG9jdW1lbnQoKTtcclxuICB9KTtcclxuXHJcbiAgaXQoXCJjYWxscyBvbkZlZWRiYWNrIHdoZW4gdGh1bWJzIHVwIGlzIGNsaWNrZWRcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgdXNlciA9IHVzZXJFdmVudC5zZXR1cCgpO1xyXG4gICAgcmVuZGVyKFxyXG4gICAgICA8Q2hhdE1lc3NhZ2VcclxuICAgICAgICBtZXNzYWdlPVwiQUkgcmVzcG9uc2VcIlxyXG4gICAgICAgIGlzVXNlcj17ZmFsc2V9XHJcbiAgICAgICAgb25GZWVkYmFjaz17bW9ja09uRmVlZGJhY2t9XHJcbiAgICAgIC8+XHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IHRodW1ic1VwQnV0dG9uID0gc2NyZWVuLmdldEJ5Um9sZShcImJ1dHRvblwiLCB7IG5hbWU6IC90aHVtYnMgdXAvaSB9KTtcclxuICAgIGF3YWl0IHVzZXIuY2xpY2sodGh1bWJzVXBCdXR0b24pO1xyXG5cclxuICAgIGV4cGVjdChtb2NrT25GZWVkYmFjaykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXCJ1cFwiKTtcclxuICB9KTtcclxuXHJcbiAgaXQoXCJjYWxscyBvbkZlZWRiYWNrIHdoZW4gdGh1bWJzIGRvd24gaXMgY2xpY2tlZFwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zdCB1c2VyID0gdXNlckV2ZW50LnNldHVwKCk7XHJcbiAgICByZW5kZXIoXHJcbiAgICAgIDxDaGF0TWVzc2FnZVxyXG4gICAgICAgIG1lc3NhZ2U9XCJBSSByZXNwb25zZVwiXHJcbiAgICAgICAgaXNVc2VyPXtmYWxzZX1cclxuICAgICAgICBvbkZlZWRiYWNrPXttb2NrT25GZWVkYmFja31cclxuICAgICAgLz5cclxuICAgICk7XHJcblxyXG4gICAgY29uc3QgdGh1bWJzRG93bkJ1dHRvbiA9IHNjcmVlbi5nZXRCeVJvbGUoXCJidXR0b25cIiwgeyBuYW1lOiAvdGh1bWJzIGRvd24vaSB9KTtcclxuICAgIGF3YWl0IHVzZXIuY2xpY2sodGh1bWJzRG93bkJ1dHRvbik7XHJcblxyXG4gICAgZXhwZWN0KG1vY2tPbkZlZWRiYWNrKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcImRvd25cIik7XHJcbiAgfSk7XHJcblxyXG4gIGl0KFwiaGlnaGxpZ2h0cyBzZWxlY3RlZCBmZWVkYmFjayBidXR0b25cIiwgKCkgPT4ge1xyXG4gICAgcmVuZGVyKFxyXG4gICAgICA8Q2hhdE1lc3NhZ2VcclxuICAgICAgICBtZXNzYWdlPVwiQUkgcmVzcG9uc2VcIlxyXG4gICAgICAgIGlzVXNlcj17ZmFsc2V9XHJcbiAgICAgICAgZmVlZGJhY2tWYWx1ZT1cInVwXCJcclxuICAgICAgICBvbkZlZWRiYWNrPXttb2NrT25GZWVkYmFja31cclxuICAgICAgLz5cclxuICAgICk7XHJcblxyXG4gICAgY29uc3QgdGh1bWJzVXBCdXR0b24gPSBzY3JlZW4uZ2V0QnlSb2xlKFwiYnV0dG9uXCIsIHsgbmFtZTogL3RodW1icyB1cC9pIH0pO1xyXG4gICAgY29uc3QgdGh1bWJzRG93bkJ1dHRvbiA9IHNjcmVlbi5nZXRCeVJvbGUoXCJidXR0b25cIiwgeyBuYW1lOiAvdGh1bWJzIGRvd24vaSB9KTtcclxuICAgIFxyXG4gICAgZXhwZWN0KHRodW1ic1VwQnV0dG9uKS50b0hhdmVDbGFzcyhcInRleHQtZ3JlZW4tNjAwXCIpO1xyXG4gICAgZXhwZWN0KHRodW1ic0Rvd25CdXR0b24pLm5vdC50b0hhdmVDbGFzcyhcInRleHQtcmVkLTYwMFwiKTtcclxuICB9KTtcclxuXHJcbiAgaXQoXCJwcmVzZXJ2ZXMgbGluZSBicmVha3MgaW4gbWVzc2FnZSBjb250ZW50XCIsICgpID0+IHtcclxuICAgIGNvbnN0IG11bHRpbGluZU1lc3NhZ2UgPSBcIkxpbmUgMVxcbkxpbmUgMlxcbkxpbmUgM1wiO1xyXG4gICAgcmVuZGVyKFxyXG4gICAgICA8Q2hhdE1lc3NhZ2VcclxuICAgICAgICBtZXNzYWdlPXttdWx0aWxpbmVNZXNzYWdlfVxyXG4gICAgICAgIGlzVXNlcj17ZmFsc2V9XHJcbiAgICAgIC8+XHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IG1lc3NhZ2VFbGVtZW50ID0gc2NyZWVuLmdldEJ5VGV4dChtdWx0aWxpbmVNZXNzYWdlKTtcclxuICAgIGV4cGVjdChtZXNzYWdlRWxlbWVudCkudG9IYXZlQ2xhc3MoXCJ3aGl0ZXNwYWNlLXByZS13cmFwXCIpO1xyXG4gIH0pO1xyXG5cclxuICBpdChcImhhbmRsZXMgbG9uZyBtZXNzYWdlcyB3aXRoIHdvcmQgd3JhcHBpbmdcIiwgKCkgPT4ge1xyXG4gICAgY29uc3QgbG9uZ01lc3NhZ2UgPSBcIlRoaXMgaXMgYSB2ZXJ5IGxvbmcgbWVzc2FnZSB0aGF0IHNob3VsZCB3cmFwIHRvIG11bHRpcGxlIGxpbmVzIHdoZW4gdGhlIGNvbnRhaW5lciB3aWR0aCBpcyBleGNlZWRlZC4gSXQgc2hvdWxkIGJyZWFrIHdvcmRzIGFwcHJvcHJpYXRlbHkgYW5kIG1haW50YWluIHJlYWRhYmlsaXR5LlwiO1xyXG4gICAgXHJcbiAgICByZW5kZXIoXHJcbiAgICAgIDxDaGF0TWVzc2FnZVxyXG4gICAgICAgIG1lc3NhZ2U9e2xvbmdNZXNzYWdlfVxyXG4gICAgICAgIGlzVXNlcj17ZmFsc2V9XHJcbiAgICAgIC8+XHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IG1lc3NhZ2VFbGVtZW50ID0gc2NyZWVuLmdldEJ5VGV4dChsb25nTWVzc2FnZSk7XHJcbiAgICBleHBlY3QobWVzc2FnZUVsZW1lbnQpLnRvSGF2ZUNsYXNzKFwiYnJlYWstd29yZHNcIik7XHJcbiAgfSk7XHJcblxyXG4gIGl0KFwiaGFuZGxlcyBlcnJvciB3aGVuIGNsaXBib2FyZCBBUEkgZmFpbHNcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgY29uc29sZVNweSA9IGplc3Quc3B5T24oY29uc29sZSwgXCJlcnJvclwiKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge30pO1xyXG4gICAgKG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0IGFzIGplc3QuTW9jaykubW9ja1JlamVjdGVkVmFsdWVPbmNlKG5ldyBFcnJvcihcIkNsaXBib2FyZCBlcnJvclwiKSk7XHJcbiAgICBcclxuICAgIGNvbnN0IHVzZXIgPSB1c2VyRXZlbnQuc2V0dXAoKTtcclxuICAgIHJlbmRlcihcclxuICAgICAgPENoYXRNZXNzYWdlXHJcbiAgICAgICAgbWVzc2FnZT1cIk1lc3NhZ2UgdG8gY29weVwiXHJcbiAgICAgICAgaXNVc2VyPXtmYWxzZX1cclxuICAgICAgICBvbkNvcHk9e21vY2tPbkNvcHl9XHJcbiAgICAgIC8+XHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IGNvcHlCdXR0b24gPSBzY3JlZW4uZ2V0QnlSb2xlKFwiYnV0dG9uXCIsIHsgbmFtZTogL2NvcHkgbWVzc2FnZS9pIH0pO1xyXG4gICAgYXdhaXQgdXNlci5jbGljayhjb3B5QnV0dG9uKTtcclxuXHJcbiAgICBleHBlY3QoY29uc29sZVNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXCJGYWlsZWQgdG8gY29weSBtZXNzYWdlOlwiLCBleHBlY3QuYW55KEVycm9yKSk7XHJcbiAgICBjb25zb2xlU3B5Lm1vY2tSZXN0b3JlKCk7XHJcbiAgfSk7XHJcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==